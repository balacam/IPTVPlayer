const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-DlcESI5x.js","./index-D-eiEXcv.js","./index-DjOSsFYa.js"])))=>i.map(i=>d[i]);
(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();function ux(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Wv={exports:{}},Bl={},zv={exports:{}},ye={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ra=Symbol.for("react.element"),cx=Symbol.for("react.portal"),dx=Symbol.for("react.fragment"),fx=Symbol.for("react.strict_mode"),hx=Symbol.for("react.profiler"),gx=Symbol.for("react.provider"),px=Symbol.for("react.context"),mx=Symbol.for("react.forward_ref"),vx=Symbol.for("react.suspense"),yx=Symbol.for("react.memo"),Sx=Symbol.for("react.lazy"),Ip=Symbol.iterator;function Ex(r){return r===null||typeof r!="object"?null:(r=Ip&&r[Ip]||r["@@iterator"],typeof r=="function"?r:null)}var qv={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Yv=Object.assign,Zv={};function pi(r,e,t){this.props=r,this.context=e,this.refs=Zv,this.updater=t||qv}pi.prototype.isReactComponent={};pi.prototype.setState=function(r,e){if(typeof r!="object"&&typeof r!="function"&&r!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,r,e,"setState")};pi.prototype.forceUpdate=function(r){this.updater.enqueueForceUpdate(this,r,"forceUpdate")};function Qv(){}Qv.prototype=pi.prototype;function Qh(r,e,t){this.props=r,this.context=e,this.refs=Zv,this.updater=t||qv}var Xh=Qh.prototype=new Qv;Xh.constructor=Qh;Yv(Xh,pi.prototype);Xh.isPureReactComponent=!0;var bp=Array.isArray,Xv=Object.prototype.hasOwnProperty,Jh={current:null},Jv={key:!0,ref:!0,__self:!0,__source:!0};function ey(r,e,t){var n,s={},i=null,a=null;if(e!=null)for(n in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(i=""+e.key),e)Xv.call(e,n)&&!Jv.hasOwnProperty(n)&&(s[n]=e[n]);var o=arguments.length-2;if(o===1)s.children=t;else if(1<o){for(var l=Array(o),u=0;u<o;u++)l[u]=arguments[u+2];s.children=l}if(r&&r.defaultProps)for(n in o=r.defaultProps,o)s[n]===void 0&&(s[n]=o[n]);return{$$typeof:Ra,type:r,key:i,ref:a,props:s,_owner:Jh.current}}function _x(r,e){return{$$typeof:Ra,type:r.type,key:e,ref:r.ref,props:r.props,_owner:r._owner}}function eg(r){return typeof r=="object"&&r!==null&&r.$$typeof===Ra}function Tx(r){var e={"=":"=0",":":"=2"};return"$"+r.replace(/[=:]/g,function(t){return e[t]})}var Rp=/\/+/g;function uu(r,e){return typeof r=="object"&&r!==null&&r.key!=null?Tx(""+r.key):e.toString(36)}function Mo(r,e,t,n,s){var i=typeof r;(i==="undefined"||i==="boolean")&&(r=null);var a=!1;if(r===null)a=!0;else switch(i){case"string":case"number":a=!0;break;case"object":switch(r.$$typeof){case Ra:case cx:a=!0}}if(a)return a=r,s=s(a),r=n===""?"."+uu(a,0):n,bp(s)?(t="",r!=null&&(t=r.replace(Rp,"$&/")+"/"),Mo(s,e,t,"",function(u){return u})):s!=null&&(eg(s)&&(s=_x(s,t+(!s.key||a&&a.key===s.key?"":(""+s.key).replace(Rp,"$&/")+"/")+r)),e.push(s)),1;if(a=0,n=n===""?".":n+":",bp(r))for(var o=0;o<r.length;o++){i=r[o];var l=n+uu(i,o);a+=Mo(i,e,t,l,s)}else if(l=Ex(r),typeof l=="function")for(r=l.call(r),o=0;!(i=r.next()).done;)i=i.value,l=n+uu(i,o++),a+=Mo(i,e,t,l,s);else if(i==="object")throw e=String(r),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function za(r,e,t){if(r==null)return r;var n=[],s=0;return Mo(r,n,"","",function(i){return e.call(t,i,s++)}),n}function xx(r){if(r._status===-1){var e=r._result;e=e(),e.then(function(t){(r._status===0||r._status===-1)&&(r._status=1,r._result=t)},function(t){(r._status===0||r._status===-1)&&(r._status=2,r._result=t)}),r._status===-1&&(r._status=0,r._result=e)}if(r._status===1)return r._result.default;throw r._result}var bt={current:null},No={transition:null},Ax={ReactCurrentDispatcher:bt,ReactCurrentBatchConfig:No,ReactCurrentOwner:Jh};function ty(){throw Error("act(...) is not supported in production builds of React.")}ye.Children={map:za,forEach:function(r,e,t){za(r,function(){e.apply(this,arguments)},t)},count:function(r){var e=0;return za(r,function(){e++}),e},toArray:function(r){return za(r,function(e){return e})||[]},only:function(r){if(!eg(r))throw Error("React.Children.only expected to receive a single React element child.");return r}};ye.Component=pi;ye.Fragment=dx;ye.Profiler=hx;ye.PureComponent=Qh;ye.StrictMode=fx;ye.Suspense=vx;ye.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ax;ye.act=ty;ye.cloneElement=function(r,e,t){if(r==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+r+".");var n=Yv({},r.props),s=r.key,i=r.ref,a=r._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,a=Jh.current),e.key!==void 0&&(s=""+e.key),r.type&&r.type.defaultProps)var o=r.type.defaultProps;for(l in e)Xv.call(e,l)&&!Jv.hasOwnProperty(l)&&(n[l]=e[l]===void 0&&o!==void 0?o[l]:e[l])}var l=arguments.length-2;if(l===1)n.children=t;else if(1<l){o=Array(l);for(var u=0;u<l;u++)o[u]=arguments[u+2];n.children=o}return{$$typeof:Ra,type:r.type,key:s,ref:i,props:n,_owner:a}};ye.createContext=function(r){return r={$$typeof:px,_currentValue:r,_currentValue2:r,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},r.Provider={$$typeof:gx,_context:r},r.Consumer=r};ye.createElement=ey;ye.createFactory=function(r){var e=ey.bind(null,r);return e.type=r,e};ye.createRef=function(){return{current:null}};ye.forwardRef=function(r){return{$$typeof:mx,render:r}};ye.isValidElement=eg;ye.lazy=function(r){return{$$typeof:Sx,_payload:{_status:-1,_result:r},_init:xx}};ye.memo=function(r,e){return{$$typeof:yx,type:r,compare:e===void 0?null:e}};ye.startTransition=function(r){var e=No.transition;No.transition={};try{r()}finally{No.transition=e}};ye.unstable_act=ty;ye.useCallback=function(r,e){return bt.current.useCallback(r,e)};ye.useContext=function(r){return bt.current.useContext(r)};ye.useDebugValue=function(){};ye.useDeferredValue=function(r){return bt.current.useDeferredValue(r)};ye.useEffect=function(r,e){return bt.current.useEffect(r,e)};ye.useId=function(){return bt.current.useId()};ye.useImperativeHandle=function(r,e,t){return bt.current.useImperativeHandle(r,e,t)};ye.useInsertionEffect=function(r,e){return bt.current.useInsertionEffect(r,e)};ye.useLayoutEffect=function(r,e){return bt.current.useLayoutEffect(r,e)};ye.useMemo=function(r,e){return bt.current.useMemo(r,e)};ye.useReducer=function(r,e,t){return bt.current.useReducer(r,e,t)};ye.useRef=function(r){return bt.current.useRef(r)};ye.useState=function(r){return bt.current.useState(r)};ye.useSyncExternalStore=function(r,e,t){return bt.current.useSyncExternalStore(r,e,t)};ye.useTransition=function(){return bt.current.useTransition()};ye.version="18.3.1";zv.exports=ye;var re=zv.exports;const ry=ux(re);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wx=re,Ix=Symbol.for("react.element"),bx=Symbol.for("react.fragment"),Rx=Object.prototype.hasOwnProperty,Lx=wx.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,kx={key:!0,ref:!0,__self:!0,__source:!0};function ny(r,e,t){var n,s={},i=null,a=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(a=e.ref);for(n in e)Rx.call(e,n)&&!kx.hasOwnProperty(n)&&(s[n]=e[n]);if(r&&r.defaultProps)for(n in e=r.defaultProps,e)s[n]===void 0&&(s[n]=e[n]);return{$$typeof:Ix,type:r,key:i,ref:a,props:s,_owner:Lx.current}}Bl.Fragment=bx;Bl.jsx=ny;Bl.jsxs=ny;Wv.exports=Bl;var C=Wv.exports,Rc={},sy={exports:{}},rr={},iy={exports:{}},ay={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(r){function e(k,F){var U=k.length;k.push(F);e:for(;0<U;){var B=U-1>>>1,G=k[B];if(0<s(G,F))k[B]=F,k[U]=G,U=B;else break e}}function t(k){return k.length===0?null:k[0]}function n(k){if(k.length===0)return null;var F=k[0],U=k.pop();if(U!==F){k[0]=U;e:for(var B=0,G=k.length,ie=G>>>1;B<ie;){var ne=2*(B+1)-1,oe=k[ne],le=ne+1,Ie=k[le];if(0>s(oe,U))le<G&&0>s(Ie,oe)?(k[B]=Ie,k[le]=U,B=le):(k[B]=oe,k[ne]=U,B=ne);else if(le<G&&0>s(Ie,U))k[B]=Ie,k[le]=U,B=le;else break e}}return F}function s(k,F){var U=k.sortIndex-F.sortIndex;return U!==0?U:k.id-F.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;r.unstable_now=function(){return i.now()}}else{var a=Date,o=a.now();r.unstable_now=function(){return a.now()-o}}var l=[],u=[],c=1,d=null,f=3,h=!1,g=!1,p=!1,v=typeof setTimeout=="function"?setTimeout:null,m=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function S(k){for(var F=t(u);F!==null;){if(F.callback===null)n(u);else if(F.startTime<=k)n(u),F.sortIndex=F.expirationTime,e(l,F);else break;F=t(u)}}function E(k){if(p=!1,S(k),!g)if(t(l)!==null)g=!0,N(T);else{var F=t(u);F!==null&&P(E,F.startTime-k)}}function T(k,F){g=!1,p&&(p=!1,m(w),w=-1),h=!0;var U=f;try{for(S(F),d=t(l);d!==null&&(!(d.expirationTime>F)||k&&!M());){var B=d.callback;if(typeof B=="function"){d.callback=null,f=d.priorityLevel;var G=B(d.expirationTime<=F);F=r.unstable_now(),typeof G=="function"?d.callback=G:d===t(l)&&n(l),S(F)}else n(l);d=t(l)}if(d!==null)var ie=!0;else{var ne=t(u);ne!==null&&P(E,ne.startTime-F),ie=!1}return ie}finally{d=null,f=U,h=!1}}var A=!1,x=null,w=-1,b=5,I=-1;function M(){return!(r.unstable_now()-I<b)}function K(){if(x!==null){var k=r.unstable_now();I=k;var F=!0;try{F=x(!0,k)}finally{F?z():(A=!1,x=null)}}else A=!1}var z;if(typeof y=="function")z=function(){y(K)};else if(typeof MessageChannel<"u"){var X=new MessageChannel,Q=X.port2;X.port1.onmessage=K,z=function(){Q.postMessage(null)}}else z=function(){v(K,0)};function N(k){x=k,A||(A=!0,z())}function P(k,F){w=v(function(){k(r.unstable_now())},F)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(k){k.callback=null},r.unstable_continueExecution=function(){g||h||(g=!0,N(T))},r.unstable_forceFrameRate=function(k){0>k||125<k?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):b=0<k?Math.floor(1e3/k):5},r.unstable_getCurrentPriorityLevel=function(){return f},r.unstable_getFirstCallbackNode=function(){return t(l)},r.unstable_next=function(k){switch(f){case 1:case 2:case 3:var F=3;break;default:F=f}var U=f;f=F;try{return k()}finally{f=U}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(k,F){switch(k){case 1:case 2:case 3:case 4:case 5:break;default:k=3}var U=f;f=k;try{return F()}finally{f=U}},r.unstable_scheduleCallback=function(k,F,U){var B=r.unstable_now();switch(typeof U=="object"&&U!==null?(U=U.delay,U=typeof U=="number"&&0<U?B+U:B):U=B,k){case 1:var G=-1;break;case 2:G=250;break;case 5:G=1073741823;break;case 4:G=1e4;break;default:G=5e3}return G=U+G,k={id:c++,callback:F,priorityLevel:k,startTime:U,expirationTime:G,sortIndex:-1},U>B?(k.sortIndex=U,e(u,k),t(l)===null&&k===t(u)&&(p?(m(w),w=-1):p=!0,P(E,U-B))):(k.sortIndex=G,e(l,k),g||h||(g=!0,N(T))),k},r.unstable_shouldYield=M,r.unstable_wrapCallback=function(k){var F=f;return function(){var U=f;f=F;try{return k.apply(this,arguments)}finally{f=U}}}})(ay);iy.exports=ay;var Cx=iy.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Px=re,tr=Cx;function Z(r){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+r,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+r+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var oy=new Set,Xi={};function ds(r,e){ai(r,e),ai(r+"Capture",e)}function ai(r,e){for(Xi[r]=e,r=0;r<e.length;r++)oy.add(e[r])}var Xr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Lc=Object.prototype.hasOwnProperty,Dx=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Lp={},kp={};function Ox(r){return Lc.call(kp,r)?!0:Lc.call(Lp,r)?!1:Dx.test(r)?kp[r]=!0:(Lp[r]=!0,!1)}function Mx(r,e,t,n){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return n?!1:t!==null?!t.acceptsBooleans:(r=r.toLowerCase().slice(0,5),r!=="data-"&&r!=="aria-");default:return!1}}function Nx(r,e,t,n){if(e===null||typeof e>"u"||Mx(r,e,t,n))return!0;if(n)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Rt(r,e,t,n,s,i,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=n,this.attributeNamespace=s,this.mustUseProperty=t,this.propertyName=r,this.type=e,this.sanitizeURL=i,this.removeEmptyString=a}var gt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(r){gt[r]=new Rt(r,0,!1,r,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(r){var e=r[0];gt[e]=new Rt(e,1,!1,r[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(r){gt[r]=new Rt(r,2,!1,r.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(r){gt[r]=new Rt(r,2,!1,r,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(r){gt[r]=new Rt(r,3,!1,r.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(r){gt[r]=new Rt(r,3,!0,r,null,!1,!1)});["capture","download"].forEach(function(r){gt[r]=new Rt(r,4,!1,r,null,!1,!1)});["cols","rows","size","span"].forEach(function(r){gt[r]=new Rt(r,6,!1,r,null,!1,!1)});["rowSpan","start"].forEach(function(r){gt[r]=new Rt(r,5,!1,r.toLowerCase(),null,!1,!1)});var tg=/[\-:]([a-z])/g;function rg(r){return r[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(r){var e=r.replace(tg,rg);gt[e]=new Rt(e,1,!1,r,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(r){var e=r.replace(tg,rg);gt[e]=new Rt(e,1,!1,r,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(r){var e=r.replace(tg,rg);gt[e]=new Rt(e,1,!1,r,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(r){gt[r]=new Rt(r,1,!1,r.toLowerCase(),null,!1,!1)});gt.xlinkHref=new Rt("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(r){gt[r]=new Rt(r,1,!1,r.toLowerCase(),null,!0,!0)});function ng(r,e,t,n){var s=gt.hasOwnProperty(e)?gt[e]:null;(s!==null?s.type!==0:n||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Nx(e,t,s,n)&&(t=null),n||s===null?Ox(e)&&(t===null?r.removeAttribute(e):r.setAttribute(e,""+t)):s.mustUseProperty?r[s.propertyName]=t===null?s.type===3?!1:"":t:(e=s.attributeName,n=s.attributeNamespace,t===null?r.removeAttribute(e):(s=s.type,t=s===3||s===4&&t===!0?"":""+t,n?r.setAttributeNS(n,e,t):r.setAttribute(e,t))))}var rn=Px.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,qa=Symbol.for("react.element"),Ms=Symbol.for("react.portal"),Ns=Symbol.for("react.fragment"),sg=Symbol.for("react.strict_mode"),kc=Symbol.for("react.profiler"),ly=Symbol.for("react.provider"),uy=Symbol.for("react.context"),ig=Symbol.for("react.forward_ref"),Cc=Symbol.for("react.suspense"),Pc=Symbol.for("react.suspense_list"),ag=Symbol.for("react.memo"),hn=Symbol.for("react.lazy"),cy=Symbol.for("react.offscreen"),Cp=Symbol.iterator;function xi(r){return r===null||typeof r!="object"?null:(r=Cp&&r[Cp]||r["@@iterator"],typeof r=="function"?r:null)}var Ke=Object.assign,cu;function Pi(r){if(cu===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);cu=e&&e[1]||""}return`
`+cu+r}var du=!1;function fu(r,e){if(!r||du)return"";du=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var n=u}Reflect.construct(r,[],e)}else{try{e.call()}catch(u){n=u}r.call(e.prototype)}else{try{throw Error()}catch(u){n=u}r()}}catch(u){if(u&&n&&typeof u.stack=="string"){for(var s=u.stack.split(`
`),i=n.stack.split(`
`),a=s.length-1,o=i.length-1;1<=a&&0<=o&&s[a]!==i[o];)o--;for(;1<=a&&0<=o;a--,o--)if(s[a]!==i[o]){if(a!==1||o!==1)do if(a--,o--,0>o||s[a]!==i[o]){var l=`
`+s[a].replace(" at new "," at ");return r.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",r.displayName)),l}while(1<=a&&0<=o);break}}}finally{du=!1,Error.prepareStackTrace=t}return(r=r?r.displayName||r.name:"")?Pi(r):""}function Fx(r){switch(r.tag){case 5:return Pi(r.type);case 16:return Pi("Lazy");case 13:return Pi("Suspense");case 19:return Pi("SuspenseList");case 0:case 2:case 15:return r=fu(r.type,!1),r;case 11:return r=fu(r.type.render,!1),r;case 1:return r=fu(r.type,!0),r;default:return""}}function Dc(r){if(r==null)return null;if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case Ns:return"Fragment";case Ms:return"Portal";case kc:return"Profiler";case sg:return"StrictMode";case Cc:return"Suspense";case Pc:return"SuspenseList"}if(typeof r=="object")switch(r.$$typeof){case uy:return(r.displayName||"Context")+".Consumer";case ly:return(r._context.displayName||"Context")+".Provider";case ig:var e=r.render;return r=r.displayName,r||(r=e.displayName||e.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case ag:return e=r.displayName||null,e!==null?e:Dc(r.type)||"Memo";case hn:e=r._payload,r=r._init;try{return Dc(r(e))}catch{}}return null}function $x(r){var e=r.type;switch(r.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return r=e.render,r=r.displayName||r.name||"",e.displayName||(r!==""?"ForwardRef("+r+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Dc(e);case 8:return e===sg?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Pn(r){switch(typeof r){case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function dy(r){var e=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Ux(r){var e=dy(r)?"checked":"value",t=Object.getOwnPropertyDescriptor(r.constructor.prototype,e),n=""+r[e];if(!r.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var s=t.get,i=t.set;return Object.defineProperty(r,e,{configurable:!0,get:function(){return s.call(this)},set:function(a){n=""+a,i.call(this,a)}}),Object.defineProperty(r,e,{enumerable:t.enumerable}),{getValue:function(){return n},setValue:function(a){n=""+a},stopTracking:function(){r._valueTracker=null,delete r[e]}}}}function Ya(r){r._valueTracker||(r._valueTracker=Ux(r))}function fy(r){if(!r)return!1;var e=r._valueTracker;if(!e)return!0;var t=e.getValue(),n="";return r&&(n=dy(r)?r.checked?"true":"false":r.value),r=n,r!==t?(e.setValue(r),!0):!1}function tl(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}function Oc(r,e){var t=e.checked;return Ke({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??r._wrapperState.initialChecked})}function Pp(r,e){var t=e.defaultValue==null?"":e.defaultValue,n=e.checked!=null?e.checked:e.defaultChecked;t=Pn(e.value!=null?e.value:t),r._wrapperState={initialChecked:n,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function hy(r,e){e=e.checked,e!=null&&ng(r,"checked",e,!1)}function Mc(r,e){hy(r,e);var t=Pn(e.value),n=e.type;if(t!=null)n==="number"?(t===0&&r.value===""||r.value!=t)&&(r.value=""+t):r.value!==""+t&&(r.value=""+t);else if(n==="submit"||n==="reset"){r.removeAttribute("value");return}e.hasOwnProperty("value")?Nc(r,e.type,t):e.hasOwnProperty("defaultValue")&&Nc(r,e.type,Pn(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(r.defaultChecked=!!e.defaultChecked)}function Dp(r,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var n=e.type;if(!(n!=="submit"&&n!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+r._wrapperState.initialValue,t||e===r.value||(r.value=e),r.defaultValue=e}t=r.name,t!==""&&(r.name=""),r.defaultChecked=!!r._wrapperState.initialChecked,t!==""&&(r.name=t)}function Nc(r,e,t){(e!=="number"||tl(r.ownerDocument)!==r)&&(t==null?r.defaultValue=""+r._wrapperState.initialValue:r.defaultValue!==""+t&&(r.defaultValue=""+t))}var Di=Array.isArray;function Ys(r,e,t,n){if(r=r.options,e){e={};for(var s=0;s<t.length;s++)e["$"+t[s]]=!0;for(t=0;t<r.length;t++)s=e.hasOwnProperty("$"+r[t].value),r[t].selected!==s&&(r[t].selected=s),s&&n&&(r[t].defaultSelected=!0)}else{for(t=""+Pn(t),e=null,s=0;s<r.length;s++){if(r[s].value===t){r[s].selected=!0,n&&(r[s].defaultSelected=!0);return}e!==null||r[s].disabled||(e=r[s])}e!==null&&(e.selected=!0)}}function Fc(r,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Z(91));return Ke({},e,{value:void 0,defaultValue:void 0,children:""+r._wrapperState.initialValue})}function Op(r,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(Z(92));if(Di(t)){if(1<t.length)throw Error(Z(93));t=t[0]}e=t}e==null&&(e=""),t=e}r._wrapperState={initialValue:Pn(t)}}function gy(r,e){var t=Pn(e.value),n=Pn(e.defaultValue);t!=null&&(t=""+t,t!==r.value&&(r.value=t),e.defaultValue==null&&r.defaultValue!==t&&(r.defaultValue=t)),n!=null&&(r.defaultValue=""+n)}function Mp(r){var e=r.textContent;e===r._wrapperState.initialValue&&e!==""&&e!==null&&(r.value=e)}function py(r){switch(r){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function $c(r,e){return r==null||r==="http://www.w3.org/1999/xhtml"?py(e):r==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":r}var Za,my=function(r){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,n,s){MSApp.execUnsafeLocalFunction(function(){return r(e,t,n,s)})}:r}(function(r,e){if(r.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in r)r.innerHTML=e;else{for(Za=Za||document.createElement("div"),Za.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Za.firstChild;r.firstChild;)r.removeChild(r.firstChild);for(;e.firstChild;)r.appendChild(e.firstChild)}});function Ji(r,e){if(e){var t=r.firstChild;if(t&&t===r.lastChild&&t.nodeType===3){t.nodeValue=e;return}}r.textContent=e}var $i={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Bx=["Webkit","ms","Moz","O"];Object.keys($i).forEach(function(r){Bx.forEach(function(e){e=e+r.charAt(0).toUpperCase()+r.substring(1),$i[e]=$i[r]})});function vy(r,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||$i.hasOwnProperty(r)&&$i[r]?(""+e).trim():e+"px"}function yy(r,e){r=r.style;for(var t in e)if(e.hasOwnProperty(t)){var n=t.indexOf("--")===0,s=vy(t,e[t],n);t==="float"&&(t="cssFloat"),n?r.setProperty(t,s):r[t]=s}}var jx=Ke({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Uc(r,e){if(e){if(jx[r]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Z(137,r));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Z(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Z(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Z(62))}}function Bc(r,e){if(r.indexOf("-")===-1)return typeof e.is=="string";switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var jc=null;function og(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var Gc=null,Zs=null,Qs=null;function Np(r){if(r=Ca(r)){if(typeof Gc!="function")throw Error(Z(280));var e=r.stateNode;e&&(e=Vl(e),Gc(r.stateNode,r.type,e))}}function Sy(r){Zs?Qs?Qs.push(r):Qs=[r]:Zs=r}function Ey(){if(Zs){var r=Zs,e=Qs;if(Qs=Zs=null,Np(r),e)for(r=0;r<e.length;r++)Np(e[r])}}function _y(r,e){return r(e)}function Ty(){}var hu=!1;function xy(r,e,t){if(hu)return r(e,t);hu=!0;try{return _y(r,e,t)}finally{hu=!1,(Zs!==null||Qs!==null)&&(Ty(),Ey())}}function ea(r,e){var t=r.stateNode;if(t===null)return null;var n=Vl(t);if(n===null)return null;t=n[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(r=r.type,n=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!n;break e;default:r=!1}if(r)return null;if(t&&typeof t!="function")throw Error(Z(231,e,typeof t));return t}var Kc=!1;if(Xr)try{var Ai={};Object.defineProperty(Ai,"passive",{get:function(){Kc=!0}}),window.addEventListener("test",Ai,Ai),window.removeEventListener("test",Ai,Ai)}catch{Kc=!1}function Gx(r,e,t,n,s,i,a,o,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(t,u)}catch(c){this.onError(c)}}var Ui=!1,rl=null,nl=!1,Hc=null,Kx={onError:function(r){Ui=!0,rl=r}};function Hx(r,e,t,n,s,i,a,o,l){Ui=!1,rl=null,Gx.apply(Kx,arguments)}function Vx(r,e,t,n,s,i,a,o,l){if(Hx.apply(this,arguments),Ui){if(Ui){var u=rl;Ui=!1,rl=null}else throw Error(Z(198));nl||(nl=!0,Hc=u)}}function fs(r){var e=r,t=r;if(r.alternate)for(;e.return;)e=e.return;else{r=e;do e=r,e.flags&4098&&(t=e.return),r=e.return;while(r)}return e.tag===3?t:null}function Ay(r){if(r.tag===13){var e=r.memoizedState;if(e===null&&(r=r.alternate,r!==null&&(e=r.memoizedState)),e!==null)return e.dehydrated}return null}function Fp(r){if(fs(r)!==r)throw Error(Z(188))}function Wx(r){var e=r.alternate;if(!e){if(e=fs(r),e===null)throw Error(Z(188));return e!==r?null:r}for(var t=r,n=e;;){var s=t.return;if(s===null)break;var i=s.alternate;if(i===null){if(n=s.return,n!==null){t=n;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===t)return Fp(s),r;if(i===n)return Fp(s),e;i=i.sibling}throw Error(Z(188))}if(t.return!==n.return)t=s,n=i;else{for(var a=!1,o=s.child;o;){if(o===t){a=!0,t=s,n=i;break}if(o===n){a=!0,n=s,t=i;break}o=o.sibling}if(!a){for(o=i.child;o;){if(o===t){a=!0,t=i,n=s;break}if(o===n){a=!0,n=i,t=s;break}o=o.sibling}if(!a)throw Error(Z(189))}}if(t.alternate!==n)throw Error(Z(190))}if(t.tag!==3)throw Error(Z(188));return t.stateNode.current===t?r:e}function wy(r){return r=Wx(r),r!==null?Iy(r):null}function Iy(r){if(r.tag===5||r.tag===6)return r;for(r=r.child;r!==null;){var e=Iy(r);if(e!==null)return e;r=r.sibling}return null}var by=tr.unstable_scheduleCallback,$p=tr.unstable_cancelCallback,zx=tr.unstable_shouldYield,qx=tr.unstable_requestPaint,ze=tr.unstable_now,Yx=tr.unstable_getCurrentPriorityLevel,lg=tr.unstable_ImmediatePriority,Ry=tr.unstable_UserBlockingPriority,sl=tr.unstable_NormalPriority,Zx=tr.unstable_LowPriority,Ly=tr.unstable_IdlePriority,jl=null,Fr=null;function Qx(r){if(Fr&&typeof Fr.onCommitFiberRoot=="function")try{Fr.onCommitFiberRoot(jl,r,void 0,(r.current.flags&128)===128)}catch{}}var xr=Math.clz32?Math.clz32:eA,Xx=Math.log,Jx=Math.LN2;function eA(r){return r>>>=0,r===0?32:31-(Xx(r)/Jx|0)|0}var Qa=64,Xa=4194304;function Oi(r){switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return r&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return r}}function il(r,e){var t=r.pendingLanes;if(t===0)return 0;var n=0,s=r.suspendedLanes,i=r.pingedLanes,a=t&268435455;if(a!==0){var o=a&~s;o!==0?n=Oi(o):(i&=a,i!==0&&(n=Oi(i)))}else a=t&~s,a!==0?n=Oi(a):i!==0&&(n=Oi(i));if(n===0)return 0;if(e!==0&&e!==n&&!(e&s)&&(s=n&-n,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(n&4&&(n|=t&16),e=r.entangledLanes,e!==0)for(r=r.entanglements,e&=n;0<e;)t=31-xr(e),s=1<<t,n|=r[t],e&=~s;return n}function tA(r,e){switch(r){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function rA(r,e){for(var t=r.suspendedLanes,n=r.pingedLanes,s=r.expirationTimes,i=r.pendingLanes;0<i;){var a=31-xr(i),o=1<<a,l=s[a];l===-1?(!(o&t)||o&n)&&(s[a]=tA(o,e)):l<=e&&(r.expiredLanes|=o),i&=~o}}function Vc(r){return r=r.pendingLanes&-1073741825,r!==0?r:r&1073741824?1073741824:0}function ky(){var r=Qa;return Qa<<=1,!(Qa&4194240)&&(Qa=64),r}function gu(r){for(var e=[],t=0;31>t;t++)e.push(r);return e}function La(r,e,t){r.pendingLanes|=e,e!==536870912&&(r.suspendedLanes=0,r.pingedLanes=0),r=r.eventTimes,e=31-xr(e),r[e]=t}function nA(r,e){var t=r.pendingLanes&~e;r.pendingLanes=e,r.suspendedLanes=0,r.pingedLanes=0,r.expiredLanes&=e,r.mutableReadLanes&=e,r.entangledLanes&=e,e=r.entanglements;var n=r.eventTimes;for(r=r.expirationTimes;0<t;){var s=31-xr(t),i=1<<s;e[s]=0,n[s]=-1,r[s]=-1,t&=~i}}function ug(r,e){var t=r.entangledLanes|=e;for(r=r.entanglements;t;){var n=31-xr(t),s=1<<n;s&e|r[n]&e&&(r[n]|=e),t&=~s}}var Ae=0;function Cy(r){return r&=-r,1<r?4<r?r&268435455?16:536870912:4:1}var Py,cg,Dy,Oy,My,Wc=!1,Ja=[],xn=null,An=null,wn=null,ta=new Map,ra=new Map,yn=[],sA="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Up(r,e){switch(r){case"focusin":case"focusout":xn=null;break;case"dragenter":case"dragleave":An=null;break;case"mouseover":case"mouseout":wn=null;break;case"pointerover":case"pointerout":ta.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":ra.delete(e.pointerId)}}function wi(r,e,t,n,s,i){return r===null||r.nativeEvent!==i?(r={blockedOn:e,domEventName:t,eventSystemFlags:n,nativeEvent:i,targetContainers:[s]},e!==null&&(e=Ca(e),e!==null&&cg(e)),r):(r.eventSystemFlags|=n,e=r.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),r)}function iA(r,e,t,n,s){switch(e){case"focusin":return xn=wi(xn,r,e,t,n,s),!0;case"dragenter":return An=wi(An,r,e,t,n,s),!0;case"mouseover":return wn=wi(wn,r,e,t,n,s),!0;case"pointerover":var i=s.pointerId;return ta.set(i,wi(ta.get(i)||null,r,e,t,n,s)),!0;case"gotpointercapture":return i=s.pointerId,ra.set(i,wi(ra.get(i)||null,r,e,t,n,s)),!0}return!1}function Ny(r){var e=Xn(r.target);if(e!==null){var t=fs(e);if(t!==null){if(e=t.tag,e===13){if(e=Ay(t),e!==null){r.blockedOn=e,My(r.priority,function(){Dy(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){r.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}r.blockedOn=null}function Fo(r){if(r.blockedOn!==null)return!1;for(var e=r.targetContainers;0<e.length;){var t=zc(r.domEventName,r.eventSystemFlags,e[0],r.nativeEvent);if(t===null){t=r.nativeEvent;var n=new t.constructor(t.type,t);jc=n,t.target.dispatchEvent(n),jc=null}else return e=Ca(t),e!==null&&cg(e),r.blockedOn=t,!1;e.shift()}return!0}function Bp(r,e,t){Fo(r)&&t.delete(e)}function aA(){Wc=!1,xn!==null&&Fo(xn)&&(xn=null),An!==null&&Fo(An)&&(An=null),wn!==null&&Fo(wn)&&(wn=null),ta.forEach(Bp),ra.forEach(Bp)}function Ii(r,e){r.blockedOn===e&&(r.blockedOn=null,Wc||(Wc=!0,tr.unstable_scheduleCallback(tr.unstable_NormalPriority,aA)))}function na(r){function e(s){return Ii(s,r)}if(0<Ja.length){Ii(Ja[0],r);for(var t=1;t<Ja.length;t++){var n=Ja[t];n.blockedOn===r&&(n.blockedOn=null)}}for(xn!==null&&Ii(xn,r),An!==null&&Ii(An,r),wn!==null&&Ii(wn,r),ta.forEach(e),ra.forEach(e),t=0;t<yn.length;t++)n=yn[t],n.blockedOn===r&&(n.blockedOn=null);for(;0<yn.length&&(t=yn[0],t.blockedOn===null);)Ny(t),t.blockedOn===null&&yn.shift()}var Xs=rn.ReactCurrentBatchConfig,al=!0;function oA(r,e,t,n){var s=Ae,i=Xs.transition;Xs.transition=null;try{Ae=1,dg(r,e,t,n)}finally{Ae=s,Xs.transition=i}}function lA(r,e,t,n){var s=Ae,i=Xs.transition;Xs.transition=null;try{Ae=4,dg(r,e,t,n)}finally{Ae=s,Xs.transition=i}}function dg(r,e,t,n){if(al){var s=zc(r,e,t,n);if(s===null)Au(r,e,n,ol,t),Up(r,n);else if(iA(s,r,e,t,n))n.stopPropagation();else if(Up(r,n),e&4&&-1<sA.indexOf(r)){for(;s!==null;){var i=Ca(s);if(i!==null&&Py(i),i=zc(r,e,t,n),i===null&&Au(r,e,n,ol,t),i===s)break;s=i}s!==null&&n.stopPropagation()}else Au(r,e,n,null,t)}}var ol=null;function zc(r,e,t,n){if(ol=null,r=og(n),r=Xn(r),r!==null)if(e=fs(r),e===null)r=null;else if(t=e.tag,t===13){if(r=Ay(e),r!==null)return r;r=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;r=null}else e!==r&&(r=null);return ol=r,null}function Fy(r){switch(r){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Yx()){case lg:return 1;case Ry:return 4;case sl:case Zx:return 16;case Ly:return 536870912;default:return 16}default:return 16}}var _n=null,fg=null,$o=null;function $y(){if($o)return $o;var r,e=fg,t=e.length,n,s="value"in _n?_n.value:_n.textContent,i=s.length;for(r=0;r<t&&e[r]===s[r];r++);var a=t-r;for(n=1;n<=a&&e[t-n]===s[i-n];n++);return $o=s.slice(r,1<n?1-n:void 0)}function Uo(r){var e=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&e===13&&(r=13)):r=e,r===10&&(r=13),32<=r||r===13?r:0}function eo(){return!0}function jp(){return!1}function nr(r){function e(t,n,s,i,a){this._reactName=t,this._targetInst=s,this.type=n,this.nativeEvent=i,this.target=a,this.currentTarget=null;for(var o in r)r.hasOwnProperty(o)&&(t=r[o],this[o]=t?t(i):i[o]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?eo:jp,this.isPropagationStopped=jp,this}return Ke(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=eo)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=eo)},persist:function(){},isPersistent:eo}),e}var mi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},hg=nr(mi),ka=Ke({},mi,{view:0,detail:0}),uA=nr(ka),pu,mu,bi,Gl=Ke({},ka,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:gg,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==bi&&(bi&&r.type==="mousemove"?(pu=r.screenX-bi.screenX,mu=r.screenY-bi.screenY):mu=pu=0,bi=r),pu)},movementY:function(r){return"movementY"in r?r.movementY:mu}}),Gp=nr(Gl),cA=Ke({},Gl,{dataTransfer:0}),dA=nr(cA),fA=Ke({},ka,{relatedTarget:0}),vu=nr(fA),hA=Ke({},mi,{animationName:0,elapsedTime:0,pseudoElement:0}),gA=nr(hA),pA=Ke({},mi,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),mA=nr(pA),vA=Ke({},mi,{data:0}),Kp=nr(vA),yA={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},SA={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},EA={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function _A(r){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(r):(r=EA[r])?!!e[r]:!1}function gg(){return _A}var TA=Ke({},ka,{key:function(r){if(r.key){var e=yA[r.key]||r.key;if(e!=="Unidentified")return e}return r.type==="keypress"?(r=Uo(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?SA[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:gg,charCode:function(r){return r.type==="keypress"?Uo(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?Uo(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),xA=nr(TA),AA=Ke({},Gl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Hp=nr(AA),wA=Ke({},ka,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:gg}),IA=nr(wA),bA=Ke({},mi,{propertyName:0,elapsedTime:0,pseudoElement:0}),RA=nr(bA),LA=Ke({},Gl,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),kA=nr(LA),CA=[9,13,27,32],pg=Xr&&"CompositionEvent"in window,Bi=null;Xr&&"documentMode"in document&&(Bi=document.documentMode);var PA=Xr&&"TextEvent"in window&&!Bi,Uy=Xr&&(!pg||Bi&&8<Bi&&11>=Bi),Vp=" ",Wp=!1;function By(r,e){switch(r){case"keyup":return CA.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function jy(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var Fs=!1;function DA(r,e){switch(r){case"compositionend":return jy(e);case"keypress":return e.which!==32?null:(Wp=!0,Vp);case"textInput":return r=e.data,r===Vp&&Wp?null:r;default:return null}}function OA(r,e){if(Fs)return r==="compositionend"||!pg&&By(r,e)?(r=$y(),$o=fg=_n=null,Fs=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Uy&&e.locale!=="ko"?null:e.data;default:return null}}var MA={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function zp(r){var e=r&&r.nodeName&&r.nodeName.toLowerCase();return e==="input"?!!MA[r.type]:e==="textarea"}function Gy(r,e,t,n){Sy(n),e=ll(e,"onChange"),0<e.length&&(t=new hg("onChange","change",null,t,n),r.push({event:t,listeners:e}))}var ji=null,sa=null;function NA(r){Jy(r,0)}function Kl(r){var e=Bs(r);if(fy(e))return r}function FA(r,e){if(r==="change")return e}var Ky=!1;if(Xr){var yu;if(Xr){var Su="oninput"in document;if(!Su){var qp=document.createElement("div");qp.setAttribute("oninput","return;"),Su=typeof qp.oninput=="function"}yu=Su}else yu=!1;Ky=yu&&(!document.documentMode||9<document.documentMode)}function Yp(){ji&&(ji.detachEvent("onpropertychange",Hy),sa=ji=null)}function Hy(r){if(r.propertyName==="value"&&Kl(sa)){var e=[];Gy(e,sa,r,og(r)),xy(NA,e)}}function $A(r,e,t){r==="focusin"?(Yp(),ji=e,sa=t,ji.attachEvent("onpropertychange",Hy)):r==="focusout"&&Yp()}function UA(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return Kl(sa)}function BA(r,e){if(r==="click")return Kl(e)}function jA(r,e){if(r==="input"||r==="change")return Kl(e)}function GA(r,e){return r===e&&(r!==0||1/r===1/e)||r!==r&&e!==e}var wr=typeof Object.is=="function"?Object.is:GA;function ia(r,e){if(wr(r,e))return!0;if(typeof r!="object"||r===null||typeof e!="object"||e===null)return!1;var t=Object.keys(r),n=Object.keys(e);if(t.length!==n.length)return!1;for(n=0;n<t.length;n++){var s=t[n];if(!Lc.call(e,s)||!wr(r[s],e[s]))return!1}return!0}function Zp(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function Qp(r,e){var t=Zp(r);r=0;for(var n;t;){if(t.nodeType===3){if(n=r+t.textContent.length,r<=e&&n>=e)return{node:t,offset:e-r};r=n}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=Zp(t)}}function Vy(r,e){return r&&e?r===e?!0:r&&r.nodeType===3?!1:e&&e.nodeType===3?Vy(r,e.parentNode):"contains"in r?r.contains(e):r.compareDocumentPosition?!!(r.compareDocumentPosition(e)&16):!1:!1}function Wy(){for(var r=window,e=tl();e instanceof r.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)r=e.contentWindow;else break;e=tl(r.document)}return e}function mg(r){var e=r&&r.nodeName&&r.nodeName.toLowerCase();return e&&(e==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||e==="textarea"||r.contentEditable==="true")}function KA(r){var e=Wy(),t=r.focusedElem,n=r.selectionRange;if(e!==t&&t&&t.ownerDocument&&Vy(t.ownerDocument.documentElement,t)){if(n!==null&&mg(t)){if(e=n.start,r=n.end,r===void 0&&(r=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(r,t.value.length);else if(r=(e=t.ownerDocument||document)&&e.defaultView||window,r.getSelection){r=r.getSelection();var s=t.textContent.length,i=Math.min(n.start,s);n=n.end===void 0?i:Math.min(n.end,s),!r.extend&&i>n&&(s=n,n=i,i=s),s=Qp(t,i);var a=Qp(t,n);s&&a&&(r.rangeCount!==1||r.anchorNode!==s.node||r.anchorOffset!==s.offset||r.focusNode!==a.node||r.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),r.removeAllRanges(),i>n?(r.addRange(e),r.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),r.addRange(e)))}}for(e=[],r=t;r=r.parentNode;)r.nodeType===1&&e.push({element:r,left:r.scrollLeft,top:r.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)r=e[t],r.element.scrollLeft=r.left,r.element.scrollTop=r.top}}var HA=Xr&&"documentMode"in document&&11>=document.documentMode,$s=null,qc=null,Gi=null,Yc=!1;function Xp(r,e,t){var n=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;Yc||$s==null||$s!==tl(n)||(n=$s,"selectionStart"in n&&mg(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),Gi&&ia(Gi,n)||(Gi=n,n=ll(qc,"onSelect"),0<n.length&&(e=new hg("onSelect","select",null,e,t),r.push({event:e,listeners:n}),e.target=$s)))}function to(r,e){var t={};return t[r.toLowerCase()]=e.toLowerCase(),t["Webkit"+r]="webkit"+e,t["Moz"+r]="moz"+e,t}var Us={animationend:to("Animation","AnimationEnd"),animationiteration:to("Animation","AnimationIteration"),animationstart:to("Animation","AnimationStart"),transitionend:to("Transition","TransitionEnd")},Eu={},zy={};Xr&&(zy=document.createElement("div").style,"AnimationEvent"in window||(delete Us.animationend.animation,delete Us.animationiteration.animation,delete Us.animationstart.animation),"TransitionEvent"in window||delete Us.transitionend.transition);function Hl(r){if(Eu[r])return Eu[r];if(!Us[r])return r;var e=Us[r],t;for(t in e)if(e.hasOwnProperty(t)&&t in zy)return Eu[r]=e[t];return r}var qy=Hl("animationend"),Yy=Hl("animationiteration"),Zy=Hl("animationstart"),Qy=Hl("transitionend"),Xy=new Map,Jp="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Nn(r,e){Xy.set(r,e),ds(e,[r])}for(var _u=0;_u<Jp.length;_u++){var Tu=Jp[_u],VA=Tu.toLowerCase(),WA=Tu[0].toUpperCase()+Tu.slice(1);Nn(VA,"on"+WA)}Nn(qy,"onAnimationEnd");Nn(Yy,"onAnimationIteration");Nn(Zy,"onAnimationStart");Nn("dblclick","onDoubleClick");Nn("focusin","onFocus");Nn("focusout","onBlur");Nn(Qy,"onTransitionEnd");ai("onMouseEnter",["mouseout","mouseover"]);ai("onMouseLeave",["mouseout","mouseover"]);ai("onPointerEnter",["pointerout","pointerover"]);ai("onPointerLeave",["pointerout","pointerover"]);ds("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ds("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ds("onBeforeInput",["compositionend","keypress","textInput","paste"]);ds("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ds("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ds("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Mi="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),zA=new Set("cancel close invalid load scroll toggle".split(" ").concat(Mi));function e0(r,e,t){var n=r.type||"unknown-event";r.currentTarget=t,Vx(n,e,void 0,r),r.currentTarget=null}function Jy(r,e){e=(e&4)!==0;for(var t=0;t<r.length;t++){var n=r[t],s=n.event;n=n.listeners;e:{var i=void 0;if(e)for(var a=n.length-1;0<=a;a--){var o=n[a],l=o.instance,u=o.currentTarget;if(o=o.listener,l!==i&&s.isPropagationStopped())break e;e0(s,o,u),i=l}else for(a=0;a<n.length;a++){if(o=n[a],l=o.instance,u=o.currentTarget,o=o.listener,l!==i&&s.isPropagationStopped())break e;e0(s,o,u),i=l}}}if(nl)throw r=Hc,nl=!1,Hc=null,r}function Ce(r,e){var t=e[ed];t===void 0&&(t=e[ed]=new Set);var n=r+"__bubble";t.has(n)||(eS(e,r,2,!1),t.add(n))}function xu(r,e,t){var n=0;e&&(n|=4),eS(t,r,n,e)}var ro="_reactListening"+Math.random().toString(36).slice(2);function aa(r){if(!r[ro]){r[ro]=!0,oy.forEach(function(t){t!=="selectionchange"&&(zA.has(t)||xu(t,!1,r),xu(t,!0,r))});var e=r.nodeType===9?r:r.ownerDocument;e===null||e[ro]||(e[ro]=!0,xu("selectionchange",!1,e))}}function eS(r,e,t,n){switch(Fy(e)){case 1:var s=oA;break;case 4:s=lA;break;default:s=dg}t=s.bind(null,e,t,r),s=void 0,!Kc||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),n?s!==void 0?r.addEventListener(e,t,{capture:!0,passive:s}):r.addEventListener(e,t,!0):s!==void 0?r.addEventListener(e,t,{passive:s}):r.addEventListener(e,t,!1)}function Au(r,e,t,n,s){var i=n;if(!(e&1)&&!(e&2)&&n!==null)e:for(;;){if(n===null)return;var a=n.tag;if(a===3||a===4){var o=n.stateNode.containerInfo;if(o===s||o.nodeType===8&&o.parentNode===s)break;if(a===4)for(a=n.return;a!==null;){var l=a.tag;if((l===3||l===4)&&(l=a.stateNode.containerInfo,l===s||l.nodeType===8&&l.parentNode===s))return;a=a.return}for(;o!==null;){if(a=Xn(o),a===null)return;if(l=a.tag,l===5||l===6){n=i=a;continue e}o=o.parentNode}}n=n.return}xy(function(){var u=i,c=og(t),d=[];e:{var f=Xy.get(r);if(f!==void 0){var h=hg,g=r;switch(r){case"keypress":if(Uo(t)===0)break e;case"keydown":case"keyup":h=xA;break;case"focusin":g="focus",h=vu;break;case"focusout":g="blur",h=vu;break;case"beforeblur":case"afterblur":h=vu;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":h=Gp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":h=dA;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":h=IA;break;case qy:case Yy:case Zy:h=gA;break;case Qy:h=RA;break;case"scroll":h=uA;break;case"wheel":h=kA;break;case"copy":case"cut":case"paste":h=mA;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":h=Hp}var p=(e&4)!==0,v=!p&&r==="scroll",m=p?f!==null?f+"Capture":null:f;p=[];for(var y=u,S;y!==null;){S=y;var E=S.stateNode;if(S.tag===5&&E!==null&&(S=E,m!==null&&(E=ea(y,m),E!=null&&p.push(oa(y,E,S)))),v)break;y=y.return}0<p.length&&(f=new h(f,g,null,t,c),d.push({event:f,listeners:p}))}}if(!(e&7)){e:{if(f=r==="mouseover"||r==="pointerover",h=r==="mouseout"||r==="pointerout",f&&t!==jc&&(g=t.relatedTarget||t.fromElement)&&(Xn(g)||g[Jr]))break e;if((h||f)&&(f=c.window===c?c:(f=c.ownerDocument)?f.defaultView||f.parentWindow:window,h?(g=t.relatedTarget||t.toElement,h=u,g=g?Xn(g):null,g!==null&&(v=fs(g),g!==v||g.tag!==5&&g.tag!==6)&&(g=null)):(h=null,g=u),h!==g)){if(p=Gp,E="onMouseLeave",m="onMouseEnter",y="mouse",(r==="pointerout"||r==="pointerover")&&(p=Hp,E="onPointerLeave",m="onPointerEnter",y="pointer"),v=h==null?f:Bs(h),S=g==null?f:Bs(g),f=new p(E,y+"leave",h,t,c),f.target=v,f.relatedTarget=S,E=null,Xn(c)===u&&(p=new p(m,y+"enter",g,t,c),p.target=S,p.relatedTarget=v,E=p),v=E,h&&g)t:{for(p=h,m=g,y=0,S=p;S;S=ms(S))y++;for(S=0,E=m;E;E=ms(E))S++;for(;0<y-S;)p=ms(p),y--;for(;0<S-y;)m=ms(m),S--;for(;y--;){if(p===m||m!==null&&p===m.alternate)break t;p=ms(p),m=ms(m)}p=null}else p=null;h!==null&&t0(d,f,h,p,!1),g!==null&&v!==null&&t0(d,v,g,p,!0)}}e:{if(f=u?Bs(u):window,h=f.nodeName&&f.nodeName.toLowerCase(),h==="select"||h==="input"&&f.type==="file")var T=FA;else if(zp(f))if(Ky)T=jA;else{T=UA;var A=$A}else(h=f.nodeName)&&h.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(T=BA);if(T&&(T=T(r,u))){Gy(d,T,t,c);break e}A&&A(r,f,u),r==="focusout"&&(A=f._wrapperState)&&A.controlled&&f.type==="number"&&Nc(f,"number",f.value)}switch(A=u?Bs(u):window,r){case"focusin":(zp(A)||A.contentEditable==="true")&&($s=A,qc=u,Gi=null);break;case"focusout":Gi=qc=$s=null;break;case"mousedown":Yc=!0;break;case"contextmenu":case"mouseup":case"dragend":Yc=!1,Xp(d,t,c);break;case"selectionchange":if(HA)break;case"keydown":case"keyup":Xp(d,t,c)}var x;if(pg)e:{switch(r){case"compositionstart":var w="onCompositionStart";break e;case"compositionend":w="onCompositionEnd";break e;case"compositionupdate":w="onCompositionUpdate";break e}w=void 0}else Fs?By(r,t)&&(w="onCompositionEnd"):r==="keydown"&&t.keyCode===229&&(w="onCompositionStart");w&&(Uy&&t.locale!=="ko"&&(Fs||w!=="onCompositionStart"?w==="onCompositionEnd"&&Fs&&(x=$y()):(_n=c,fg="value"in _n?_n.value:_n.textContent,Fs=!0)),A=ll(u,w),0<A.length&&(w=new Kp(w,r,null,t,c),d.push({event:w,listeners:A}),x?w.data=x:(x=jy(t),x!==null&&(w.data=x)))),(x=PA?DA(r,t):OA(r,t))&&(u=ll(u,"onBeforeInput"),0<u.length&&(c=new Kp("onBeforeInput","beforeinput",null,t,c),d.push({event:c,listeners:u}),c.data=x))}Jy(d,e)})}function oa(r,e,t){return{instance:r,listener:e,currentTarget:t}}function ll(r,e){for(var t=e+"Capture",n=[];r!==null;){var s=r,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=ea(r,t),i!=null&&n.unshift(oa(r,i,s)),i=ea(r,e),i!=null&&n.push(oa(r,i,s))),r=r.return}return n}function ms(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5);return r||null}function t0(r,e,t,n,s){for(var i=e._reactName,a=[];t!==null&&t!==n;){var o=t,l=o.alternate,u=o.stateNode;if(l!==null&&l===n)break;o.tag===5&&u!==null&&(o=u,s?(l=ea(t,i),l!=null&&a.unshift(oa(t,l,o))):s||(l=ea(t,i),l!=null&&a.push(oa(t,l,o)))),t=t.return}a.length!==0&&r.push({event:e,listeners:a})}var qA=/\r\n?/g,YA=/\u0000|\uFFFD/g;function r0(r){return(typeof r=="string"?r:""+r).replace(qA,`
`).replace(YA,"")}function no(r,e,t){if(e=r0(e),r0(r)!==e&&t)throw Error(Z(425))}function ul(){}var Zc=null,Qc=null;function Xc(r,e){return r==="textarea"||r==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Jc=typeof setTimeout=="function"?setTimeout:void 0,ZA=typeof clearTimeout=="function"?clearTimeout:void 0,n0=typeof Promise=="function"?Promise:void 0,QA=typeof queueMicrotask=="function"?queueMicrotask:typeof n0<"u"?function(r){return n0.resolve(null).then(r).catch(XA)}:Jc;function XA(r){setTimeout(function(){throw r})}function wu(r,e){var t=e,n=0;do{var s=t.nextSibling;if(r.removeChild(t),s&&s.nodeType===8)if(t=s.data,t==="/$"){if(n===0){r.removeChild(s),na(e);return}n--}else t!=="$"&&t!=="$?"&&t!=="$!"||n++;t=s}while(t);na(e)}function In(r){for(;r!=null;r=r.nextSibling){var e=r.nodeType;if(e===1||e===3)break;if(e===8){if(e=r.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return r}function s0(r){r=r.previousSibling;for(var e=0;r;){if(r.nodeType===8){var t=r.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return r;e--}else t==="/$"&&e++}r=r.previousSibling}return null}var vi=Math.random().toString(36).slice(2),Dr="__reactFiber$"+vi,la="__reactProps$"+vi,Jr="__reactContainer$"+vi,ed="__reactEvents$"+vi,JA="__reactListeners$"+vi,e1="__reactHandles$"+vi;function Xn(r){var e=r[Dr];if(e)return e;for(var t=r.parentNode;t;){if(e=t[Jr]||t[Dr]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(r=s0(r);r!==null;){if(t=r[Dr])return t;r=s0(r)}return e}r=t,t=r.parentNode}return null}function Ca(r){return r=r[Dr]||r[Jr],!r||r.tag!==5&&r.tag!==6&&r.tag!==13&&r.tag!==3?null:r}function Bs(r){if(r.tag===5||r.tag===6)return r.stateNode;throw Error(Z(33))}function Vl(r){return r[la]||null}var td=[],js=-1;function Fn(r){return{current:r}}function Pe(r){0>js||(r.current=td[js],td[js]=null,js--)}function ke(r,e){js++,td[js]=r.current,r.current=e}var Dn={},_t=Fn(Dn),Nt=Fn(!1),is=Dn;function oi(r,e){var t=r.type.contextTypes;if(!t)return Dn;var n=r.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===e)return n.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in t)s[i]=e[i];return n&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=e,r.__reactInternalMemoizedMaskedChildContext=s),s}function Ft(r){return r=r.childContextTypes,r!=null}function cl(){Pe(Nt),Pe(_t)}function i0(r,e,t){if(_t.current!==Dn)throw Error(Z(168));ke(_t,e),ke(Nt,t)}function tS(r,e,t){var n=r.stateNode;if(e=e.childContextTypes,typeof n.getChildContext!="function")return t;n=n.getChildContext();for(var s in n)if(!(s in e))throw Error(Z(108,$x(r)||"Unknown",s));return Ke({},t,n)}function dl(r){return r=(r=r.stateNode)&&r.__reactInternalMemoizedMergedChildContext||Dn,is=_t.current,ke(_t,r),ke(Nt,Nt.current),!0}function a0(r,e,t){var n=r.stateNode;if(!n)throw Error(Z(169));t?(r=tS(r,e,is),n.__reactInternalMemoizedMergedChildContext=r,Pe(Nt),Pe(_t),ke(_t,r)):Pe(Nt),ke(Nt,t)}var zr=null,Wl=!1,Iu=!1;function rS(r){zr===null?zr=[r]:zr.push(r)}function t1(r){Wl=!0,rS(r)}function $n(){if(!Iu&&zr!==null){Iu=!0;var r=0,e=Ae;try{var t=zr;for(Ae=1;r<t.length;r++){var n=t[r];do n=n(!0);while(n!==null)}zr=null,Wl=!1}catch(s){throw zr!==null&&(zr=zr.slice(r+1)),by(lg,$n),s}finally{Ae=e,Iu=!1}}return null}var Gs=[],Ks=0,fl=null,hl=0,sr=[],ir=0,as=null,Yr=1,Zr="";function Wn(r,e){Gs[Ks++]=hl,Gs[Ks++]=fl,fl=r,hl=e}function nS(r,e,t){sr[ir++]=Yr,sr[ir++]=Zr,sr[ir++]=as,as=r;var n=Yr;r=Zr;var s=32-xr(n)-1;n&=~(1<<s),t+=1;var i=32-xr(e)+s;if(30<i){var a=s-s%5;i=(n&(1<<a)-1).toString(32),n>>=a,s-=a,Yr=1<<32-xr(e)+s|t<<s|n,Zr=i+r}else Yr=1<<i|t<<s|n,Zr=r}function vg(r){r.return!==null&&(Wn(r,1),nS(r,1,0))}function yg(r){for(;r===fl;)fl=Gs[--Ks],Gs[Ks]=null,hl=Gs[--Ks],Gs[Ks]=null;for(;r===as;)as=sr[--ir],sr[ir]=null,Zr=sr[--ir],sr[ir]=null,Yr=sr[--ir],sr[ir]=null}var Jt=null,Xt=null,Me=!1,Tr=null;function sS(r,e){var t=ar(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=r,e=r.deletions,e===null?(r.deletions=[t],r.flags|=16):e.push(t)}function o0(r,e){switch(r.tag){case 5:var t=r.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(r.stateNode=e,Jt=r,Xt=In(e.firstChild),!0):!1;case 6:return e=r.pendingProps===""||e.nodeType!==3?null:e,e!==null?(r.stateNode=e,Jt=r,Xt=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=as!==null?{id:Yr,overflow:Zr}:null,r.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=ar(18,null,null,0),t.stateNode=e,t.return=r,r.child=t,Jt=r,Xt=null,!0):!1;default:return!1}}function rd(r){return(r.mode&1)!==0&&(r.flags&128)===0}function nd(r){if(Me){var e=Xt;if(e){var t=e;if(!o0(r,e)){if(rd(r))throw Error(Z(418));e=In(t.nextSibling);var n=Jt;e&&o0(r,e)?sS(n,t):(r.flags=r.flags&-4097|2,Me=!1,Jt=r)}}else{if(rd(r))throw Error(Z(418));r.flags=r.flags&-4097|2,Me=!1,Jt=r}}}function l0(r){for(r=r.return;r!==null&&r.tag!==5&&r.tag!==3&&r.tag!==13;)r=r.return;Jt=r}function so(r){if(r!==Jt)return!1;if(!Me)return l0(r),Me=!0,!1;var e;if((e=r.tag!==3)&&!(e=r.tag!==5)&&(e=r.type,e=e!=="head"&&e!=="body"&&!Xc(r.type,r.memoizedProps)),e&&(e=Xt)){if(rd(r))throw iS(),Error(Z(418));for(;e;)sS(r,e),e=In(e.nextSibling)}if(l0(r),r.tag===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(Z(317));e:{for(r=r.nextSibling,e=0;r;){if(r.nodeType===8){var t=r.data;if(t==="/$"){if(e===0){Xt=In(r.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}r=r.nextSibling}Xt=null}}else Xt=Jt?In(r.stateNode.nextSibling):null;return!0}function iS(){for(var r=Xt;r;)r=In(r.nextSibling)}function li(){Xt=Jt=null,Me=!1}function Sg(r){Tr===null?Tr=[r]:Tr.push(r)}var r1=rn.ReactCurrentBatchConfig;function Ri(r,e,t){if(r=t.ref,r!==null&&typeof r!="function"&&typeof r!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(Z(309));var n=t.stateNode}if(!n)throw Error(Z(147,r));var s=n,i=""+r;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(a){var o=s.refs;a===null?delete o[i]:o[i]=a},e._stringRef=i,e)}if(typeof r!="string")throw Error(Z(284));if(!t._owner)throw Error(Z(290,r))}return r}function io(r,e){throw r=Object.prototype.toString.call(e),Error(Z(31,r==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":r))}function u0(r){var e=r._init;return e(r._payload)}function aS(r){function e(m,y){if(r){var S=m.deletions;S===null?(m.deletions=[y],m.flags|=16):S.push(y)}}function t(m,y){if(!r)return null;for(;y!==null;)e(m,y),y=y.sibling;return null}function n(m,y){for(m=new Map;y!==null;)y.key!==null?m.set(y.key,y):m.set(y.index,y),y=y.sibling;return m}function s(m,y){return m=kn(m,y),m.index=0,m.sibling=null,m}function i(m,y,S){return m.index=S,r?(S=m.alternate,S!==null?(S=S.index,S<y?(m.flags|=2,y):S):(m.flags|=2,y)):(m.flags|=1048576,y)}function a(m){return r&&m.alternate===null&&(m.flags|=2),m}function o(m,y,S,E){return y===null||y.tag!==6?(y=Du(S,m.mode,E),y.return=m,y):(y=s(y,S),y.return=m,y)}function l(m,y,S,E){var T=S.type;return T===Ns?c(m,y,S.props.children,E,S.key):y!==null&&(y.elementType===T||typeof T=="object"&&T!==null&&T.$$typeof===hn&&u0(T)===y.type)?(E=s(y,S.props),E.ref=Ri(m,y,S),E.return=m,E):(E=Wo(S.type,S.key,S.props,null,m.mode,E),E.ref=Ri(m,y,S),E.return=m,E)}function u(m,y,S,E){return y===null||y.tag!==4||y.stateNode.containerInfo!==S.containerInfo||y.stateNode.implementation!==S.implementation?(y=Ou(S,m.mode,E),y.return=m,y):(y=s(y,S.children||[]),y.return=m,y)}function c(m,y,S,E,T){return y===null||y.tag!==7?(y=ns(S,m.mode,E,T),y.return=m,y):(y=s(y,S),y.return=m,y)}function d(m,y,S){if(typeof y=="string"&&y!==""||typeof y=="number")return y=Du(""+y,m.mode,S),y.return=m,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case qa:return S=Wo(y.type,y.key,y.props,null,m.mode,S),S.ref=Ri(m,null,y),S.return=m,S;case Ms:return y=Ou(y,m.mode,S),y.return=m,y;case hn:var E=y._init;return d(m,E(y._payload),S)}if(Di(y)||xi(y))return y=ns(y,m.mode,S,null),y.return=m,y;io(m,y)}return null}function f(m,y,S,E){var T=y!==null?y.key:null;if(typeof S=="string"&&S!==""||typeof S=="number")return T!==null?null:o(m,y,""+S,E);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case qa:return S.key===T?l(m,y,S,E):null;case Ms:return S.key===T?u(m,y,S,E):null;case hn:return T=S._init,f(m,y,T(S._payload),E)}if(Di(S)||xi(S))return T!==null?null:c(m,y,S,E,null);io(m,S)}return null}function h(m,y,S,E,T){if(typeof E=="string"&&E!==""||typeof E=="number")return m=m.get(S)||null,o(y,m,""+E,T);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case qa:return m=m.get(E.key===null?S:E.key)||null,l(y,m,E,T);case Ms:return m=m.get(E.key===null?S:E.key)||null,u(y,m,E,T);case hn:var A=E._init;return h(m,y,S,A(E._payload),T)}if(Di(E)||xi(E))return m=m.get(S)||null,c(y,m,E,T,null);io(y,E)}return null}function g(m,y,S,E){for(var T=null,A=null,x=y,w=y=0,b=null;x!==null&&w<S.length;w++){x.index>w?(b=x,x=null):b=x.sibling;var I=f(m,x,S[w],E);if(I===null){x===null&&(x=b);break}r&&x&&I.alternate===null&&e(m,x),y=i(I,y,w),A===null?T=I:A.sibling=I,A=I,x=b}if(w===S.length)return t(m,x),Me&&Wn(m,w),T;if(x===null){for(;w<S.length;w++)x=d(m,S[w],E),x!==null&&(y=i(x,y,w),A===null?T=x:A.sibling=x,A=x);return Me&&Wn(m,w),T}for(x=n(m,x);w<S.length;w++)b=h(x,m,w,S[w],E),b!==null&&(r&&b.alternate!==null&&x.delete(b.key===null?w:b.key),y=i(b,y,w),A===null?T=b:A.sibling=b,A=b);return r&&x.forEach(function(M){return e(m,M)}),Me&&Wn(m,w),T}function p(m,y,S,E){var T=xi(S);if(typeof T!="function")throw Error(Z(150));if(S=T.call(S),S==null)throw Error(Z(151));for(var A=T=null,x=y,w=y=0,b=null,I=S.next();x!==null&&!I.done;w++,I=S.next()){x.index>w?(b=x,x=null):b=x.sibling;var M=f(m,x,I.value,E);if(M===null){x===null&&(x=b);break}r&&x&&M.alternate===null&&e(m,x),y=i(M,y,w),A===null?T=M:A.sibling=M,A=M,x=b}if(I.done)return t(m,x),Me&&Wn(m,w),T;if(x===null){for(;!I.done;w++,I=S.next())I=d(m,I.value,E),I!==null&&(y=i(I,y,w),A===null?T=I:A.sibling=I,A=I);return Me&&Wn(m,w),T}for(x=n(m,x);!I.done;w++,I=S.next())I=h(x,m,w,I.value,E),I!==null&&(r&&I.alternate!==null&&x.delete(I.key===null?w:I.key),y=i(I,y,w),A===null?T=I:A.sibling=I,A=I);return r&&x.forEach(function(K){return e(m,K)}),Me&&Wn(m,w),T}function v(m,y,S,E){if(typeof S=="object"&&S!==null&&S.type===Ns&&S.key===null&&(S=S.props.children),typeof S=="object"&&S!==null){switch(S.$$typeof){case qa:e:{for(var T=S.key,A=y;A!==null;){if(A.key===T){if(T=S.type,T===Ns){if(A.tag===7){t(m,A.sibling),y=s(A,S.props.children),y.return=m,m=y;break e}}else if(A.elementType===T||typeof T=="object"&&T!==null&&T.$$typeof===hn&&u0(T)===A.type){t(m,A.sibling),y=s(A,S.props),y.ref=Ri(m,A,S),y.return=m,m=y;break e}t(m,A);break}else e(m,A);A=A.sibling}S.type===Ns?(y=ns(S.props.children,m.mode,E,S.key),y.return=m,m=y):(E=Wo(S.type,S.key,S.props,null,m.mode,E),E.ref=Ri(m,y,S),E.return=m,m=E)}return a(m);case Ms:e:{for(A=S.key;y!==null;){if(y.key===A)if(y.tag===4&&y.stateNode.containerInfo===S.containerInfo&&y.stateNode.implementation===S.implementation){t(m,y.sibling),y=s(y,S.children||[]),y.return=m,m=y;break e}else{t(m,y);break}else e(m,y);y=y.sibling}y=Ou(S,m.mode,E),y.return=m,m=y}return a(m);case hn:return A=S._init,v(m,y,A(S._payload),E)}if(Di(S))return g(m,y,S,E);if(xi(S))return p(m,y,S,E);io(m,S)}return typeof S=="string"&&S!==""||typeof S=="number"?(S=""+S,y!==null&&y.tag===6?(t(m,y.sibling),y=s(y,S),y.return=m,m=y):(t(m,y),y=Du(S,m.mode,E),y.return=m,m=y),a(m)):t(m,y)}return v}var ui=aS(!0),oS=aS(!1),gl=Fn(null),pl=null,Hs=null,Eg=null;function _g(){Eg=Hs=pl=null}function Tg(r){var e=gl.current;Pe(gl),r._currentValue=e}function sd(r,e,t){for(;r!==null;){var n=r.alternate;if((r.childLanes&e)!==e?(r.childLanes|=e,n!==null&&(n.childLanes|=e)):n!==null&&(n.childLanes&e)!==e&&(n.childLanes|=e),r===t)break;r=r.return}}function Js(r,e){pl=r,Eg=Hs=null,r=r.dependencies,r!==null&&r.firstContext!==null&&(r.lanes&e&&(Ot=!0),r.firstContext=null)}function ur(r){var e=r._currentValue;if(Eg!==r)if(r={context:r,memoizedValue:e,next:null},Hs===null){if(pl===null)throw Error(Z(308));Hs=r,pl.dependencies={lanes:0,firstContext:r}}else Hs=Hs.next=r;return e}var Jn=null;function xg(r){Jn===null?Jn=[r]:Jn.push(r)}function lS(r,e,t,n){var s=e.interleaved;return s===null?(t.next=t,xg(e)):(t.next=s.next,s.next=t),e.interleaved=t,en(r,n)}function en(r,e){r.lanes|=e;var t=r.alternate;for(t!==null&&(t.lanes|=e),t=r,r=r.return;r!==null;)r.childLanes|=e,t=r.alternate,t!==null&&(t.childLanes|=e),t=r,r=r.return;return t.tag===3?t.stateNode:null}var gn=!1;function Ag(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function uS(r,e){r=r.updateQueue,e.updateQueue===r&&(e.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,effects:r.effects})}function Qr(r,e){return{eventTime:r,lane:e,tag:0,payload:null,callback:null,next:null}}function bn(r,e,t){var n=r.updateQueue;if(n===null)return null;if(n=n.shared,_e&2){var s=n.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),n.pending=e,en(r,t)}return s=n.interleaved,s===null?(e.next=e,xg(n)):(e.next=s.next,s.next=e),n.interleaved=e,en(r,t)}function Bo(r,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var n=e.lanes;n&=r.pendingLanes,t|=n,e.lanes=t,ug(r,t)}}function c0(r,e){var t=r.updateQueue,n=r.alternate;if(n!==null&&(n=n.updateQueue,t===n)){var s=null,i=null;if(t=t.firstBaseUpdate,t!==null){do{var a={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};i===null?s=i=a:i=i.next=a,t=t.next}while(t!==null);i===null?s=i=e:i=i.next=e}else s=i=e;t={baseState:n.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:n.shared,effects:n.effects},r.updateQueue=t;return}r=t.lastBaseUpdate,r===null?t.firstBaseUpdate=e:r.next=e,t.lastBaseUpdate=e}function ml(r,e,t,n){var s=r.updateQueue;gn=!1;var i=s.firstBaseUpdate,a=s.lastBaseUpdate,o=s.shared.pending;if(o!==null){s.shared.pending=null;var l=o,u=l.next;l.next=null,a===null?i=u:a.next=u,a=l;var c=r.alternate;c!==null&&(c=c.updateQueue,o=c.lastBaseUpdate,o!==a&&(o===null?c.firstBaseUpdate=u:o.next=u,c.lastBaseUpdate=l))}if(i!==null){var d=s.baseState;a=0,c=u=l=null,o=i;do{var f=o.lane,h=o.eventTime;if((n&f)===f){c!==null&&(c=c.next={eventTime:h,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var g=r,p=o;switch(f=e,h=t,p.tag){case 1:if(g=p.payload,typeof g=="function"){d=g.call(h,d,f);break e}d=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=p.payload,f=typeof g=="function"?g.call(h,d,f):g,f==null)break e;d=Ke({},d,f);break e;case 2:gn=!0}}o.callback!==null&&o.lane!==0&&(r.flags|=64,f=s.effects,f===null?s.effects=[o]:f.push(o))}else h={eventTime:h,lane:f,tag:o.tag,payload:o.payload,callback:o.callback,next:null},c===null?(u=c=h,l=d):c=c.next=h,a|=f;if(o=o.next,o===null){if(o=s.shared.pending,o===null)break;f=o,o=f.next,f.next=null,s.lastBaseUpdate=f,s.shared.pending=null}}while(!0);if(c===null&&(l=d),s.baseState=l,s.firstBaseUpdate=u,s.lastBaseUpdate=c,e=s.shared.interleaved,e!==null){s=e;do a|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);ls|=a,r.lanes=a,r.memoizedState=d}}function d0(r,e,t){if(r=e.effects,e.effects=null,r!==null)for(e=0;e<r.length;e++){var n=r[e],s=n.callback;if(s!==null){if(n.callback=null,n=t,typeof s!="function")throw Error(Z(191,s));s.call(n)}}}var Pa={},$r=Fn(Pa),ua=Fn(Pa),ca=Fn(Pa);function es(r){if(r===Pa)throw Error(Z(174));return r}function wg(r,e){switch(ke(ca,e),ke(ua,r),ke($r,Pa),r=e.nodeType,r){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:$c(null,"");break;default:r=r===8?e.parentNode:e,e=r.namespaceURI||null,r=r.tagName,e=$c(e,r)}Pe($r),ke($r,e)}function ci(){Pe($r),Pe(ua),Pe(ca)}function cS(r){es(ca.current);var e=es($r.current),t=$c(e,r.type);e!==t&&(ke(ua,r),ke($r,t))}function Ig(r){ua.current===r&&(Pe($r),Pe(ua))}var Be=Fn(0);function vl(r){for(var e=r;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===r)break;for(;e.sibling===null;){if(e.return===null||e.return===r)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var bu=[];function bg(){for(var r=0;r<bu.length;r++)bu[r]._workInProgressVersionPrimary=null;bu.length=0}var jo=rn.ReactCurrentDispatcher,Ru=rn.ReactCurrentBatchConfig,os=0,Ge=null,et=null,st=null,yl=!1,Ki=!1,da=0,n1=0;function vt(){throw Error(Z(321))}function Rg(r,e){if(e===null)return!1;for(var t=0;t<e.length&&t<r.length;t++)if(!wr(r[t],e[t]))return!1;return!0}function Lg(r,e,t,n,s,i){if(os=i,Ge=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,jo.current=r===null||r.memoizedState===null?o1:l1,r=t(n,s),Ki){i=0;do{if(Ki=!1,da=0,25<=i)throw Error(Z(301));i+=1,st=et=null,e.updateQueue=null,jo.current=u1,r=t(n,s)}while(Ki)}if(jo.current=Sl,e=et!==null&&et.next!==null,os=0,st=et=Ge=null,yl=!1,e)throw Error(Z(300));return r}function kg(){var r=da!==0;return da=0,r}function kr(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return st===null?Ge.memoizedState=st=r:st=st.next=r,st}function cr(){if(et===null){var r=Ge.alternate;r=r!==null?r.memoizedState:null}else r=et.next;var e=st===null?Ge.memoizedState:st.next;if(e!==null)st=e,et=r;else{if(r===null)throw Error(Z(310));et=r,r={memoizedState:et.memoizedState,baseState:et.baseState,baseQueue:et.baseQueue,queue:et.queue,next:null},st===null?Ge.memoizedState=st=r:st=st.next=r}return st}function fa(r,e){return typeof e=="function"?e(r):e}function Lu(r){var e=cr(),t=e.queue;if(t===null)throw Error(Z(311));t.lastRenderedReducer=r;var n=et,s=n.baseQueue,i=t.pending;if(i!==null){if(s!==null){var a=s.next;s.next=i.next,i.next=a}n.baseQueue=s=i,t.pending=null}if(s!==null){i=s.next,n=n.baseState;var o=a=null,l=null,u=i;do{var c=u.lane;if((os&c)===c)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),n=u.hasEagerState?u.eagerState:r(n,u.action);else{var d={lane:c,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(o=l=d,a=n):l=l.next=d,Ge.lanes|=c,ls|=c}u=u.next}while(u!==null&&u!==i);l===null?a=n:l.next=o,wr(n,e.memoizedState)||(Ot=!0),e.memoizedState=n,e.baseState=a,e.baseQueue=l,t.lastRenderedState=n}if(r=t.interleaved,r!==null){s=r;do i=s.lane,Ge.lanes|=i,ls|=i,s=s.next;while(s!==r)}else s===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function ku(r){var e=cr(),t=e.queue;if(t===null)throw Error(Z(311));t.lastRenderedReducer=r;var n=t.dispatch,s=t.pending,i=e.memoizedState;if(s!==null){t.pending=null;var a=s=s.next;do i=r(i,a.action),a=a.next;while(a!==s);wr(i,e.memoizedState)||(Ot=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),t.lastRenderedState=i}return[i,n]}function dS(){}function fS(r,e){var t=Ge,n=cr(),s=e(),i=!wr(n.memoizedState,s);if(i&&(n.memoizedState=s,Ot=!0),n=n.queue,Cg(pS.bind(null,t,n,r),[r]),n.getSnapshot!==e||i||st!==null&&st.memoizedState.tag&1){if(t.flags|=2048,ha(9,gS.bind(null,t,n,s,e),void 0,null),it===null)throw Error(Z(349));os&30||hS(t,e,s)}return s}function hS(r,e,t){r.flags|=16384,r={getSnapshot:e,value:t},e=Ge.updateQueue,e===null?(e={lastEffect:null,stores:null},Ge.updateQueue=e,e.stores=[r]):(t=e.stores,t===null?e.stores=[r]:t.push(r))}function gS(r,e,t,n){e.value=t,e.getSnapshot=n,mS(e)&&vS(r)}function pS(r,e,t){return t(function(){mS(e)&&vS(r)})}function mS(r){var e=r.getSnapshot;r=r.value;try{var t=e();return!wr(r,t)}catch{return!0}}function vS(r){var e=en(r,1);e!==null&&Ar(e,r,1,-1)}function f0(r){var e=kr();return typeof r=="function"&&(r=r()),e.memoizedState=e.baseState=r,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:fa,lastRenderedState:r},e.queue=r,r=r.dispatch=a1.bind(null,Ge,r),[e.memoizedState,r]}function ha(r,e,t,n){return r={tag:r,create:e,destroy:t,deps:n,next:null},e=Ge.updateQueue,e===null?(e={lastEffect:null,stores:null},Ge.updateQueue=e,e.lastEffect=r.next=r):(t=e.lastEffect,t===null?e.lastEffect=r.next=r:(n=t.next,t.next=r,r.next=n,e.lastEffect=r)),r}function yS(){return cr().memoizedState}function Go(r,e,t,n){var s=kr();Ge.flags|=r,s.memoizedState=ha(1|e,t,void 0,n===void 0?null:n)}function zl(r,e,t,n){var s=cr();n=n===void 0?null:n;var i=void 0;if(et!==null){var a=et.memoizedState;if(i=a.destroy,n!==null&&Rg(n,a.deps)){s.memoizedState=ha(e,t,i,n);return}}Ge.flags|=r,s.memoizedState=ha(1|e,t,i,n)}function h0(r,e){return Go(8390656,8,r,e)}function Cg(r,e){return zl(2048,8,r,e)}function SS(r,e){return zl(4,2,r,e)}function ES(r,e){return zl(4,4,r,e)}function _S(r,e){if(typeof e=="function")return r=r(),e(r),function(){e(null)};if(e!=null)return r=r(),e.current=r,function(){e.current=null}}function TS(r,e,t){return t=t!=null?t.concat([r]):null,zl(4,4,_S.bind(null,e,r),t)}function Pg(){}function xS(r,e){var t=cr();e=e===void 0?null:e;var n=t.memoizedState;return n!==null&&e!==null&&Rg(e,n[1])?n[0]:(t.memoizedState=[r,e],r)}function AS(r,e){var t=cr();e=e===void 0?null:e;var n=t.memoizedState;return n!==null&&e!==null&&Rg(e,n[1])?n[0]:(r=r(),t.memoizedState=[r,e],r)}function wS(r,e,t){return os&21?(wr(t,e)||(t=ky(),Ge.lanes|=t,ls|=t,r.baseState=!0),e):(r.baseState&&(r.baseState=!1,Ot=!0),r.memoizedState=t)}function s1(r,e){var t=Ae;Ae=t!==0&&4>t?t:4,r(!0);var n=Ru.transition;Ru.transition={};try{r(!1),e()}finally{Ae=t,Ru.transition=n}}function IS(){return cr().memoizedState}function i1(r,e,t){var n=Ln(r);if(t={lane:n,action:t,hasEagerState:!1,eagerState:null,next:null},bS(r))RS(e,t);else if(t=lS(r,e,t,n),t!==null){var s=wt();Ar(t,r,n,s),LS(t,e,n)}}function a1(r,e,t){var n=Ln(r),s={lane:n,action:t,hasEagerState:!1,eagerState:null,next:null};if(bS(r))RS(e,s);else{var i=r.alternate;if(r.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var a=e.lastRenderedState,o=i(a,t);if(s.hasEagerState=!0,s.eagerState=o,wr(o,a)){var l=e.interleaved;l===null?(s.next=s,xg(e)):(s.next=l.next,l.next=s),e.interleaved=s;return}}catch{}finally{}t=lS(r,e,s,n),t!==null&&(s=wt(),Ar(t,r,n,s),LS(t,e,n))}}function bS(r){var e=r.alternate;return r===Ge||e!==null&&e===Ge}function RS(r,e){Ki=yl=!0;var t=r.pending;t===null?e.next=e:(e.next=t.next,t.next=e),r.pending=e}function LS(r,e,t){if(t&4194240){var n=e.lanes;n&=r.pendingLanes,t|=n,e.lanes=t,ug(r,t)}}var Sl={readContext:ur,useCallback:vt,useContext:vt,useEffect:vt,useImperativeHandle:vt,useInsertionEffect:vt,useLayoutEffect:vt,useMemo:vt,useReducer:vt,useRef:vt,useState:vt,useDebugValue:vt,useDeferredValue:vt,useTransition:vt,useMutableSource:vt,useSyncExternalStore:vt,useId:vt,unstable_isNewReconciler:!1},o1={readContext:ur,useCallback:function(r,e){return kr().memoizedState=[r,e===void 0?null:e],r},useContext:ur,useEffect:h0,useImperativeHandle:function(r,e,t){return t=t!=null?t.concat([r]):null,Go(4194308,4,_S.bind(null,e,r),t)},useLayoutEffect:function(r,e){return Go(4194308,4,r,e)},useInsertionEffect:function(r,e){return Go(4,2,r,e)},useMemo:function(r,e){var t=kr();return e=e===void 0?null:e,r=r(),t.memoizedState=[r,e],r},useReducer:function(r,e,t){var n=kr();return e=t!==void 0?t(e):e,n.memoizedState=n.baseState=e,r={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:e},n.queue=r,r=r.dispatch=i1.bind(null,Ge,r),[n.memoizedState,r]},useRef:function(r){var e=kr();return r={current:r},e.memoizedState=r},useState:f0,useDebugValue:Pg,useDeferredValue:function(r){return kr().memoizedState=r},useTransition:function(){var r=f0(!1),e=r[0];return r=s1.bind(null,r[1]),kr().memoizedState=r,[e,r]},useMutableSource:function(){},useSyncExternalStore:function(r,e,t){var n=Ge,s=kr();if(Me){if(t===void 0)throw Error(Z(407));t=t()}else{if(t=e(),it===null)throw Error(Z(349));os&30||hS(n,e,t)}s.memoizedState=t;var i={value:t,getSnapshot:e};return s.queue=i,h0(pS.bind(null,n,i,r),[r]),n.flags|=2048,ha(9,gS.bind(null,n,i,t,e),void 0,null),t},useId:function(){var r=kr(),e=it.identifierPrefix;if(Me){var t=Zr,n=Yr;t=(n&~(1<<32-xr(n)-1)).toString(32)+t,e=":"+e+"R"+t,t=da++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=n1++,e=":"+e+"r"+t.toString(32)+":";return r.memoizedState=e},unstable_isNewReconciler:!1},l1={readContext:ur,useCallback:xS,useContext:ur,useEffect:Cg,useImperativeHandle:TS,useInsertionEffect:SS,useLayoutEffect:ES,useMemo:AS,useReducer:Lu,useRef:yS,useState:function(){return Lu(fa)},useDebugValue:Pg,useDeferredValue:function(r){var e=cr();return wS(e,et.memoizedState,r)},useTransition:function(){var r=Lu(fa)[0],e=cr().memoizedState;return[r,e]},useMutableSource:dS,useSyncExternalStore:fS,useId:IS,unstable_isNewReconciler:!1},u1={readContext:ur,useCallback:xS,useContext:ur,useEffect:Cg,useImperativeHandle:TS,useInsertionEffect:SS,useLayoutEffect:ES,useMemo:AS,useReducer:ku,useRef:yS,useState:function(){return ku(fa)},useDebugValue:Pg,useDeferredValue:function(r){var e=cr();return et===null?e.memoizedState=r:wS(e,et.memoizedState,r)},useTransition:function(){var r=ku(fa)[0],e=cr().memoizedState;return[r,e]},useMutableSource:dS,useSyncExternalStore:fS,useId:IS,unstable_isNewReconciler:!1};function yr(r,e){if(r&&r.defaultProps){e=Ke({},e),r=r.defaultProps;for(var t in r)e[t]===void 0&&(e[t]=r[t]);return e}return e}function id(r,e,t,n){e=r.memoizedState,t=t(n,e),t=t==null?e:Ke({},e,t),r.memoizedState=t,r.lanes===0&&(r.updateQueue.baseState=t)}var ql={isMounted:function(r){return(r=r._reactInternals)?fs(r)===r:!1},enqueueSetState:function(r,e,t){r=r._reactInternals;var n=wt(),s=Ln(r),i=Qr(n,s);i.payload=e,t!=null&&(i.callback=t),e=bn(r,i,s),e!==null&&(Ar(e,r,s,n),Bo(e,r,s))},enqueueReplaceState:function(r,e,t){r=r._reactInternals;var n=wt(),s=Ln(r),i=Qr(n,s);i.tag=1,i.payload=e,t!=null&&(i.callback=t),e=bn(r,i,s),e!==null&&(Ar(e,r,s,n),Bo(e,r,s))},enqueueForceUpdate:function(r,e){r=r._reactInternals;var t=wt(),n=Ln(r),s=Qr(t,n);s.tag=2,e!=null&&(s.callback=e),e=bn(r,s,n),e!==null&&(Ar(e,r,n,t),Bo(e,r,n))}};function g0(r,e,t,n,s,i,a){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(n,i,a):e.prototype&&e.prototype.isPureReactComponent?!ia(t,n)||!ia(s,i):!0}function kS(r,e,t){var n=!1,s=Dn,i=e.contextType;return typeof i=="object"&&i!==null?i=ur(i):(s=Ft(e)?is:_t.current,n=e.contextTypes,i=(n=n!=null)?oi(r,s):Dn),e=new e(t,i),r.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=ql,r.stateNode=e,e._reactInternals=r,n&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=s,r.__reactInternalMemoizedMaskedChildContext=i),e}function p0(r,e,t,n){r=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,n),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,n),e.state!==r&&ql.enqueueReplaceState(e,e.state,null)}function ad(r,e,t,n){var s=r.stateNode;s.props=t,s.state=r.memoizedState,s.refs={},Ag(r);var i=e.contextType;typeof i=="object"&&i!==null?s.context=ur(i):(i=Ft(e)?is:_t.current,s.context=oi(r,i)),s.state=r.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(id(r,e,i,t),s.state=r.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&ql.enqueueReplaceState(s,s.state,null),ml(r,t,s,n),s.state=r.memoizedState),typeof s.componentDidMount=="function"&&(r.flags|=4194308)}function di(r,e){try{var t="",n=e;do t+=Fx(n),n=n.return;while(n);var s=t}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:r,source:e,stack:s,digest:null}}function Cu(r,e,t){return{value:r,source:null,stack:t??null,digest:e??null}}function od(r,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var c1=typeof WeakMap=="function"?WeakMap:Map;function CS(r,e,t){t=Qr(-1,t),t.tag=3,t.payload={element:null};var n=e.value;return t.callback=function(){_l||(_l=!0,vd=n),od(r,e)},t}function PS(r,e,t){t=Qr(-1,t),t.tag=3;var n=r.type.getDerivedStateFromError;if(typeof n=="function"){var s=e.value;t.payload=function(){return n(s)},t.callback=function(){od(r,e)}}var i=r.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(t.callback=function(){od(r,e),typeof n!="function"&&(Rn===null?Rn=new Set([this]):Rn.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),t}function m0(r,e,t){var n=r.pingCache;if(n===null){n=r.pingCache=new c1;var s=new Set;n.set(e,s)}else s=n.get(e),s===void 0&&(s=new Set,n.set(e,s));s.has(t)||(s.add(t),r=A1.bind(null,r,e,t),e.then(r,r))}function v0(r){do{var e;if((e=r.tag===13)&&(e=r.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return r;r=r.return}while(r!==null);return null}function y0(r,e,t,n,s){return r.mode&1?(r.flags|=65536,r.lanes=s,r):(r===e?r.flags|=65536:(r.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=Qr(-1,1),e.tag=2,bn(t,e,1))),t.lanes|=1),r)}var d1=rn.ReactCurrentOwner,Ot=!1;function Tt(r,e,t,n){e.child=r===null?oS(e,null,t,n):ui(e,r.child,t,n)}function S0(r,e,t,n,s){t=t.render;var i=e.ref;return Js(e,s),n=Lg(r,e,t,n,i,s),t=kg(),r!==null&&!Ot?(e.updateQueue=r.updateQueue,e.flags&=-2053,r.lanes&=~s,tn(r,e,s)):(Me&&t&&vg(e),e.flags|=1,Tt(r,e,n,s),e.child)}function E0(r,e,t,n,s){if(r===null){var i=t.type;return typeof i=="function"&&!Bg(i)&&i.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=i,DS(r,e,i,n,s)):(r=Wo(t.type,null,n,e,e.mode,s),r.ref=e.ref,r.return=e,e.child=r)}if(i=r.child,!(r.lanes&s)){var a=i.memoizedProps;if(t=t.compare,t=t!==null?t:ia,t(a,n)&&r.ref===e.ref)return tn(r,e,s)}return e.flags|=1,r=kn(i,n),r.ref=e.ref,r.return=e,e.child=r}function DS(r,e,t,n,s){if(r!==null){var i=r.memoizedProps;if(ia(i,n)&&r.ref===e.ref)if(Ot=!1,e.pendingProps=n=i,(r.lanes&s)!==0)r.flags&131072&&(Ot=!0);else return e.lanes=r.lanes,tn(r,e,s)}return ld(r,e,t,n,s)}function OS(r,e,t){var n=e.pendingProps,s=n.children,i=r!==null?r.memoizedState:null;if(n.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},ke(Ws,qt),qt|=t;else{if(!(t&1073741824))return r=i!==null?i.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:r,cachePool:null,transitions:null},e.updateQueue=null,ke(Ws,qt),qt|=r,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=i!==null?i.baseLanes:t,ke(Ws,qt),qt|=n}else i!==null?(n=i.baseLanes|t,e.memoizedState=null):n=t,ke(Ws,qt),qt|=n;return Tt(r,e,s,t),e.child}function MS(r,e){var t=e.ref;(r===null&&t!==null||r!==null&&r.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function ld(r,e,t,n,s){var i=Ft(t)?is:_t.current;return i=oi(e,i),Js(e,s),t=Lg(r,e,t,n,i,s),n=kg(),r!==null&&!Ot?(e.updateQueue=r.updateQueue,e.flags&=-2053,r.lanes&=~s,tn(r,e,s)):(Me&&n&&vg(e),e.flags|=1,Tt(r,e,t,s),e.child)}function _0(r,e,t,n,s){if(Ft(t)){var i=!0;dl(e)}else i=!1;if(Js(e,s),e.stateNode===null)Ko(r,e),kS(e,t,n),ad(e,t,n,s),n=!0;else if(r===null){var a=e.stateNode,o=e.memoizedProps;a.props=o;var l=a.context,u=t.contextType;typeof u=="object"&&u!==null?u=ur(u):(u=Ft(t)?is:_t.current,u=oi(e,u));var c=t.getDerivedStateFromProps,d=typeof c=="function"||typeof a.getSnapshotBeforeUpdate=="function";d||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==n||l!==u)&&p0(e,a,n,u),gn=!1;var f=e.memoizedState;a.state=f,ml(e,n,a,s),l=e.memoizedState,o!==n||f!==l||Nt.current||gn?(typeof c=="function"&&(id(e,t,c,n),l=e.memoizedState),(o=gn||g0(e,t,o,n,f,l,u))?(d||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=n,e.memoizedState=l),a.props=n,a.state=l,a.context=u,n=o):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),n=!1)}else{a=e.stateNode,uS(r,e),o=e.memoizedProps,u=e.type===e.elementType?o:yr(e.type,o),a.props=u,d=e.pendingProps,f=a.context,l=t.contextType,typeof l=="object"&&l!==null?l=ur(l):(l=Ft(t)?is:_t.current,l=oi(e,l));var h=t.getDerivedStateFromProps;(c=typeof h=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==d||f!==l)&&p0(e,a,n,l),gn=!1,f=e.memoizedState,a.state=f,ml(e,n,a,s);var g=e.memoizedState;o!==d||f!==g||Nt.current||gn?(typeof h=="function"&&(id(e,t,h,n),g=e.memoizedState),(u=gn||g0(e,t,u,n,f,g,l)||!1)?(c||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(n,g,l),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(n,g,l)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||o===r.memoizedProps&&f===r.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===r.memoizedProps&&f===r.memoizedState||(e.flags|=1024),e.memoizedProps=n,e.memoizedState=g),a.props=n,a.state=g,a.context=l,n=u):(typeof a.componentDidUpdate!="function"||o===r.memoizedProps&&f===r.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===r.memoizedProps&&f===r.memoizedState||(e.flags|=1024),n=!1)}return ud(r,e,t,n,i,s)}function ud(r,e,t,n,s,i){MS(r,e);var a=(e.flags&128)!==0;if(!n&&!a)return s&&a0(e,t,!1),tn(r,e,i);n=e.stateNode,d1.current=e;var o=a&&typeof t.getDerivedStateFromError!="function"?null:n.render();return e.flags|=1,r!==null&&a?(e.child=ui(e,r.child,null,i),e.child=ui(e,null,o,i)):Tt(r,e,o,i),e.memoizedState=n.state,s&&a0(e,t,!0),e.child}function NS(r){var e=r.stateNode;e.pendingContext?i0(r,e.pendingContext,e.pendingContext!==e.context):e.context&&i0(r,e.context,!1),wg(r,e.containerInfo)}function T0(r,e,t,n,s){return li(),Sg(s),e.flags|=256,Tt(r,e,t,n),e.child}var cd={dehydrated:null,treeContext:null,retryLane:0};function dd(r){return{baseLanes:r,cachePool:null,transitions:null}}function FS(r,e,t){var n=e.pendingProps,s=Be.current,i=!1,a=(e.flags&128)!==0,o;if((o=a)||(o=r!==null&&r.memoizedState===null?!1:(s&2)!==0),o?(i=!0,e.flags&=-129):(r===null||r.memoizedState!==null)&&(s|=1),ke(Be,s&1),r===null)return nd(e),r=e.memoizedState,r!==null&&(r=r.dehydrated,r!==null)?(e.mode&1?r.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=n.children,r=n.fallback,i?(n=e.mode,i=e.child,a={mode:"hidden",children:a},!(n&1)&&i!==null?(i.childLanes=0,i.pendingProps=a):i=Ql(a,n,0,null),r=ns(r,n,t,null),i.return=e,r.return=e,i.sibling=r,e.child=i,e.child.memoizedState=dd(t),e.memoizedState=cd,r):Dg(e,a));if(s=r.memoizedState,s!==null&&(o=s.dehydrated,o!==null))return f1(r,e,a,n,o,s,t);if(i){i=n.fallback,a=e.mode,s=r.child,o=s.sibling;var l={mode:"hidden",children:n.children};return!(a&1)&&e.child!==s?(n=e.child,n.childLanes=0,n.pendingProps=l,e.deletions=null):(n=kn(s,l),n.subtreeFlags=s.subtreeFlags&14680064),o!==null?i=kn(o,i):(i=ns(i,a,t,null),i.flags|=2),i.return=e,n.return=e,n.sibling=i,e.child=n,n=i,i=e.child,a=r.child.memoizedState,a=a===null?dd(t):{baseLanes:a.baseLanes|t,cachePool:null,transitions:a.transitions},i.memoizedState=a,i.childLanes=r.childLanes&~t,e.memoizedState=cd,n}return i=r.child,r=i.sibling,n=kn(i,{mode:"visible",children:n.children}),!(e.mode&1)&&(n.lanes=t),n.return=e,n.sibling=null,r!==null&&(t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)),e.child=n,e.memoizedState=null,n}function Dg(r,e){return e=Ql({mode:"visible",children:e},r.mode,0,null),e.return=r,r.child=e}function ao(r,e,t,n){return n!==null&&Sg(n),ui(e,r.child,null,t),r=Dg(e,e.pendingProps.children),r.flags|=2,e.memoizedState=null,r}function f1(r,e,t,n,s,i,a){if(t)return e.flags&256?(e.flags&=-257,n=Cu(Error(Z(422))),ao(r,e,a,n)):e.memoizedState!==null?(e.child=r.child,e.flags|=128,null):(i=n.fallback,s=e.mode,n=Ql({mode:"visible",children:n.children},s,0,null),i=ns(i,s,a,null),i.flags|=2,n.return=e,i.return=e,n.sibling=i,e.child=n,e.mode&1&&ui(e,r.child,null,a),e.child.memoizedState=dd(a),e.memoizedState=cd,i);if(!(e.mode&1))return ao(r,e,a,null);if(s.data==="$!"){if(n=s.nextSibling&&s.nextSibling.dataset,n)var o=n.dgst;return n=o,i=Error(Z(419)),n=Cu(i,n,void 0),ao(r,e,a,n)}if(o=(a&r.childLanes)!==0,Ot||o){if(n=it,n!==null){switch(a&-a){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(n.suspendedLanes|a)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,en(r,s),Ar(n,r,s,-1))}return Ug(),n=Cu(Error(Z(421))),ao(r,e,a,n)}return s.data==="$?"?(e.flags|=128,e.child=r.child,e=w1.bind(null,r),s._reactRetry=e,null):(r=i.treeContext,Xt=In(s.nextSibling),Jt=e,Me=!0,Tr=null,r!==null&&(sr[ir++]=Yr,sr[ir++]=Zr,sr[ir++]=as,Yr=r.id,Zr=r.overflow,as=e),e=Dg(e,n.children),e.flags|=4096,e)}function x0(r,e,t){r.lanes|=e;var n=r.alternate;n!==null&&(n.lanes|=e),sd(r.return,e,t)}function Pu(r,e,t,n,s){var i=r.memoizedState;i===null?r.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:t,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=n,i.tail=t,i.tailMode=s)}function $S(r,e,t){var n=e.pendingProps,s=n.revealOrder,i=n.tail;if(Tt(r,e,n.children,t),n=Be.current,n&2)n=n&1|2,e.flags|=128;else{if(r!==null&&r.flags&128)e:for(r=e.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&x0(r,t,e);else if(r.tag===19)x0(r,t,e);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break e;for(;r.sibling===null;){if(r.return===null||r.return===e)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}n&=1}if(ke(Be,n),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(t=e.child,s=null;t!==null;)r=t.alternate,r!==null&&vl(r)===null&&(s=t),t=t.sibling;t=s,t===null?(s=e.child,e.child=null):(s=t.sibling,t.sibling=null),Pu(e,!1,s,t,i);break;case"backwards":for(t=null,s=e.child,e.child=null;s!==null;){if(r=s.alternate,r!==null&&vl(r)===null){e.child=s;break}r=s.sibling,s.sibling=t,t=s,s=r}Pu(e,!0,t,null,i);break;case"together":Pu(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Ko(r,e){!(e.mode&1)&&r!==null&&(r.alternate=null,e.alternate=null,e.flags|=2)}function tn(r,e,t){if(r!==null&&(e.dependencies=r.dependencies),ls|=e.lanes,!(t&e.childLanes))return null;if(r!==null&&e.child!==r.child)throw Error(Z(153));if(e.child!==null){for(r=e.child,t=kn(r,r.pendingProps),e.child=t,t.return=e;r.sibling!==null;)r=r.sibling,t=t.sibling=kn(r,r.pendingProps),t.return=e;t.sibling=null}return e.child}function h1(r,e,t){switch(e.tag){case 3:NS(e),li();break;case 5:cS(e);break;case 1:Ft(e.type)&&dl(e);break;case 4:wg(e,e.stateNode.containerInfo);break;case 10:var n=e.type._context,s=e.memoizedProps.value;ke(gl,n._currentValue),n._currentValue=s;break;case 13:if(n=e.memoizedState,n!==null)return n.dehydrated!==null?(ke(Be,Be.current&1),e.flags|=128,null):t&e.child.childLanes?FS(r,e,t):(ke(Be,Be.current&1),r=tn(r,e,t),r!==null?r.sibling:null);ke(Be,Be.current&1);break;case 19:if(n=(t&e.childLanes)!==0,r.flags&128){if(n)return $S(r,e,t);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),ke(Be,Be.current),n)break;return null;case 22:case 23:return e.lanes=0,OS(r,e,t)}return tn(r,e,t)}var US,fd,BS,jS;US=function(r,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)r.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};fd=function(){};BS=function(r,e,t,n){var s=r.memoizedProps;if(s!==n){r=e.stateNode,es($r.current);var i=null;switch(t){case"input":s=Oc(r,s),n=Oc(r,n),i=[];break;case"select":s=Ke({},s,{value:void 0}),n=Ke({},n,{value:void 0}),i=[];break;case"textarea":s=Fc(r,s),n=Fc(r,n),i=[];break;default:typeof s.onClick!="function"&&typeof n.onClick=="function"&&(r.onclick=ul)}Uc(t,n);var a;t=null;for(u in s)if(!n.hasOwnProperty(u)&&s.hasOwnProperty(u)&&s[u]!=null)if(u==="style"){var o=s[u];for(a in o)o.hasOwnProperty(a)&&(t||(t={}),t[a]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Xi.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in n){var l=n[u];if(o=s!=null?s[u]:void 0,n.hasOwnProperty(u)&&l!==o&&(l!=null||o!=null))if(u==="style")if(o){for(a in o)!o.hasOwnProperty(a)||l&&l.hasOwnProperty(a)||(t||(t={}),t[a]="");for(a in l)l.hasOwnProperty(a)&&o[a]!==l[a]&&(t||(t={}),t[a]=l[a])}else t||(i||(i=[]),i.push(u,t)),t=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,o=o?o.__html:void 0,l!=null&&o!==l&&(i=i||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Xi.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&Ce("scroll",r),i||o===l||(i=[])):(i=i||[]).push(u,l))}t&&(i=i||[]).push("style",t);var u=i;(e.updateQueue=u)&&(e.flags|=4)}};jS=function(r,e,t,n){t!==n&&(e.flags|=4)};function Li(r,e){if(!Me)switch(r.tailMode){case"hidden":e=r.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?r.tail=null:t.sibling=null;break;case"collapsed":t=r.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e||r.tail===null?r.tail=null:r.tail.sibling=null:n.sibling=null}}function yt(r){var e=r.alternate!==null&&r.alternate.child===r.child,t=0,n=0;if(e)for(var s=r.child;s!==null;)t|=s.lanes|s.childLanes,n|=s.subtreeFlags&14680064,n|=s.flags&14680064,s.return=r,s=s.sibling;else for(s=r.child;s!==null;)t|=s.lanes|s.childLanes,n|=s.subtreeFlags,n|=s.flags,s.return=r,s=s.sibling;return r.subtreeFlags|=n,r.childLanes=t,e}function g1(r,e,t){var n=e.pendingProps;switch(yg(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return yt(e),null;case 1:return Ft(e.type)&&cl(),yt(e),null;case 3:return n=e.stateNode,ci(),Pe(Nt),Pe(_t),bg(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(r===null||r.child===null)&&(so(e)?e.flags|=4:r===null||r.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Tr!==null&&(Ed(Tr),Tr=null))),fd(r,e),yt(e),null;case 5:Ig(e);var s=es(ca.current);if(t=e.type,r!==null&&e.stateNode!=null)BS(r,e,t,n,s),r.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!n){if(e.stateNode===null)throw Error(Z(166));return yt(e),null}if(r=es($r.current),so(e)){n=e.stateNode,t=e.type;var i=e.memoizedProps;switch(n[Dr]=e,n[la]=i,r=(e.mode&1)!==0,t){case"dialog":Ce("cancel",n),Ce("close",n);break;case"iframe":case"object":case"embed":Ce("load",n);break;case"video":case"audio":for(s=0;s<Mi.length;s++)Ce(Mi[s],n);break;case"source":Ce("error",n);break;case"img":case"image":case"link":Ce("error",n),Ce("load",n);break;case"details":Ce("toggle",n);break;case"input":Pp(n,i),Ce("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!i.multiple},Ce("invalid",n);break;case"textarea":Op(n,i),Ce("invalid",n)}Uc(t,i),s=null;for(var a in i)if(i.hasOwnProperty(a)){var o=i[a];a==="children"?typeof o=="string"?n.textContent!==o&&(i.suppressHydrationWarning!==!0&&no(n.textContent,o,r),s=["children",o]):typeof o=="number"&&n.textContent!==""+o&&(i.suppressHydrationWarning!==!0&&no(n.textContent,o,r),s=["children",""+o]):Xi.hasOwnProperty(a)&&o!=null&&a==="onScroll"&&Ce("scroll",n)}switch(t){case"input":Ya(n),Dp(n,i,!0);break;case"textarea":Ya(n),Mp(n);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(n.onclick=ul)}n=s,e.updateQueue=n,n!==null&&(e.flags|=4)}else{a=s.nodeType===9?s:s.ownerDocument,r==="http://www.w3.org/1999/xhtml"&&(r=py(t)),r==="http://www.w3.org/1999/xhtml"?t==="script"?(r=a.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild)):typeof n.is=="string"?r=a.createElement(t,{is:n.is}):(r=a.createElement(t),t==="select"&&(a=r,n.multiple?a.multiple=!0:n.size&&(a.size=n.size))):r=a.createElementNS(r,t),r[Dr]=e,r[la]=n,US(r,e,!1,!1),e.stateNode=r;e:{switch(a=Bc(t,n),t){case"dialog":Ce("cancel",r),Ce("close",r),s=n;break;case"iframe":case"object":case"embed":Ce("load",r),s=n;break;case"video":case"audio":for(s=0;s<Mi.length;s++)Ce(Mi[s],r);s=n;break;case"source":Ce("error",r),s=n;break;case"img":case"image":case"link":Ce("error",r),Ce("load",r),s=n;break;case"details":Ce("toggle",r),s=n;break;case"input":Pp(r,n),s=Oc(r,n),Ce("invalid",r);break;case"option":s=n;break;case"select":r._wrapperState={wasMultiple:!!n.multiple},s=Ke({},n,{value:void 0}),Ce("invalid",r);break;case"textarea":Op(r,n),s=Fc(r,n),Ce("invalid",r);break;default:s=n}Uc(t,s),o=s;for(i in o)if(o.hasOwnProperty(i)){var l=o[i];i==="style"?yy(r,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&my(r,l)):i==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&Ji(r,l):typeof l=="number"&&Ji(r,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Xi.hasOwnProperty(i)?l!=null&&i==="onScroll"&&Ce("scroll",r):l!=null&&ng(r,i,l,a))}switch(t){case"input":Ya(r),Dp(r,n,!1);break;case"textarea":Ya(r),Mp(r);break;case"option":n.value!=null&&r.setAttribute("value",""+Pn(n.value));break;case"select":r.multiple=!!n.multiple,i=n.value,i!=null?Ys(r,!!n.multiple,i,!1):n.defaultValue!=null&&Ys(r,!!n.multiple,n.defaultValue,!0);break;default:typeof s.onClick=="function"&&(r.onclick=ul)}switch(t){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return yt(e),null;case 6:if(r&&e.stateNode!=null)jS(r,e,r.memoizedProps,n);else{if(typeof n!="string"&&e.stateNode===null)throw Error(Z(166));if(t=es(ca.current),es($r.current),so(e)){if(n=e.stateNode,t=e.memoizedProps,n[Dr]=e,(i=n.nodeValue!==t)&&(r=Jt,r!==null))switch(r.tag){case 3:no(n.nodeValue,t,(r.mode&1)!==0);break;case 5:r.memoizedProps.suppressHydrationWarning!==!0&&no(n.nodeValue,t,(r.mode&1)!==0)}i&&(e.flags|=4)}else n=(t.nodeType===9?t:t.ownerDocument).createTextNode(n),n[Dr]=e,e.stateNode=n}return yt(e),null;case 13:if(Pe(Be),n=e.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(Me&&Xt!==null&&e.mode&1&&!(e.flags&128))iS(),li(),e.flags|=98560,i=!1;else if(i=so(e),n!==null&&n.dehydrated!==null){if(r===null){if(!i)throw Error(Z(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Z(317));i[Dr]=e}else li(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;yt(e),i=!1}else Tr!==null&&(Ed(Tr),Tr=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(n=n!==null,n!==(r!==null&&r.memoizedState!==null)&&n&&(e.child.flags|=8192,e.mode&1&&(r===null||Be.current&1?rt===0&&(rt=3):Ug())),e.updateQueue!==null&&(e.flags|=4),yt(e),null);case 4:return ci(),fd(r,e),r===null&&aa(e.stateNode.containerInfo),yt(e),null;case 10:return Tg(e.type._context),yt(e),null;case 17:return Ft(e.type)&&cl(),yt(e),null;case 19:if(Pe(Be),i=e.memoizedState,i===null)return yt(e),null;if(n=(e.flags&128)!==0,a=i.rendering,a===null)if(n)Li(i,!1);else{if(rt!==0||r!==null&&r.flags&128)for(r=e.child;r!==null;){if(a=vl(r),a!==null){for(e.flags|=128,Li(i,!1),n=a.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),e.subtreeFlags=0,n=t,t=e.child;t!==null;)i=t,r=n,i.flags&=14680066,a=i.alternate,a===null?(i.childLanes=0,i.lanes=r,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=a.childLanes,i.lanes=a.lanes,i.child=a.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=a.memoizedProps,i.memoizedState=a.memoizedState,i.updateQueue=a.updateQueue,i.type=a.type,r=a.dependencies,i.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),t=t.sibling;return ke(Be,Be.current&1|2),e.child}r=r.sibling}i.tail!==null&&ze()>fi&&(e.flags|=128,n=!0,Li(i,!1),e.lanes=4194304)}else{if(!n)if(r=vl(a),r!==null){if(e.flags|=128,n=!0,t=r.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),Li(i,!0),i.tail===null&&i.tailMode==="hidden"&&!a.alternate&&!Me)return yt(e),null}else 2*ze()-i.renderingStartTime>fi&&t!==1073741824&&(e.flags|=128,n=!0,Li(i,!1),e.lanes=4194304);i.isBackwards?(a.sibling=e.child,e.child=a):(t=i.last,t!==null?t.sibling=a:e.child=a,i.last=a)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=ze(),e.sibling=null,t=Be.current,ke(Be,n?t&1|2:t&1),e):(yt(e),null);case 22:case 23:return $g(),n=e.memoizedState!==null,r!==null&&r.memoizedState!==null!==n&&(e.flags|=8192),n&&e.mode&1?qt&1073741824&&(yt(e),e.subtreeFlags&6&&(e.flags|=8192)):yt(e),null;case 24:return null;case 25:return null}throw Error(Z(156,e.tag))}function p1(r,e){switch(yg(e),e.tag){case 1:return Ft(e.type)&&cl(),r=e.flags,r&65536?(e.flags=r&-65537|128,e):null;case 3:return ci(),Pe(Nt),Pe(_t),bg(),r=e.flags,r&65536&&!(r&128)?(e.flags=r&-65537|128,e):null;case 5:return Ig(e),null;case 13:if(Pe(Be),r=e.memoizedState,r!==null&&r.dehydrated!==null){if(e.alternate===null)throw Error(Z(340));li()}return r=e.flags,r&65536?(e.flags=r&-65537|128,e):null;case 19:return Pe(Be),null;case 4:return ci(),null;case 10:return Tg(e.type._context),null;case 22:case 23:return $g(),null;case 24:return null;default:return null}}var oo=!1,Et=!1,m1=typeof WeakSet=="function"?WeakSet:Set,te=null;function Vs(r,e){var t=r.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(n){We(r,e,n)}else t.current=null}function hd(r,e,t){try{t()}catch(n){We(r,e,n)}}var A0=!1;function v1(r,e){if(Zc=al,r=Wy(),mg(r)){if("selectionStart"in r)var t={start:r.selectionStart,end:r.selectionEnd};else e:{t=(t=r.ownerDocument)&&t.defaultView||window;var n=t.getSelection&&t.getSelection();if(n&&n.rangeCount!==0){t=n.anchorNode;var s=n.anchorOffset,i=n.focusNode;n=n.focusOffset;try{t.nodeType,i.nodeType}catch{t=null;break e}var a=0,o=-1,l=-1,u=0,c=0,d=r,f=null;t:for(;;){for(var h;d!==t||s!==0&&d.nodeType!==3||(o=a+s),d!==i||n!==0&&d.nodeType!==3||(l=a+n),d.nodeType===3&&(a+=d.nodeValue.length),(h=d.firstChild)!==null;)f=d,d=h;for(;;){if(d===r)break t;if(f===t&&++u===s&&(o=a),f===i&&++c===n&&(l=a),(h=d.nextSibling)!==null)break;d=f,f=d.parentNode}d=h}t=o===-1||l===-1?null:{start:o,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(Qc={focusedElem:r,selectionRange:t},al=!1,te=e;te!==null;)if(e=te,r=e.child,(e.subtreeFlags&1028)!==0&&r!==null)r.return=e,te=r;else for(;te!==null;){e=te;try{var g=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(g!==null){var p=g.memoizedProps,v=g.memoizedState,m=e.stateNode,y=m.getSnapshotBeforeUpdate(e.elementType===e.type?p:yr(e.type,p),v);m.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var S=e.stateNode.containerInfo;S.nodeType===1?S.textContent="":S.nodeType===9&&S.documentElement&&S.removeChild(S.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Z(163))}}catch(E){We(e,e.return,E)}if(r=e.sibling,r!==null){r.return=e.return,te=r;break}te=e.return}return g=A0,A0=!1,g}function Hi(r,e,t){var n=e.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var s=n=n.next;do{if((s.tag&r)===r){var i=s.destroy;s.destroy=void 0,i!==void 0&&hd(e,t,i)}s=s.next}while(s!==n)}}function Yl(r,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&r)===r){var n=t.create;t.destroy=n()}t=t.next}while(t!==e)}}function gd(r){var e=r.ref;if(e!==null){var t=r.stateNode;switch(r.tag){case 5:r=t;break;default:r=t}typeof e=="function"?e(r):e.current=r}}function GS(r){var e=r.alternate;e!==null&&(r.alternate=null,GS(e)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(e=r.stateNode,e!==null&&(delete e[Dr],delete e[la],delete e[ed],delete e[JA],delete e[e1])),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}function KS(r){return r.tag===5||r.tag===3||r.tag===4}function w0(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||KS(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function pd(r,e,t){var n=r.tag;if(n===5||n===6)r=r.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(r,e):t.insertBefore(r,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(r,t)):(e=t,e.appendChild(r)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=ul));else if(n!==4&&(r=r.child,r!==null))for(pd(r,e,t),r=r.sibling;r!==null;)pd(r,e,t),r=r.sibling}function md(r,e,t){var n=r.tag;if(n===5||n===6)r=r.stateNode,e?t.insertBefore(r,e):t.appendChild(r);else if(n!==4&&(r=r.child,r!==null))for(md(r,e,t),r=r.sibling;r!==null;)md(r,e,t),r=r.sibling}var ut=null,Er=!1;function cn(r,e,t){for(t=t.child;t!==null;)HS(r,e,t),t=t.sibling}function HS(r,e,t){if(Fr&&typeof Fr.onCommitFiberUnmount=="function")try{Fr.onCommitFiberUnmount(jl,t)}catch{}switch(t.tag){case 5:Et||Vs(t,e);case 6:var n=ut,s=Er;ut=null,cn(r,e,t),ut=n,Er=s,ut!==null&&(Er?(r=ut,t=t.stateNode,r.nodeType===8?r.parentNode.removeChild(t):r.removeChild(t)):ut.removeChild(t.stateNode));break;case 18:ut!==null&&(Er?(r=ut,t=t.stateNode,r.nodeType===8?wu(r.parentNode,t):r.nodeType===1&&wu(r,t),na(r)):wu(ut,t.stateNode));break;case 4:n=ut,s=Er,ut=t.stateNode.containerInfo,Er=!0,cn(r,e,t),ut=n,Er=s;break;case 0:case 11:case 14:case 15:if(!Et&&(n=t.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){s=n=n.next;do{var i=s,a=i.destroy;i=i.tag,a!==void 0&&(i&2||i&4)&&hd(t,e,a),s=s.next}while(s!==n)}cn(r,e,t);break;case 1:if(!Et&&(Vs(t,e),n=t.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=t.memoizedProps,n.state=t.memoizedState,n.componentWillUnmount()}catch(o){We(t,e,o)}cn(r,e,t);break;case 21:cn(r,e,t);break;case 22:t.mode&1?(Et=(n=Et)||t.memoizedState!==null,cn(r,e,t),Et=n):cn(r,e,t);break;default:cn(r,e,t)}}function I0(r){var e=r.updateQueue;if(e!==null){r.updateQueue=null;var t=r.stateNode;t===null&&(t=r.stateNode=new m1),e.forEach(function(n){var s=I1.bind(null,r,n);t.has(n)||(t.add(n),n.then(s,s))})}}function gr(r,e){var t=e.deletions;if(t!==null)for(var n=0;n<t.length;n++){var s=t[n];try{var i=r,a=e,o=a;e:for(;o!==null;){switch(o.tag){case 5:ut=o.stateNode,Er=!1;break e;case 3:ut=o.stateNode.containerInfo,Er=!0;break e;case 4:ut=o.stateNode.containerInfo,Er=!0;break e}o=o.return}if(ut===null)throw Error(Z(160));HS(i,a,s),ut=null,Er=!1;var l=s.alternate;l!==null&&(l.return=null),s.return=null}catch(u){We(s,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)VS(e,r),e=e.sibling}function VS(r,e){var t=r.alternate,n=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:if(gr(e,r),br(r),n&4){try{Hi(3,r,r.return),Yl(3,r)}catch(p){We(r,r.return,p)}try{Hi(5,r,r.return)}catch(p){We(r,r.return,p)}}break;case 1:gr(e,r),br(r),n&512&&t!==null&&Vs(t,t.return);break;case 5:if(gr(e,r),br(r),n&512&&t!==null&&Vs(t,t.return),r.flags&32){var s=r.stateNode;try{Ji(s,"")}catch(p){We(r,r.return,p)}}if(n&4&&(s=r.stateNode,s!=null)){var i=r.memoizedProps,a=t!==null?t.memoizedProps:i,o=r.type,l=r.updateQueue;if(r.updateQueue=null,l!==null)try{o==="input"&&i.type==="radio"&&i.name!=null&&hy(s,i),Bc(o,a);var u=Bc(o,i);for(a=0;a<l.length;a+=2){var c=l[a],d=l[a+1];c==="style"?yy(s,d):c==="dangerouslySetInnerHTML"?my(s,d):c==="children"?Ji(s,d):ng(s,c,d,u)}switch(o){case"input":Mc(s,i);break;case"textarea":gy(s,i);break;case"select":var f=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var h=i.value;h!=null?Ys(s,!!i.multiple,h,!1):f!==!!i.multiple&&(i.defaultValue!=null?Ys(s,!!i.multiple,i.defaultValue,!0):Ys(s,!!i.multiple,i.multiple?[]:"",!1))}s[la]=i}catch(p){We(r,r.return,p)}}break;case 6:if(gr(e,r),br(r),n&4){if(r.stateNode===null)throw Error(Z(162));s=r.stateNode,i=r.memoizedProps;try{s.nodeValue=i}catch(p){We(r,r.return,p)}}break;case 3:if(gr(e,r),br(r),n&4&&t!==null&&t.memoizedState.isDehydrated)try{na(e.containerInfo)}catch(p){We(r,r.return,p)}break;case 4:gr(e,r),br(r);break;case 13:gr(e,r),br(r),s=r.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(Ng=ze())),n&4&&I0(r);break;case 22:if(c=t!==null&&t.memoizedState!==null,r.mode&1?(Et=(u=Et)||c,gr(e,r),Et=u):gr(e,r),br(r),n&8192){if(u=r.memoizedState!==null,(r.stateNode.isHidden=u)&&!c&&r.mode&1)for(te=r,c=r.child;c!==null;){for(d=te=c;te!==null;){switch(f=te,h=f.child,f.tag){case 0:case 11:case 14:case 15:Hi(4,f,f.return);break;case 1:Vs(f,f.return);var g=f.stateNode;if(typeof g.componentWillUnmount=="function"){n=f,t=f.return;try{e=n,g.props=e.memoizedProps,g.state=e.memoizedState,g.componentWillUnmount()}catch(p){We(n,t,p)}}break;case 5:Vs(f,f.return);break;case 22:if(f.memoizedState!==null){R0(d);continue}}h!==null?(h.return=f,te=h):R0(d)}c=c.sibling}e:for(c=null,d=r;;){if(d.tag===5){if(c===null){c=d;try{s=d.stateNode,u?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(o=d.stateNode,l=d.memoizedProps.style,a=l!=null&&l.hasOwnProperty("display")?l.display:null,o.style.display=vy("display",a))}catch(p){We(r,r.return,p)}}}else if(d.tag===6){if(c===null)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(p){We(r,r.return,p)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===r)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===r)break e;for(;d.sibling===null;){if(d.return===null||d.return===r)break e;c===d&&(c=null),d=d.return}c===d&&(c=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:gr(e,r),br(r),n&4&&I0(r);break;case 21:break;default:gr(e,r),br(r)}}function br(r){var e=r.flags;if(e&2){try{e:{for(var t=r.return;t!==null;){if(KS(t)){var n=t;break e}t=t.return}throw Error(Z(160))}switch(n.tag){case 5:var s=n.stateNode;n.flags&32&&(Ji(s,""),n.flags&=-33);var i=w0(r);md(r,i,s);break;case 3:case 4:var a=n.stateNode.containerInfo,o=w0(r);pd(r,o,a);break;default:throw Error(Z(161))}}catch(l){We(r,r.return,l)}r.flags&=-3}e&4096&&(r.flags&=-4097)}function y1(r,e,t){te=r,WS(r)}function WS(r,e,t){for(var n=(r.mode&1)!==0;te!==null;){var s=te,i=s.child;if(s.tag===22&&n){var a=s.memoizedState!==null||oo;if(!a){var o=s.alternate,l=o!==null&&o.memoizedState!==null||Et;o=oo;var u=Et;if(oo=a,(Et=l)&&!u)for(te=s;te!==null;)a=te,l=a.child,a.tag===22&&a.memoizedState!==null?L0(s):l!==null?(l.return=a,te=l):L0(s);for(;i!==null;)te=i,WS(i),i=i.sibling;te=s,oo=o,Et=u}b0(r)}else s.subtreeFlags&8772&&i!==null?(i.return=s,te=i):b0(r)}}function b0(r){for(;te!==null;){var e=te;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Et||Yl(5,e);break;case 1:var n=e.stateNode;if(e.flags&4&&!Et)if(t===null)n.componentDidMount();else{var s=e.elementType===e.type?t.memoizedProps:yr(e.type,t.memoizedProps);n.componentDidUpdate(s,t.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&d0(e,i,n);break;case 3:var a=e.updateQueue;if(a!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}d0(e,a,t)}break;case 5:var o=e.stateNode;if(t===null&&e.flags&4){t=o;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var c=u.memoizedState;if(c!==null){var d=c.dehydrated;d!==null&&na(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Z(163))}Et||e.flags&512&&gd(e)}catch(f){We(e,e.return,f)}}if(e===r){te=null;break}if(t=e.sibling,t!==null){t.return=e.return,te=t;break}te=e.return}}function R0(r){for(;te!==null;){var e=te;if(e===r){te=null;break}var t=e.sibling;if(t!==null){t.return=e.return,te=t;break}te=e.return}}function L0(r){for(;te!==null;){var e=te;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{Yl(4,e)}catch(l){We(e,t,l)}break;case 1:var n=e.stateNode;if(typeof n.componentDidMount=="function"){var s=e.return;try{n.componentDidMount()}catch(l){We(e,s,l)}}var i=e.return;try{gd(e)}catch(l){We(e,i,l)}break;case 5:var a=e.return;try{gd(e)}catch(l){We(e,a,l)}}}catch(l){We(e,e.return,l)}if(e===r){te=null;break}var o=e.sibling;if(o!==null){o.return=e.return,te=o;break}te=e.return}}var S1=Math.ceil,El=rn.ReactCurrentDispatcher,Og=rn.ReactCurrentOwner,or=rn.ReactCurrentBatchConfig,_e=0,it=null,Qe=null,ht=0,qt=0,Ws=Fn(0),rt=0,ga=null,ls=0,Zl=0,Mg=0,Vi=null,Dt=null,Ng=0,fi=1/0,Kr=null,_l=!1,vd=null,Rn=null,lo=!1,Tn=null,Tl=0,Wi=0,yd=null,Ho=-1,Vo=0;function wt(){return _e&6?ze():Ho!==-1?Ho:Ho=ze()}function Ln(r){return r.mode&1?_e&2&&ht!==0?ht&-ht:r1.transition!==null?(Vo===0&&(Vo=ky()),Vo):(r=Ae,r!==0||(r=window.event,r=r===void 0?16:Fy(r.type)),r):1}function Ar(r,e,t,n){if(50<Wi)throw Wi=0,yd=null,Error(Z(185));La(r,t,n),(!(_e&2)||r!==it)&&(r===it&&(!(_e&2)&&(Zl|=t),rt===4&&Sn(r,ht)),$t(r,n),t===1&&_e===0&&!(e.mode&1)&&(fi=ze()+500,Wl&&$n()))}function $t(r,e){var t=r.callbackNode;rA(r,e);var n=il(r,r===it?ht:0);if(n===0)t!==null&&$p(t),r.callbackNode=null,r.callbackPriority=0;else if(e=n&-n,r.callbackPriority!==e){if(t!=null&&$p(t),e===1)r.tag===0?t1(k0.bind(null,r)):rS(k0.bind(null,r)),QA(function(){!(_e&6)&&$n()}),t=null;else{switch(Cy(n)){case 1:t=lg;break;case 4:t=Ry;break;case 16:t=sl;break;case 536870912:t=Ly;break;default:t=sl}t=eE(t,zS.bind(null,r))}r.callbackPriority=e,r.callbackNode=t}}function zS(r,e){if(Ho=-1,Vo=0,_e&6)throw Error(Z(327));var t=r.callbackNode;if(ei()&&r.callbackNode!==t)return null;var n=il(r,r===it?ht:0);if(n===0)return null;if(n&30||n&r.expiredLanes||e)e=xl(r,n);else{e=n;var s=_e;_e|=2;var i=YS();(it!==r||ht!==e)&&(Kr=null,fi=ze()+500,rs(r,e));do try{T1();break}catch(o){qS(r,o)}while(!0);_g(),El.current=i,_e=s,Qe!==null?e=0:(it=null,ht=0,e=rt)}if(e!==0){if(e===2&&(s=Vc(r),s!==0&&(n=s,e=Sd(r,s))),e===1)throw t=ga,rs(r,0),Sn(r,n),$t(r,ze()),t;if(e===6)Sn(r,n);else{if(s=r.current.alternate,!(n&30)&&!E1(s)&&(e=xl(r,n),e===2&&(i=Vc(r),i!==0&&(n=i,e=Sd(r,i))),e===1))throw t=ga,rs(r,0),Sn(r,n),$t(r,ze()),t;switch(r.finishedWork=s,r.finishedLanes=n,e){case 0:case 1:throw Error(Z(345));case 2:zn(r,Dt,Kr);break;case 3:if(Sn(r,n),(n&130023424)===n&&(e=Ng+500-ze(),10<e)){if(il(r,0)!==0)break;if(s=r.suspendedLanes,(s&n)!==n){wt(),r.pingedLanes|=r.suspendedLanes&s;break}r.timeoutHandle=Jc(zn.bind(null,r,Dt,Kr),e);break}zn(r,Dt,Kr);break;case 4:if(Sn(r,n),(n&4194240)===n)break;for(e=r.eventTimes,s=-1;0<n;){var a=31-xr(n);i=1<<a,a=e[a],a>s&&(s=a),n&=~i}if(n=s,n=ze()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*S1(n/1960))-n,10<n){r.timeoutHandle=Jc(zn.bind(null,r,Dt,Kr),n);break}zn(r,Dt,Kr);break;case 5:zn(r,Dt,Kr);break;default:throw Error(Z(329))}}}return $t(r,ze()),r.callbackNode===t?zS.bind(null,r):null}function Sd(r,e){var t=Vi;return r.current.memoizedState.isDehydrated&&(rs(r,e).flags|=256),r=xl(r,e),r!==2&&(e=Dt,Dt=t,e!==null&&Ed(e)),r}function Ed(r){Dt===null?Dt=r:Dt.push.apply(Dt,r)}function E1(r){for(var e=r;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var n=0;n<t.length;n++){var s=t[n],i=s.getSnapshot;s=s.value;try{if(!wr(i(),s))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===r)break;for(;e.sibling===null;){if(e.return===null||e.return===r)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Sn(r,e){for(e&=~Mg,e&=~Zl,r.suspendedLanes|=e,r.pingedLanes&=~e,r=r.expirationTimes;0<e;){var t=31-xr(e),n=1<<t;r[t]=-1,e&=~n}}function k0(r){if(_e&6)throw Error(Z(327));ei();var e=il(r,0);if(!(e&1))return $t(r,ze()),null;var t=xl(r,e);if(r.tag!==0&&t===2){var n=Vc(r);n!==0&&(e=n,t=Sd(r,n))}if(t===1)throw t=ga,rs(r,0),Sn(r,e),$t(r,ze()),t;if(t===6)throw Error(Z(345));return r.finishedWork=r.current.alternate,r.finishedLanes=e,zn(r,Dt,Kr),$t(r,ze()),null}function Fg(r,e){var t=_e;_e|=1;try{return r(e)}finally{_e=t,_e===0&&(fi=ze()+500,Wl&&$n())}}function us(r){Tn!==null&&Tn.tag===0&&!(_e&6)&&ei();var e=_e;_e|=1;var t=or.transition,n=Ae;try{if(or.transition=null,Ae=1,r)return r()}finally{Ae=n,or.transition=t,_e=e,!(_e&6)&&$n()}}function $g(){qt=Ws.current,Pe(Ws)}function rs(r,e){r.finishedWork=null,r.finishedLanes=0;var t=r.timeoutHandle;if(t!==-1&&(r.timeoutHandle=-1,ZA(t)),Qe!==null)for(t=Qe.return;t!==null;){var n=t;switch(yg(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&cl();break;case 3:ci(),Pe(Nt),Pe(_t),bg();break;case 5:Ig(n);break;case 4:ci();break;case 13:Pe(Be);break;case 19:Pe(Be);break;case 10:Tg(n.type._context);break;case 22:case 23:$g()}t=t.return}if(it=r,Qe=r=kn(r.current,null),ht=qt=e,rt=0,ga=null,Mg=Zl=ls=0,Dt=Vi=null,Jn!==null){for(e=0;e<Jn.length;e++)if(t=Jn[e],n=t.interleaved,n!==null){t.interleaved=null;var s=n.next,i=t.pending;if(i!==null){var a=i.next;i.next=s,n.next=a}t.pending=n}Jn=null}return r}function qS(r,e){do{var t=Qe;try{if(_g(),jo.current=Sl,yl){for(var n=Ge.memoizedState;n!==null;){var s=n.queue;s!==null&&(s.pending=null),n=n.next}yl=!1}if(os=0,st=et=Ge=null,Ki=!1,da=0,Og.current=null,t===null||t.return===null){rt=1,ga=e,Qe=null;break}e:{var i=r,a=t.return,o=t,l=e;if(e=ht,o.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,c=o,d=c.tag;if(!(c.mode&1)&&(d===0||d===11||d===15)){var f=c.alternate;f?(c.updateQueue=f.updateQueue,c.memoizedState=f.memoizedState,c.lanes=f.lanes):(c.updateQueue=null,c.memoizedState=null)}var h=v0(a);if(h!==null){h.flags&=-257,y0(h,a,o,i,e),h.mode&1&&m0(i,u,e),e=h,l=u;var g=e.updateQueue;if(g===null){var p=new Set;p.add(l),e.updateQueue=p}else g.add(l);break e}else{if(!(e&1)){m0(i,u,e),Ug();break e}l=Error(Z(426))}}else if(Me&&o.mode&1){var v=v0(a);if(v!==null){!(v.flags&65536)&&(v.flags|=256),y0(v,a,o,i,e),Sg(di(l,o));break e}}i=l=di(l,o),rt!==4&&(rt=2),Vi===null?Vi=[i]:Vi.push(i),i=a;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var m=CS(i,l,e);c0(i,m);break e;case 1:o=l;var y=i.type,S=i.stateNode;if(!(i.flags&128)&&(typeof y.getDerivedStateFromError=="function"||S!==null&&typeof S.componentDidCatch=="function"&&(Rn===null||!Rn.has(S)))){i.flags|=65536,e&=-e,i.lanes|=e;var E=PS(i,o,e);c0(i,E);break e}}i=i.return}while(i!==null)}QS(t)}catch(T){e=T,Qe===t&&t!==null&&(Qe=t=t.return);continue}break}while(!0)}function YS(){var r=El.current;return El.current=Sl,r===null?Sl:r}function Ug(){(rt===0||rt===3||rt===2)&&(rt=4),it===null||!(ls&268435455)&&!(Zl&268435455)||Sn(it,ht)}function xl(r,e){var t=_e;_e|=2;var n=YS();(it!==r||ht!==e)&&(Kr=null,rs(r,e));do try{_1();break}catch(s){qS(r,s)}while(!0);if(_g(),_e=t,El.current=n,Qe!==null)throw Error(Z(261));return it=null,ht=0,rt}function _1(){for(;Qe!==null;)ZS(Qe)}function T1(){for(;Qe!==null&&!zx();)ZS(Qe)}function ZS(r){var e=JS(r.alternate,r,qt);r.memoizedProps=r.pendingProps,e===null?QS(r):Qe=e,Og.current=null}function QS(r){var e=r;do{var t=e.alternate;if(r=e.return,e.flags&32768){if(t=p1(t,e),t!==null){t.flags&=32767,Qe=t;return}if(r!==null)r.flags|=32768,r.subtreeFlags=0,r.deletions=null;else{rt=6,Qe=null;return}}else if(t=g1(t,e,qt),t!==null){Qe=t;return}if(e=e.sibling,e!==null){Qe=e;return}Qe=e=r}while(e!==null);rt===0&&(rt=5)}function zn(r,e,t){var n=Ae,s=or.transition;try{or.transition=null,Ae=1,x1(r,e,t,n)}finally{or.transition=s,Ae=n}return null}function x1(r,e,t,n){do ei();while(Tn!==null);if(_e&6)throw Error(Z(327));t=r.finishedWork;var s=r.finishedLanes;if(t===null)return null;if(r.finishedWork=null,r.finishedLanes=0,t===r.current)throw Error(Z(177));r.callbackNode=null,r.callbackPriority=0;var i=t.lanes|t.childLanes;if(nA(r,i),r===it&&(Qe=it=null,ht=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||lo||(lo=!0,eE(sl,function(){return ei(),null})),i=(t.flags&15990)!==0,t.subtreeFlags&15990||i){i=or.transition,or.transition=null;var a=Ae;Ae=1;var o=_e;_e|=4,Og.current=null,v1(r,t),VS(t,r),KA(Qc),al=!!Zc,Qc=Zc=null,r.current=t,y1(t),qx(),_e=o,Ae=a,or.transition=i}else r.current=t;if(lo&&(lo=!1,Tn=r,Tl=s),i=r.pendingLanes,i===0&&(Rn=null),Qx(t.stateNode),$t(r,ze()),e!==null)for(n=r.onRecoverableError,t=0;t<e.length;t++)s=e[t],n(s.value,{componentStack:s.stack,digest:s.digest});if(_l)throw _l=!1,r=vd,vd=null,r;return Tl&1&&r.tag!==0&&ei(),i=r.pendingLanes,i&1?r===yd?Wi++:(Wi=0,yd=r):Wi=0,$n(),null}function ei(){if(Tn!==null){var r=Cy(Tl),e=or.transition,t=Ae;try{if(or.transition=null,Ae=16>r?16:r,Tn===null)var n=!1;else{if(r=Tn,Tn=null,Tl=0,_e&6)throw Error(Z(331));var s=_e;for(_e|=4,te=r.current;te!==null;){var i=te,a=i.child;if(te.flags&16){var o=i.deletions;if(o!==null){for(var l=0;l<o.length;l++){var u=o[l];for(te=u;te!==null;){var c=te;switch(c.tag){case 0:case 11:case 15:Hi(8,c,i)}var d=c.child;if(d!==null)d.return=c,te=d;else for(;te!==null;){c=te;var f=c.sibling,h=c.return;if(GS(c),c===u){te=null;break}if(f!==null){f.return=h,te=f;break}te=h}}}var g=i.alternate;if(g!==null){var p=g.child;if(p!==null){g.child=null;do{var v=p.sibling;p.sibling=null,p=v}while(p!==null)}}te=i}}if(i.subtreeFlags&2064&&a!==null)a.return=i,te=a;else e:for(;te!==null;){if(i=te,i.flags&2048)switch(i.tag){case 0:case 11:case 15:Hi(9,i,i.return)}var m=i.sibling;if(m!==null){m.return=i.return,te=m;break e}te=i.return}}var y=r.current;for(te=y;te!==null;){a=te;var S=a.child;if(a.subtreeFlags&2064&&S!==null)S.return=a,te=S;else e:for(a=y;te!==null;){if(o=te,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:Yl(9,o)}}catch(T){We(o,o.return,T)}if(o===a){te=null;break e}var E=o.sibling;if(E!==null){E.return=o.return,te=E;break e}te=o.return}}if(_e=s,$n(),Fr&&typeof Fr.onPostCommitFiberRoot=="function")try{Fr.onPostCommitFiberRoot(jl,r)}catch{}n=!0}return n}finally{Ae=t,or.transition=e}}return!1}function C0(r,e,t){e=di(t,e),e=CS(r,e,1),r=bn(r,e,1),e=wt(),r!==null&&(La(r,1,e),$t(r,e))}function We(r,e,t){if(r.tag===3)C0(r,r,t);else for(;e!==null;){if(e.tag===3){C0(e,r,t);break}else if(e.tag===1){var n=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Rn===null||!Rn.has(n))){r=di(t,r),r=PS(e,r,1),e=bn(e,r,1),r=wt(),e!==null&&(La(e,1,r),$t(e,r));break}}e=e.return}}function A1(r,e,t){var n=r.pingCache;n!==null&&n.delete(e),e=wt(),r.pingedLanes|=r.suspendedLanes&t,it===r&&(ht&t)===t&&(rt===4||rt===3&&(ht&130023424)===ht&&500>ze()-Ng?rs(r,0):Mg|=t),$t(r,e)}function XS(r,e){e===0&&(r.mode&1?(e=Xa,Xa<<=1,!(Xa&130023424)&&(Xa=4194304)):e=1);var t=wt();r=en(r,e),r!==null&&(La(r,e,t),$t(r,t))}function w1(r){var e=r.memoizedState,t=0;e!==null&&(t=e.retryLane),XS(r,t)}function I1(r,e){var t=0;switch(r.tag){case 13:var n=r.stateNode,s=r.memoizedState;s!==null&&(t=s.retryLane);break;case 19:n=r.stateNode;break;default:throw Error(Z(314))}n!==null&&n.delete(e),XS(r,t)}var JS;JS=function(r,e,t){if(r!==null)if(r.memoizedProps!==e.pendingProps||Nt.current)Ot=!0;else{if(!(r.lanes&t)&&!(e.flags&128))return Ot=!1,h1(r,e,t);Ot=!!(r.flags&131072)}else Ot=!1,Me&&e.flags&1048576&&nS(e,hl,e.index);switch(e.lanes=0,e.tag){case 2:var n=e.type;Ko(r,e),r=e.pendingProps;var s=oi(e,_t.current);Js(e,t),s=Lg(null,e,n,r,s,t);var i=kg();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Ft(n)?(i=!0,dl(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,Ag(e),s.updater=ql,e.stateNode=s,s._reactInternals=e,ad(e,n,r,t),e=ud(null,e,n,!0,i,t)):(e.tag=0,Me&&i&&vg(e),Tt(null,e,s,t),e=e.child),e;case 16:n=e.elementType;e:{switch(Ko(r,e),r=e.pendingProps,s=n._init,n=s(n._payload),e.type=n,s=e.tag=R1(n),r=yr(n,r),s){case 0:e=ld(null,e,n,r,t);break e;case 1:e=_0(null,e,n,r,t);break e;case 11:e=S0(null,e,n,r,t);break e;case 14:e=E0(null,e,n,yr(n.type,r),t);break e}throw Error(Z(306,n,""))}return e;case 0:return n=e.type,s=e.pendingProps,s=e.elementType===n?s:yr(n,s),ld(r,e,n,s,t);case 1:return n=e.type,s=e.pendingProps,s=e.elementType===n?s:yr(n,s),_0(r,e,n,s,t);case 3:e:{if(NS(e),r===null)throw Error(Z(387));n=e.pendingProps,i=e.memoizedState,s=i.element,uS(r,e),ml(e,n,null,t);var a=e.memoizedState;if(n=a.element,i.isDehydrated)if(i={element:n,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=di(Error(Z(423)),e),e=T0(r,e,n,t,s);break e}else if(n!==s){s=di(Error(Z(424)),e),e=T0(r,e,n,t,s);break e}else for(Xt=In(e.stateNode.containerInfo.firstChild),Jt=e,Me=!0,Tr=null,t=oS(e,null,n,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(li(),n===s){e=tn(r,e,t);break e}Tt(r,e,n,t)}e=e.child}return e;case 5:return cS(e),r===null&&nd(e),n=e.type,s=e.pendingProps,i=r!==null?r.memoizedProps:null,a=s.children,Xc(n,s)?a=null:i!==null&&Xc(n,i)&&(e.flags|=32),MS(r,e),Tt(r,e,a,t),e.child;case 6:return r===null&&nd(e),null;case 13:return FS(r,e,t);case 4:return wg(e,e.stateNode.containerInfo),n=e.pendingProps,r===null?e.child=ui(e,null,n,t):Tt(r,e,n,t),e.child;case 11:return n=e.type,s=e.pendingProps,s=e.elementType===n?s:yr(n,s),S0(r,e,n,s,t);case 7:return Tt(r,e,e.pendingProps,t),e.child;case 8:return Tt(r,e,e.pendingProps.children,t),e.child;case 12:return Tt(r,e,e.pendingProps.children,t),e.child;case 10:e:{if(n=e.type._context,s=e.pendingProps,i=e.memoizedProps,a=s.value,ke(gl,n._currentValue),n._currentValue=a,i!==null)if(wr(i.value,a)){if(i.children===s.children&&!Nt.current){e=tn(r,e,t);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var o=i.dependencies;if(o!==null){a=i.child;for(var l=o.firstContext;l!==null;){if(l.context===n){if(i.tag===1){l=Qr(-1,t&-t),l.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var c=u.pending;c===null?l.next=l:(l.next=c.next,c.next=l),u.pending=l}}i.lanes|=t,l=i.alternate,l!==null&&(l.lanes|=t),sd(i.return,t,e),o.lanes|=t;break}l=l.next}}else if(i.tag===10)a=i.type===e.type?null:i.child;else if(i.tag===18){if(a=i.return,a===null)throw Error(Z(341));a.lanes|=t,o=a.alternate,o!==null&&(o.lanes|=t),sd(a,t,e),a=i.sibling}else a=i.child;if(a!==null)a.return=i;else for(a=i;a!==null;){if(a===e){a=null;break}if(i=a.sibling,i!==null){i.return=a.return,a=i;break}a=a.return}i=a}Tt(r,e,s.children,t),e=e.child}return e;case 9:return s=e.type,n=e.pendingProps.children,Js(e,t),s=ur(s),n=n(s),e.flags|=1,Tt(r,e,n,t),e.child;case 14:return n=e.type,s=yr(n,e.pendingProps),s=yr(n.type,s),E0(r,e,n,s,t);case 15:return DS(r,e,e.type,e.pendingProps,t);case 17:return n=e.type,s=e.pendingProps,s=e.elementType===n?s:yr(n,s),Ko(r,e),e.tag=1,Ft(n)?(r=!0,dl(e)):r=!1,Js(e,t),kS(e,n,s),ad(e,n,s,t),ud(null,e,n,!0,r,t);case 19:return $S(r,e,t);case 22:return OS(r,e,t)}throw Error(Z(156,e.tag))};function eE(r,e){return by(r,e)}function b1(r,e,t,n){this.tag=r,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ar(r,e,t,n){return new b1(r,e,t,n)}function Bg(r){return r=r.prototype,!(!r||!r.isReactComponent)}function R1(r){if(typeof r=="function")return Bg(r)?1:0;if(r!=null){if(r=r.$$typeof,r===ig)return 11;if(r===ag)return 14}return 2}function kn(r,e){var t=r.alternate;return t===null?(t=ar(r.tag,e,r.key,r.mode),t.elementType=r.elementType,t.type=r.type,t.stateNode=r.stateNode,t.alternate=r,r.alternate=t):(t.pendingProps=e,t.type=r.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=r.flags&14680064,t.childLanes=r.childLanes,t.lanes=r.lanes,t.child=r.child,t.memoizedProps=r.memoizedProps,t.memoizedState=r.memoizedState,t.updateQueue=r.updateQueue,e=r.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=r.sibling,t.index=r.index,t.ref=r.ref,t}function Wo(r,e,t,n,s,i){var a=2;if(n=r,typeof r=="function")Bg(r)&&(a=1);else if(typeof r=="string")a=5;else e:switch(r){case Ns:return ns(t.children,s,i,e);case sg:a=8,s|=8;break;case kc:return r=ar(12,t,e,s|2),r.elementType=kc,r.lanes=i,r;case Cc:return r=ar(13,t,e,s),r.elementType=Cc,r.lanes=i,r;case Pc:return r=ar(19,t,e,s),r.elementType=Pc,r.lanes=i,r;case cy:return Ql(t,s,i,e);default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case ly:a=10;break e;case uy:a=9;break e;case ig:a=11;break e;case ag:a=14;break e;case hn:a=16,n=null;break e}throw Error(Z(130,r==null?r:typeof r,""))}return e=ar(a,t,e,s),e.elementType=r,e.type=n,e.lanes=i,e}function ns(r,e,t,n){return r=ar(7,r,n,e),r.lanes=t,r}function Ql(r,e,t,n){return r=ar(22,r,n,e),r.elementType=cy,r.lanes=t,r.stateNode={isHidden:!1},r}function Du(r,e,t){return r=ar(6,r,null,e),r.lanes=t,r}function Ou(r,e,t){return e=ar(4,r.children!==null?r.children:[],r.key,e),e.lanes=t,e.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},e}function L1(r,e,t,n,s){this.tag=e,this.containerInfo=r,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gu(0),this.expirationTimes=gu(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gu(0),this.identifierPrefix=n,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function jg(r,e,t,n,s,i,a,o,l){return r=new L1(r,e,t,o,l),e===1?(e=1,i===!0&&(e|=8)):e=0,i=ar(3,null,null,e),r.current=i,i.stateNode=r,i.memoizedState={element:n,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ag(i),r}function k1(r,e,t){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ms,key:n==null?null:""+n,children:r,containerInfo:e,implementation:t}}function tE(r){if(!r)return Dn;r=r._reactInternals;e:{if(fs(r)!==r||r.tag!==1)throw Error(Z(170));var e=r;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Ft(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Z(171))}if(r.tag===1){var t=r.type;if(Ft(t))return tS(r,t,e)}return e}function rE(r,e,t,n,s,i,a,o,l){return r=jg(t,n,!0,r,s,i,a,o,l),r.context=tE(null),t=r.current,n=wt(),s=Ln(t),i=Qr(n,s),i.callback=e??null,bn(t,i,s),r.current.lanes=s,La(r,s,n),$t(r,n),r}function Xl(r,e,t,n){var s=e.current,i=wt(),a=Ln(s);return t=tE(t),e.context===null?e.context=t:e.pendingContext=t,e=Qr(i,a),e.payload={element:r},n=n===void 0?null:n,n!==null&&(e.callback=n),r=bn(s,e,a),r!==null&&(Ar(r,s,a,i),Bo(r,s,a)),a}function Al(r){if(r=r.current,!r.child)return null;switch(r.child.tag){case 5:return r.child.stateNode;default:return r.child.stateNode}}function P0(r,e){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var t=r.retryLane;r.retryLane=t!==0&&t<e?t:e}}function Gg(r,e){P0(r,e),(r=r.alternate)&&P0(r,e)}function C1(){return null}var nE=typeof reportError=="function"?reportError:function(r){console.error(r)};function Kg(r){this._internalRoot=r}Jl.prototype.render=Kg.prototype.render=function(r){var e=this._internalRoot;if(e===null)throw Error(Z(409));Xl(r,e,null,null)};Jl.prototype.unmount=Kg.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var e=r.containerInfo;us(function(){Xl(null,r,null,null)}),e[Jr]=null}};function Jl(r){this._internalRoot=r}Jl.prototype.unstable_scheduleHydration=function(r){if(r){var e=Oy();r={blockedOn:null,target:r,priority:e};for(var t=0;t<yn.length&&e!==0&&e<yn[t].priority;t++);yn.splice(t,0,r),t===0&&Ny(r)}};function Hg(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function eu(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11&&(r.nodeType!==8||r.nodeValue!==" react-mount-point-unstable "))}function D0(){}function P1(r,e,t,n,s){if(s){if(typeof n=="function"){var i=n;n=function(){var u=Al(a);i.call(u)}}var a=rE(e,n,r,0,null,!1,!1,"",D0);return r._reactRootContainer=a,r[Jr]=a.current,aa(r.nodeType===8?r.parentNode:r),us(),a}for(;s=r.lastChild;)r.removeChild(s);if(typeof n=="function"){var o=n;n=function(){var u=Al(l);o.call(u)}}var l=jg(r,0,!1,null,null,!1,!1,"",D0);return r._reactRootContainer=l,r[Jr]=l.current,aa(r.nodeType===8?r.parentNode:r),us(function(){Xl(e,l,t,n)}),l}function tu(r,e,t,n,s){var i=t._reactRootContainer;if(i){var a=i;if(typeof s=="function"){var o=s;s=function(){var l=Al(a);o.call(l)}}Xl(e,a,r,s)}else a=P1(t,e,r,s,n);return Al(a)}Py=function(r){switch(r.tag){case 3:var e=r.stateNode;if(e.current.memoizedState.isDehydrated){var t=Oi(e.pendingLanes);t!==0&&(ug(e,t|1),$t(e,ze()),!(_e&6)&&(fi=ze()+500,$n()))}break;case 13:us(function(){var n=en(r,1);if(n!==null){var s=wt();Ar(n,r,1,s)}}),Gg(r,1)}};cg=function(r){if(r.tag===13){var e=en(r,134217728);if(e!==null){var t=wt();Ar(e,r,134217728,t)}Gg(r,134217728)}};Dy=function(r){if(r.tag===13){var e=Ln(r),t=en(r,e);if(t!==null){var n=wt();Ar(t,r,e,n)}Gg(r,e)}};Oy=function(){return Ae};My=function(r,e){var t=Ae;try{return Ae=r,e()}finally{Ae=t}};Gc=function(r,e,t){switch(e){case"input":if(Mc(r,t),e=t.name,t.type==="radio"&&e!=null){for(t=r;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var n=t[e];if(n!==r&&n.form===r.form){var s=Vl(n);if(!s)throw Error(Z(90));fy(n),Mc(n,s)}}}break;case"textarea":gy(r,t);break;case"select":e=t.value,e!=null&&Ys(r,!!t.multiple,e,!1)}};_y=Fg;Ty=us;var D1={usingClientEntryPoint:!1,Events:[Ca,Bs,Vl,Sy,Ey,Fg]},ki={findFiberByHostInstance:Xn,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},O1={bundleType:ki.bundleType,version:ki.version,rendererPackageName:ki.rendererPackageName,rendererConfig:ki.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:rn.ReactCurrentDispatcher,findHostInstanceByFiber:function(r){return r=wy(r),r===null?null:r.stateNode},findFiberByHostInstance:ki.findFiberByHostInstance||C1,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var uo=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!uo.isDisabled&&uo.supportsFiber)try{jl=uo.inject(O1),Fr=uo}catch{}}rr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=D1;rr.createPortal=function(r,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Hg(e))throw Error(Z(200));return k1(r,e,null,t)};rr.createRoot=function(r,e){if(!Hg(r))throw Error(Z(299));var t=!1,n="",s=nE;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(n=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=jg(r,1,!1,null,null,t,!1,n,s),r[Jr]=e.current,aa(r.nodeType===8?r.parentNode:r),new Kg(e)};rr.findDOMNode=function(r){if(r==null)return null;if(r.nodeType===1)return r;var e=r._reactInternals;if(e===void 0)throw typeof r.render=="function"?Error(Z(188)):(r=Object.keys(r).join(","),Error(Z(268,r)));return r=wy(e),r=r===null?null:r.stateNode,r};rr.flushSync=function(r){return us(r)};rr.hydrate=function(r,e,t){if(!eu(e))throw Error(Z(200));return tu(null,r,e,!0,t)};rr.hydrateRoot=function(r,e,t){if(!Hg(r))throw Error(Z(405));var n=t!=null&&t.hydratedSources||null,s=!1,i="",a=nE;if(t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),e=rE(e,null,r,1,t??null,s,!1,i,a),r[Jr]=e.current,aa(r),n)for(r=0;r<n.length;r++)t=n[r],s=t._getVersion,s=s(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,s]:e.mutableSourceEagerHydrationData.push(t,s);return new Jl(e)};rr.render=function(r,e,t){if(!eu(e))throw Error(Z(200));return tu(null,r,e,!1,t)};rr.unmountComponentAtNode=function(r){if(!eu(r))throw Error(Z(40));return r._reactRootContainer?(us(function(){tu(null,null,r,!1,function(){r._reactRootContainer=null,r[Jr]=null})}),!0):!1};rr.unstable_batchedUpdates=Fg;rr.unstable_renderSubtreeIntoContainer=function(r,e,t,n){if(!eu(t))throw Error(Z(200));if(r==null||r._reactInternals===void 0)throw Error(Z(38));return tu(r,e,t,!1,n)};rr.version="18.3.1-next-f1338f8080-20240426";function sE(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(sE)}catch(r){console.error(r)}}sE(),sy.exports=rr;var M1=sy.exports,O0=M1;Rc.createRoot=O0.createRoot,Rc.hydrateRoot=O0.hydrateRoot;var N1={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const F1=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Ne=(r,e)=>{const t=re.forwardRef(({color:n="currentColor",size:s=24,strokeWidth:i=2,absoluteStrokeWidth:a,children:o,...l},u)=>re.createElement("svg",{ref:u,...N1,width:s,height:s,stroke:n,strokeWidth:a?Number(i)*24/Number(s):i,className:`lucide lucide-${F1(r)}`,...l},[...e.map(([c,d])=>re.createElement(c,d)),...(Array.isArray(o)?o:[o])||[]]));return t.displayName=`${r}`,t},$1=Ne("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),U1=Ne("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),B1=Ne("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),j1=Ne("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),G1=Ne("Clapperboard",[["path",{d:"M20.2 6 3 11l-.9-2.4c-.3-1.1.3-2.2 1.3-2.5l13.5-4c1.1-.3 2.2.3 2.5 1.3Z",key:"1tn4o7"}],["path",{d:"m6.2 5.3 3.1 3.9",key:"iuk76l"}],["path",{d:"m12.4 3.4 3.1 4",key:"6hsd6n"}],["path",{d:"M3 11h18v8a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2Z",key:"ltgou9"}]]),K1=Ne("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),H1=Ne("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),M0=Ne("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]),Mu=Ne("ExternalLink",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]]),V1=Ne("Film",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M7 3v18",key:"bbkbws"}],["path",{d:"M3 7.5h4",key:"zfgn84"}],["path",{d:"M3 12h18",key:"1i2n21"}],["path",{d:"M3 16.5h4",key:"1230mu"}],["path",{d:"M17 3v18",key:"in4fa5"}],["path",{d:"M17 7.5h4",key:"myr1c1"}],["path",{d:"M17 16.5h4",key:"go4c1d"}]]),W1=Ne("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]),z1=Ne("Folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]),q1=Ne("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),_d=Ne("Loader",[["line",{x1:"12",x2:"12",y1:"2",y2:"6",key:"gza1u7"}],["line",{x1:"12",x2:"12",y1:"18",y2:"22",key:"1qhbu9"}],["line",{x1:"4.93",x2:"7.76",y1:"4.93",y2:"7.76",key:"xae44r"}],["line",{x1:"16.24",x2:"19.07",y1:"16.24",y2:"19.07",key:"bxnmvf"}],["line",{x1:"2",x2:"6",y1:"12",y2:"12",key:"89khin"}],["line",{x1:"18",x2:"22",y1:"12",y2:"12",key:"pb8tfm"}],["line",{x1:"4.93",x2:"7.76",y1:"19.07",y2:"16.24",key:"1uxjnu"}],["line",{x1:"16.24",x2:"19.07",y1:"7.76",y2:"4.93",key:"6duxfx"}]]),N0=Ne("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]),Y1=Ne("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),Z1=Ne("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),Q1=Ne("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),F0=Ne("SkipForward",[["polygon",{points:"5 4 15 12 5 20 5 4",key:"16p6eg"}],["line",{x1:"19",x2:"19",y1:"5",y2:"19",key:"futhcm"}]]),X1=Ne("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),J1=Ne("Tv",[["rect",{width:"20",height:"15",x:"2",y:"7",rx:"2",ry:"2",key:"10ag99"}],["polyline",{points:"17 2 12 7 7 2",key:"11pgbg"}]]),Td=Ne("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),ew=Ne("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]),tw=Ne("VolumeX",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]);function xd(){return xd=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},xd.apply(null,arguments)}function $0(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function Ad(r,e){return Ad=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},Ad(r,e)}function rw(r,e){r.prototype=Object.create(e.prototype),r.prototype.constructor=r,Ad(r,e)}var U0=Number.isNaN||function(e){return typeof e=="number"&&e!==e};function nw(r,e){return!!(r===e||U0(r)&&U0(e))}function sw(r,e){if(r.length!==e.length)return!1;for(var t=0;t<r.length;t++)if(!nw(r[t],e[t]))return!1;return!0}function Nu(r,e){e===void 0&&(e=sw);var t,n=[],s,i=!1;function a(){for(var o=[],l=0;l<arguments.length;l++)o[l]=arguments[l];return i&&t===this&&e(o,n)||(s=r.apply(this,o),i=!0,t=this,n=o),s}return a}var iw=typeof performance=="object"&&typeof performance.now=="function",B0=iw?function(){return performance.now()}:function(){return Date.now()};function j0(r){cancelAnimationFrame(r.id)}function aw(r,e){var t=B0();function n(){B0()-t>=e?r.call(null):s.id=requestAnimationFrame(n)}var s={id:requestAnimationFrame(n)};return s}var Fu=-1;function G0(r){if(r===void 0&&(r=!1),Fu===-1||r){var e=document.createElement("div"),t=e.style;t.width="50px",t.height="50px",t.overflow="scroll",document.body.appendChild(e),Fu=e.offsetWidth-e.clientWidth,document.body.removeChild(e)}return Fu}var vs=null;function K0(r){if(r===void 0&&(r=!1),vs===null||r){var e=document.createElement("div"),t=e.style;t.width="50px",t.height="50px",t.overflow="scroll",t.direction="rtl";var n=document.createElement("div"),s=n.style;return s.width="100px",s.height="100px",e.appendChild(n),document.body.appendChild(e),e.scrollLeft>0?vs="positive-descending":(e.scrollLeft=1,e.scrollLeft===0?vs="negative":vs="positive-ascending"),document.body.removeChild(e),vs}return vs}var ow=150,lw=function(e,t){return e};function uw(r){var e,t=r.getItemOffset,n=r.getEstimatedTotalSize,s=r.getItemSize,i=r.getOffsetForIndexAndAlignment,a=r.getStartIndexForOffset,o=r.getStopIndexForStartIndex,l=r.initInstanceProps,u=r.shouldResetStyleCacheOnItemSizeChange,c=r.validateProps;return e=function(d){rw(f,d);function f(g){var p;return p=d.call(this,g)||this,p._instanceProps=l(p.props,$0(p)),p._outerRef=void 0,p._resetIsScrollingTimeoutId=null,p.state={instance:$0(p),isScrolling:!1,scrollDirection:"forward",scrollOffset:typeof p.props.initialScrollOffset=="number"?p.props.initialScrollOffset:0,scrollUpdateWasRequested:!1},p._callOnItemsRendered=void 0,p._callOnItemsRendered=Nu(function(v,m,y,S){return p.props.onItemsRendered({overscanStartIndex:v,overscanStopIndex:m,visibleStartIndex:y,visibleStopIndex:S})}),p._callOnScroll=void 0,p._callOnScroll=Nu(function(v,m,y){return p.props.onScroll({scrollDirection:v,scrollOffset:m,scrollUpdateWasRequested:y})}),p._getItemStyle=void 0,p._getItemStyle=function(v){var m=p.props,y=m.direction,S=m.itemSize,E=m.layout,T=p._getItemStyleCache(u&&S,u&&E,u&&y),A;if(T.hasOwnProperty(v))A=T[v];else{var x=t(p.props,v,p._instanceProps),w=s(p.props,v,p._instanceProps),b=y==="horizontal"||E==="horizontal",I=y==="rtl",M=b?x:0;T[v]=A={position:"absolute",left:I?void 0:M,right:I?M:void 0,top:b?0:x,height:b?"100%":w,width:b?w:"100%"}}return A},p._getItemStyleCache=void 0,p._getItemStyleCache=Nu(function(v,m,y){return{}}),p._onScrollHorizontal=function(v){var m=v.currentTarget,y=m.clientWidth,S=m.scrollLeft,E=m.scrollWidth;p.setState(function(T){if(T.scrollOffset===S)return null;var A=p.props.direction,x=S;if(A==="rtl")switch(K0()){case"negative":x=-S;break;case"positive-descending":x=E-y-S;break}return x=Math.max(0,Math.min(x,E-y)),{isScrolling:!0,scrollDirection:T.scrollOffset<x?"forward":"backward",scrollOffset:x,scrollUpdateWasRequested:!1}},p._resetIsScrollingDebounced)},p._onScrollVertical=function(v){var m=v.currentTarget,y=m.clientHeight,S=m.scrollHeight,E=m.scrollTop;p.setState(function(T){if(T.scrollOffset===E)return null;var A=Math.max(0,Math.min(E,S-y));return{isScrolling:!0,scrollDirection:T.scrollOffset<A?"forward":"backward",scrollOffset:A,scrollUpdateWasRequested:!1}},p._resetIsScrollingDebounced)},p._outerRefSetter=function(v){var m=p.props.outerRef;p._outerRef=v,typeof m=="function"?m(v):m!=null&&typeof m=="object"&&m.hasOwnProperty("current")&&(m.current=v)},p._resetIsScrollingDebounced=function(){p._resetIsScrollingTimeoutId!==null&&j0(p._resetIsScrollingTimeoutId),p._resetIsScrollingTimeoutId=aw(p._resetIsScrolling,ow)},p._resetIsScrolling=function(){p._resetIsScrollingTimeoutId=null,p.setState({isScrolling:!1},function(){p._getItemStyleCache(-1,null)})},p}f.getDerivedStateFromProps=function(p,v){return cw(p,v),c(p),null};var h=f.prototype;return h.scrollTo=function(p){p=Math.max(0,p),this.setState(function(v){return v.scrollOffset===p?null:{scrollDirection:v.scrollOffset<p?"forward":"backward",scrollOffset:p,scrollUpdateWasRequested:!0}},this._resetIsScrollingDebounced)},h.scrollToItem=function(p,v){v===void 0&&(v="auto");var m=this.props,y=m.itemCount,S=m.layout,E=this.state.scrollOffset;p=Math.max(0,Math.min(p,y-1));var T=0;if(this._outerRef){var A=this._outerRef;S==="vertical"?T=A.scrollWidth>A.clientWidth?G0():0:T=A.scrollHeight>A.clientHeight?G0():0}this.scrollTo(i(this.props,p,v,E,this._instanceProps,T))},h.componentDidMount=function(){var p=this.props,v=p.direction,m=p.initialScrollOffset,y=p.layout;if(typeof m=="number"&&this._outerRef!=null){var S=this._outerRef;v==="horizontal"||y==="horizontal"?S.scrollLeft=m:S.scrollTop=m}this._callPropsCallbacks()},h.componentDidUpdate=function(){var p=this.props,v=p.direction,m=p.layout,y=this.state,S=y.scrollOffset,E=y.scrollUpdateWasRequested;if(E&&this._outerRef!=null){var T=this._outerRef;if(v==="horizontal"||m==="horizontal")if(v==="rtl")switch(K0()){case"negative":T.scrollLeft=-S;break;case"positive-ascending":T.scrollLeft=S;break;default:var A=T.clientWidth,x=T.scrollWidth;T.scrollLeft=x-A-S;break}else T.scrollLeft=S;else T.scrollTop=S}this._callPropsCallbacks()},h.componentWillUnmount=function(){this._resetIsScrollingTimeoutId!==null&&j0(this._resetIsScrollingTimeoutId)},h.render=function(){var p=this.props,v=p.children,m=p.className,y=p.direction,S=p.height,E=p.innerRef,T=p.innerElementType,A=p.innerTagName,x=p.itemCount,w=p.itemData,b=p.itemKey,I=b===void 0?lw:b,M=p.layout,K=p.outerElementType,z=p.outerTagName,X=p.style,Q=p.useIsScrolling,N=p.width,P=this.state.isScrolling,k=y==="horizontal"||M==="horizontal",F=k?this._onScrollHorizontal:this._onScrollVertical,U=this._getRangeToRender(),B=U[0],G=U[1],ie=[];if(x>0)for(var ne=B;ne<=G;ne++)ie.push(re.createElement(v,{data:w,key:I(ne,w),index:ne,isScrolling:Q?P:void 0,style:this._getItemStyle(ne)}));var oe=n(this.props,this._instanceProps);return re.createElement(K||z||"div",{className:m,onScroll:F,ref:this._outerRefSetter,style:xd({position:"relative",height:S,width:N,overflow:"auto",WebkitOverflowScrolling:"touch",willChange:"transform",direction:y},X)},re.createElement(T||A||"div",{children:ie,ref:E,style:{height:k?"100%":oe,pointerEvents:P?"none":void 0,width:k?oe:"100%"}}))},h._callPropsCallbacks=function(){if(typeof this.props.onItemsRendered=="function"){var p=this.props.itemCount;if(p>0){var v=this._getRangeToRender(),m=v[0],y=v[1],S=v[2],E=v[3];this._callOnItemsRendered(m,y,S,E)}}if(typeof this.props.onScroll=="function"){var T=this.state,A=T.scrollDirection,x=T.scrollOffset,w=T.scrollUpdateWasRequested;this._callOnScroll(A,x,w)}},h._getRangeToRender=function(){var p=this.props,v=p.itemCount,m=p.overscanCount,y=this.state,S=y.isScrolling,E=y.scrollDirection,T=y.scrollOffset;if(v===0)return[0,0,0,0];var A=a(this.props,T,this._instanceProps),x=o(this.props,A,T,this._instanceProps),w=!S||E==="backward"?Math.max(1,m):1,b=!S||E==="forward"?Math.max(1,m):1;return[Math.max(0,A-w),Math.max(0,Math.min(v-1,x+b)),A,x]},f}(re.PureComponent),e.defaultProps={direction:"ltr",itemData:void 0,layout:"vertical",overscanCount:2,useIsScrolling:!1},e}var cw=function(e,t){e.children,e.direction,e.height,e.layout,e.innerTagName,e.outerTagName,e.width,t.instance},dw=uw({getItemOffset:function(e,t){var n=e.itemSize;return t*n},getItemSize:function(e,t){var n=e.itemSize;return n},getEstimatedTotalSize:function(e){var t=e.itemCount,n=e.itemSize;return n*t},getOffsetForIndexAndAlignment:function(e,t,n,s,i,a){var o=e.direction,l=e.height,u=e.itemCount,c=e.itemSize,d=e.layout,f=e.width,h=o==="horizontal"||d==="horizontal",g=h?f:l,p=Math.max(0,u*c-g),v=Math.min(p,t*c),m=Math.max(0,t*c-g+c+a);switch(n==="smart"&&(s>=m-g&&s<=v+g?n="auto":n="center"),n){case"start":return v;case"end":return m;case"center":{var y=Math.round(m+(v-m)/2);return y<Math.ceil(g/2)?0:y>p+Math.floor(g/2)?p:y}case"auto":default:return s>=m&&s<=v?s:s<m?m:v}},getStartIndexForOffset:function(e,t){var n=e.itemCount,s=e.itemSize;return Math.max(0,Math.min(n-1,Math.floor(t/s)))},getStopIndexForStartIndex:function(e,t,n){var s=e.direction,i=e.height,a=e.itemCount,o=e.itemSize,l=e.layout,u=e.width,c=s==="horizontal"||l==="horizontal",d=t*o,f=c?u:i,h=Math.ceil((f+n-d)/o);return Math.max(0,Math.min(a-1,t+h-1))},initInstanceProps:function(e){},shouldResetStyleCacheOnItemSizeChange:!0,validateProps:function(e){e.itemSize}});let lr;typeof window<"u"?lr=window:typeof self<"u"?lr=self:lr=global;let wd=null,Id=null;const H0=20,$u=lr.clearTimeout,V0=lr.setTimeout,Uu=lr.cancelAnimationFrame||lr.mozCancelAnimationFrame||lr.webkitCancelAnimationFrame,W0=lr.requestAnimationFrame||lr.mozRequestAnimationFrame||lr.webkitRequestAnimationFrame;Uu==null||W0==null?(wd=$u,Id=function(e){return V0(e,H0)}):(wd=function([e,t]){Uu(e),$u(t)},Id=function(e){const t=W0(function(){$u(n),e()}),n=V0(function(){Uu(t),e()},H0);return[t,n]});function fw(r){let e,t,n,s,i,a,o;const l=typeof document<"u"&&document.attachEvent;if(!l){a=function(m){const y=m.__resizeTriggers__,S=y.firstElementChild,E=y.lastElementChild,T=S.firstElementChild;E.scrollLeft=E.scrollWidth,E.scrollTop=E.scrollHeight,T.style.width=S.offsetWidth+1+"px",T.style.height=S.offsetHeight+1+"px",S.scrollLeft=S.scrollWidth,S.scrollTop=S.scrollHeight},i=function(m){return m.offsetWidth!==m.__resizeLast__.width||m.offsetHeight!==m.__resizeLast__.height},o=function(m){if(m.target.className&&typeof m.target.className.indexOf=="function"&&m.target.className.indexOf("contract-trigger")<0&&m.target.className.indexOf("expand-trigger")<0)return;const y=this;a(this),this.__resizeRAF__&&wd(this.__resizeRAF__),this.__resizeRAF__=Id(function(){i(y)&&(y.__resizeLast__.width=y.offsetWidth,y.__resizeLast__.height=y.offsetHeight,y.__resizeListeners__.forEach(function(T){T.call(y,m)}))})};let f=!1,h="";n="animationstart";const g="Webkit Moz O ms".split(" ");let p="webkitAnimationStart animationstart oAnimationStart MSAnimationStart".split(" "),v="";{const m=document.createElement("fakeelement");if(m.style.animationName!==void 0&&(f=!0),f===!1){for(let y=0;y<g.length;y++)if(m.style[g[y]+"AnimationName"]!==void 0){v=g[y],h="-"+v.toLowerCase()+"-",n=p[y],f=!0;break}}}t="resizeanim",e="@"+h+"keyframes "+t+" { from { opacity: 0; } to { opacity: 0; } } ",s=h+"animation: 1ms "+t+"; "}const u=function(f){if(!f.getElementById("detectElementResize")){const h=(e||"")+".resize-triggers { "+(s||"")+'visibility: hidden; opacity: 0; } .resize-triggers, .resize-triggers > div, .contract-trigger:before { content: " "; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; z-index: -1; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',g=f.head||f.getElementsByTagName("head")[0],p=f.createElement("style");p.id="detectElementResize",p.type="text/css",r!=null&&p.setAttribute("nonce",r),p.styleSheet?p.styleSheet.cssText=h:p.appendChild(f.createTextNode(h)),g.appendChild(p)}};return{addResizeListener:function(f,h){if(l)f.attachEvent("onresize",h);else{if(!f.__resizeTriggers__){const g=f.ownerDocument,p=lr.getComputedStyle(f);p&&p.position==="static"&&(f.style.position="relative"),u(g),f.__resizeLast__={},f.__resizeListeners__=[],(f.__resizeTriggers__=g.createElement("div")).className="resize-triggers";const v=g.createElement("div");v.className="expand-trigger",v.appendChild(g.createElement("div"));const m=g.createElement("div");m.className="contract-trigger",f.__resizeTriggers__.appendChild(v),f.__resizeTriggers__.appendChild(m),f.appendChild(f.__resizeTriggers__),a(f),f.addEventListener("scroll",o,!0),n&&(f.__resizeTriggers__.__animationListener__=function(S){S.animationName===t&&a(f)},f.__resizeTriggers__.addEventListener(n,f.__resizeTriggers__.__animationListener__))}f.__resizeListeners__.push(h)}},removeResizeListener:function(f,h){if(l)f.detachEvent("onresize",h);else if(f.__resizeListeners__.splice(f.__resizeListeners__.indexOf(h),1),!f.__resizeListeners__.length){f.removeEventListener("scroll",o,!0),f.__resizeTriggers__.__animationListener__&&(f.__resizeTriggers__.removeEventListener(n,f.__resizeTriggers__.__animationListener__),f.__resizeTriggers__.__animationListener__=null);try{f.__resizeTriggers__=!f.removeChild(f.__resizeTriggers__)}catch{}}}}}class hw extends re.Component{constructor(...e){super(...e),this.state={height:this.props.defaultHeight||0,width:this.props.defaultWidth||0},this._autoSizer=null,this._detectElementResize=null,this._didLogDeprecationWarning=!1,this._parentNode=null,this._resizeObserver=null,this._timeoutId=null,this._onResize=()=>{this._timeoutId=null;const{disableHeight:t,disableWidth:n,onResize:s}=this.props;if(this._parentNode){const i=window.getComputedStyle(this._parentNode)||{},a=parseFloat(i.paddingLeft||"0"),o=parseFloat(i.paddingRight||"0"),l=parseFloat(i.paddingTop||"0"),u=parseFloat(i.paddingBottom||"0"),c=this._parentNode.getBoundingClientRect(),d=c.height-l-u,f=c.width-a-o;if(!t&&this.state.height!==d||!n&&this.state.width!==f){this.setState({height:d,width:f});const h=()=>{this._didLogDeprecationWarning||(this._didLogDeprecationWarning=!0,console.warn("scaledWidth and scaledHeight parameters have been deprecated; use width and height instead"))};typeof s=="function"&&s({height:d,width:f,get scaledHeight(){return h(),d},get scaledWidth(){return h(),f}})}}},this._setRef=t=>{this._autoSizer=t}}componentDidMount(){const{nonce:e}=this.props,t=this._autoSizer?this._autoSizer.parentNode:null;if(t!=null&&t.ownerDocument&&t.ownerDocument.defaultView&&t instanceof t.ownerDocument.defaultView.HTMLElement){this._parentNode=t;const n=t.ownerDocument.defaultView.ResizeObserver;n!=null?(this._resizeObserver=new n(()=>{this._timeoutId=setTimeout(this._onResize,0)}),this._resizeObserver.observe(t)):(this._detectElementResize=fw(e),this._detectElementResize.addResizeListener(t,this._onResize)),this._onResize()}}componentWillUnmount(){this._parentNode&&(this._detectElementResize&&this._detectElementResize.removeResizeListener(this._parentNode,this._onResize),this._timeoutId!==null&&clearTimeout(this._timeoutId),this._resizeObserver&&this._resizeObserver.disconnect())}render(){const{children:e,defaultHeight:t,defaultWidth:n,disableHeight:s=!1,disableWidth:i=!1,doNotBailOutOnEmptyChildren:a=!1,nonce:o,onResize:l,style:u={},tagName:c="div",...d}=this.props,{height:f,width:h}=this.state,g={overflow:"visible"},p={};let v=!1;return s||(f===0&&(v=!0),g.height=0,p.height=f,p.scaledHeight=f),i||(h===0&&(v=!0),g.width=0,p.width=h,p.scaledWidth=h),a&&(v=!1),re.createElement(c,{ref:this._setRef,style:{...g,...u},...d},!v&&e(p))}}function gw(r,e){const[t,n]=re.useState(r);return re.useEffect(()=>{const s=setTimeout(()=>{n(r)},e);return()=>{clearTimeout(s)}},[r,e]),t}const qr=new Map,pw=r=>{if(!r||qr.has(r))return;const e=new Image;e.onload=()=>qr.set(r,"loaded"),e.onerror=()=>qr.set(r,"error"),e.src=r},mw=({logo:r})=>{const[e,t]=re.useState(()=>r?qr.has(r)?qr.get(r):"loading":"error");return re.useEffect(()=>{if(!r){t("error");return}if(qr.has(r)){t(qr.get(r));return}t("loading")},[r]),!r||e==="error"?C.jsx("div",{className:"flex-shrink-0 flex items-center justify-center bg-gray-700 rounded",style:{width:"40px",height:"40px"},children:C.jsx("span",{className:"text-orange-500 text-sm",children:""})}):C.jsx("div",{className:"flex-shrink-0 flex items-center justify-center bg-gray-800 rounded overflow-hidden",style:{width:"40px",height:"40px"},children:C.jsx("img",{src:r,alt:"",style:{width:"40px",height:"40px",objectFit:"contain"},onLoad:()=>{qr.set(r,"loaded"),t("loaded")},onError:()=>{qr.set(r,"error"),t("error")}})})},vw=({channels:r,selectedChannel:e,onSelectChannel:t,onDeleteChannel:n,isPlaylistView:s,canDelete:i})=>{const[a,o]=re.useState({}),[l,u]=re.useState(""),c=gw(l,300),[d,f]=re.useState({visible:!1,x:0,y:0,channel:null}),h=re.useRef(null),g=re.useRef(null);re.useEffect(()=>{const A=x=>{g.current&&!g.current.contains(x.target)&&f({visible:!1,x:0,y:0,channel:null})};return document.addEventListener("mousedown",A),()=>document.removeEventListener("mousedown",A)},[]);const p=re.useCallback((A,x)=>{A.preventDefault(),f({visible:!0,x:A.clientX,y:A.clientY,channel:x})},[]),v=re.useCallback(()=>{d.channel&&n&&n(d.channel),f({visible:!1,x:0,y:0,channel:null})},[d.channel,n]),m=re.useMemo(()=>{if(!c.trim())return r;const A=c.toLowerCase();return r.filter(x=>x.name.toLowerCase().includes(A)||x.group&&x.group.toLowerCase().includes(A))},[r,c]),y=re.useMemo(()=>m.reduce((A,x)=>{const w=s?"All":x.group||"Other";return A[w]||(A[w]=[]),A[w].push(x),A},{}),[m,s]),S=re.useMemo(()=>{const A=[];return Object.entries(y).forEach(([x,w])=>{s||A.push({type:"header",groupName:x,count:w.length}),(s||a[x])&&w.forEach(b=>{A.push({type:"channel",channel:b})})}),A},[y,a,s]),E=re.useCallback(A=>{o(x=>({...x,[A]:!x[A]}))},[]);re.useEffect(()=>{(r==null?void 0:r.length)>0&&r.slice(0,100).forEach(A=>A.logo&&pw(A.logo))},[r]);const T=re.useCallback(({index:A,style:x})=>{const w=S[A];if(w.type==="header"){const K=a[w.groupName];return C.jsxs("div",{style:x,className:"bg-[#1e293b] border-b border-gray-700/50 px-4 flex items-center cursor-pointer hover:bg-[#253248] transition-colors",onClick:()=>E(w.groupName),children:[C.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[K?C.jsx(U1,{size:16,className:"text-gray-400"}):C.jsx(j1,{size:16,className:"text-gray-400"}),K?C.jsx(W1,{size:14,className:"text-orange-500"}):C.jsx(z1,{size:14,className:"text-gray-400"}),C.jsx("span",{className:"font-bold text-orange-500 text-sm",children:w.groupName})]}),C.jsx("span",{className:"text-xs text-gray-400 bg-gray-800 px-2 py-0.5 rounded-full",children:w.count})]})}const b=w.channel,I=(e==null?void 0:e.id)===b.id,M=b.url.includes("get.php")||b.url.includes("type=m3u");return C.jsxs("div",{style:x,className:`flex items-center px-4 gap-3 cursor-pointer transition-colors ${I?"bg-blue-600/20 border-l-4 border-l-blue-500":"hover:bg-gray-800/50 border-l-4 border-l-transparent"}`,onClick:()=>t(b,!1),onDoubleClick:()=>t(b,!0),onContextMenu:K=>p(K,b),children:[C.jsx(mw,{logo:b.logo}),C.jsxs("div",{className:"flex-1 min-w-0",children:[C.jsx("div",{className:`font-medium text-sm truncate ${I?"text-blue-100":"text-gray-200"}`,children:b.name}),C.jsx("div",{className:"text-xs text-gray-500 truncate",children:b.group||"-"})]}),C.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${M?"bg-purple-900/50 text-purple-300":"bg-gray-800 text-gray-400"}`,children:M?"Link":"Stream"})]})},[S,a,e,t,E,p]);return C.jsxs("div",{className:"w-[450px] bg-[#0f172a] border-r border-gray-800 h-full flex flex-col relative",children:[d.visible&&i&&C.jsx("div",{ref:g,className:"fixed bg-gray-800 border border-gray-600 rounded-lg shadow-xl py-1 z-50 min-w-[160px]",style:{left:d.x,top:d.y},children:C.jsxs("button",{onClick:v,className:"w-full px-4 py-2 text-left text-sm text-red-400 hover:bg-red-900/30 flex items-center gap-2 transition-colors",children:[C.jsx(X1,{size:14}),"Kanal Sil"]})}),C.jsxs("div",{className:"p-3 border-b border-gray-800",children:[C.jsxs("div",{className:"relative",children:[C.jsx(Q1,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500"}),C.jsx("input",{type:"text",placeholder:"Search channels...",value:l,onChange:A=>u(A.target.value),className:"w-full bg-gray-800 border border-gray-700 rounded-lg pl-9 pr-4 py-2 text-sm text-gray-200 placeholder-gray-500 focus:outline-none focus:border-orange-500"})]}),C.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:[m.length," channels ",l&&`(for "${l}")`]})]}),C.jsx("div",{className:"flex-1",children:S.length===0?C.jsxs("div",{className:"p-12 text-gray-500 text-sm text-center flex flex-col items-center justify-center h-full",children:[C.jsx("span",{className:"text-4xl mb-4",children:""}),C.jsx("p",{children:"No channels found."})]}):C.jsx(hw,{children:({height:A,width:x})=>C.jsx(dw,{ref:h,height:A,width:x,itemCount:S.length,itemSize:56,overscanCount:10,children:T})})})]})},J=Number.isFinite||function(r){return typeof r=="number"&&isFinite(r)},yw=Number.isSafeInteger||function(r){return typeof r=="number"&&Math.abs(r)<=Sw},Sw=Number.MAX_SAFE_INTEGER||9007199254740991;let se=function(r){return r.NETWORK_ERROR="networkError",r.MEDIA_ERROR="mediaError",r.KEY_SYSTEM_ERROR="keySystemError",r.MUX_ERROR="muxError",r.OTHER_ERROR="otherError",r}({}),O=function(r){return r.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",r.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",r.KEY_SYSTEM_NO_SESSION="keySystemNoSession",r.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",r.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",r.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",r.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",r.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",r.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",r.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",r.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",r.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",r.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",r.MANIFEST_LOAD_ERROR="manifestLoadError",r.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",r.MANIFEST_PARSING_ERROR="manifestParsingError",r.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",r.LEVEL_EMPTY_ERROR="levelEmptyError",r.LEVEL_LOAD_ERROR="levelLoadError",r.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",r.LEVEL_PARSING_ERROR="levelParsingError",r.LEVEL_SWITCH_ERROR="levelSwitchError",r.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",r.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",r.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",r.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",r.FRAG_LOAD_ERROR="fragLoadError",r.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",r.FRAG_DECRYPT_ERROR="fragDecryptError",r.FRAG_PARSING_ERROR="fragParsingError",r.FRAG_GAP="fragGap",r.REMUX_ALLOC_ERROR="remuxAllocError",r.KEY_LOAD_ERROR="keyLoadError",r.KEY_LOAD_TIMEOUT="keyLoadTimeOut",r.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",r.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",r.BUFFER_APPEND_ERROR="bufferAppendError",r.BUFFER_APPENDING_ERROR="bufferAppendingError",r.BUFFER_STALLED_ERROR="bufferStalledError",r.BUFFER_FULL_ERROR="bufferFullError",r.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",r.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",r.ASSET_LIST_LOAD_ERROR="assetListLoadError",r.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",r.ASSET_LIST_PARSING_ERROR="assetListParsingError",r.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",r.INTERNAL_EXCEPTION="internalException",r.INTERNAL_ABORTED="aborted",r.ATTACH_MEDIA_ERROR="attachMediaError",r.UNKNOWN="unknown",r}({}),_=function(r){return r.MEDIA_ATTACHING="hlsMediaAttaching",r.MEDIA_ATTACHED="hlsMediaAttached",r.MEDIA_DETACHING="hlsMediaDetaching",r.MEDIA_DETACHED="hlsMediaDetached",r.MEDIA_ENDED="hlsMediaEnded",r.STALL_RESOLVED="hlsStallResolved",r.BUFFER_RESET="hlsBufferReset",r.BUFFER_CODECS="hlsBufferCodecs",r.BUFFER_CREATED="hlsBufferCreated",r.BUFFER_APPENDING="hlsBufferAppending",r.BUFFER_APPENDED="hlsBufferAppended",r.BUFFER_EOS="hlsBufferEos",r.BUFFERED_TO_END="hlsBufferedToEnd",r.BUFFER_FLUSHING="hlsBufferFlushing",r.BUFFER_FLUSHED="hlsBufferFlushed",r.MANIFEST_LOADING="hlsManifestLoading",r.MANIFEST_LOADED="hlsManifestLoaded",r.MANIFEST_PARSED="hlsManifestParsed",r.LEVEL_SWITCHING="hlsLevelSwitching",r.LEVEL_SWITCHED="hlsLevelSwitched",r.LEVEL_LOADING="hlsLevelLoading",r.LEVEL_LOADED="hlsLevelLoaded",r.LEVEL_UPDATED="hlsLevelUpdated",r.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",r.LEVELS_UPDATED="hlsLevelsUpdated",r.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",r.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",r.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",r.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",r.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",r.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",r.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",r.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",r.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",r.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",r.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",r.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",r.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",r.CUES_PARSED="hlsCuesParsed",r.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",r.INIT_PTS_FOUND="hlsInitPtsFound",r.FRAG_LOADING="hlsFragLoading",r.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",r.FRAG_LOADED="hlsFragLoaded",r.FRAG_DECRYPTED="hlsFragDecrypted",r.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",r.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",r.FRAG_PARSING_METADATA="hlsFragParsingMetadata",r.FRAG_PARSED="hlsFragParsed",r.FRAG_BUFFERED="hlsFragBuffered",r.FRAG_CHANGED="hlsFragChanged",r.FPS_DROP="hlsFpsDrop",r.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",r.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",r.ERROR="hlsError",r.DESTROYING="hlsDestroying",r.KEY_LOADING="hlsKeyLoading",r.KEY_LOADED="hlsKeyLoaded",r.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",r.BACK_BUFFER_REACHED="hlsBackBufferReached",r.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",r.ASSET_LIST_LOADING="hlsAssetListLoading",r.ASSET_LIST_LOADED="hlsAssetListLoaded",r.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",r.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",r.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",r.INTERSTITIAL_STARTED="hlsInterstitialStarted",r.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",r.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",r.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",r.INTERSTITIAL_ENDED="hlsInterstitialEnded",r.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",r.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",r.EVENT_CUE_ENTER="hlsEventCueEnter",r}({});var ve={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},ee={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class ys{constructor(e,t=0,n=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=n}sample(e,t){const n=Math.pow(this.alpha_,e);this.estimate_=t*(1-n)+n*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class Ew{constructor(e,t,n,s=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new ys(e),this.fast_=new ys(t),this.defaultTTFB_=s,this.ttfb_=new ys(e)}update(e,t){const{slow_:n,fast_:s,ttfb_:i}=this;n.halfLife!==e&&(this.slow_=new ys(e,n.getEstimate(),n.getTotalWeight())),s.halfLife!==t&&(this.fast_=new ys(t,s.getEstimate(),s.getTotalWeight())),i.halfLife!==e&&(this.ttfb_=new ys(e,i.getEstimate(),i.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const n=8*t,s=e/1e3,i=n/s;this.fast_.sample(s,i),this.slow_.sample(s,i)}sampleTTFB(e){const t=e/1e3,n=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(n,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function _w(r,e,t){return(e=xw(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function we(){return we=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},we.apply(null,arguments)}function z0(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,n)}return t}function Te(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?z0(Object(t),!0).forEach(function(n){_w(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):z0(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function Tw(r,e){if(typeof r!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function xw(r){var e=Tw(r,"string");return typeof e=="symbol"?e:e+""}class fr{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const n=`[${e}]:`;this.trace=pn,this.debug=t.debug.bind(null,n),this.log=t.log.bind(null,n),this.warn=t.warn.bind(null,n),this.info=t.info.bind(null,n),this.error=t.error.bind(null,n)}}const pn=function(){},Aw={trace:pn,debug:pn,log:pn,warn:pn,info:pn,error:pn};function bd(){return we({},Aw)}function ww(r,e){const t=self.console[r];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${r}] >`):pn}function q0(r,e,t){return e[r]?e[r].bind(e):ww(r,t)}const Rd=bd();function Iw(r,e,t){const n=bd();if(typeof console=="object"&&r===!0||typeof r=="object"){const s=["debug","log","info","warn","error"];s.forEach(i=>{n[i]=q0(i,r,t)});try{n.log(`Debug logs enabled for "${e}" in hls.js version 1.6.15`)}catch{return bd()}s.forEach(i=>{Rd[i]=q0(i,r)})}else we(Rd,n);return n}const xe=Rd;function On(r=!0){return typeof self>"u"?void 0:(r||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function bw(r){return typeof self<"u"&&r===self.ManagedMediaSource}function iE(r,e){const t=Object.keys(r),n=Object.keys(e),s=t.length,i=n.length;return!s||!i||s===i&&!t.some(a=>n.indexOf(a)===-1)}function er(r,e=!1){if(typeof TextDecoder<"u"){const u=new TextDecoder("utf-8").decode(r);if(e){const c=u.indexOf("\0");return c!==-1?u.substring(0,c):u}return u.replace(/\0/g,"")}const t=r.length;let n,s,i,a="",o=0;for(;o<t;){if(n=r[o++],n===0&&e)return a;if(n===0||n===3)continue;switch(n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(n);break;case 12:case 13:s=r[o++],a+=String.fromCharCode((n&31)<<6|s&63);break;case 14:s=r[o++],i=r[o++],a+=String.fromCharCode((n&15)<<12|(s&63)<<6|(i&63)<<0);break}}return a}function dt(r){let e="";for(let t=0;t<r.length;t++){let n=r[t].toString(16);n.length<2&&(n="0"+n),e+=n}return e}function aE(r){return Uint8Array.from(r.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function Rw(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Bu={exports:{}},Y0;function Lw(){return Y0||(Y0=1,function(r,e){(function(t){var n=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,s=/^(?=([^\/?#]*))\1([^]*)$/,i=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o={buildAbsoluteURL:function(l,u,c){if(c=c||{},l=l.trim(),u=u.trim(),!u){if(!c.alwaysNormalize)return l;var d=o.parseURL(l);if(!d)throw new Error("Error trying to parse base URL.");return d.path=o.normalizePath(d.path),o.buildURLFromParts(d)}var f=o.parseURL(u);if(!f)throw new Error("Error trying to parse relative URL.");if(f.scheme)return c.alwaysNormalize?(f.path=o.normalizePath(f.path),o.buildURLFromParts(f)):u;var h=o.parseURL(l);if(!h)throw new Error("Error trying to parse base URL.");if(!h.netLoc&&h.path&&h.path[0]!=="/"){var g=s.exec(h.path);h.netLoc=g[1],h.path=g[2]}h.netLoc&&!h.path&&(h.path="/");var p={scheme:h.scheme,netLoc:f.netLoc,path:null,params:f.params,query:f.query,fragment:f.fragment};if(!f.netLoc&&(p.netLoc=h.netLoc,f.path[0]!=="/"))if(!f.path)p.path=h.path,f.params||(p.params=h.params,f.query||(p.query=h.query));else{var v=h.path,m=v.substring(0,v.lastIndexOf("/")+1)+f.path;p.path=o.normalizePath(m)}return p.path===null&&(p.path=c.alwaysNormalize?o.normalizePath(f.path):f.path),o.buildURLFromParts(p)},parseURL:function(l){var u=n.exec(l);return u?{scheme:u[1]||"",netLoc:u[2]||"",path:u[3]||"",params:u[4]||"",query:u[5]||"",fragment:u[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(i,"");l.length!==(l=l.replace(a,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}};r.exports=o})()}(Bu)),Bu.exports}var Vg=Lw();class Wg{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var be={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class oE{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,Cw(this,"stats")}setByteRange(e,t){const n=e.split("@",2);let s;n.length===1?s=(t==null?void 0:t.byteRangeEndOffset)||0:s=parseInt(n[1]),this._byteRange=[s,parseInt(n[0])+s]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[be.AUDIO]:null,[be.VIDEO]:null,[be.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new Wg),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Vg.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[be.AUDIO]=null,e[be.VIDEO]=null,e[be.AUDIOVIDEO]=null}}function qe(r){return r.sn!=="initSegment"}class ju extends oE{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(J(e)&&J(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const n=Object.keys(t);if(n.length===1){const s=this._decryptdata=t[n[0]]||null;s&&(this._decryptdata=s.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=J(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const n=Object.keys(this.levelkeys),s=n.length;if(s>1||s===1&&(t=this.levelkeys[n[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!J(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return qe(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var n;const s=t[e];s&&!((n=this._decryptdata)!=null&&n.keyId)&&(this._decryptdata=s.getDecryptData(this.sn,t))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,n,s,i,a=!1){const{elementaryStreams:o}=this,l=o[e];if(!l){o[e]={startPTS:t,endPTS:n,startDTS:s,endDTS:i,partial:a};return}l.startPTS=Math.min(l.startPTS,t),l.endPTS=Math.max(l.endPTS,n),l.startDTS=Math.min(l.startDTS,s),l.endDTS=Math.max(l.endDTS,i)}}class kw extends oE{constructor(e,t,n,s,i){super(n),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=s;const a=e.enumeratedString("BYTERANGE");a&&this.setByteRange(a,i),i&&(this.fragOffset=i.fragOffset+i.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function lE(r,e){const t=Object.getPrototypeOf(r);if(t){const n=Object.getOwnPropertyDescriptor(t,e);return n||lE(t,e)}}function Cw(r,e){const t=lE(r,e);t&&(t.enumerable=!0,Object.defineProperty(r,e,t))}const Z0=Math.pow(2,32)-1,Pw=[].push,uE={video:1,audio:2,id3:3,text:4};function Je(r){return String.fromCharCode.apply(null,r)}function cE(r,e){const t=r[e]<<8|r[e+1];return t<0?65536+t:t}function he(r,e){const t=dE(r,e);return t<0?4294967296+t:t}function Q0(r,e){let t=he(r,e);return t*=Math.pow(2,32),t+=he(r,e+4),t}function dE(r,e){return r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3]}function Dw(r){const e=r.byteLength;for(let t=0;t<e;){const n=he(r,t);if(n>8&&r[t+4]===109&&r[t+5]===111&&r[t+6]===111&&r[t+7]===102)return!0;t=n>1?t+n:e}return!1}function me(r,e){const t=[];if(!e.length)return t;const n=r.byteLength;for(let s=0;s<n;){const i=he(r,s),a=Je(r.subarray(s+4,s+8)),o=i>1?s+i:n;if(a===e[0])if(e.length===1)t.push(r.subarray(s+8,o));else{const l=me(r.subarray(s+8,o),e.slice(1));l.length&&Pw.apply(t,l)}s=o}return t}function Ow(r){const e=[],t=r[0];let n=8;const s=he(r,n);n+=4;let i=0,a=0;t===0?(i=he(r,n),a=he(r,n+4),n+=8):(i=Q0(r,n),a=Q0(r,n+8),n+=16),n+=2;let o=r.length+a;const l=cE(r,n);n+=2;for(let u=0;u<l;u++){let c=n;const d=he(r,c);c+=4;const f=d&2147483647;if((d&2147483648)>>>31===1)return xe.warn("SIDX has hierarchical references (not supported)"),null;const g=he(r,c);c+=4,e.push({referenceSize:f,subsegmentDuration:g,info:{duration:g/s,start:o,end:o+f-1}}),o+=f,c+=4,n=c}return{earliestPresentationTime:i,timescale:s,version:t,referencesCount:l,references:e}}function fE(r){const e=[],t=me(r,["moov","trak"]);for(let s=0;s<t.length;s++){const i=t[s],a=me(i,["tkhd"])[0];if(a){let o=a[0];const l=he(a,o===0?12:20),u=me(i,["mdia","mdhd"])[0];if(u){o=u[0];const c=he(u,o===0?12:20),d=me(i,["mdia","hdlr"])[0];if(d){const f=Je(d.subarray(8,12)),h={soun:be.AUDIO,vide:be.VIDEO}[f],g=me(i,["mdia","minf","stbl","stsd"])[0],p=Mw(g);h?(e[l]={timescale:c,type:h,stsd:p},e[h]=Te({timescale:c,id:l},p)):e[l]={timescale:c,type:f,stsd:p}}}}}return me(r,["moov","mvex","trex"]).forEach(s=>{const i=he(s,4),a=e[i];a&&(a.default={duration:he(s,12),flags:he(s,20)})}),e}function Mw(r){const e=r.subarray(8),t=e.subarray(86),n=Je(e.subarray(4,8));let s=n,i;const a=n==="enca"||n==="encv";if(a){const u=me(e,[n])[0].subarray(n==="enca"?28:78);me(u,["sinf"]).forEach(d=>{const f=me(d,["schm"])[0];if(f){const h=Je(f.subarray(4,8));if(h==="cbcs"||h==="cenc"){const g=me(d,["frma"])[0];g&&(s=Je(g))}}})}const o=s;switch(s){case"avc1":case"avc2":case"avc3":case"avc4":{const l=me(t,["avcC"])[0];l&&l.length>3&&(s+="."+fo(l[1])+fo(l[2])+fo(l[3]),i=co(o==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const l=me(e,[n])[0],u=me(l.subarray(28),["esds"])[0];if(u&&u.length>7){let c=4;if(u[c++]!==3)break;c=Gu(u,c),c+=2;const d=u[c++];if(d&128&&(c+=2),d&64&&(c+=u[c++]),u[c++]!==4)break;c=Gu(u,c);const f=u[c++];if(f===64)s+="."+fo(f);else break;if(c+=12,u[c++]!==5)break;c=Gu(u,c);const h=u[c++];let g=(h&248)>>3;g===31&&(g+=1+((h&7)<<3)+((u[c]&224)>>5)),s+="."+g}break}case"hvc1":case"hev1":{const l=me(t,["hvcC"])[0];if(l&&l.length>12){const u=l[1],c=["","A","B","C"][u>>6],d=u&31,f=he(l,2),h=(u&32)>>5?"H":"L",g=l[12],p=l.subarray(6,12);s+="."+c+d,s+="."+Nw(f).toString(16).toUpperCase(),s+="."+h+g;let v="";for(let m=p.length;m--;){const y=p[m];(y||v)&&(v="."+y.toString(16).toUpperCase()+v)}s+=v}i=co(o=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{s=co(s,t)||s;break}case"vp09":{const l=me(t,["vpcC"])[0];if(l&&l.length>6){const u=l[4],c=l[5],d=l[6]>>4&15;s+="."+Cr(u)+"."+Cr(c)+"."+Cr(d)}break}case"av01":{const l=me(t,["av1C"])[0];if(l&&l.length>2){const u=l[1]>>>5,c=l[1]&31,d=l[2]>>>7?"H":"M",f=(l[2]&64)>>6,h=(l[2]&32)>>5,g=u===2&&f?h?12:10:f?10:8,p=(l[2]&16)>>4,v=(l[2]&8)>>3,m=(l[2]&4)>>2,y=l[2]&3;s+="."+u+"."+Cr(c)+d+"."+Cr(g)+"."+p+"."+v+m+y+"."+Cr(1)+"."+Cr(1)+"."+Cr(1)+"."+0,i=co("dav1",t)}break}}return{codec:s,encrypted:a,supplemental:i}}function co(r,e){const t=me(e,["dvvC"]),n=t.length?t[0]:me(e,["dvcC"])[0];if(n){const s=n[2]>>1&127,i=n[2]<<5&32|n[3]>>3&31;return r+"."+Cr(s)+"."+Cr(i)}}function Nw(r){let e=0;for(let t=0;t<32;t++)e|=(r>>t&1)<<31-t;return e>>>0}function Gu(r,e){const t=e+5;for(;r[e++]&128&&e<t;);return e}function fo(r){return("0"+r.toString(16).toUpperCase()).slice(-2)}function Cr(r){return(r<10?"0":"")+r}function Fw(r,e){if(!r||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&hE(r,(n,s)=>{const i=n.subarray(8,24);i.some(a=>a!==0)||(xe.log(`[eme] Patching keyId in 'enc${s?"a":"v"}>sinf>>tenc' box: ${dt(i)} -> ${dt(t)}`),n.set(t,8))})}function $w(r){const e=[];return hE(r,t=>e.push(t.subarray(8,24))),e}function hE(r,e){me(r,["moov","trak"]).forEach(n=>{const s=me(n,["mdia","minf","stbl","stsd"])[0];if(!s)return;const i=s.subarray(8);let a=me(i,["enca"]);const o=a.length>0;o||(a=me(i,["encv"])),a.forEach(l=>{const u=o?l.subarray(28):l.subarray(78);me(u,["sinf"]).forEach(d=>{const f=gE(d);f&&e(f,o)})})})}function gE(r){const e=me(r,["schm"])[0];if(e){const t=Je(e.subarray(4,8));if(t==="cbcs"||t==="cenc"){const n=me(r,["schi","tenc"])[0];if(n)return n}}}function Uw(r,e,t){const n={},s=me(r,["moof","traf"]);for(let i=0;i<s.length;i++){const a=s[i],o=me(a,["tfhd"])[0],l=he(o,4),u=e[l];if(!u)continue;n[l]||(n[l]={start:NaN,duration:0,sampleCount:0,timescale:u.timescale,type:u.type});const c=n[l],d=me(a,["tfdt"])[0];if(d){const S=d[0];let E=he(d,4);S===1&&(E===Z0?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(E*=Z0+1,E+=he(d,8))),J(E)&&(!J(c.start)||E<c.start)&&(c.start=E)}const f=u.default,h=he(o,0)|(f==null?void 0:f.flags);let g=(f==null?void 0:f.duration)||0;h&8&&(h&2?g=he(o,12):g=he(o,8));const p=me(a,["trun"]);let v=c.start||0,m=0,y=g;for(let S=0;S<p.length;S++){const E=p[S],T=he(E,4),A=c.sampleCount;c.sampleCount+=T;const x=E[3]&1,w=E[3]&4,b=E[2]&1,I=E[2]&2,M=E[2]&4,K=E[2]&8;let z=8,X=T;for(x&&(z+=4),w&&T&&(!(E[z+1]&1)&&c.keyFrameIndex===void 0&&(c.keyFrameIndex=A),z+=4,b?(y=he(E,z),z+=4):y=g,I&&(z+=4),K&&(z+=4),v+=y,m+=y,X--);X--;)b?(y=he(E,z),z+=4):y=g,I&&(z+=4),M&&(E[z+1]&1||c.keyFrameIndex===void 0&&(c.keyFrameIndex=c.sampleCount-(X+1),c.keyFrameStart=v),z+=4),K&&(z+=4),v+=y,m+=y;!m&&g&&(m+=g*T)}c.duration+=m}if(!Object.keys(n).some(i=>n[i].duration)){let i=1/0,a=0;const o=me(r,["sidx"]);for(let l=0;l<o.length;l++){const u=Ow(o[l]);if(u!=null&&u.references){i=Math.min(i,u.earliestPresentationTime/u.timescale);const c=u.references.reduce((d,f)=>d+f.info.duration||0,0);a=Math.max(a,c+u.earliestPresentationTime/u.timescale)}}a&&J(a)&&Object.keys(n).forEach(l=>{n[l].duration||(n[l].duration=a*n[l].timescale-n[l].start)})}return n}function Bw(r){const e={valid:null,remainder:null},t=me(r,["moof"]);if(t.length<2)return e.remainder=r,e;const n=t[t.length-1];return e.valid=r.slice(0,n.byteOffset-8),e.remainder=r.slice(n.byteOffset-8),e}function dr(r,e){const t=new Uint8Array(r.length+e.length);return t.set(r),t.set(e,r.length),t}function X0(r,e){const t=[],n=e.samples,s=e.timescale,i=e.id;let a=!1;return me(n,["moof"]).map(l=>{const u=l.byteOffset-8;me(l,["traf"]).map(d=>{const f=me(d,["tfdt"]).map(h=>{const g=h[0];let p=he(h,4);return g===1&&(p*=Math.pow(2,32),p+=he(h,8)),p/s})[0];return f!==void 0&&(r=f),me(d,["tfhd"]).map(h=>{const g=he(h,4),p=he(h,0)&16777215,v=(p&1)!==0,m=(p&2)!==0,y=(p&8)!==0;let S=0;const E=(p&16)!==0;let T=0;const A=(p&32)!==0;let x=8;g===i&&(v&&(x+=8),m&&(x+=4),y&&(S=he(h,x),x+=4),E&&(T=he(h,x),x+=4),A&&(x+=4),e.type==="video"&&(a=ru(e.codec)),me(d,["trun"]).map(w=>{const b=w[0],I=he(w,0)&16777215,M=(I&1)!==0;let K=0;const z=(I&4)!==0,X=(I&256)!==0;let Q=0;const N=(I&512)!==0;let P=0;const k=(I&1024)!==0,F=(I&2048)!==0;let U=0;const B=he(w,4);let G=8;M&&(K=he(w,G),G+=4),z&&(G+=4);let ie=K+u;for(let ne=0;ne<B;ne++){if(X?(Q=he(w,G),G+=4):Q=S,N?(P=he(w,G),G+=4):P=T,k&&(G+=4),F&&(b===0?U=he(w,G):U=dE(w,G),G+=4),e.type===be.VIDEO){let oe=0;for(;oe<P;){const le=he(n,ie);if(ie+=4,jw(a,n[ie])){const Ie=n.subarray(ie,ie+le);zg(Ie,a?2:1,r+U/s,t)}ie+=le,oe+=le+4}}r+=Q/s}}))})})}),t}function ru(r){if(!r)return!1;const e=r.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function jw(r,e){if(r){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function zg(r,e,t,n){const s=pE(r);let i=0;i+=e;let a=0,o=0,l=0;for(;i<s.length;){a=0;do{if(i>=s.length)break;l=s[i++],a+=l}while(l===255);o=0;do{if(i>=s.length)break;l=s[i++],o+=l}while(l===255);const u=s.length-i;let c=i;if(o<u)i+=o;else if(o>u){xe.error(`Malformed SEI payload. ${o} is too small, only ${u} bytes left to parse.`);break}if(a===4){if(s[c++]===181){const f=cE(s,c);if(c+=2,f===49){const h=he(s,c);if(c+=4,h===1195456820){const g=s[c++];if(g===3){const p=s[c++],v=31&p,m=64&p,y=m?2+v*3:0,S=new Uint8Array(y);if(m){S[0]=p;for(let E=1;E<y;E++)S[E]=s[c++]}n.push({type:g,payloadType:a,pts:t,bytes:S})}}}}}else if(a===5&&o>16){const d=[];for(let g=0;g<16;g++){const p=s[c++].toString(16);d.push(p.length==1?"0"+p:p),(g===3||g===5||g===7||g===9)&&d.push("-")}const f=o-16,h=new Uint8Array(f);for(let g=0;g<f;g++)h[g]=s[c++];n.push({payloadType:a,pts:t,uuid:d.join(""),userData:er(h),userDataBytes:h})}}}function pE(r){const e=r.byteLength,t=[];let n=1;for(;n<e-2;)r[n]===0&&r[n+1]===0&&r[n+2]===3?(t.push(n+2),n+=2):n++;if(t.length===0)return r;const s=e-t.length,i=new Uint8Array(s);let a=0;for(n=0;n<s;a++,n++)a===t[0]&&(a++,t.shift()),i[n]=r[a];return i}function Gw(r){const e=r[0];let t="",n="",s=0,i=0,a=0,o=0,l=0,u=0;if(e===0){for(;Je(r.subarray(u,u+1))!=="\0";)t+=Je(r.subarray(u,u+1)),u+=1;for(t+=Je(r.subarray(u,u+1)),u+=1;Je(r.subarray(u,u+1))!=="\0";)n+=Je(r.subarray(u,u+1)),u+=1;n+=Je(r.subarray(u,u+1)),u+=1,s=he(r,12),i=he(r,16),o=he(r,20),l=he(r,24),u=28}else if(e===1){u+=4,s=he(r,u),u+=4;const d=he(r,u);u+=4;const f=he(r,u);for(u+=4,a=2**32*d+f,yw(a)||(a=Number.MAX_SAFE_INTEGER,xe.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=he(r,u),u+=4,l=he(r,u),u+=4;Je(r.subarray(u,u+1))!=="\0";)t+=Je(r.subarray(u,u+1)),u+=1;for(t+=Je(r.subarray(u,u+1)),u+=1;Je(r.subarray(u,u+1))!=="\0";)n+=Je(r.subarray(u,u+1)),u+=1;n+=Je(r.subarray(u,u+1)),u+=1}const c=r.subarray(u,r.byteLength);return{schemeIdUri:t,value:n,timeScale:s,presentationTime:a,presentationTimeDelta:i,eventDuration:o,id:l,payload:c}}function Kw(r,...e){const t=e.length;let n=8,s=t;for(;s--;)n+=e[s].byteLength;const i=new Uint8Array(n);for(i[0]=n>>24&255,i[1]=n>>16&255,i[2]=n>>8&255,i[3]=n&255,i.set(r,4),s=0,n=8;s<t;s++)i.set(e[s],n),n+=e[s].byteLength;return i}function Hw(r,e,t){if(r.byteLength!==16)throw new RangeError("Invalid system id");let n,s;n=0,s=new Uint8Array;let i;n>0?(i=new Uint8Array(4),e.length>0&&new DataView(i.buffer).setUint32(0,e.length,!1)):i=new Uint8Array;const a=new Uint8Array(4);return t.byteLength>0&&new DataView(a.buffer).setUint32(0,t.byteLength,!1),Kw([112,115,115,104],new Uint8Array([n,0,0,0]),r,i,s,a,t)}function Vw(r){const e=[];if(r instanceof ArrayBuffer){const t=r.byteLength;let n=0;for(;n+32<t;){const s=new DataView(r,n),i=Ww(s);e.push(i),n+=i.size}}return e}function Ww(r){const e=r.getUint32(0),t=r.byteOffset,n=r.byteLength;if(n<e)return{offset:t,size:n};if(r.getUint32(4)!==1886614376)return{offset:t,size:e};const i=r.getUint32(8)>>>24;if(i!==0&&i!==1)return{offset:t,size:e};const a=r.buffer,o=dt(new Uint8Array(a,t+12,16));let l=null,u=null,c=0;if(i===0)c=28;else{const f=r.getUint32(28);if(!f||n<32+f*16)return{offset:t,size:e};l=[];for(let h=0;h<f;h++)l.push(new Uint8Array(a,t+32+h*16,16));c=32+f*16}if(!c)return{offset:t,size:e};const d=r.getUint32(c);return e-32<d?{offset:t,size:e}:(u=new Uint8Array(a,t+c+4,d),{version:i,systemId:o,kids:l,data:u,offset:t,size:e})}const mE=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),hi={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function qg(r,e){const t=hi[e];return!!t&&!!t[r.slice(0,4)]}function pa(r,e,t=!0){return!r.split(",").some(n=>!Yg(n,e,t))}function Yg(r,e,t=!0){var n;const s=On(t);return(n=s==null?void 0:s.isTypeSupported(ma(r,e)))!=null?n:!1}function ma(r,e){return`${e}/mp4;codecs=${r}`}function J0(r){if(r){const e=r.substring(0,4);return hi.video[e]}return 2}function wl(r){const e=mE();return r.split(",").reduce((t,n)=>{const i=e&&ru(n)?9:hi.video[n];return i?(i*2+t)/(t?3:2):(hi.audio[n]+t)/(t?2:1)},0)}const Ku={};function zw(r,e=!0){if(Ku[r])return Ku[r];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[r];for(let s=0;s<t.length;s++){var n;if(Yg(t[s],"audio",e))return Ku[r]=t[s],t[s];if(t[s]==="mp3"&&(n=On(e))!=null&&n.isTypeSupported("audio/mpeg"))return""}return r}const qw=/flac|opus|mp4a\.40\.34/i;function Il(r,e=!0){return r.replace(qw,t=>zw(t.toLowerCase(),e))}function Yw(r,e){const t=[];if(r){const n=r.split(",");for(let s=0;s<n.length;s++)qg(n[s],"video")||t.push(n[s])}return e&&t.push(e),t.join(",")}function zo(r,e){if(r&&(r.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(r)!==-1)&&(em(r,"audio")||em(r,"video")))return r;if(e){const t=e.split(",");if(t.length>1){if(r){for(let n=t.length;n--;)if(t[n].substring(0,4)===r.substring(0,4))return t[n]}return t[0]}}return e||r}function em(r,e){return qg(r,e)&&Yg(r,e)}function Zw(r){const e=r.split(",");for(let t=0;t<e.length;t++){const n=e[t].split(".");n.length>2&&n[0]==="avc1"&&(e[t]=`avc1.${parseInt(n[1]).toString(16)}${("000"+parseInt(n[2]).toString(16)).slice(-4)}`)}return e.join(",")}function Qw(r){if(r.startsWith("av01.")){const e=r.split("."),t=["0","111","01","01","01","0"];for(let n=e.length;n>4&&n<10;n++)e[n]=t[n-4];return e.join(".")}return r}function tm(r){const e=On(r)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function Ld(r){return r.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const Xw={supported:!0,powerEfficient:!0,smooth:!0},Jw={supported:!1,smooth:!1,powerEfficient:!1},vE={supported:!0,configurations:[],decodingInfoResults:[Xw]};function yE(r,e){return{supported:!1,configurations:e,decodingInfoResults:[Jw],error:r}}function eI(r,e,t,n,s,i){const a=r.videoCodec,o=r.audioCodec?r.audioGroups:null,l=i==null?void 0:i.audioCodec,u=i==null?void 0:i.channels,c=u?parseInt(u):l?1/0:2;let d=null;if(o!=null&&o.length)try{o.length===1&&o[0]?d=e.groups[o[0]].channels:d=o.reduce((f,h)=>{if(h){const g=e.groups[h];if(!g)throw new Error(`Audio track group ${h} not found`);Object.keys(g.channels).forEach(p=>{f[p]=(f[p]||0)+g.channels[p]})}return f},{2:0})}catch{return!0}return a!==void 0&&(a.split(",").some(f=>ru(f))||r.width>1920&&r.height>1088||r.height>1920&&r.width>1088||r.frameRate>Math.max(n,30)||r.videoRange!=="SDR"&&r.videoRange!==t||r.bitrate>Math.max(s,8e6))||!!d&&J(c)&&Object.keys(d).some(f=>parseInt(f)>c)}function SE(r,e,t,n={}){const s=r.videoCodec;if(!s&&!r.audioCodec||!t)return Promise.resolve(vE);const i=[],a=tI(r),o=a.length,l=rI(r,e,o>0),u=l.length;for(let c=o||1*u||1;c--;){const d={type:"media-source"};if(o&&(d.video=a[c%o]),u){d.audio=l[c%u];const f=d.audio.bitrate;d.video&&f&&(d.video.bitrate-=f)}i.push(d)}if(s){const c=navigator.userAgent;if(s.split(",").some(d=>ru(d))&&mE())return Promise.resolve(yE(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${c})`),i))}return Promise.all(i.map(c=>{const d=sI(c);return n[d]||(n[d]=t.decodingInfo(c))})).then(c=>({supported:!c.some(d=>!d.supported),configurations:i,decodingInfoResults:c})).catch(c=>({supported:!1,configurations:i,decodingInfoResults:[],error:c}))}function tI(r){var e;const t=(e=r.videoCodec)==null?void 0:e.split(","),n=EE(r),s=r.width||640,i=r.height||480,a=r.frameRate||30,o=r.videoRange.toLowerCase();return t?t.map(l=>{const u={contentType:ma(Qw(l),"video"),width:s,height:i,bitrate:n,framerate:a};return o!=="sdr"&&(u.transferFunction=o),u}):[]}function rI(r,e,t){var n;const s=(n=r.audioCodec)==null?void 0:n.split(","),i=EE(r);return s&&r.audioGroups?r.audioGroups.reduce((a,o)=>{var l;const u=o?(l=e.groups[o])==null?void 0:l.tracks:null;return u?u.reduce((c,d)=>{if(d.groupId===o){const f=parseFloat(d.channels||"");s.forEach(h=>{const g={contentType:ma(h,"audio"),bitrate:t?nI(h,i):i};f&&(g.channels=""+f),c.push(g)})}return c},a):a},[]):[]}function nI(r,e){if(e<=1)return 1;let t=128e3;return r==="ec-3"?t=768e3:r==="ac-3"&&(t=64e4),Math.min(e/2,t)}function EE(r){return Math.ceil(Math.max(r.bitrate*.9,r.averageBitrate)/1e3)*1e3||1}function sI(r){let e="";const{audio:t,video:n}=r;if(n){const s=Ld(n.contentType);e+=`${s}_r${n.height}x${n.width}f${Math.ceil(n.framerate)}${n.transferFunction||"sd"}_${Math.ceil(n.bitrate/1e5)}`}if(t){const s=Ld(t.contentType);e+=`${n?"_":""}${s}_c${t.channels}`}return e}const kd=["NONE","TYPE-0","TYPE-1",null];function iI(r){return kd.indexOf(r)>-1}const bl=["SDR","PQ","HLG"];function aI(r){return!!r&&bl.indexOf(r)>-1}var qo={No:"",Yes:"YES",v2:"v2"};function rm(r){const{canSkipUntil:e,canSkipDateRanges:t,age:n}=r,s=n<e/2;return e&&s?t?qo.v2:qo.Yes:qo.No}class nm{constructor(e,t,n){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=n}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class va{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(n=>!!n).map(n=>n.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const n=(t=e.supplemental)==null?void 0:t.videoCodec;n&&n!==e.videoCodec&&(this.codecSet+=`,${n.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return sm(this._audioGroups,e)}hasSubtitleGroup(e){return sm(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let n=this._audioGroups;n||(n=this._audioGroups=[]),n.indexOf(t)===-1&&n.push(t)}else if(e==="text"){let n=this._subtitleGroups;n||(n=this._subtitleGroups=[]),n.indexOf(t)===-1&&n.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function sm(r,e){return!e||!r?!1:r.indexOf(e)!==-1}function oI(){if(typeof matchMedia=="function"){const r=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(r.media!==e.media)return r.matches===!0}return!1}function lI(r,e){let t=!1,n=[];if(r&&(t=r!=="SDR",n=[r]),e){n=e.allowedVideoRanges||bl.slice(0);const s=n.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:s&&oI(),t||(n=["SDR"])}return{preferHDR:t,allowedVideoRanges:n}}const uI=r=>{const e=new WeakSet;return(t,n)=>{if(r&&(n=r(t,n)),typeof n=="object"&&n!==null){if(e.has(n))return;e.add(n)}return n}},Re=(r,e)=>JSON.stringify(r,uI(e));function cI(r,e,t,n,s){const i=Object.keys(r),a=n==null?void 0:n.channels,o=n==null?void 0:n.audioCodec,l=s==null?void 0:s.videoCodec,u=a&&parseInt(a)===2;let c=!1,d=!1,f=1/0,h=1/0,g=1/0,p=1/0,v=0,m=[];const{preferHDR:y,allowedVideoRanges:S}=lI(e,s);for(let w=i.length;w--;){const b=r[i[w]];c||(c=b.channels[2]>0),f=Math.min(f,b.minHeight),h=Math.min(h,b.minFramerate),g=Math.min(g,b.minBitrate),S.filter(M=>b.videoRanges[M]>0).length>0&&(d=!0)}f=J(f)?f:0,h=J(h)?h:0;const E=Math.max(1080,f),T=Math.max(30,h);g=J(g)?g:t,t=Math.max(g,t),d||(e=void 0);const A=i.length>1;return{codecSet:i.reduce((w,b)=>{const I=r[b];if(b===w)return w;if(m=d?S.filter(M=>I.videoRanges[M]>0):[],A){if(I.minBitrate>t)return Rr(b,`min bitrate of ${I.minBitrate} > current estimate of ${t}`),w;if(!I.hasDefaultAudio)return Rr(b,"no renditions with default or auto-select sound found"),w;if(o&&b.indexOf(o.substring(0,4))%5!==0)return Rr(b,`audio codec preference "${o}" not found`),w;if(a&&!u){if(!I.channels[a])return Rr(b,`no renditions with ${a} channel sound found (channels options: ${Object.keys(I.channels)})`),w}else if((!o||u)&&c&&I.channels[2]===0)return Rr(b,"no renditions with stereo sound found"),w;if(I.minHeight>E)return Rr(b,`min resolution of ${I.minHeight} > maximum of ${E}`),w;if(I.minFramerate>T)return Rr(b,`min framerate of ${I.minFramerate} > maximum of ${T}`),w;if(!m.some(M=>I.videoRanges[M]>0))return Rr(b,`no variants with VIDEO-RANGE of ${Re(m)} found`),w;if(l&&b.indexOf(l.substring(0,4))%5!==0)return Rr(b,`video codec preference "${l}" not found`),w;if(I.maxScore<v)return Rr(b,`max score of ${I.maxScore} < selected max of ${v}`),w}return w&&(wl(b)>=wl(w)||I.fragmentError>r[w].fragmentError)?w:(p=I.minIndex,v=I.maxScore,b)},void 0),videoRanges:m,preferHDR:y,minFramerate:h,minBitrate:g,minIndex:p}}function Rr(r,e){xe.log(`[abr] start candidates with "${r}" ignored because ${e}`)}function _E(r){return r.reduce((e,t)=>{let n=e.groups[t.groupId];n||(n=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),n.tracks.push(t);const s=t.channels||"2";return n.channels[s]=(n.channels[s]||0)+1,n.hasDefault=n.hasDefault||t.default,n.hasAutoSelect=n.hasAutoSelect||t.autoselect,n.hasDefault&&(e.hasDefaultAudio=!0),n.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function dI(r,e,t,n){return r.slice(t,n+1).reduce((s,i,a)=>{if(!i.codecSet)return s;const o=i.audioGroups;let l=s[i.codecSet];l||(s[i.codecSet]=l={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:a,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!o,fragmentError:0}),l.minBitrate=Math.min(l.minBitrate,i.bitrate);const u=Math.min(i.height,i.width);return l.minHeight=Math.min(l.minHeight,u),l.minFramerate=Math.min(l.minFramerate,i.frameRate),l.minIndex=Math.min(l.minIndex,a),l.maxScore=Math.max(l.maxScore,i.score),l.fragmentError+=i.fragmentError,l.videoRanges[i.videoRange]=(l.videoRanges[i.videoRange]||0)+1,o&&o.forEach(c=>{if(!c)return;const d=e.groups[c];d&&(l.hasDefaultAudio=l.hasDefaultAudio||e.hasDefaultAudio?d.hasDefault:d.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(d.channels).forEach(f=>{l.channels[f]=(l.channels[f]||0)+d.channels[f]}))}),s},{})}function im(r){if(!r)return r;const{lang:e,assocLang:t,characteristics:n,channels:s,audioCodec:i}=r;return{lang:e,assocLang:t,characteristics:n,channels:s,audioCodec:i}}function Mr(r,e,t){if("attrs"in r){const n=e.indexOf(r);if(n!==-1)return n}for(let n=0;n<e.length;n++){const s=e[n];if(ss(r,s,t))return n}return-1}function ss(r,e,t){const{groupId:n,name:s,lang:i,assocLang:a,default:o}=r,l=r.forced;return(n===void 0||e.groupId===n)&&(s===void 0||e.name===s)&&(i===void 0||fI(i,e.lang))&&(i===void 0||e.assocLang===a)&&(o===void 0||e.default===o)&&(l===void 0||e.forced===l)&&(!("characteristics"in r)||hI(r.characteristics||"",e.characteristics))&&(t===void 0||t(r,e))}function fI(r,e="--"){return r.length===e.length?r===e:r.startsWith(e)||e.startsWith(r)}function hI(r,e=""){const t=r.split(","),n=e.split(",");return t.length===n.length&&!t.some(s=>n.indexOf(s)===-1)}function qn(r,e){const{audioCodec:t,channels:n}=r;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(n===void 0||n===(e.channels||"2"))}function gI(r,e,t,n,s){const i=e[n],o=e.reduce((f,h,g)=>{const p=h.uri;return(f[p]||(f[p]=[])).push(g),f},{})[i.uri];o.length>1&&(n=Math.max.apply(Math,o));const l=i.videoRange,u=i.frameRate,c=i.codecSet.substring(0,4),d=am(e,n,f=>{if(f.videoRange!==l||f.frameRate!==u||f.codecSet.substring(0,4)!==c)return!1;const h=f.audioGroups,g=t.filter(p=>!h||h.indexOf(p.groupId)!==-1);return Mr(r,g,s)>-1});return d>-1?d:am(e,n,f=>{const h=f.audioGroups,g=t.filter(p=>!h||h.indexOf(p.groupId)!==-1);return Mr(r,g,s)>-1})}function am(r,e,t){for(let n=e;n>-1;n--)if(t(r[n]))return n;for(let n=e+1;n<r.length;n++)if(t(r[n]))return n;return-1}function Rl(r,e){var t;return!!r&&r!==((t=e.loadLevelObj)==null?void 0:t.uri)}class pI extends fr{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var n;const{fragCurrent:s,partCurrent:i,hls:a}=this,{autoLevelEnabled:o,media:l}=a;if(!s||!l)return;const u=performance.now(),c=i?i.stats:s.stats,d=i?i.duration:s.duration,f=u-c.loading.start,h=a.minAutoLevel,g=s.level,p=this._nextAutoLevel;if(c.aborted||c.loaded&&c.loaded===c.total||g<=h){this.clearTimer(),this._nextAutoLevel=-1;return}if(!o)return;const v=p>-1&&p!==g,m=!!t||v;if(!m&&(l.paused||!l.playbackRate||!l.readyState))return;const y=a.mainForwardBufferInfo;if(!m&&y===null)return;const S=this.bwEstimator.getEstimateTTFB(),E=Math.abs(l.playbackRate);if(f<=Math.max(S,1e3*(d/(E*2))))return;const T=y?y.len/E:0,A=c.loading.first?c.loading.first-c.loading.start:-1,x=c.loaded&&A>-1,w=this.getBwEstimate(),b=a.levels,I=b[g],M=Math.max(c.loaded,Math.round(d*(s.bitrate||I.averageBitrate)/8));let K=x?f-A:f;K<1&&x&&(K=Math.min(f,c.loaded*8/w));const z=x?c.loaded*1e3/K:0,X=S/1e3,Q=z?(M-c.loaded)/z:M*8/w+X;if(Q<=T)return;const N=z?z*8:w,P=((n=(t==null?void 0:t.details)||this.hls.latestLevelDetails)==null?void 0:n.live)===!0,k=this.hls.config.abrBandWidthUpFactor;let F=Number.POSITIVE_INFINITY,U;for(U=g-1;U>h;U--){const ne=b[U].maxBitrate,oe=!b[U].details||P;if(F=this.getTimeToLoadFrag(X,N,d*ne,oe),F<Math.min(T,d+X))break}if(F>=Q||F>d*10)return;x?this.bwEstimator.sample(f-Math.min(S,A),c.loaded):this.bwEstimator.sampleTTFB(f);const B=b[U].maxBitrate;this.getBwEstimate()*k>B&&this.resetEstimator(B);const G=this.findBestLevel(B,h,U,0,T,1,1);G>-1&&(U=G),this.warn(`Fragment ${s.sn}${i?" part "+i.index:""} of level ${g} is loading too slowly;
      Fragment duration: ${s.duration.toFixed(3)}
      Time to underbuffer: ${T.toFixed(3)} s
      Estimated load time for current fragment: ${Q.toFixed(3)} s
      Estimated load time for down switch fragment: ${F.toFixed(3)} s
      TTFB estimate: ${A|0} ms
      Current BW estimate: ${J(w)?w|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${U} @ ${B|0} bps`),a.nextLoadLevel=a.nextAutoLevel=U,this.clearTimer();const ie=()=>{if(this.clearTimer(),this.fragCurrent===s&&this.hls.loadLevel===U&&U>0){const ne=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${U>0?"and switching down":""}
      Fragment duration: ${s.duration.toFixed(3)} s
      Time to underbuffer: ${ne.toFixed(3)} s`),s.abortRequests(),this.fragCurrent=this.partCurrent=null,U>h){let oe=this.findBestLevel(this.hls.levels[h].bitrate,h,U,0,ne,1,1);oe===-1&&(oe=h),this.hls.nextLoadLevel=this.hls.nextAutoLevel=oe,this.resetEstimator(this.hls.levels[oe].bitrate)}}};v||Q>F*2?ie():this.timer=self.setInterval(ie,F*1e3),a.trigger(_.FRAG_LOAD_EMERGENCY_ABORTED,{frag:s,part:i,stats:c})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new Ew(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(_.MANIFEST_LOADING,this.onManifestLoading,this),e.on(_.FRAG_LOADING,this.onFragLoading,this),e.on(_.FRAG_LOADED,this.onFragLoaded,this),e.on(_.FRAG_BUFFERED,this.onFragBuffered,this),e.on(_.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(_.LEVEL_LOADED,this.onLevelLoaded,this),e.on(_.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(_.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(_.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(_.MANIFEST_LOADING,this.onManifestLoading,this),e.off(_.FRAG_LOADING,this.onFragLoading,this),e.off(_.FRAG_LOADED,this.onFragLoaded,this),e.off(_.FRAG_BUFFERED,this.onFragBuffered,this),e.off(_.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(_.LEVEL_LOADED,this.onLevelLoaded,this),e.off(_.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(_.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(_.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const n=t.frag;if(!this.ignoreFragment(n)){if(!n.bitrateTest){var s;this.fragCurrent=n,this.partCurrent=(s=t.part)!=null?s:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case O.BUFFER_ADD_CODEC_ERROR:case O.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case O.FRAG_LOAD_TIMEOUT:{const n=t.frag,{fragCurrent:s,partCurrent:i}=this;if(n&&s&&n.sn===s.sn&&n.level===s.level){const a=performance.now(),o=i?i.stats:n.stats,l=a-o.loading.start,u=o.loading.first?o.loading.first-o.loading.start:-1;if(o.loaded&&u>-1){const d=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(l-Math.min(d,u),o.loaded)}else this.bwEstimator.sampleTTFB(l)}break}}}getTimeToLoadFrag(e,t,n,s){const i=e+n/t,a=s?e+this.lastLevelLoadSec:0;return i+a}onLevelLoaded(e,t){const n=this.hls.config,{loading:s}=t.stats,i=s.end-s.first;J(i)&&(this.lastLevelLoadSec=i/1e3),t.details.live?this.bwEstimator.update(n.abrEwmaSlowLive,n.abrEwmaFastLive):this.bwEstimator.update(n.abrEwmaSlowVoD,n.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:n}){const s=n?n.stats:t.stats;if(t.type===ee.MAIN&&this.bwEstimator.sampleTTFB(s.loading.first-s.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const i=n?n.duration:t.duration,a=this.hls.levels[t.level],o=(a.loaded?a.loaded.bytes:0)+s.loaded,l=(a.loaded?a.loaded.duration:0)+i;a.loaded={bytes:o,duration:l},a.realBitrate=Math.round(8*o/l)}if(t.bitrateTest){const i={stats:s,frag:t,part:n,id:t.type};this.onFragBuffered(_.FRAG_BUFFERED,i),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:n,part:s}=t,i=s!=null&&s.stats.loaded?s.stats:n.stats;if(i.aborted||this.ignoreFragment(n))return;const a=i.parsing.end-i.loading.start-Math.min(i.loading.first-i.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(a,i.loaded),i.bwEstimate=this.getBwEstimate(),n.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==ee.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,n=this.getBwEstimate(),s=this.hls.config.maxStarvationDelay,i=this.findBestLevel(n,t,e,0,s,1,1);if(i>-1)return i;const a=this.hls.firstLevel,o=Math.min(Math.max(a,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${a} clamped to ${o}`),o}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,n=this.bwEstimator.canEstimate(),s=this.lastLoadedFragLevel>-1;if(e!==-1&&(!n||!s||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const i=n&&s?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const a=this.hls.levels;if(a.length>Math.max(e,i)&&a[e].loadError<=a[i].loadError)return e}return this._nextAutoLevel=i,this.nextAutoLevelKey=this.getAutoLevelKey(),i}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:n}=this;if(n.levels.length<=1)return n.loadLevel;const{maxAutoLevel:s,config:i,minAutoLevel:a}=n,o=t?t.duration:e?e.duration:0,l=this.getBwEstimate(),u=this.getStarvationDelay();let c=i.abrBandWidthFactor,d=i.abrBandWidthUpFactor;if(u){const v=this.findBestLevel(l,a,s,u,0,c,d);if(v>=0)return this.rebufferNotice=-1,v}let f=o?Math.min(o,i.maxStarvationDelay):i.maxStarvationDelay;if(!u){const v=this.bitrateTestDelay;v&&(f=(o?Math.min(o,i.maxLoadingDelay):i.maxLoadingDelay)-v,this.info(`bitrate test took ${Math.round(1e3*v)}ms, set first fragment max fetchDuration to ${Math.round(1e3*f)} ms`),c=d=1)}const h=this.findBestLevel(l,a,s,u,f,c,d);if(this.rebufferNotice!==h&&(this.rebufferNotice=h,this.info(`${u?"rebuffering expected":"buffer is empty"}, optimal quality level ${h}`)),h>-1)return h;const g=n.levels[a],p=n.loadLevelObj;return p&&(g==null?void 0:g.bitrate)<p.bitrate?a:n.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const n=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,s=e.mainForwardBufferInfo;return(s?s.len:0)/n}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,n,s,i,a,o){var l;const u=s+i,c=this.lastLoadedFragLevel,d=c===-1?this.hls.firstLevel:c,{fragCurrent:f,partCurrent:h}=this,{levels:g,allAudioTracks:p,loadLevel:v,config:m}=this.hls;if(g.length===1)return 0;const y=g[d],S=!!((l=this.hls.latestLevelDetails)!=null&&l.live),E=v===-1||c===-1;let T,A="SDR",x=(y==null?void 0:y.frameRate)||0;const{audioPreference:w,videoPreference:b}=m,I=this.audioTracksByGroup||(this.audioTracksByGroup=_E(p));let M=-1;if(E){if(this.firstSelection!==-1)return this.firstSelection;const N=this.codecTiers||(this.codecTiers=dI(g,I,t,n)),P=cI(N,A,e,w,b),{codecSet:k,videoRanges:F,minFramerate:U,minBitrate:B,minIndex:G,preferHDR:ie}=P;M=G,T=k,A=ie?F[F.length-1]:F[0],x=U,e=Math.max(e,B),this.log(`picked start tier ${Re(P)}`)}else T=y==null?void 0:y.codecSet,A=y==null?void 0:y.videoRange;const K=h?h.duration:f?f.duration:0,z=this.bwEstimator.getEstimateTTFB()/1e3,X=[];for(let N=n;N>=t;N--){var Q;const P=g[N],k=N>d;if(!P)continue;if(m.useMediaCapabilities&&!P.supportedResult&&!P.supportedPromise){const oe=navigator.mediaCapabilities;typeof(oe==null?void 0:oe.decodingInfo)=="function"&&eI(P,I,A,x,e,w)?(P.supportedPromise=SE(P,I,oe,this.supportedCache),P.supportedPromise.then(le=>{if(!this.hls)return;P.supportedResult=le;const Ie=this.hls.levels,Fe=Ie.indexOf(P);le.error?this.warn(`MediaCapabilities decodingInfo error: "${le.error}" for level ${Fe} ${Re(le)}`):le.supported?le.decodingInfoResults.some(Ye=>Ye.smooth===!1||Ye.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${Fe} not smooth or powerEfficient: ${Re(le)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${Fe} ${Re(le)}`),Fe>-1&&Ie.length>1&&(this.log(`Removing unsupported level ${Fe}`),this.hls.removeLevel(Fe),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(le=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${le}`)})):P.supportedResult=vE}if((T&&P.codecSet!==T||A&&P.videoRange!==A||k&&x>P.frameRate||!k&&x>0&&x<P.frameRate||(Q=P.supportedResult)!=null&&(Q=Q.decodingInfoResults)!=null&&Q.some(oe=>oe.smooth===!1))&&(!E||N!==M)){X.push(N);continue}const F=P.details,U=(h?F==null?void 0:F.partTarget:F==null?void 0:F.averagetargetduration)||K;let B;k?B=o*e:B=a*e;const G=K&&s>=K*2&&i===0?P.averageBitrate:P.maxBitrate,ie=this.getTimeToLoadFrag(z,B,G*U,F===void 0);if(B>=G&&(N===c||P.loadError===0&&P.fragmentError===0)&&(ie<=z||!J(ie)||S&&!this.bitrateTestDelay||ie<u)){const oe=this.forcedAutoLevel;return N!==v&&(oe===-1||oe!==v)&&(X.length&&this.trace(`Skipped level(s) ${X.join(",")} of ${n} max with CODECS and VIDEO-RANGE:"${g[X[0]].codecs}" ${g[X[0]].videoRange}; not compatible with "${T}" ${A}`),this.info(`switch candidate:${d}->${N} adjustedbw(${Math.round(B)})-bitrate=${Math.round(B-G)} ttfb:${z.toFixed(1)} avgDuration:${U.toFixed(1)} maxFetchDuration:${u.toFixed(1)} fetchDuration:${ie.toFixed(1)} firstSelection:${E} codecSet:${P.codecSet} videoRange:${P.videoRange} hls.loadLevel:${v}`)),E&&(this.firstSelection=N),N}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:n}=this.hls;return Math.min(Math.max(e,n),t)}}const TE={search:function(r,e){let t=0,n=r.length-1,s=null,i=null;for(;t<=n;){s=(t+n)/2|0,i=r[s];const a=e(i);if(a>0)t=s+1;else if(a<0)n=s-1;else return i}return null}};function mI(r,e,t){if(e===null||!Array.isArray(r)||!r.length||!J(e))return null;const n=r[0].programDateTime;if(e<(n||0))return null;const s=r[r.length-1].endProgramDateTime;if(e>=(s||0))return null;for(let i=0;i<r.length;++i){const a=r[i];if(yI(e,t,a))return a}return null}function cs(r,e,t=0,n=0,s=.005){let i=null;if(r){i=e[1+r.sn-e[0].sn]||null;const o=r.endDTS-t;o>0&&o<15e-7&&(t+=15e-7),i&&r.level!==i.level&&i.end<=r.end&&(i=e[2+r.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(i=e[0]);if(i&&((!r||r.level===i.level)&&om(t,n,i)===0||vI(i,r,Math.min(s,n))))return i;const a=TE.search(e,om.bind(null,t,n));return a&&(a!==r||!i)?a:i}function vI(r,e,t){if(e&&e.start===0&&e.level<r.level&&(e.endPTS||0)>0){const n=e.tagList.reduce((s,i)=>(i[0]==="INF"&&(s+=parseFloat(i[1])),s),t);return r.start<=n}return!1}function om(r=0,e=0,t){if(t.start<=r&&t.start+t.duration>r)return 0;const n=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-n<=r?1:t.start-n>r&&t.start?-1:0}function yI(r,e,t){const n=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-n>r}function xE(r,e,t){if(r&&r.startCC<=e&&r.endCC>=e){let n=r.fragments;const{fragmentHint:s}=r;s&&(n=n.concat(s));let i;return TE.search(n,a=>a.cc<e?1:a.cc>e?-1:(i=a,a.end<=t?1:a.start>t?-1:0)),i||null}return null}function Ll(r){switch(r.details){case O.FRAG_LOAD_TIMEOUT:case O.KEY_LOAD_TIMEOUT:case O.LEVEL_LOAD_TIMEOUT:case O.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function AE(r){return r.details.startsWith("key")}function wE(r){return AE(r)&&!!r.frag&&!r.frag.decryptdata}function lm(r,e){const t=Ll(e);return r.default[`${t?"timeout":"error"}Retry`]}function Zg(r,e){const t=r.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*r.retryDelayMs,r.maxRetryDelayMs)}function um(r){return Te(Te({},r),{errorRetry:null,timeoutRetry:null})}function kl(r,e,t,n){if(!r)return!1;const s=n==null?void 0:n.code,i=e<r.maxNumRetry&&(SI(s)||!!t);return r.shouldRetry?r.shouldRetry(r,e,t,n,i):i}function SI(r){return Cd(r)||!!r&&(r<400||r>499)}function Cd(r){return r===0&&navigator.onLine===!1}var ct={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},Wt={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4};class EI extends fr{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(_.ERROR,this.onError,this),e.on(_.MANIFEST_LOADING,this.onManifestLoading,this),e.on(_.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(_.ERROR,this.onError,this),e.off(_.ERROR,this.onErrorOut,this),e.off(_.MANIFEST_LOADING,this.onManifestLoading,this),e.off(_.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===ee.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,n=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||n===-1?t.loadLevel:n}variantHasKey(e,t){if(e){var n;if((n=e.details)!=null&&n.hasKey(t))return!0;const s=e.audioGroups;if(s)return this.hls.allAudioTracks.filter(a=>s.indexOf(a.groupId)>=0).some(a=>{var o;return(o=a.details)==null?void 0:o.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var n;if(t.fatal)return;const s=this.hls,i=t.context;switch(t.details){case O.FRAG_LOAD_ERROR:case O.FRAG_LOAD_TIMEOUT:case O.KEY_LOAD_ERROR:case O.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case O.FRAG_PARSING_ERROR:if((n=t.frag)!=null&&n.gap){t.errorAction=ti();return}case O.FRAG_GAP:case O.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=ct.SendAlternateToPenaltyBox;return}case O.LEVEL_EMPTY_ERROR:case O.LEVEL_PARSING_ERROR:{var a;const l=t.parent===ee.MAIN?t.level:s.loadLevel;t.details===O.LEVEL_EMPTY_ERROR&&((a=t.context)!=null&&(a=a.levelDetails)!=null&&a.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,l):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,l))}return;case O.LEVEL_LOAD_ERROR:case O.LEVEL_LOAD_TIMEOUT:typeof(i==null?void 0:i.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.level));return;case O.AUDIO_TRACK_LOAD_ERROR:case O.AUDIO_TRACK_LOAD_TIMEOUT:case O.SUBTITLE_LOAD_ERROR:case O.SUBTITLE_TRACK_LOAD_TIMEOUT:if(i){const l=s.loadLevelObj;if(l&&(i.type===ve.AUDIO_TRACK&&l.hasAudioGroup(i.groupId)||i.type===ve.SUBTITLE_TRACK&&l.hasSubtitleGroup(i.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,s.loadLevel),t.errorAction.action=ct.SendAlternateToPenaltyBox,t.errorAction.flags=Wt.MoveAllAlternatesMatchingHost;return}}return;case O.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:ct.SendAlternateToPenaltyBox,flags:Wt.MoveAllAlternatesMatchingHDCP};return;case O.KEY_SYSTEM_SESSION_UPDATE_FAILED:case O.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case O.KEY_SYSTEM_NO_SESSION:t.errorAction={action:ct.SendAlternateToPenaltyBox,flags:Wt.MoveAllAlternatesMatchingKey};return;case O.BUFFER_ADD_CODEC_ERROR:case O.REMUX_ALLOC_ERROR:case O.BUFFER_APPEND_ERROR:if(!t.errorAction){var o;t.errorAction=this.getLevelSwitchAction(t,(o=t.level)!=null?o:s.loadLevel)}return;case O.INTERNAL_EXCEPTION:case O.BUFFER_APPENDING_ERROR:case O.BUFFER_FULL_ERROR:case O.LEVEL_SWITCH_ERROR:case O.BUFFER_STALLED_ERROR:case O.BUFFER_SEEK_OVER_HOLE:case O.BUFFER_NUDGE_ON_STALL:t.errorAction=ti();return}t.type===se.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=ti())}getPlaylistRetryOrSwitchAction(e,t){const n=this.hls,s=lm(n.config.playlistLoadPolicy,e),i=this.playlistError++;if(kl(s,i,Ll(e),e.response))return{action:ct.RetryRequest,flags:Wt.None,retryConfig:s,retryCount:i};const o=this.getLevelSwitchAction(e,t);return s&&(o.retryConfig=s,o.retryCount=i),o}getFragRetryOrSwitchAction(e){const t=this.hls,n=this.getVariantLevelIndex(e.frag),s=t.levels[n],{fragLoadPolicy:i,keyLoadPolicy:a}=t.config,o=lm(AE(e)?a:i,e),l=t.levels.reduce((c,d)=>c+d.fragmentError,0);if(s&&(e.details!==O.FRAG_GAP&&s.fragmentError++,!wE(e)&&kl(o,l,Ll(e),e.response)))return{action:ct.RetryRequest,flags:Wt.None,retryConfig:o,retryCount:l};const u=this.getLevelSwitchAction(e,n);return o&&(u.retryConfig=o,u.retryCount=l),u}getLevelSwitchAction(e,t){const n=this.hls;t==null&&(t=n.loadLevel);const s=this.hls.levels[t];if(s){var i,a;const u=e.details;s.loadError++,u===O.BUFFER_APPEND_ERROR&&s.fragmentError++;let c=-1;const{levels:d,loadLevel:f,minAutoLevel:h,maxAutoLevel:g}=n;!n.autoLevelEnabled&&!n.config.preserveManualLevelOnError&&(n.loadLevel=-1);const p=(i=e.frag)==null?void 0:i.type,m=(p===ee.AUDIO&&u===O.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(u===O.BUFFER_ADD_CODEC_ERROR||u===O.BUFFER_APPEND_ERROR))&&d.some(({audioCodec:A})=>s.audioCodec!==A),S=e.sourceBufferName==="video"&&(u===O.BUFFER_ADD_CODEC_ERROR||u===O.BUFFER_APPEND_ERROR)&&d.some(({codecSet:A,audioCodec:x})=>s.codecSet!==A&&s.audioCodec===x),{type:E,groupId:T}=(a=e.context)!=null?a:{};for(let A=d.length;A--;){const x=(A+f)%d.length;if(x!==f&&x>=h&&x<=g&&d[x].loadError===0){var o,l;const w=d[x];if(u===O.FRAG_GAP&&p===ee.MAIN&&e.frag){const b=d[x].details;if(b){const I=cs(e.frag,b.fragments,e.frag.start);if(I!=null&&I.gap)continue}}else{if(E===ve.AUDIO_TRACK&&w.hasAudioGroup(T)||E===ve.SUBTITLE_TRACK&&w.hasSubtitleGroup(T))continue;if(p===ee.AUDIO&&(o=s.audioGroups)!=null&&o.some(b=>w.hasAudioGroup(b))||p===ee.SUBTITLE&&(l=s.subtitleGroups)!=null&&l.some(b=>w.hasSubtitleGroup(b))||m&&s.audioCodec===w.audioCodec||S&&s.codecSet===w.codecSet||!m&&s.codecSet!==w.codecSet)continue}c=x;break}}if(c>-1&&n.loadLevel!==c)return e.levelRetry=!0,this.playlistError=0,{action:ct.SendAlternateToPenaltyBox,flags:Wt.None,nextAutoLevel:c}}return{action:ct.SendAlternateToPenaltyBox,flags:Wt.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var n;switch((n=t.errorAction)==null?void 0:n.action){case ct.DoNothing:break;case ct.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==O.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,n=e.errorAction;if(!n)return;const{flags:s}=n,i=n.nextAutoLevel;switch(s){case Wt.None:this.switchLevel(e,i);break;case Wt.MoveAllAlternatesMatchingHDCP:{const l=this.getVariantLevelIndex(e.frag),u=t.levels[l],c=u==null?void 0:u.attrs["HDCP-LEVEL"];if(n.hdcpLevel=c,c==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(c){t.maxHdcpLevel=kd[kd.indexOf(c)-1],n.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case Wt.MoveAllAlternatesMatchingKey:{const l=e.decryptdata;if(l){const u=this.hls.levels,c=u.length;for(let f=c;f--;)if(this.variantHasKey(u[f],l)){var a,o;this.log(`Banned key found in level ${f} (${u[f].bitrate}bps) or audio group "${(a=u[f].audioGroups)==null?void 0:a.join(",")}" (${(o=e.frag)==null?void 0:o.type} fragment) ${dt(l.keyId||[])}`),u[f].fragmentError++,u[f].loadError++,this.log(`Removing level ${f} with key error (${e.error})`),this.hls.removeLevel(f)}const d=e.frag;if(this.hls.levels.length<c)n.resolved=!0;else if(d&&d.type!==ee.MAIN){const f=d.decryptdata;f&&!l.matches(f)&&(n.resolved=!0)}}break}}n.resolved||this.switchLevel(e,i)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===O.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const n=Ld(e.mimeType),s=this.hls.levels;for(let i=s.length;i--;)s[i][`${e.sourceBufferName}Codec`]===n&&(this.log(`Removing level ${i} for ${e.details} ("${n}" not supported)`),this.hls.removeLevel(i))}}}function ti(r){const e={action:ct.DoNothing,flags:Wt.None};return r&&(e.resolved=!0),e}var tt={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class _I{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(_.MANIFEST_LOADING,this.onManifestLoading,this),e.on(_.BUFFER_APPENDED,this.onBufferAppended,this),e.on(_.FRAG_BUFFERED,this.onFragBuffered,this),e.on(_.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(_.MANIFEST_LOADING,this.onManifestLoading,this),e.off(_.BUFFER_APPENDED,this.onBufferAppended,this),e.off(_.FRAG_BUFFERED,this.onFragBuffered,this),e.off(_.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const n=this.activePartLists[t];if(n)for(let s=n.length;s--;){const i=n[s];if(!i)break;if(i.start<=e&&e<=i.end&&i.loaded)return i}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,n){const{fragments:s}=this,i=Object.keys(s);for(let a=i.length;a--;){const o=s[i[a]];if((o==null?void 0:o.body.type)===t&&(!n||o.buffered)){const l=o.body;if(l.start<=e&&e<=l.end)return l}}return null}detectEvictedFragments(e,t,n,s,i){this.timeRanges&&(this.timeRanges[e]=t);const a=(s==null?void 0:s.fragment.sn)||-1;Object.keys(this.fragments).forEach(o=>{const l=this.fragments[o];if(!l||a>=l.body.sn)return;if(!l.buffered&&(!l.loaded||i)){l.body.type===n&&this.removeFragment(l.body);return}const u=l.range[e];if(u){if(u.time.length===0){this.removeFragment(l.body);return}u.time.some(c=>{const d=!this.isTimeBuffered(c.startPTS,c.endPTS,t);return d&&this.removeFragment(l.body),d})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const n=e.frag,s=Ss(n),i=this.fragments[s];if(!i||i.buffered&&n.gap)return;const a=!n.relurl;Object.keys(t).forEach(o=>{const l=n.elementaryStreams[o];if(!l)return;const u=t[o],c=a||l.partial===!0;i.range[o]=this.getBufferedTimes(n,e.part,c,u)}),i.loaded=null,Object.keys(i.range).length?(this.bufferedEnd(i,n),ho(i)||this.removeParts(n.sn-1,n.type)):this.removeFragment(i.body)}bufferedEnd(e,t){e.buffered=!0,(e.body.endList=t.endList||e.body.endList)&&(this.endListFragments[e.body.type]=e)}removeParts(e,t){const n=this.activePartLists[t];n&&(this.activePartLists[t]=cm(n,s=>s.fragment.sn>=e))}fragBuffered(e,t){const n=Ss(e);let s=this.fragments[n];!s&&t&&(s=this.fragments[n]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),s&&(s.loaded=null,this.bufferedEnd(s,e))}getBufferedTimes(e,t,n,s){const i={time:[],partial:n},a=e.start,o=e.end,l=e.minEndPTS||o,u=e.maxStartPTS||a;for(let c=0;c<s.length;c++){const d=s.start(c)-this.bufferPadding,f=s.end(c)+this.bufferPadding;if(u>=d&&l<=f){i.time.push({startPTS:Math.max(a,s.start(c)),endPTS:Math.min(o,s.end(c))});break}else if(a<f&&o>d){const h=Math.max(a,s.start(c)),g=Math.min(o,s.end(c));g>h&&(i.partial=!0,i.time.push({startPTS:h,endPTS:g}))}else if(o<=d)break}return i}getPartialFragment(e){let t=null,n,s,i,a=0;const{bufferPadding:o,fragments:l}=this;return Object.keys(l).forEach(u=>{const c=l[u];c&&ho(c)&&(s=c.body.start-o,i=c.body.end+o,e>=s&&e<=i&&(n=Math.min(e-s,i-e),a<=n&&(t=c.body,a=n)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||ho(t))}getState(e){const t=Ss(e),n=this.fragments[t];return n?n.buffered?ho(n)?tt.PARTIAL:tt.OK:tt.APPENDING:tt.NOT_LOADED}isTimeBuffered(e,t,n){let s,i;for(let a=0;a<n.length;a++){if(s=n.start(a)-this.bufferPadding,i=n.end(a)+this.bufferPadding,e>=s&&t<=i)return!0;if(t<=s)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const n=t.frag,s=t.part?null:t,i=Ss(n);this.fragments[i]={body:n,appendedPTS:null,loaded:s,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:n,part:s,timeRanges:i,type:a}=t;if(n.sn==="initSegment")return;const o=n.type;if(s){let u=this.activePartLists[o];u||(this.activePartLists[o]=u=[]),u.push(s)}this.timeRanges=i;const l=i[a];this.detectEvictedFragments(a,l,o,s)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=Ss(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,n=Object.keys(t);if(!e)return n.length>0;for(let s=n.length;s--;){const i=t[n[s]];if((i==null?void 0:i.body.type)===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,n,s,i){s&&!this.hasGaps||Object.keys(this.fragments).forEach(a=>{const o=this.fragments[a];if(!o)return;const l=o.body;l.type!==n||s&&!l.gap||l.start<t&&l.end>e&&(o.buffered||i)&&this.removeFragment(l)})}removeFragment(e){const t=Ss(e);e.clearElementaryStreamInfo();const n=this.activePartLists[e.type];if(n){const s=e.sn;this.activePartLists[e.type]=cm(n,i=>i.fragment.sn!==s)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(n=>n.clearElementaryStreamInfo())}}function ho(r){var e,t,n;return r.buffered&&!!(r.body.gap||(e=r.range.video)!=null&&e.partial||(t=r.range.audio)!=null&&t.partial||(n=r.range.audiovideo)!=null&&n.partial)}function Ss(r){return`${r.type}_${r.level}_${r.sn}`}function cm(r,e){return r.filter(t=>{const n=e(t);return n||t.clearElementaryStreamInfo(),n})}var Mn={cbc:0,ctr:1};class TI{constructor(e,t,n){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=n}decrypt(e,t){switch(this.aesMode){case Mn.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case Mn.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function xI(r){const e=r.byteLength,t=e&&new DataView(r.buffer).getUint8(e-1);return t?r.slice(0,e-t):r}class AI{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),n=new Uint32Array(4);for(let s=0;s<4;s++)n[s]=t.getUint32(s*4);return n}initTable(){const e=this.sBox,t=this.invSBox,n=this.subMix,s=n[0],i=n[1],a=n[2],o=n[3],l=this.invSubMix,u=l[0],c=l[1],d=l[2],f=l[3],h=new Uint32Array(256);let g=0,p=0,v=0;for(v=0;v<256;v++)v<128?h[v]=v<<1:h[v]=v<<1^283;for(v=0;v<256;v++){let m=p^p<<1^p<<2^p<<3^p<<4;m=m>>>8^m&255^99,e[g]=m,t[m]=g;const y=h[g],S=h[y],E=h[S];let T=h[m]*257^m*16843008;s[g]=T<<24|T>>>8,i[g]=T<<16|T>>>16,a[g]=T<<8|T>>>24,o[g]=T,T=E*16843009^S*65537^y*257^g*16843008,u[m]=T<<24|T>>>8,c[m]=T<<16|T>>>16,d[m]=T<<8|T>>>24,f[m]=T,g?(g=y^h[h[h[E^y]]],p^=h[h[p]]):g=p=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let n=!0,s=0;for(;s<t.length&&n;)n=t[s]===this.key[s],s++;if(n)return;this.key=t;const i=this.keySize=t.length;if(i!==4&&i!==6&&i!==8)throw new Error("Invalid aes key size="+i);const a=this.ksRows=(i+6+1)*4;let o,l;const u=this.keySchedule=new Uint32Array(a),c=this.invKeySchedule=new Uint32Array(a),d=this.sBox,f=this.rcon,h=this.invSubMix,g=h[0],p=h[1],v=h[2],m=h[3];let y,S;for(o=0;o<a;o++){if(o<i){y=u[o]=t[o];continue}S=y,o%i===0?(S=S<<8|S>>>24,S=d[S>>>24]<<24|d[S>>>16&255]<<16|d[S>>>8&255]<<8|d[S&255],S^=f[o/i|0]<<24):i>6&&o%i===4&&(S=d[S>>>24]<<24|d[S>>>16&255]<<16|d[S>>>8&255]<<8|d[S&255]),u[o]=y=(u[o-i]^S)>>>0}for(l=0;l<a;l++)o=a-l,l&3?S=u[o]:S=u[o-4],l<4||o<=4?c[l]=S:c[l]=g[d[S>>>24]]^p[d[S>>>16&255]]^v[d[S>>>8&255]]^m[d[S&255]],c[l]=c[l]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,n){const s=this.keySize+6,i=this.invKeySchedule,a=this.invSBox,o=this.invSubMix,l=o[0],u=o[1],c=o[2],d=o[3],f=this.uint8ArrayToUint32Array_(n);let h=f[0],g=f[1],p=f[2],v=f[3];const m=new Int32Array(e),y=new Int32Array(m.length);let S,E,T,A,x,w,b,I,M,K,z,X,Q,N;const P=this.networkToHostOrderSwap;for(;t<m.length;){for(M=P(m[t]),K=P(m[t+1]),z=P(m[t+2]),X=P(m[t+3]),x=M^i[0],w=X^i[1],b=z^i[2],I=K^i[3],Q=4,N=1;N<s;N++)S=l[x>>>24]^u[w>>16&255]^c[b>>8&255]^d[I&255]^i[Q],E=l[w>>>24]^u[b>>16&255]^c[I>>8&255]^d[x&255]^i[Q+1],T=l[b>>>24]^u[I>>16&255]^c[x>>8&255]^d[w&255]^i[Q+2],A=l[I>>>24]^u[x>>16&255]^c[w>>8&255]^d[b&255]^i[Q+3],x=S,w=E,b=T,I=A,Q=Q+4;S=a[x>>>24]<<24^a[w>>16&255]<<16^a[b>>8&255]<<8^a[I&255]^i[Q],E=a[w>>>24]<<24^a[b>>16&255]<<16^a[I>>8&255]<<8^a[x&255]^i[Q+1],T=a[b>>>24]<<24^a[I>>16&255]<<16^a[x>>8&255]<<8^a[w&255]^i[Q+2],A=a[I>>>24]<<24^a[x>>16&255]<<16^a[w>>8&255]<<8^a[b&255]^i[Q+3],y[t]=P(S^h),y[t+1]=P(A^g),y[t+2]=P(T^p),y[t+3]=P(E^v),h=M,g=K,p=z,v=X,t=t+4}return y.buffer}}class wI{constructor(e,t,n){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=n}expandKey(){const e=II(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function II(r){switch(r){case Mn.cbc:return"AES-CBC";case Mn.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${r}`)}}const bI=16;class Qg{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const n=self.crypto;n&&(this.subtle=n.subtle||n.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const n=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?xI(n):n}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,n,s){return this.useSoftware?new Promise((i,a)=>{const o=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(o,t,n,s);const l=this.flush();l?i(l.buffer):a(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,n,s)}softwareDecrypt(e,t,n,s){const{currentIV:i,currentResult:a,remainderData:o}=this;if(s!==Mn.cbc||t.byteLength!==16)return xe.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),o&&(e=dr(o,e),this.remainderData=null);const l=this.getValidChunk(e);if(!l.length)return null;i&&(n=i);let u=this.softwareDecrypter;u||(u=this.softwareDecrypter=new AI),u.expandKey(t);const c=a;return this.currentResult=u.decrypt(l.buffer,0,n),this.currentIV=l.slice(-16).buffer,c||null}webCryptoDecrypt(e,t,n,s){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,n,s));this.key=t,this.fastAesKey=new wI(this.subtle,t,s)}return this.fastAesKey.expandKey().then(i=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new TI(this.subtle,new Uint8Array(n),s).decrypt(e.buffer,i)):Promise.reject(new Error("web crypto not initialized"))).catch(i=>(xe.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${i.name}: ${i.message}`),this.onWebCryptoError(e,t,n,s)))}onWebCryptoError(e,t,n,s){const i=this.enableSoftwareAES;if(i){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,n,s);const a=this.flush();if(a)return a.buffer}throw new Error("WebCrypto"+(i?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const n=e.length-e.length%bI;return n!==e.length&&(t=e.slice(0,n),this.remainderData=e.slice(n)),t}logOnce(e){this.logEnabled&&(xe.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const dm=Math.pow(2,17);class RI{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const n=e.url;if(!n)return Promise.reject(new Hr({type:se.NETWORK_ERROR,details:O.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${n?"part list":"url"}`),networkDetails:null}));this.abort();const s=this.config,i=s.fLoader,a=s.loader;return new Promise((o,l)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(g=>g[0]==="GAP")){l(hm(e));return}else e.gap=!1;const u=this.loader=i?new i(s):new a(s),c=fm(e);e.loader=u;const d=um(s.fragLoadPolicy.default),f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:dm};e.stats=u.stats;const h={onSuccess:(g,p,v,m)=>{this.resetLoader(e,u);let y=g.data;v.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(y.slice(0,16)),y=y.slice(16)),o({frag:e,part:null,payload:y,networkDetails:m})},onError:(g,p,v,m)=>{this.resetLoader(e,u),l(new Hr({type:se.NETWORK_ERROR,details:O.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:Te({url:n,data:void 0},g),error:new Error(`HTTP Error ${g.code} ${g.text}`),networkDetails:v,stats:m}))},onAbort:(g,p,v)=>{this.resetLoader(e,u),l(new Hr({type:se.NETWORK_ERROR,details:O.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:v,stats:g}))},onTimeout:(g,p,v)=>{this.resetLoader(e,u),l(new Hr({type:se.NETWORK_ERROR,details:O.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:v,stats:g}))}};t&&(h.onProgress=(g,p,v,m)=>t({frag:e,part:null,payload:v,networkDetails:m})),u.load(c,f,h)})}loadPart(e,t,n){this.abort();const s=this.config,i=s.fLoader,a=s.loader;return new Promise((o,l)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){l(hm(e,t));return}const u=this.loader=i?new i(s):new a(s),c=fm(e,t);e.loader=u;const d=um(s.fragLoadPolicy.default),f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:dm};t.stats=u.stats,u.load(c,f,{onSuccess:(h,g,p,v)=>{this.resetLoader(e,u),this.updateStatsFromPart(e,t);const m={frag:e,part:t,payload:h.data,networkDetails:v};n(m),o(m)},onError:(h,g,p,v)=>{this.resetLoader(e,u),l(new Hr({type:se.NETWORK_ERROR,details:O.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:Te({url:c.url,data:void 0},h),error:new Error(`HTTP Error ${h.code} ${h.text}`),networkDetails:p,stats:v}))},onAbort:(h,g,p)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,u),l(new Hr({type:se.NETWORK_ERROR,details:O.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:p,stats:h}))},onTimeout:(h,g,p)=>{this.resetLoader(e,u),l(new Hr({type:se.NETWORK_ERROR,details:O.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:p,stats:h}))}})})}updateStatsFromPart(e,t){const n=e.stats,s=t.stats,i=s.total;if(n.loaded+=s.loaded,i){const l=Math.round(e.duration/t.duration),u=Math.min(Math.round(n.loaded/i),l),d=(l-u)*Math.round(n.loaded/u);n.total=n.loaded+d}else n.total=Math.max(n.loaded,n.total);const a=n.loading,o=s.loading;a.start?a.first+=o.first-o.start:(a.start=o.start,a.first=o.first),a.end=o.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function fm(r,e=null){const t=e||r,n={frag:r,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},s=t.byteRangeStartOffset,i=t.byteRangeEndOffset;if(J(s)&&J(i)){var a;let o=s,l=i;if(r.sn==="initSegment"&&LI((a=r.decryptdata)==null?void 0:a.method)){const u=i-s;u%16&&(l=i+(16-u%16)),s!==0&&(n.resetIV=!0,o=s-16)}n.rangeStart=o,n.rangeEnd=l}return n}function hm(r,e){const t=new Error(`GAP ${r.gap?"tag":"attribute"} found`),n={type:se.MEDIA_ERROR,details:O.FRAG_GAP,fatal:!1,frag:r,error:t,networkDetails:null};return e&&(n.part=e),(e||r).stats.aborted=!0,new Hr(n)}function LI(r){return r==="AES-128"||r==="AES-256"}class Hr extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class IE extends fr{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class Xg{constructor(e,t,n,s=0,i=-1,a=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=go(),this.buffering={audio:go(),video:go(),audiovideo:go()},this.level=e,this.sn=t,this.id=n,this.size=s,this.part=i,this.partial=a}}function go(){return{start:0,executeStart:0,executeEnd:0,end:0}}const gm={length:0,start:()=>0,end:()=>0};class ge{static isBuffered(e,t){if(e){const n=ge.getBuffered(e);for(let s=n.length;s--;)if(t>=n.start(s)&&t<=n.end(s))return!0}return!1}static bufferedRanges(e){if(e){const t=ge.getBuffered(e);return ge.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let n=0;n<e.length;n++)t.push({start:e.start(n),end:e.end(n)});return t}static bufferInfo(e,t,n){if(e){const s=ge.bufferedRanges(e);if(s.length)return ge.bufferedInfo(s,t,n)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,n){t=Math.max(0,t),e.length>1&&e.sort((c,d)=>c.start-d.start||d.end-c.end);let s=-1,i=[];if(n)for(let c=0;c<e.length;c++){t>=e[c].start&&t<=e[c].end&&(s=c);const d=i.length;if(d){const f=i[d-1].end;e[c].start-f<n?e[c].end>f&&(i[d-1].end=e[c].end):i.push(e[c])}else i.push(e[c])}else i=e;let a=0,o,l=t,u=t;for(let c=0;c<i.length;c++){const d=i[c].start,f=i[c].end;if(s===-1&&t>=d&&t<=f&&(s=c),t+n>=d&&t<f)l=d,u=f,a=u-t;else if(t+n<d){o=d;break}}return{len:a,start:l||0,end:u||0,nextStart:o,buffered:e,bufferedIndex:s}}static getBuffered(e){try{return e.buffered||gm}catch(t){return xe.log("failed to get media.buffered",t),gm}}}const bE=/\{\$([a-zA-Z0-9-_]+)\}/g;function pm(r){return bE.test(r)}function Pd(r,e){if(r.variableList!==null||r.hasVariableRefs){const t=r.variableList;return e.replace(bE,n=>{const s=n.substring(2,n.length-1),i=t==null?void 0:t[s];return i===void 0?(r.playlistParsingError||(r.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${s}"`)),n):i})}return e}function mm(r,e,t){let n=r.variableList;n||(r.variableList=n={});let s,i;if("QUERYPARAM"in e){s=e.QUERYPARAM;try{const a=new self.URL(t).searchParams;if(a.has(s))i=a.get(s);else throw new Error(`"${s}" does not match any query parameter in URI: "${t}"`)}catch(a){r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${a.message}`))}}else s=e.NAME,i=e.VALUE;s in n?r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${s}"`)):n[s]=i||""}function kI(r,e,t){const n=e.IMPORT;if(t&&n in t){let s=r.variableList;s||(r.variableList=s={}),s[n]=t[n]}else r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${n}"`))}const CI=/^(\d+)x(\d+)$/,vm=/(.+?)=(".*?"|.*?)(?:,|$)/g;class $e{constructor(e,t){typeof e=="string"&&(e=$e.parseAttrList(e,t)),we(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const n=new Uint8Array(t.length/2);for(let s=0;s<t.length/2;s++)n[s]=parseInt(t.slice(s*2,s*2+2),16);return n}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const n=this[e];return n?parseFloat(n):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const n=this[e];return(n?n.split(/[ ,]+/):[]).reduce((s,i)=>(s[i.toLowerCase()]=!0,s),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=CI.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let n;const s={},i='"';for(vm.lastIndex=0;(n=vm.exec(e))!==null;){const a=n[1].trim();let o=n[2];const l=o.indexOf(i)===0&&o.lastIndexOf(i)===o.length-1;let u=!1;if(l)o=o.slice(1,-1);else switch(a){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":u=!0}if(t&&(l||u))o=Pd(t,o);else if(!u&&!l)switch(a){case"CLOSED-CAPTIONS":if(o==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":xe.warn(`${e}: attribute ${a} is missing quotes`)}s[a]=o}return s}}const PI="com.apple.hls.interstitial";function DI(r){return r!=="ID"&&r!=="CLASS"&&r!=="CUE"&&r!=="START-DATE"&&r!=="DURATION"&&r!=="END-DATE"&&r!=="END-ON-NEXT"}function OI(r){return r==="SCTE35-OUT"||r==="SCTE35-IN"||r==="SCTE35-CMD"}class RE{constructor(e,t,n=0){var s;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(t==null?void 0:t.tagAnchor)||null,this.tagOrder=(s=t==null?void 0:t.tagOrder)!=null?s:n,t){const i=t.attr;for(const a in i)if(Object.prototype.hasOwnProperty.call(e,a)&&e[a]!==i[a]){xe.warn(`DATERANGE tag attribute: "${a}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=a;break}e=we(new $e({}),i,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const i=(t==null?void 0:t.endDate)||new Date(this.attr["END-DATE"]);J(i.getTime())&&(this._endDate=i)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(xe.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(J(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===PI}get isValid(){return!!this.id&&!this._badValueForSameId&&J(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const MI=10;class NI{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,n=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!n||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&n>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let n=t.decryptdata;return n||(t.setKeyFormat(e.keyFormat),n=t.decryptdata),!!n&&e.matches(n)})}get hasProgramDateTime(){return this.fragments.length?J(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||MI}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let n=e.length;n--;)if(e[n].index>t)return e[n].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function Cl(r,e){return r.length===e.length?!r.some((t,n)=>t!==e[n]):!1}function ym(r,e){return!r&&!e?!0:!r||!e?!1:Cl(r,e)}function ri(r){return r==="AES-128"||r==="AES-256"||r==="AES-256-CTR"}function Jg(r){switch(r){case"AES-128":case"AES-256":return Mn.cbc;case"AES-256-CTR":return Mn.ctr;default:throw new Error(`invalid full segment method ${r}`)}}function ep(r){return Uint8Array.from(atob(r),e=>e.charCodeAt(0))}function Dd(r){return Uint8Array.from(unescape(encodeURIComponent(r)),e=>e.charCodeAt(0))}function FI(r){const e=Dd(r).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function LE(r){const e=function(n,s,i){const a=n[s];n[s]=n[i],n[i]=a};e(r,0,3),e(r,1,2),e(r,4,5),e(r,6,7)}function kE(r){const e=r.split(":");let t=null;if(e[0]==="data"&&e.length===2){const n=e[1].split(";"),s=n[n.length-1].split(",");if(s.length===2){const i=s[0]==="base64",a=s[1];i?(n.splice(-1,1),t=ep(a)):t=FI(a)}}return t}const Pl=typeof self<"u"?self:void 0;var je={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},ft={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function Yo(r){switch(r){case ft.FAIRPLAY:return je.FAIRPLAY;case ft.PLAYREADY:return je.PLAYREADY;case ft.WIDEVINE:return je.WIDEVINE;case ft.CLEARKEY:return je.CLEARKEY}}function Hu(r){switch(r){case je.FAIRPLAY:return ft.FAIRPLAY;case je.PLAYREADY:return ft.PLAYREADY;case je.WIDEVINE:return ft.WIDEVINE;case je.CLEARKEY:return ft.CLEARKEY}}function Ni(r){const{drmSystems:e,widevineLicenseUrl:t}=r,n=e?[je.FAIRPLAY,je.WIDEVINE,je.PLAYREADY,je.CLEARKEY].filter(s=>!!e[s]):[];return!n[je.WIDEVINE]&&t&&n.push(je.WIDEVINE),n}const CE=function(r){return Pl!=null&&(r=Pl.navigator)!=null&&r.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function $I(r,e,t,n){let s;switch(r){case je.FAIRPLAY:s=["cenc","sinf"];break;case je.WIDEVINE:case je.PLAYREADY:s=["cenc"];break;case je.CLEARKEY:s=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${r}`)}return UI(s,e,t,n)}function UI(r,e,t,n){return[{initDataTypes:r,persistentState:n.persistentState||"optional",distinctiveIdentifier:n.distinctiveIdentifier||"optional",sessionTypes:n.sessionTypes||[n.sessionType||"temporary"],audioCapabilities:e.map(i=>({contentType:`audio/mp4; codecs=${i}`,robustness:n.audioRobustness||"",encryptionScheme:n.audioEncryptionScheme||null})),videoCapabilities:t.map(i=>({contentType:`video/mp4; codecs=${i}`,robustness:n.videoRobustness||"",encryptionScheme:n.videoEncryptionScheme||null}))}]}function BI(r){var e;return!!r&&(r.sessionType==="persistent-license"||!!((e=r.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function PE(r){const e=new Uint16Array(r.buffer,r.byteOffset,r.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),n=t.substring(t.indexOf("<"),t.length),a=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("KID")[0];if(a){const o=a.childNodes[0]?a.childNodes[0].nodeValue:a.getAttribute("VALUE");if(o){const l=ep(o).subarray(0,16);return LE(l),l}}return null}let Es={};class Cn{static clearKeyUriToKeyIdMap(){Es={}}static setKeyIdForUri(e,t){Es[e]=t}static addKeyIdForUri(e){const t=Object.keys(Es).length%Number.MAX_SAFE_INTEGER,n=new Uint8Array(16);return new DataView(n.buffer,12,4).setUint32(0,t),Es[e]=n,n}constructor(e,t,n,s=[1],i=null,a){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=n,this.keyFormatVersions=s,this.iv=i,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!ri(e),a!=null&&a.startsWith("0x")&&(this.keyId=new Uint8Array(aE(a)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&Cl(e.keyFormatVersions,this.keyFormatVersions)&&ym(e.iv,this.iv)&&ym(e.keyId,this.keyId)}isSupported(){if(this.method){if(ri(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case ft.FAIRPLAY:case ft.WIDEVINE:case ft.PLAYREADY:case ft.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(ri(this.method)){let i=this.iv;return i||(typeof e!="number"&&(xe.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),i=GI(e)),new Cn(this.method,this.uri,"identity",this.keyFormatVersions,i)}if(this.keyId){const i=Es[this.uri];if(i&&!Cl(this.keyId,i)&&Cn.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const n=kE(this.uri);if(n)switch(this.keyFormat){case ft.WIDEVINE:if(this.pssh=n,!this.keyId){const i=Vw(n.buffer);if(i.length){var s;const a=i[0];this.keyId=(s=a.kids)!=null&&s.length?a.kids[0]:null}}this.keyId||(this.keyId=Sm(t));break;case ft.PLAYREADY:{const i=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=Hw(i,null,n),this.keyId=PE(n);break}default:{let i=n.subarray(0,16);if(i.length!==16){const a=new Uint8Array(16);a.set(i,16-i.length),i=a}this.keyId=i;break}}if(!this.keyId||this.keyId.byteLength!==16){let i;i=jI(t),i||(i=Sm(t),i||(i=Es[this.uri])),i&&(this.keyId=i,Cn.setKeyIdForUri(this.uri,i))}return this}}function jI(r){const e=r==null?void 0:r[ft.WIDEVINE];return e?e.keyId:null}function Sm(r){const e=r==null?void 0:r[ft.PLAYREADY];if(e){const t=kE(e.uri);if(t)return PE(t)}return null}function GI(r){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=r>>8*(15-t)&255;return e}const Em=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,_m=/#EXT-X-MEDIA:(.*)/g,KI=/^#EXT(?:INF|-X-TARGETDURATION):/m,Vu=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),HI=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Nr{static findGroup(e,t){for(let n=0;n<e.length;n++){const s=e[n];if(s.id===t)return s}}static resolve(e,t){return Vg.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return KI.test(e)}static parseMasterPlaylist(e,t){const n=pm(e),s={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:n},i=[];if(Em.lastIndex=0,!e.startsWith("#EXTM3U"))return s.playlistParsingError=new Error("no EXTM3U delimiter"),s;let a;for(;(a=Em.exec(e))!=null;)if(a[1]){var o;const u=new $e(a[1],s),c=Pd(s,a[2]),d={attrs:u,bitrate:u.decimalInteger("BANDWIDTH")||u.decimalInteger("AVERAGE-BANDWIDTH"),name:u.NAME,url:Nr.resolve(c,t)},f=u.decimalResolution("RESOLUTION");f&&(d.width=f.width,d.height=f.height),Am(u.CODECS,d);const h=u["SUPPLEMENTAL-CODECS"];h&&(d.supplemental={},Am(h,d.supplemental)),(o=d.unknownCodecs)!=null&&o.length||i.push(d),s.levels.push(d)}else if(a[3]){const u=a[3],c=a[4];switch(u){case"SESSION-DATA":{const d=new $e(c,s),f=d["DATA-ID"];f&&(s.sessionData===null&&(s.sessionData={}),s.sessionData[f]=d);break}case"SESSION-KEY":{const d=Tm(c,t,s);d.encrypted&&d.isSupported()?(s.sessionKeys===null&&(s.sessionKeys=[]),s.sessionKeys.push(d)):xe.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${c}"`);break}case"DEFINE":{{const d=new $e(c,s);mm(s,d,t)}break}case"CONTENT-STEERING":{const d=new $e(c,s);s.contentSteering={uri:Nr.resolve(d["SERVER-URI"],t),pathwayId:d["PATHWAY-ID"]||"."};break}case"START":{s.startTimeOffset=xm(c);break}}}const l=i.length>0&&i.length<s.levels.length;return s.levels=l?i:s.levels,s.levels.length===0&&(s.playlistParsingError=new Error("no levels found in manifest")),s}static parseMasterPlaylistMedia(e,t,n){let s;const i={},a=n.levels,o={AUDIO:a.map(u=>({id:u.attrs.AUDIO,audioCodec:u.audioCodec})),SUBTITLES:a.map(u=>({id:u.attrs.SUBTITLES,textCodec:u.textCodec})),"CLOSED-CAPTIONS":[]};let l=0;for(_m.lastIndex=0;(s=_m.exec(e))!==null;){const u=new $e(s[1],n),c=u.TYPE;if(c){const d=o[c],f=i[c]||[];i[c]=f;const h=u.LANGUAGE,g=u["ASSOC-LANGUAGE"],p=u.CHANNELS,v=u.CHARACTERISTICS,m=u["INSTREAM-ID"],y={attrs:u,bitrate:0,id:l++,groupId:u["GROUP-ID"]||"",name:u.NAME||h||"",type:c,default:u.bool("DEFAULT"),autoselect:u.bool("AUTOSELECT"),forced:u.bool("FORCED"),lang:h,url:u.URI?Nr.resolve(u.URI,t):""};if(g&&(y.assocLang=g),p&&(y.channels=p),v&&(y.characteristics=v),m&&(y.instreamId=m),d!=null&&d.length){const S=Nr.findGroup(d,y.groupId)||d[0];wm(y,S,"audioCodec"),wm(y,S,"textCodec")}f.push(y)}}return i}static parseLevelPlaylist(e,t,n,s,i,a){var o;const l={url:t},u=new NI(t),c=u.fragments,d=[];let f=null,h=0,g=0,p=0,v=0,m=0,y=null,S=new ju(s,l),E,T,A,x=-1,w=!1,b=null,I;if(Vu.lastIndex=0,u.m3u8=e,u.hasVariableRefs=pm(e),((o=Vu.exec(e))==null?void 0:o[0])!=="#EXTM3U")return u.playlistParsingError=new Error("Missing format identifier #EXTM3U"),u;for(;(E=Vu.exec(e))!==null;){w&&(w=!1,S=new ju(s,l),S.playlistOffset=p,S.setStart(p),S.sn=h,S.cc=v,m&&(S.bitrate=m),S.level=n,f&&(S.initSegment=f,f.rawProgramDateTime&&(S.rawProgramDateTime=f.rawProgramDateTime,f.rawProgramDateTime=null),b&&(S.setByteRange(b),b=null)));const X=E[1];if(X){S.duration=parseFloat(X);const Q=(" "+E[2]).slice(1);S.title=Q||null,S.tagList.push(Q?["INF",X,Q]:["INF",X])}else if(E[3]){if(J(S.duration)){S.playlistOffset=p,S.setStart(p),A&&bm(S,A,u),S.sn=h,S.level=n,S.cc=v,c.push(S);const Q=(" "+E[3]).slice(1);S.relurl=Pd(u,Q),Od(S,y,d),y=S,p+=S.duration,h++,g=0,w=!0}}else{if(E=E[0].match(HI),!E){xe.warn("No matches on slow regex match for level playlist!");continue}for(T=1;T<E.length&&E[T]===void 0;T++);const Q=(" "+E[T]).slice(1),N=(" "+E[T+1]).slice(1),P=E[T+2]?(" "+E[T+2]).slice(1):null;switch(Q){case"BYTERANGE":y?S.setByteRange(N,y):S.setByteRange(N);break;case"PROGRAM-DATE-TIME":S.rawProgramDateTime=N,S.tagList.push(["PROGRAM-DATE-TIME",N]),x===-1&&(x=c.length);break;case"PLAYLIST-TYPE":u.type&&jr(u,Q,E),u.type=N.toUpperCase();break;case"MEDIA-SEQUENCE":u.startSN!==0?jr(u,Q,E):c.length>0&&Rm(u,Q,E),h=u.startSN=parseInt(N);break;case"SKIP":{u.skippedSegments&&jr(u,Q,E);const k=new $e(N,u),F=k.decimalInteger("SKIPPED-SEGMENTS");if(J(F)){u.skippedSegments+=F;for(let B=F;B--;)c.push(null);h+=F}const U=k.enumeratedString("RECENTLY-REMOVED-DATERANGES");U&&(u.recentlyRemovedDateranges=(u.recentlyRemovedDateranges||[]).concat(U.split("	")));break}case"TARGETDURATION":u.targetduration!==0&&jr(u,Q,E),u.targetduration=Math.max(parseInt(N),1);break;case"VERSION":u.version!==null&&jr(u,Q,E),u.version=parseInt(N);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":u.live||jr(u,Q,E),u.live=!1;break;case"#":(N||P)&&S.tagList.push(P?[N,P]:[N]);break;case"DISCONTINUITY":v++,S.tagList.push(["DIS"]);break;case"GAP":S.gap=!0,S.tagList.push([Q]);break;case"BITRATE":S.tagList.push([Q,N]),m=parseInt(N)*1e3,J(m)?S.bitrate=m:m=0;break;case"DATERANGE":{const k=new $e(N,u),F=new RE(k,u.dateRanges[k.ID],u.dateRangeTagCount);u.dateRangeTagCount++,F.isValid||u.skippedSegments?u.dateRanges[F.id]=F:xe.warn(`Ignoring invalid DATERANGE tag: "${N}"`),S.tagList.push(["EXT-X-DATERANGE",N]);break}case"DEFINE":{{const k=new $e(N,u);"IMPORT"in k?kI(u,k,a):mm(u,k,t)}break}case"DISCONTINUITY-SEQUENCE":u.startCC!==0?jr(u,Q,E):c.length>0&&Rm(u,Q,E),u.startCC=v=parseInt(N);break;case"KEY":{const k=Tm(N,t,u);if(k.isSupported()){if(k.method==="NONE"){A=void 0;break}A||(A={});const F=A[k.keyFormat];F!=null&&F.matches(k)||(F&&(A=we({},A)),A[k.keyFormat]=k)}else xe.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${N}"`);break}case"START":u.startTimeOffset=xm(N);break;case"MAP":{const k=new $e(N,u);if(S.duration){const F=new ju(s,l);Im(F,k,n,A),f=F,S.initSegment=f,f.rawProgramDateTime&&!S.rawProgramDateTime&&(S.rawProgramDateTime=f.rawProgramDateTime)}else{const F=S.byteRangeEndOffset;if(F){const U=S.byteRangeStartOffset;b=`${F-U}@${U}`}else b=null;Im(S,k,n,A),f=S,w=!0}f.cc=v;break}case"SERVER-CONTROL":{I&&jr(u,Q,E),I=new $e(N),u.canBlockReload=I.bool("CAN-BLOCK-RELOAD"),u.canSkipUntil=I.optionalFloat("CAN-SKIP-UNTIL",0),u.canSkipDateRanges=u.canSkipUntil>0&&I.bool("CAN-SKIP-DATERANGES"),u.partHoldBack=I.optionalFloat("PART-HOLD-BACK",0),u.holdBack=I.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{u.partTarget&&jr(u,Q,E);const k=new $e(N);u.partTarget=k.decimalFloatingPoint("PART-TARGET");break}case"PART":{let k=u.partList;k||(k=u.partList=[]);const F=g>0?k[k.length-1]:void 0,U=g++,B=new $e(N,u),G=new kw(B,S,l,U,F);k.push(G),S.duration+=G.duration;break}case"PRELOAD-HINT":{const k=new $e(N,u);u.preloadHint=k;break}case"RENDITION-REPORT":{const k=new $e(N,u);u.renditionReports=u.renditionReports||[],u.renditionReports.push(k);break}default:xe.warn(`line parsed but not handled: ${E}`);break}}}y&&!y.relurl?(c.pop(),p-=y.duration,u.partList&&(u.fragmentHint=y)):u.partList&&(Od(S,y,d),S.cc=v,u.fragmentHint=S,A&&bm(S,A,u)),u.targetduration||(u.playlistParsingError=new Error("Missing Target Duration"));const M=c.length,K=c[0],z=c[M-1];if(p+=u.skippedSegments*u.targetduration,p>0&&M&&z){u.averagetargetduration=p/M;const X=z.sn;u.endSN=X!=="initSegment"?X:0,u.live||(z.endList=!0),x>0&&(WI(c,x),K&&d.unshift(K))}return u.fragmentHint&&(p+=u.fragmentHint.duration),u.totalduration=p,d.length&&u.dateRangeTagCount&&K&&DE(d,u),u.endCC=v,u}}function DE(r,e){let t=r.length;if(!t)if(e.hasProgramDateTime){const o=e.fragments[e.fragments.length-1];r.push(o),t++}else return;const n=r[t-1],s=e.live?1/0:e.totalduration,i=Object.keys(e.dateRanges);for(let o=i.length;o--;){const l=e.dateRanges[i[o]],u=l.startDate.getTime();l.tagAnchor=n.ref;for(let c=t;c--;){var a;if(((a=r[c])==null?void 0:a.sn)<e.startSN)break;const d=VI(e,u,r,c,s);if(d!==-1){l.tagAnchor=e.fragments[d].ref;break}}}}function VI(r,e,t,n,s){const i=t[n];if(i){const o=i.programDateTime;if(e>=o||n===0){var a;const l=(((a=t[n+1])==null?void 0:a.start)||s)-i.start;if(e<=o+l*1e3){const u=t[n].sn-r.startSN;if(u<0)return-1;const c=r.fragments;if(c.length>t.length){const f=(t[n+1]||c[c.length-1]).sn-r.startSN;for(let h=f;h>u;h--){const g=c[h].programDateTime;if(e>=g&&e<g+c[h].duration*1e3)return h}}return u}}}return-1}function Tm(r,e,t){var n,s;const i=new $e(r,t),a=(n=i.METHOD)!=null?n:"",o=i.URI,l=i.hexadecimalInteger("IV"),u=i.KEYFORMATVERSIONS,c=(s=i.KEYFORMAT)!=null?s:"identity";o&&i.IV&&!l&&xe.error(`Invalid IV: ${i.IV}`);const d=o?Nr.resolve(o,e):"",f=(u||"1").split("/").map(Number).filter(Number.isFinite);return new Cn(a,d,c,f,l,i.KEYID)}function xm(r){const t=new $e(r).decimalFloatingPoint("TIME-OFFSET");return J(t)?t:null}function Am(r,e){let t=(r||"").split(/[ ,]+/).filter(n=>n);["video","audio","text"].forEach(n=>{const s=t.filter(i=>qg(i,n));s.length&&(e[`${n}Codec`]=s.map(i=>i.split("/")[0]).join(","),t=t.filter(i=>s.indexOf(i)===-1))}),e.unknownCodecs=t}function wm(r,e,t){const n=e[t];n&&(r[t]=n)}function WI(r,e){let t=r[e];for(let n=e;n--;){const s=r[n];if(!s)return;s.programDateTime=t.programDateTime-s.duration*1e3,t=s}}function Od(r,e,t){r.rawProgramDateTime?t.push(r):e!=null&&e.programDateTime&&(r.programDateTime=e.endProgramDateTime)}function Im(r,e,t,n){r.relurl=e.URI,e.BYTERANGE&&r.setByteRange(e.BYTERANGE),r.level=t,r.sn="initSegment",n&&(r.levelkeys=n),r.initSegment=null}function bm(r,e,t){r.levelkeys=e;const{encryptedFragments:n}=t;(!n.length||n[n.length-1].levelkeys!==e)&&Object.keys(e).some(s=>e[s].isCommonEncryption)&&n.push(r)}function jr(r,e,t){r.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function Rm(r,e,t){r.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function Wu(r,e){const t=e.startPTS;if(J(t)){let n=0,s;e.sn>r.sn?(n=t-r.start,s=r):(n=r.start-t,s=e),s.duration!==n&&s.setDuration(n)}else e.sn>r.sn?r.cc===e.cc&&r.minEndPTS?e.setStart(r.start+(r.minEndPTS-r.start)):e.setStart(r.start+r.duration):e.setStart(Math.max(r.start-e.duration,0))}function OE(r,e,t,n,s,i,a){n-t<=0&&(a.warn("Fragment should have a positive duration",e),n=t+e.duration,i=s+e.duration);let l=t,u=n;const c=e.startPTS,d=e.endPTS;if(J(c)){const m=Math.abs(c-t);r&&m>r.totalduration?a.warn(`media timestamps and playlist times differ by ${m}s for level ${e.level} ${r.url}`):J(e.deltaPTS)?e.deltaPTS=Math.max(m,e.deltaPTS):e.deltaPTS=m,l=Math.max(t,c),t=Math.min(t,c),s=e.startDTS!==void 0?Math.min(s,e.startDTS):s,u=Math.min(n,d),n=Math.max(n,d),i=e.endDTS!==void 0?Math.max(i,e.endDTS):i}const f=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(n-e.start),e.startPTS=t,e.maxStartPTS=l,e.startDTS=s,e.endPTS=n,e.minEndPTS=u,e.endDTS=i;const h=e.sn;if(!r||h<r.startSN||h>r.endSN)return 0;let g;const p=h-r.startSN,v=r.fragments;for(v[p]=e,g=p;g>0;g--)Wu(v[g],v[g-1]);for(g=p;g<v.length-1;g++)Wu(v[g],v[g+1]);return r.fragmentHint&&Wu(v[v.length-1],r.fragmentHint),r.PTSKnown=r.alignedSliding=!0,f}function zI(r,e,t){if(r===e)return;let n=null;const s=r.fragments;for(let c=s.length-1;c>=0;c--){const d=s[c].initSegment;if(d){n=d;break}}r.fragmentHint&&delete r.fragmentHint.endPTS;let i;ZI(r,e,(c,d,f,h)=>{if((!e.startCC||e.skippedSegments)&&d.cc!==c.cc){const g=c.cc-d.cc;for(let p=f;p<h.length;p++)h[p].cc+=g;e.endCC=h[h.length-1].cc}J(c.startPTS)&&J(c.endPTS)&&(d.setStart(d.startPTS=c.startPTS),d.startDTS=c.startDTS,d.maxStartPTS=c.maxStartPTS,d.endPTS=c.endPTS,d.endDTS=c.endDTS,d.minEndPTS=c.minEndPTS,d.setDuration(c.endPTS-c.startPTS),d.duration&&(i=d),e.PTSKnown=e.alignedSliding=!0),c.hasStreams&&(d.elementaryStreams=c.elementaryStreams),d.loader=c.loader,c.hasStats&&(d.stats=c.stats),c.initSegment&&(d.initSegment=c.initSegment,n=c.initSegment)});const a=e.fragments,o=e.fragmentHint?a.concat(e.fragmentHint):a;if(n&&o.forEach(c=>{var d;c&&(!c.initSegment||c.initSegment.relurl===((d=n)==null?void 0:d.relurl))&&(c.initSegment=n)}),e.skippedSegments){if(e.deltaUpdateFailed=a.some(c=>!c),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let c=e.skippedSegments;c--;)a.shift();e.startSN=a[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=qI(r.dateRanges,e,t));const c=r.fragments.filter(d=>d.rawProgramDateTime);if(r.hasProgramDateTime&&!e.hasProgramDateTime)for(let d=1;d<o.length;d++)o[d].programDateTime===null&&Od(o[d],o[d-1],c);DE(c,e)}e.endCC=a[a.length-1].cc}if(!e.startCC){var l;const c=FE(r,e.startSN-1);e.startCC=(l=c==null?void 0:c.cc)!=null?l:a[0].cc}YI(r.partList,e.partList,(c,d)=>{d.elementaryStreams=c.elementaryStreams,d.stats=c.stats}),i?OE(e,i,i.startPTS,i.endPTS,i.startDTS,i.endDTS,t):ME(r,e),a.length&&(e.totalduration=e.edge-a[0].start),e.driftStartTime=r.driftStartTime,e.driftStart=r.driftStart;const u=e.advancedDateTime;if(e.advanced&&u){const c=e.edge;e.driftStart||(e.driftStartTime=u,e.driftStart=c),e.driftEndTime=u,e.driftEnd=c}else e.driftEndTime=r.driftEndTime,e.driftEnd=r.driftEnd,e.advancedDateTime=r.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=r.requestScheduled)}function qI(r,e,t){const{dateRanges:n,recentlyRemovedDateranges:s}=e,i=we({},r);s&&s.forEach(l=>{delete i[l]});const o=Object.keys(i).length;return o?(Object.keys(n).forEach(l=>{const u=i[l],c=new RE(n[l].attr,u);c.isValid?(i[l]=c,u||(c.tagOrder+=o)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${Re(n[l].attr)}"`)}),i):n}function YI(r,e,t){if(r&&e){let n=0;for(let s=0,i=r.length;s<=i;s++){const a=r[s],o=e[s+n];a&&o&&a.index===o.index&&a.fragment.sn===o.fragment.sn?t(a,o):n--}}}function ZI(r,e,t){const n=e.skippedSegments,s=Math.max(r.startSN,e.startSN)-e.startSN,i=(r.fragmentHint?1:0)+(n?e.endSN:Math.min(r.endSN,e.endSN))-e.startSN,a=e.startSN-r.startSN,o=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=r.fragmentHint?r.fragments.concat(r.fragmentHint):r.fragments;for(let u=s;u<=i;u++){const c=l[a+u];let d=o[u];if(n&&!d&&c&&(d=e.fragments[u]=c),c&&d){t(c,d,u,o);const f=c.relurl,h=d.relurl;if(f&&QI(f,h)){e.playlistParsingError=Lm(`media sequence mismatch ${d.sn}:`,r,e,c,d);return}else if(c.cc!==d.cc){e.playlistParsingError=Lm(`discontinuity sequence mismatch (${c.cc}!=${d.cc})`,r,e,c,d);return}}}}function Lm(r,e,t,n,s){return new Error(`${r} ${s.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function ME(r,e,t=!0){const n=e.startSN+e.skippedSegments-r.startSN,s=r.fragments,i=n>=0;let a=0;if(i&&n<s.length)a=s[n].start;else if(i&&e.startSN===r.endSN+1)a=r.fragmentEnd;else if(i&&t)a=r.fragmentStart+n*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)a=r.fragmentStart;else return;Md(e,a)}function Md(r,e){if(e){const t=r.fragments;for(let n=r.skippedSegments;n<t.length;n++)t[n].addStart(e);r.fragmentHint&&r.fragmentHint.addStart(e)}}function NE(r,e=1/0){let t=1e3*r.targetduration;if(r.updated){const n=r.fragments;if(n.length&&t*4>e){const i=n[n.length-1].duration*1e3;i<t&&(t=i)}}else t/=2;return Math.round(t)}function FE(r,e,t){if(!r)return null;let n=r.fragments[e-r.startSN];return n||(n=r.fragmentHint,n&&n.sn===e)?n:e<r.startSN&&t&&t.sn===e?t:null}function km(r,e,t){return r?$E(r.partList,e,t):null}function $E(r,e,t){if(r)for(let n=r.length;n--;){const s=r[n];if(s.index===t&&s.fragment.sn===e)return s}return null}function UE(r){r.forEach((e,t)=>{var n;(n=e.details)==null||n.fragments.forEach(s=>{s.level=t,s.initSegment&&(s.initSegment.level=t)})})}function QI(r,e){return r!==e&&e?Cm(r)!==Cm(e):!1}function Cm(r){return r.replace(/\?[^?]*$/,"")}function zi(r,e){for(let n=0,s=r.length;n<s;n++){var t;if(((t=r[n])==null?void 0:t.cc)===e)return r[n]}return null}function XI(r,e){return!!(r&&e.startCC<r.endCC&&e.endCC>r.startCC)}function Pm(r,e){const t=r.start+e;r.startPTS=t,r.setStart(t),r.endPTS=t+r.duration}function BE(r,e){const t=e.fragments;for(let n=0,s=t.length;n<s;n++)Pm(t[n],r);e.fragmentHint&&Pm(e.fragmentHint,r),e.alignedSliding=!0}function JI(r,e){r&&(jE(e,r),e.alignedSliding||Dl(e,r),!e.alignedSliding&&!e.skippedSegments&&ME(r,e,!1))}function jE(r,e){if(!XI(e,r))return;const t=Math.min(e.endCC,r.endCC),n=zi(e.fragments,t),s=zi(r.fragments,t);if(!n||!s)return;xe.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const i=n.start-s.start;BE(i,r)}function Dl(r,e){if(!r.hasProgramDateTime||!e.hasProgramDateTime)return;const t=r.fragments,n=e.fragments;if(!t.length||!n.length)return;let s,i;const a=Math.min(e.endCC,r.endCC);e.startCC<a&&r.startCC<a&&(s=zi(n,a),i=zi(t,a)),(!s||!i)&&(s=n[Math.floor(n.length/2)],i=zi(t,s.cc)||t[Math.floor(t.length/2)]);const o=s.programDateTime,l=i.programDateTime;if(!o||!l)return;const u=(l-o)/1e3-(i.start-s.start);BE(u,r)}function At(r,e,t){Mt(r,e,t),r.addEventListener(e,t)}function Mt(r,e,t){r.removeEventListener(e,t)}const eb={toString:function(r){let e="";const t=r.length;for(let n=0;n<t;n++)e+=`[${r.start(n).toFixed(3)}-${r.end(n).toFixed(3)}]`;return e}},j={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class tp extends IE{constructor(e,t,n,s,i){super(s,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=j.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:a,fragCurrent:o,media:l,mediaBuffer:u,state:c}=this,d=l?l.currentTime:0,f=ge.bufferInfo(u||l,d,a.maxBufferHole),h=!f.len;if(this.log(`Media seeking to ${J(d)?d.toFixed(3):d}, state: ${c}, ${h?"out of":"in"} buffer`),this.state===j.ENDED)this.resetLoadingState();else if(o){const g=a.maxFragLookUpTolerance,p=o.start-g,v=o.start+o.duration+g;if(h||v<f.start||p>f.end){const m=d>v;(d<p||m)&&(m&&o.loader&&(this.log(`Cancelling fragment load for seek (sn: ${o.sn})`),o.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(l){this.fragmentTracker.removeFragmentsInRange(d,1/0,this.playlistType,!0);const g=this.lastCurrentTime;if(d>g&&(this.lastCurrentTime=d),!this.loadingParts){const p=Math.max(f.end,d),v=this.shouldLoadParts(this.getLevelDetails(),p);v&&(this.log(`LL-Part loading ON after seeking to ${d.toFixed(2)} with buffer @${p.toFixed(2)}`),this.loadingParts=v)}}this.hls.hasEnoughToStart||(this.log(`Setting ${h?"startPosition":"nextLoadPosition"} to ${d} for seek without enough to start`),this.nextLoadPosition=d,h&&(this.startPosition=d)),h&&this.state===j.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=i,this.hls=e,this.fragmentLoader=new RI(e.config),this.keyLoader=n,this.fragmentTracker=t,this.config=e.config,this.decrypter=new Qg(e.config)}registerListeners(){const{hls:e}=this;e.on(_.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(_.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(_.MANIFEST_LOADING,this.onManifestLoading,this),e.on(_.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(_.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(_.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(_.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(_.MANIFEST_LOADING,this.onManifestLoading,this),e.off(_.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(_.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===j.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=j.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const n=e.end||0,s=this.config.timelineOffset||0;if(n<=s)return!1;const i=e.buffered;this.config.maxBufferHole&&i&&i.length>1&&(e=ge.bufferedInfo(i,e.start,0));const a=e.nextStart;if(a&&a>s&&a<t.edge||this.media.currentTime<e.start)return!1;const l=t.partList;if(l!=null&&l.length){const c=l[l.length-1];return ge.isBuffered(this.media,c.start+c.duration/2)}const u=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(u)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const n=this.media=this.mediaBuffer=t.media;At(n,"seeking",this.onMediaSeeking),At(n,"ended",this.onMediaEnded);const s=this.config;this.levels&&s.autoStartLoad&&this.state===j.STOPPED&&this.startLoad(s.startPosition)}onMediaDetaching(e,t){const n=!!t.transferMedia,s=this.media;if(s!==null){if(s.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),Mt(s,"seeking",this.onMediaSeeking),Mt(s,"ended",this.onMediaEnded),this.keyLoader&&!n&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,n){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=j.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,n){this.startFragRequested=!0,this._loadFragForPlayback(e,t,n)}_loadFragForPlayback(e,t,n){const s=i=>{const a=i.frag;if(this.fragContextChanged(a)){this.warn(`${a.type} sn: ${a.sn}${i.part?" part: "+i.part.index:""} of ${this.fragInfo(a,!1,i.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(a);return}a.stats.chunkCount++,this._handleFragmentLoadProgress(i)};this._doFragLoad(e,t,n,s).then(i=>{if(!i)return;const a=this.state,o=i.frag;if(this.fragContextChanged(o)){(a===j.FRAG_LOADING||!this.fragCurrent&&a===j.PARSING)&&(this.fragmentTracker.removeFragment(o),this.state=j.IDLE);return}"payload"in i&&(this.log(`Loaded ${o.type} sn: ${o.sn} of ${this.playlistLabel()} ${o.level}`),this.hls.trigger(_.FRAG_LOADED,i)),this._handleFragmentLoadComplete(i)}).catch(i=>{this.state===j.STOPPED||this.state===j.ERROR||(this.warn(`Frag error: ${(i==null?void 0:i.message)||i}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:n}=this;if(n.getState(e)===tt.APPENDING){const i=e.type,a=this.getFwdBufferInfo(this.mediaBuffer,i),o=Math.max(e.duration,a?a.len:this.config.maxBufferLength),l=this.backtrackFragment;((l?e.sn-l.sn:0)===1||this.reduceMaxBufferLength(o,e.duration))&&n.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?n.removeAllFragments():n.hasParts(e.type)&&(n.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),n.getState(e)===tt.PARTIAL&&n.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(t==null?void 0:t.live)&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,n=null){if(!(e-t))return;const s={startOffset:e,endOffset:t,type:n};this.hls.trigger(_.BUFFER_FLUSHING,s)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(n=>{const s=n==null?void 0:n.frag;if(!s||this.fragContextChanged(s)||!this.levels)throw new Error("init load aborted");return n}).then(n=>{const{hls:s}=this,{frag:i,payload:a}=n,o=i.decryptdata;if(a&&a.byteLength>0&&o!=null&&o.key&&o.iv&&ri(o.method)){const l=self.performance.now();return this.decrypter.decrypt(new Uint8Array(a),o.key.buffer,o.iv.buffer,Jg(o.method)).catch(u=>{throw s.trigger(_.ERROR,{type:se.MEDIA_ERROR,details:O.FRAG_DECRYPT_ERROR,fatal:!1,error:u,reason:u.message,frag:i}),u}).then(u=>{const c=self.performance.now();return s.trigger(_.FRAG_DECRYPTED,{frag:i,payload:u,stats:{tstart:l,tdecrypt:c}}),n.payload=u,this.completeInitSegmentLoad(n)})}return this.completeInitSegmentLoad(n)}).catch(n=>{this.state===j.STOPPED||this.state===j.ERROR||(this.warn(n),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const n=e.frag.stats;this.state!==j.STOPPED&&(this.state=j.IDLE),e.frag.data=new Uint8Array(e.payload),n.parsing.start=n.buffering.start=self.performance.now(),n.parsing.end=n.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var n,s;const i=e.tracks;if(i&&!t.encrypted&&((n=i.audio)!=null&&n.encrypted||(s=i.video)!=null&&s.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const a=this.media,o=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${a?"attached mediaKeys: "+a.mediaKeys:"detached"})`);return this.warn(o.message),!a||a.mediaKeys?!1:(this.hls.trigger(_.ERROR,{type:se.KEY_SYSTEM_ERROR,details:O.KEY_SYSTEM_NO_KEYS,fatal:!1,error:o,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const n=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${n?eb.toString(ge.getBuffered(n)):"(detached)"})`),qe(e)){var s;if(e.type!==ee.SUBTITLE){const a=e.elementaryStreams;if(!Object.keys(a).some(o=>!!a[o])){this.state=j.IDLE;return}}const i=(s=this.levels)==null?void 0:s[e.level];i!=null&&i.fragmentError&&(this.log(`Resetting level fragment error count of ${i.fragmentError} on frag buffered`),i.fragmentError=0)}this.state=j.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:n,part:s,partsLoaded:i}=e,a=!i||i.length===0||i.some(l=>!l),o=new Xg(n.level,n.sn,n.stats.chunkCount+1,0,s?s.index:-1,!a);t.flush(o)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,n=null,s){var i;this.fragCurrent=e;const a=t.details;if(!this.levels||!a)throw new Error(`frag load aborted, missing level${a?"":" detail"}s`);let o=null;if(e.encrypted&&!((i=e.decryptdata)!=null&&i.key)){if(this.log(`Loading key for ${e.sn} of [${a.startSN}-${a.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=j.KEY_LOADING,this.fragCurrent=e,o=this.keyLoader.load(e).then(f=>{if(!this.fragContextChanged(f.frag))return this.hls.trigger(_.KEY_LOADED,f),this.state===j.KEY_LOADING&&(this.state=j.IDLE),f}),this.hls.trigger(_.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(o=this.keyLoader.loadClear(e,a.encryptedFragments,this.startFragRequested),o&&this.log("[eme] blocking frag load until media-keys acquired"));const l=this.fragPrevious;if(qe(e)&&(!l||e.sn!==l.sn)){const f=this.shouldLoadParts(t.details,e.end);f!==this.loadingParts&&(this.log(`LL-Part loading ${f?"ON":"OFF"} loading sn ${l==null?void 0:l.sn}->${e.sn}`),this.loadingParts=f)}if(n=Math.max(e.start,n||0),this.loadingParts&&qe(e)){const f=a.partList;if(f&&s){n>a.fragmentEnd&&a.fragmentHint&&(e=a.fragmentHint);const h=this.getNextPart(f,e,n);if(h>-1){const g=f[h];e=this.fragCurrent=g.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${g.index} (${h}/${f.length-1}) of ${this.fragInfo(e,!1,g)}) cc: ${e.cc} [${a.startSN}-${a.endSN}], target: ${parseFloat(n.toFixed(3))}`),this.nextLoadPosition=g.start+g.duration,this.state=j.FRAG_LOADING;let p;return o?p=o.then(v=>!v||this.fragContextChanged(v.frag)?null:this.doFragPartsLoad(e,g,t,s)).catch(v=>this.handleFragLoadError(v)):p=this.doFragPartsLoad(e,g,t,s).catch(v=>this.handleFragLoadError(v)),this.hls.trigger(_.FRAG_LOADING,{frag:e,part:g,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):p}else if(!e.url||this.loadedEndOfParts(f,n))return Promise.resolve(null)}}if(qe(e)&&this.loadingParts){var u;this.log(`LL-Part loading OFF after next part miss @${n.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(u=a.partList)==null?void 0:u.filter(f=>f.loaded).map(f=>`[${f.start}-${f.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+a.startSN+"-"+a.endSN+"]"}, target: ${parseFloat(n.toFixed(3))}`),J(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=j.FRAG_LOADING;const c=this.config.progressive&&e.type!==ee.SUBTITLE;let d;return c&&o?d=o.then(f=>!f||this.fragContextChanged(f.frag)?null:this.fragmentLoader.load(e,s)).catch(f=>this.handleFragLoadError(f)):d=Promise.all([this.fragmentLoader.load(e,c?s:void 0),o]).then(([f])=>(!c&&s&&s(f),f)).catch(f=>this.handleFragLoadError(f)),this.hls.trigger(_.FRAG_LOADING,{frag:e,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):d}doFragPartsLoad(e,t,n,s){return new Promise((i,a)=>{var o;const l=[],u=(o=n.details)==null?void 0:o.partList,c=d=>{this.fragmentLoader.loadPart(e,d,s).then(f=>{l[d.index]=f;const h=f.part;this.hls.trigger(_.FRAG_LOADED,f);const g=km(n.details,e.sn,d.index+1)||$E(u,e.sn,d.index+1);if(g)c(g);else return i({frag:e,part:h,partsLoaded:l})}).catch(a)};c(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===O.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===se.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(_.ERROR,t)}else this.hls.trigger(_.ERROR,{type:se.OTHER_ERROR,details:O.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==j.PARSING){!this.fragCurrent&&this.state!==j.STOPPED&&this.state!==j.ERROR&&(this.state=j.IDLE);return}const{frag:n,part:s,level:i}=t,a=self.performance.now();n.stats.parsing.end=a,s&&(s.stats.parsing.end=a);const o=this.getLevelDetails(),u=o&&n.sn>o.endSN||this.shouldLoadParts(o,n.end);u!==this.loadingParts&&(this.log(`LL-Part loading ${u?"ON":"OFF"} after parsing segment ending @${n.end.toFixed(2)}`),this.loadingParts=u),this.updateLevelTiming(n,s,i,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var n;const i=e.partList[0];if(i.fragment.type===ee.SUBTITLE)return!1;const a=i.end+(((n=e.fragmentHint)==null?void 0:n.duration)||0);if(t>=a){var s;if((this.hls.hasEnoughToStart?((s=this.media)==null?void 0:s.currentTime)||this.lastCurrentTime:this.getLoadPosition())>i.start-i.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:n}=this,{level:s,sn:i,part:a}=e;if(!(t!=null&&t[s]))return this.warn(`Levels object was unset while buffering fragment ${i} of ${this.playlistLabel()} ${s}. The current chunk will not be buffered.`),null;const o=t[s],l=o.details,u=a>-1?km(l,i,a):null,c=u?u.fragment:FE(l,i,n);return c?(n&&n!==c&&(c.stats=n.stats),{frag:c,part:u,level:o}):null}bufferFragmentData(e,t,n,s,i){if(this.state!==j.PARSING)return;const{data1:a,data2:o}=e;let l=a;if(o&&(l=dr(a,o)),!l.length)return;const u=this.initPTS[t.cc],c=u?-u.baseTime/u.timescale:void 0,d={type:e.type,frag:t,part:n,chunkMeta:s,offset:c,parent:t.type,data:l};if(this.hls.trigger(_.BUFFER_APPENDING,d),e.dropped&&e.independent&&!n){if(i)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!ge.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const n=t.currentTime,s=ge.bufferInfo(t,n,0),i=e.duration,a=Math.min(this.config.maxFragLookUpTolerance*2,i*.25),o=Math.max(Math.min(e.start-a,s.end-a),n+a);e.start-o>a&&this.flushMainBuffer(o,e.start)}getFwdBufferInfo(e,t){var n;const s=this.getLoadPosition();if(!J(s))return null;const a=this.lastCurrentTime>s||(n=this.media)!=null&&n.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,s,t,a)}getFwdBufferInfoAtPos(e,t,n,s){const i=ge.bufferInfo(e,t,s);if(i.len===0&&i.nextStart!==void 0){const a=this.fragmentTracker.getBufferedFrag(t,n);if(a&&(i.nextStart<=a.end||a.gap)){const o=Math.max(Math.min(i.nextStart,a.end)-t,s);return ge.bufferInfo(e,t,o)}}return i}getMaxBufferLength(e){const{config:t}=this;let n;return e?n=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):n=t.maxBufferLength,Math.min(n,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const n=this.config,s=Math.max(Math.min(e-t,n.maxBufferLength),t),i=Math.max(e-t*3,n.maxMaxBufferLength/2,s);return i>=s?(n.maxMaxBufferLength=i,this.warn(`Reduce max buffer length to ${i}s`),!0):!1}getAppendedFrag(e,t=ee.MAIN){const n=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return n&&"fragment"in n?n.fragment:n}getNextFragment(e,t){const n=t.fragments,s=n.length;if(!s)return null;const{config:i}=this,a=n[0].start,o=i.lowLatencyMode&&!!t.partList;let l=null;if(t.live){const d=i.initialLiveManifestSize;if(s<d)return this.warn(`Not enough fragments to start playback (have: ${s}, need: ${d})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<a){var u;o&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),l=this.getInitialLiveFragment(t);const f=this.hls.startPosition,h=this.hls.liveSyncPosition,g=l?(f!==-1&&f>=a?f:h)||l.start:e;this.log(`Setting startPosition to ${g} to match start frag at live edge. mainStart: ${f} liveSyncPosition: ${h} frag.start: ${(u=l)==null?void 0:u.start}`),this.startPosition=this.nextLoadPosition=g}}else e<=a&&(l=n[0]);if(!l){const d=this.loadingParts?t.partEnd:t.fragmentEnd;l=this.getFragmentAtPosition(e,d,t)}let c=this.filterReplacedPrimary(l,t);if(!c&&l){const d=l.sn-t.startSN;c=this.filterReplacedPrimary(n[d+1]||null,t)}return this.mapToInitFragWhenRequired(c)}isLoopLoading(e,t){const n=this.fragmentTracker.getState(e);return(n===tt.OK||n===tt.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,n,s,i){let a=null;if(e.gap&&(a=this.getNextFragment(this.nextLoadPosition,t),a&&!a.gap&&n.nextStart)){const o=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,n.nextStart,s,0);if(o!==null&&n.len+o.len>=i){const l=a.sn;return this.loopSn!==l&&(this.log(`buffer full after gaps in "${s}" playlist starting at sn: ${l}`),this.loopSn=l),null}}return this.loopSn=void 0,a}get primaryPrefetch(){if(Dm(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(Dm(this.config)&&e.type!==ee.SUBTITLE){const n=this.hls.interstitialsManager,s=n==null?void 0:n.bufferingItem;if(s){const a=s.event;if(a){if(a.appendInPlace||Math.abs(e.start-s.start)>1||s.start===0)return null}else if(e.end<=s.start&&(t==null?void 0:t.live)===!1||e.start>s.end&&s.nextEvent&&(s.nextEvent.appendInPlace||e.start-s.end>1))return null}const i=n==null?void 0:n.playerQueue;if(i)for(let a=i.length;a--;){const o=i[a].interstitial;if(o.appendInPlace&&e.start>=o.startTime&&e.end<=o.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,n){let s=-1,i=!1,a=!0;for(let o=0,l=e.length;o<l;o++){const u=e[o];if(a=a&&!u.independent,s>-1&&n<u.start)break;const c=u.loaded;c?s=-1:(i||(u.independent||a)&&u.fragment===t)&&(u.fragment!==t&&this.warn(`Need buffer at ${n} but next unloaded part starts at ${u.start}`),s=o),i=c}return s}loadedEndOfParts(e,t){let n;for(let s=e.length;s--;){if(n=e[s],!n.loaded)return!1;if(t>n.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,n=this.fragPrevious;let s=null;if(n){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${n.programDateTime}`),s=mI(t,n.endProgramDateTime,this.config.maxFragLookUpTolerance)),!s){const i=n.sn+1;if(i>=e.startSN&&i<=e.endSN){const a=t[i-e.startSN];n.cc===a.cc&&(s=a,this.log(`Live playlist, switching playlist, load frag with next SN: ${s.sn}`))}s||(s=xE(e,n.cc,n.end),s&&this.log(`Live playlist, switching playlist, load frag with same CC: ${s.sn}`))}}else{const i=this.hls.liveSyncPosition;i!==null&&(s=this.getFragmentAtPosition(i,this.bitrateTest?e.fragmentEnd:e.edge,e))}return s}getFragmentAtPosition(e,t,n){const{config:s}=this;let{fragPrevious:i}=this,{fragments:a,endSN:o}=n;const{fragmentHint:l}=n,{maxFragLookUpTolerance:u}=s,c=n.partList,d=!!(this.loadingParts&&c!=null&&c.length&&l);d&&!this.bitrateTest&&c[c.length-1].fragment.sn===l.sn&&(a=a.concat(l),o=l.sn);let f;if(e<t){var h;const p=e<this.lastCurrentTime||e>t-u||(h=this.media)!=null&&h.paused||!this.startFragRequested?0:u;f=cs(i,a,e,p)}else f=a[a.length-1];if(f){const g=f.sn-n.startSN,p=this.fragmentTracker.getState(f);if((p===tt.OK||p===tt.PARTIAL&&f.gap)&&(i=f),i&&f.sn===i.sn&&(!d||c[0].fragment.sn>f.sn||!n.live)&&f.level===i.level){const m=a[g+1];f.sn<o&&this.fragmentTracker.getState(m)!==tt.OK?f=m:f=null}}return f}alignPlaylists(e,t,n){const s=e.fragments.length;if(!s)return this.warn("No fragments in live playlist"),0;const i=e.fragmentStart,a=!t,o=e.alignedSliding&&J(i);if(a||!o&&!i){JI(n,e);const l=e.fragmentStart;return this.log(`Live playlist sliding: ${l.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${s}`),l}return i}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let n=this.startPosition;n<t&&(n=-1);const s=this.timelineOffset;if(n===-1){const i=this.startTimeOffset!==null,a=i?this.startTimeOffset:e.startTimeOffset;a!==null&&J(a)?(n=t+a,a<0&&(n+=e.edge),n=Math.min(Math.max(t,n),t+e.totalduration),this.log(`Setting startPosition to ${n} for start time offset ${a} found in ${i?"multivariant":"media"} playlist`),this.startPosition=n):e.live?(n=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${n}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=n=0),this.lastCurrentTime=n+s}this.nextLoadPosition=n+s}getLoadPosition(){var e;const{media:t}=this;let n=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?n=t.currentTime:this.nextLoadPosition>=0&&(n=this.nextLoadPosition),n}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&qe(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==j.FRAG_LOADING_WAITING_RETRY)&&(this.state=j.IDLE)}onFragmentOrKeyLoadError(e,t){var n;if(t.chunkMeta&&!t.frag){const m=this.getCurrentContext(t.chunkMeta);m&&(t.frag=m.frag)}const s=t.frag;if(!s||s.type!==e||!this.levels)return;if(this.fragContextChanged(s)){var i;this.warn(`Frag load error must match current frag to retry ${s.url} > ${(i=this.fragCurrent)==null?void 0:i.url}`);return}const a=t.details===O.FRAG_GAP;a&&this.fragmentTracker.fragBuffered(s,!0);const o=t.errorAction;if(!o){this.state=j.ERROR;return}const{action:l,flags:u,retryCount:c=0,retryConfig:d}=o,f=!!d,h=f&&l===ct.RetryRequest,g=f&&!o.resolved&&u===Wt.MoveAllAlternatesMatchingHost,p=(n=this.hls.latestLevelDetails)==null?void 0:n.live;if(!h&&g&&qe(s)&&!s.endList&&p&&!wE(t))this.resetFragmentErrors(e),this.treatAsGap(s),o.resolved=!0;else if((h||g)&&c<d.maxNumRetry){var v;const m=Cd((v=t.response)==null?void 0:v.code),y=Zg(d,c);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+y,this.state=j.FRAG_LOADING_WAITING_RETRY,o.resolved=!0,m){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${s.sn} of ${e} ${s.level} errored with ${t.details}, retrying loading ${c+1}/${d.maxNumRetry} in ${y}ms`)}else if(d)if(this.resetFragmentErrors(e),c<d.maxNumRetry)!a&&l!==ct.RemoveAlternatePermanently&&(o.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${c})`);return}else l===ct.SendAlternateToPenaltyBox?this.state=j.WAITING_LEVEL:this.state=j.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,n=t===1/0;(!t||e>=t||n&&!Cd(0))&&(n&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=j.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===j.PARSING||this.state===j.PARSED){const t=e.frag,n=e.parent,s=this.getFwdBufferInfo(this.mediaBuffer,n),i=s&&s.len>.5;i&&this.reduceMaxBufferLength(s.len,(t==null?void 0:t.duration)||10);const a=!i;return a&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${n} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),a}return!1}resetFragmentErrors(e){e===ee.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==j.STOPPED&&(this.state=j.IDLE)}afterBufferFlushed(e,t,n){if(!e)return;const s=ge.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,s,n),this.state===j.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==j.STOPPED&&(this.state=j.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,n,s){const i=n.details;if(!i){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((l,u)=>{const c=e.elementaryStreams[u];if(c){const d=c.endPTS-c.startPTS;if(d<=0)return this.warn(`Could not parse fragment ${e.sn} ${u} duration reliably (${d})`),l||!1;const f=s?0:OE(i,e,c.startPTS,c.endPTS,c.startDTS,c.endDTS,this);return this.hls.trigger(_.LEVEL_PTS_UPDATED,{details:i,level:n,drift:f,type:u,frag:e,start:c.startPTS,end:c.endPTS}),!0}return l},!1)){var o;const l=((o=this.transmuxer)==null?void 0:o.error)===null;if((n.fragmentError===0||l&&(n.fragmentError<2||e.endList))&&this.treatAsGap(e,n),l){const u=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(u.message),this.hls.trigger(_.ERROR,{type:se.MEDIA_ERROR,details:O.FRAG_PARSING_ERROR,fatal:!1,error:u,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${n.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=j.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(_.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===ee.MAIN?"level":"track"}fragInfo(e,t=!0,n){var s,i;return`${this.playlistLabel()} ${e.level} (${n?"part":"frag"}:[${((s=t&&!n?e.startPTS:(n||e).start)!=null?s:NaN).toFixed(3)}-${((i=t&&!n?e.endPTS:(n||e).end)!=null?i:NaN).toFixed(3)}]${n&&e.type==="main"?"INDEPENDENT="+(n.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function Dm(r){return!!r.interstitialsController&&r.enableInterstitialPlayback!==!1}class GE{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let n;if(e.length)e.length===1?n=e[0]:n=tb(e,t);else return new Uint8Array(0);return this.reset(),n}reset(){this.chunks.length=0,this.dataLength=0}}function tb(r,e){const t=new Uint8Array(e);let n=0;for(let s=0;s<r.length;s++){const i=r[s];t.set(i,n),n+=i.length}return t}var zu={exports:{}},Om;function rb(){return Om||(Om=1,function(r){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function s(l,u,c){this.fn=l,this.context=u,this.once=c||!1}function i(l,u,c,d,f){if(typeof c!="function")throw new TypeError("The listener must be a function");var h=new s(c,d||l,f),g=t?t+u:u;return l._events[g]?l._events[g].fn?l._events[g]=[l._events[g],h]:l._events[g].push(h):(l._events[g]=h,l._eventsCount++),l}function a(l,u){--l._eventsCount===0?l._events=new n:delete l._events[u]}function o(){this._events=new n,this._eventsCount=0}o.prototype.eventNames=function(){var u=[],c,d;if(this._eventsCount===0)return u;for(d in c=this._events)e.call(c,d)&&u.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(c)):u},o.prototype.listeners=function(u){var c=t?t+u:u,d=this._events[c];if(!d)return[];if(d.fn)return[d.fn];for(var f=0,h=d.length,g=new Array(h);f<h;f++)g[f]=d[f].fn;return g},o.prototype.listenerCount=function(u){var c=t?t+u:u,d=this._events[c];return d?d.fn?1:d.length:0},o.prototype.emit=function(u,c,d,f,h,g){var p=t?t+u:u;if(!this._events[p])return!1;var v=this._events[p],m=arguments.length,y,S;if(v.fn){switch(v.once&&this.removeListener(u,v.fn,void 0,!0),m){case 1:return v.fn.call(v.context),!0;case 2:return v.fn.call(v.context,c),!0;case 3:return v.fn.call(v.context,c,d),!0;case 4:return v.fn.call(v.context,c,d,f),!0;case 5:return v.fn.call(v.context,c,d,f,h),!0;case 6:return v.fn.call(v.context,c,d,f,h,g),!0}for(S=1,y=new Array(m-1);S<m;S++)y[S-1]=arguments[S];v.fn.apply(v.context,y)}else{var E=v.length,T;for(S=0;S<E;S++)switch(v[S].once&&this.removeListener(u,v[S].fn,void 0,!0),m){case 1:v[S].fn.call(v[S].context);break;case 2:v[S].fn.call(v[S].context,c);break;case 3:v[S].fn.call(v[S].context,c,d);break;case 4:v[S].fn.call(v[S].context,c,d,f);break;default:if(!y)for(T=1,y=new Array(m-1);T<m;T++)y[T-1]=arguments[T];v[S].fn.apply(v[S].context,y)}}return!0},o.prototype.on=function(u,c,d){return i(this,u,c,d,!1)},o.prototype.once=function(u,c,d){return i(this,u,c,d,!0)},o.prototype.removeListener=function(u,c,d,f){var h=t?t+u:u;if(!this._events[h])return this;if(!c)return a(this,h),this;var g=this._events[h];if(g.fn)g.fn===c&&(!f||g.once)&&(!d||g.context===d)&&a(this,h);else{for(var p=0,v=[],m=g.length;p<m;p++)(g[p].fn!==c||f&&!g[p].once||d&&g[p].context!==d)&&v.push(g[p]);v.length?this._events[h]=v.length===1?v[0]:v:a(this,h)}return this},o.prototype.removeAllListeners=function(u){var c;return u?(c=t?t+u:u,this._events[c]&&a(this,c)):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,r.exports=o}(zu)),zu.exports}var nb=rb(),rp=Rw(nb);const ya="1.6.15",gi={};function sb(){return typeof __HLS_WORKER_BUNDLE__=="function"}function ib(){const r=gi[ya];if(r)return r.clientCount++,r;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),s={worker:new self.Worker(t),objectURL:t,clientCount:1};return gi[ya]=s,s}function ab(r){const e=gi[r];if(e)return e.clientCount++,e;const t=new self.URL(r,self.location.href).href,s={worker:new self.Worker(t),scriptURL:t,clientCount:1};return gi[r]=s,s}function ob(r){const e=gi[r||ya];if(e&&e.clientCount--===1){const{worker:n,objectURL:s}=e;delete gi[r||ya],s&&self.URL.revokeObjectURL(s),n.terminate()}}function KE(r,e){return e+10<=r.length&&r[e]===51&&r[e+1]===68&&r[e+2]===73&&r[e+3]<255&&r[e+4]<255&&r[e+6]<128&&r[e+7]<128&&r[e+8]<128&&r[e+9]<128}function np(r,e){return e+10<=r.length&&r[e]===73&&r[e+1]===68&&r[e+2]===51&&r[e+3]<255&&r[e+4]<255&&r[e+6]<128&&r[e+7]<128&&r[e+8]<128&&r[e+9]<128}function nu(r,e){let t=0;return t=(r[e]&127)<<21,t|=(r[e+1]&127)<<14,t|=(r[e+2]&127)<<7,t|=r[e+3]&127,t}function Sa(r,e){const t=e;let n=0;for(;np(r,e);){n+=10;const s=nu(r,e+6);n+=s,KE(r,e+10)&&(n+=10),e+=n}if(n>0)return r.subarray(t,t+n)}function lb(r,e,t,n){const s=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],i=e[t+2],a=i>>2&15;if(a>12){const h=new Error(`invalid ADTS sampling index:${a}`);r.emit(_.ERROR,_.ERROR,{type:se.MEDIA_ERROR,details:O.FRAG_PARSING_ERROR,fatal:!0,error:h,reason:h.message});return}const o=(i>>6&3)+1,l=e[t+3]>>6&3|(i&1)<<2,u="mp4a.40."+o,c=s[a];let d=a;(o===5||o===29)&&(d-=3);const f=[o<<3|(d&14)>>1,(d&1)<<7|l<<3];return xe.log(`manifest codec:${n}, parsed codec:${u}, channels:${l}, rate:${c} (ADTS object type:${o} sampling index:${a})`),{config:f,samplerate:c,channelCount:l,codec:u,parsedCodec:u,manifestCodec:n}}function HE(r,e){return r[e]===255&&(r[e+1]&246)===240}function VE(r,e){return r[e+1]&1?7:9}function sp(r,e){return(r[e+3]&3)<<11|r[e+4]<<3|(r[e+5]&224)>>>5}function ub(r,e){return e+5<r.length}function Ol(r,e){return e+1<r.length&&HE(r,e)}function cb(r,e){return ub(r,e)&&HE(r,e)&&sp(r,e)<=r.length-e}function db(r,e){if(Ol(r,e)){const t=VE(r,e);if(e+t>=r.length)return!1;const n=sp(r,e);if(n<=t)return!1;const s=e+n;return s===r.length||Ol(r,s)}return!1}function WE(r,e,t,n,s){if(!r.samplerate){const i=lb(e,t,n,s);if(!i)return;we(r,i)}}function zE(r){return 1024*9e4/r}function fb(r,e){const t=VE(r,e);if(e+t<=r.length){const n=sp(r,e)-t;if(n>0)return{headerLength:t,frameLength:n}}}function qE(r,e,t,n,s){const i=zE(r.samplerate),a=n+s*i,o=fb(e,t);let l;if(o){const{frameLength:d,headerLength:f}=o,h=f+d,g=Math.max(0,t+h-e.length);g?(l=new Uint8Array(h-f),l.set(e.subarray(t+f,e.length),0)):l=e.subarray(t+f,t+h);const p={unit:l,pts:a};return g||r.samples.push(p),{sample:p,length:h,missing:g}}const u=e.length-t;return l=new Uint8Array(u),l.set(e.subarray(t,e.length),0),{sample:{unit:l,pts:a},length:u,missing:-1}}function hb(r,e){return np(r,e)&&nu(r,e+6)+10<=r.length-e}function gb(r){return r instanceof ArrayBuffer?r:r.byteOffset==0&&r.byteLength==r.buffer.byteLength?r.buffer:new Uint8Array(r).buffer}function qu(r,e=0,t=1/0){return pb(r,e,t,Uint8Array)}function pb(r,e,t,n){const s=mb(r);let i=1;"BYTES_PER_ELEMENT"in n&&(i=n.BYTES_PER_ELEMENT);const a=vb(r)?r.byteOffset:0,o=(a+r.byteLength)/i,l=(a+e)/i,u=Math.floor(Math.max(0,Math.min(l,o))),c=Math.floor(Math.min(u+Math.max(t,0),o));return new n(s,u,c-u)}function mb(r){return r instanceof ArrayBuffer?r:r.buffer}function vb(r){return r&&r.buffer instanceof ArrayBuffer&&r.byteLength!==void 0&&r.byteOffset!==void 0}function yb(r){const e={key:r.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(r.size<2)return;if(r.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const n=r.data.subarray(1).indexOf(0);if(n===-1)return;const s=er(qu(r.data,1,n)),i=r.data[2+n],a=r.data.subarray(3+n).indexOf(0);if(a===-1)return;const o=er(qu(r.data,3+n,a));let l;return s==="-->"?l=er(qu(r.data,4+n+a)):l=gb(r.data.subarray(4+n+a)),e.mimeType=s,e.pictureType=i,e.description=o,e.data=l,e}function Sb(r){if(r.size<2)return;const e=er(r.data,!0),t=new Uint8Array(r.data.subarray(e.length+1));return{key:r.type,info:e,data:t.buffer}}function Eb(r){if(r.size<2)return;if(r.type==="TXXX"){let t=1;const n=er(r.data.subarray(t),!0);t+=n.length+1;const s=er(r.data.subarray(t));return{key:r.type,info:n,data:s}}const e=er(r.data.subarray(1));return{key:r.type,info:"",data:e}}function _b(r){if(r.type==="WXXX"){if(r.size<2)return;let t=1;const n=er(r.data.subarray(t),!0);t+=n.length+1;const s=er(r.data.subarray(t));return{key:r.type,info:n,data:s}}const e=er(r.data);return{key:r.type,info:"",data:e}}function Tb(r){return r.type==="PRIV"?Sb(r):r.type[0]==="W"?_b(r):r.type==="APIC"?yb(r):Eb(r)}function xb(r){const e=String.fromCharCode(r[0],r[1],r[2],r[3]),t=nu(r,4),n=10;return{type:e,size:t,data:r.subarray(n,n+t)}}const po=10,Ab=10;function YE(r){let e=0;const t=[];for(;np(r,e);){const n=nu(r,e+6);r[e+5]>>6&1&&(e+=po),e+=po;const s=e+n;for(;e+Ab<s;){const i=xb(r.subarray(e)),a=Tb(i);a&&t.push(a),e+=i.size+po}KE(r,e)&&(e+=po)}return t}function ZE(r){return r&&r.key==="PRIV"&&r.info==="com.apple.streaming.transportStreamTimestamp"}function wb(r){if(r.data.byteLength===8){const e=new Uint8Array(r.data),t=e[3]&1;let n=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return n/=45,t&&(n+=4772185884e-2),Math.round(n)}}function ip(r){const e=YE(r);for(let t=0;t<e.length;t++){const n=e[t];if(ZE(n))return wb(n)}}let Yt=function(r){return r.audioId3="org.id3",r.dateRange="com.apple.quicktime.HLS",r.emsg="https://aomedia.org/emsg/ID3",r.misbklv="urn:misb:KLV:bin:1910.1",r}({});function Pr(r="",e=9e4){return{type:r,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class ap{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,n,s){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,n){}demux(e,t){this.cachedData&&(e=dr(this.cachedData,e),this.cachedData=null);let n=Sa(e,0),s=n?n.length:0,i;const a=this._audioTrack,o=this._id3Track,l=n?ip(n):void 0,u=e.length;for((this.basePTS===null||this.frameIndex===0&&J(l))&&(this.basePTS=Ib(l,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),n&&n.length>0&&o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:Yt.audioId3,duration:Number.POSITIVE_INFINITY});s<u;){if(this.canParse(e,s)){const c=this.appendFrame(a,e,s);c?(this.frameIndex++,this.lastPTS=c.sample.pts,s+=c.length,i=s):s=u}else hb(e,s)?(n=Sa(e,s),o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:Yt.audioId3,duration:Number.POSITIVE_INFINITY}),s+=n.length,i=s):s++;if(s===u&&i!==u){const c=e.slice(i);this.cachedData?this.cachedData=dr(this.cachedData,c):this.cachedData=c}}return{audioTrack:a,videoTrack:Pr(),id3Track:o,textTrack:Pr()}}demuxSampleAes(e,t,n){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Pr(),id3Track:this._id3Track,textTrack:Pr()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const Ib=(r,e,t)=>{if(J(r))return r*90;const n=t?t.baseTime*9e4/t.timescale:0;return e*9e4+n};let mo=null;const bb=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],Rb=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],Lb=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],kb=[0,1,1,4];function QE(r,e,t,n,s){if(t+24>e.length)return;const i=XE(e,t);if(i&&t+i.frameLength<=e.length){const a=i.samplesPerFrame*9e4/i.sampleRate,o=n+s*a,l={unit:e.subarray(t,t+i.frameLength),pts:o,dts:o};return r.config=[],r.channelCount=i.channelCount,r.samplerate=i.sampleRate,r.samples.push(l),{sample:l,length:i.frameLength,missing:0}}}function XE(r,e){const t=r[e+1]>>3&3,n=r[e+1]>>1&3,s=r[e+2]>>4&15,i=r[e+2]>>2&3;if(t!==1&&s!==0&&s!==15&&i!==3){const a=r[e+2]>>1&1,o=r[e+3]>>6,l=t===3?3-n:n===3?3:4,u=bb[l*14+s-1]*1e3,d=Rb[(t===3?0:t===2?1:2)*3+i],f=o===3?1:2,h=Lb[t][n],g=kb[n],p=h*8*g,v=Math.floor(h*u/d+a)*g;if(mo===null){const S=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);mo=S?parseInt(S[1]):0}return!!mo&&mo<=87&&n===2&&u>=224e3&&o===0&&(r[e+3]=r[e+3]|128),{sampleRate:d,channelCount:f,frameLength:v,samplesPerFrame:p}}}function op(r,e){return r[e]===255&&(r[e+1]&224)===224&&(r[e+1]&6)!==0}function JE(r,e){return e+1<r.length&&op(r,e)}function Cb(r,e){return op(r,e)&&4<=r.length-e}function e_(r,e){if(e+1<r.length&&op(r,e)){const n=XE(r,e);let s=4;n!=null&&n.frameLength&&(s=n.frameLength);const i=e+s;return i===r.length||JE(r,i)}return!1}class Pb extends ap{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,n,s){super.resetInitSegment(e,t,n,s),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const n=Sa(e,0);let s=(n==null?void 0:n.length)||0;if(e_(e,s))return!1;for(let i=e.length;s<i;s++)if(db(e,s))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return cb(e,t)}appendFrame(e,t,n){WE(e,this.observer,t,n,e.manifestCodec);const s=qE(e,t,n,this.basePTS,this.frameIndex);if(s&&s.missing===0)return s}}const t_=(r,e)=>{let t=0,n=5;e+=n;const s=new Uint32Array(1),i=new Uint32Array(1),a=new Uint8Array(1);for(;n>0;){a[0]=r[e];const o=Math.min(n,8),l=8-o;i[0]=4278190080>>>24+l<<l,s[0]=(a[0]&i[0])>>l,t=t?t<<o|s[0]:s[0],e+=1,n-=o}return t};class Db extends ap{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,n,s){super.resetInitSegment(e,t,n,s),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,n){const s=r_(e,t,n,this.basePTS,this.frameIndex);if(s!==-1)return{sample:e.samples[e.samples.length-1],length:s,missing:0}}static probe(e){if(!e)return!1;const t=Sa(e,0);if(!t)return!1;const n=t.length;return e[n]===11&&e[n+1]===119&&ip(t)!==void 0&&t_(e,n)<16}}function r_(r,e,t,n,s){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const i=e[t+4]>>6;if(i>=3)return-1;const o=[48e3,44100,32e3][i],l=e[t+4]&63,c=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][l*3+i]*2;if(t+c>e.length)return-1;const d=e[t+6]>>5;let f=0;d===2?f+=2:(d&1&&d!==1&&(f+=2),d&4&&(f+=2));const h=(e[t+6]<<8|e[t+7])>>12-f&1,p=[2,1,2,3,3,4,4,5][d]+h,v=e[t+5]>>3,m=e[t+5]&7,y=new Uint8Array([i<<6|v<<1|m>>2,(m&3)<<6|d<<3|h<<2|l>>4,l<<4&224]),S=1536/o*9e4,E=n+s*S,T=e.subarray(t,t+c);return r.config=y,r.channelCount=p,r.samplerate=o,r.samples.push({unit:T,pts:E}),c}class Ob extends ap{resetInitSegment(e,t,n,s){super.resetInitSegment(e,t,n,s),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Sa(e,0);let n=(t==null?void 0:t.length)||0;if(t&&e[n]===11&&e[n+1]===119&&ip(t)!==void 0&&t_(e,n)<=16)return!1;for(let s=e.length;n<s;n++)if(e_(e,n))return xe.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return Cb(e,t)}appendFrame(e,t,n){if(this.basePTS!==null)return QE(e,t,n,this.basePTS,this.frameIndex)}}const Mb=/\/emsg[-/]ID3/i;class Nb{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,n,s){const i=this.videoTrack=Pr("video",1),a=this.audioTrack=Pr("audio",1),o=this.txtTrack=Pr("text",1);if(this.id3Track=Pr("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const l=fE(e);if(l.video){const{id:u,timescale:c,codec:d,supplemental:f}=l.video;i.id=u,i.timescale=o.timescale=c,i.codec=d,i.supplemental=f}if(l.audio){const{id:u,timescale:c,codec:d}=l.audio;a.id=u,a.timescale=c,a.codec=d}o.id=uE.text,i.sampleDuration=0,i.duration=a.duration=s}resetContiguity(){this.remainderData=null}static probe(e){return Dw(e)}demux(e,t){this.timeOffset=t;let n=e;const s=this.videoTrack,i=this.txtTrack;if(this.config.progressive){this.remainderData&&(n=dr(this.remainderData,e));const o=Bw(n);this.remainderData=o.remainder,s.samples=o.valid||new Uint8Array}else s.samples=n;const a=this.extractID3Track(s,t);return i.samples=X0(t,s),{videoTrack:s,audioTrack:this.audioTrack,id3Track:a,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,n=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const s=this.extractID3Track(t,this.timeOffset);return n.samples=X0(e,t),{videoTrack:t,audioTrack:Pr(),id3Track:s,textTrack:Pr()}}extractID3Track(e,t){const n=this.id3Track;if(e.samples.length){const s=me(e.samples,["emsg"]);s&&s.forEach(i=>{const a=Gw(i);if(Mb.test(a.schemeIdUri)){const o=Mm(a,t);let l=a.eventDuration===4294967295?Number.POSITIVE_INFINITY:a.eventDuration/a.timeScale;l<=.001&&(l=Number.POSITIVE_INFINITY);const u=a.payload;n.samples.push({data:u,len:u.byteLength,dts:o,pts:o,type:Yt.emsg,duration:l})}else if(this.config.enableEmsgKLVMetadata&&a.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const o=Mm(a,t);n.samples.push({data:a.payload,len:a.payload.byteLength,dts:o,pts:o,type:Yt.misbklv,duration:Number.POSITIVE_INFINITY})}})}return n}demuxSampleAes(e,t,n){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function Mm(r,e){return J(r.presentationTime)?r.presentationTime/r.timeScale:e+r.presentationTimeDelta/r.timeScale}class Fb{constructor(e,t,n){this.keyData=void 0,this.decrypter=void 0,this.keyData=n,this.decrypter=new Qg(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,Mn.cbc)}decryptAacSample(e,t,n){const s=e[t].unit;if(s.length<=16)return;const i=s.subarray(16,s.length-s.length%16),a=i.buffer.slice(i.byteOffset,i.byteOffset+i.length);this.decryptBuffer(a).then(o=>{const l=new Uint8Array(o);s.set(l,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,n)}).catch(n)}decryptAacSamples(e,t,n){for(;;t++){if(t>=e.length){n();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,n),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,n=new Int8Array(t);let s=0;for(let i=32;i<e.length-16;i+=160,s+=16)n.set(e.subarray(i,i+16),s);return n}getAvcDecryptedUnit(e,t){const n=new Uint8Array(t);let s=0;for(let i=32;i<e.length-16;i+=160,s+=16)e.set(n.subarray(s,s+16),i);return e}decryptAvcSample(e,t,n,s,i){const a=pE(i.data),o=this.getAvcEncryptedData(a);this.decryptBuffer(o.buffer).then(l=>{i.data=this.getAvcDecryptedUnit(a,l),this.decrypter.isSync()||this.decryptAvcSamples(e,t,n+1,s)}).catch(s)}decryptAvcSamples(e,t,n,s){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,n=0){if(t>=e.length){s();return}const i=e[t].units;for(;!(n>=i.length);n++){const a=i[n];if(!(a.data.length<=48||a.type!==1&&a.type!==5)&&(this.decryptAvcSample(e,t,n,s,a),!this.decrypter.isSync()))return}}}}class n_{constructor(){this.VideoSample=null}createVideoSample(e,t,n){return{key:e,frame:!1,pts:t,dts:n,units:[],length:0}}getLastNalUnit(e){var t;let n=this.VideoSample,s;if((!n||n.units.length===0)&&(n=e[e.length-1]),(t=n)!=null&&t.units){const i=n.units;s=i[i.length-1]}return s}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const n=t.samples,s=n.length;if(s){const i=n[s-1];e.pts=i.pts,e.dts=i.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,n){const s=t.byteLength;let i=e.naluState||0;const a=i,o=[];let l=0,u,c,d,f=-1,h=0;for(i===-1&&(f=0,h=this.getNALuType(t,0),i=0,l=1);l<s;){if(u=t[l++],!i){i=u?0:1;continue}if(i===1){i=u?0:2;continue}if(!u)i=3;else if(u===1){if(c=l-i-1,f>=0){const g={data:t.subarray(f,c),type:h};o.push(g)}else{const g=this.getLastNalUnit(e.samples);g&&(a&&l<=4-a&&g.state&&(g.data=g.data.subarray(0,g.data.byteLength-a)),c>0&&(g.data=dr(g.data,t.subarray(0,c)),g.state=0))}l<s?(d=this.getNALuType(t,l),f=l,h=d,i=0):i=-1}else i=0}if(f>=0&&i>=0){const g={data:t.subarray(f,s),type:h,state:i};o.push(g)}if(o.length===0){const g=this.getLastNalUnit(e.samples);g&&(g.data=dr(g.data,t))}return e.naluState=i,o}}class qi{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,n=e.byteLength-t,s=new Uint8Array(4),i=Math.min(4,t);if(i===0)throw new Error("no bytes available");s.set(e.subarray(n,n+i)),this.word=new DataView(s.buffer).getUint32(0),this.bitsAvailable=i*8,this.bytesAvailable-=i}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const n=this.word>>>32-t;if(e>32&&xe.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?n<<t|this.readBits(t):n}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class $b extends n_{parsePES(e,t,n,s){const i=this.parseNALu(e,n.data,s);let a=this.VideoSample,o,l=!1;n.data=null,a&&i.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),i.forEach(u=>{var c,d;switch(u.type){case 1:{let p=!1;o=!0;const v=u.data;if(l&&v.length>4){const m=this.readSliceType(v);(m===2||m===4||m===7||m===9)&&(p=!0)}if(p){var f;(f=a)!=null&&f.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.frame=!0,a.key=p;break}case 5:o=!0,(c=a)!=null&&c.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0,a.frame=!0;break;case 6:{o=!0,zg(u.data,1,n.pts,t.samples);break}case 7:{var h,g;o=!0,l=!0;const p=u.data,v=this.readSPS(p);if(!e.sps||e.width!==v.width||e.height!==v.height||((h=e.pixelRatio)==null?void 0:h[0])!==v.pixelRatio[0]||((g=e.pixelRatio)==null?void 0:g[1])!==v.pixelRatio[1]){e.width=v.width,e.height=v.height,e.pixelRatio=v.pixelRatio,e.sps=[p];const m=p.subarray(1,4);let y="avc1.";for(let S=0;S<3;S++){let E=m[S].toString(16);E.length<2&&(E="0"+E),y+=E}e.codec=y}break}case 8:o=!0,e.pps=[u.data];break;case 9:o=!0,e.audFound=!0,(d=a)!=null&&d.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;case 12:o=!0;break;default:o=!1;break}a&&o&&a.units.push(u)}),s&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new qi(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let n=8,s=8,i;for(let a=0;a<e;a++)s!==0&&(i=t.readEG(),s=(n+i+256)%256),n=s===0?n:s}readSPS(e){const t=new qi(e);let n=0,s=0,i=0,a=0,o,l,u;const c=t.readUByte.bind(t),d=t.readBits.bind(t),f=t.readUEG.bind(t),h=t.readBoolean.bind(t),g=t.skipBits.bind(t),p=t.skipEG.bind(t),v=t.skipUEG.bind(t),m=this.skipScalingList.bind(this);c();const y=c();if(d(5),g(3),c(),v(),y===100||y===110||y===122||y===244||y===44||y===83||y===86||y===118||y===128){const w=f();if(w===3&&g(1),v(),v(),g(1),h())for(l=w!==3?8:12,u=0;u<l;u++)h()&&(u<6?m(16,t):m(64,t))}v();const S=f();if(S===0)f();else if(S===1)for(g(1),p(),p(),o=f(),u=0;u<o;u++)p();v(),g(1);const E=f(),T=f(),A=d(1);A===0&&g(1),g(1),h()&&(n=f(),s=f(),i=f(),a=f());let x=[1,1];if(h()&&h())switch(c()){case 1:x=[1,1];break;case 2:x=[12,11];break;case 3:x=[10,11];break;case 4:x=[16,11];break;case 5:x=[40,33];break;case 6:x=[24,11];break;case 7:x=[20,11];break;case 8:x=[32,11];break;case 9:x=[80,33];break;case 10:x=[18,11];break;case 11:x=[15,11];break;case 12:x=[64,33];break;case 13:x=[160,99];break;case 14:x=[4,3];break;case 15:x=[3,2];break;case 16:x=[2,1];break;case 255:{x=[c()<<8|c(),c()<<8|c()];break}}return{width:Math.ceil((E+1)*16-n*2-s*2),height:(2-A)*(T+1)*16-(A?2:4)*(i+a),pixelRatio:x}}}class Ub extends n_{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,n,s){const i=this.parseNALu(e,n.data,s);let a=this.VideoSample,o,l=!1;n.data=null,a&&i.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),i.forEach(u=>{var c,d;switch(u.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:a||(a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),a.frame=!0,o=!0;break;case 16:case 17:case 18:case 21:if(o=!0,l){var f;(f=a)!=null&&f.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0,a.frame=!0;break;case 19:case 20:o=!0,(c=a)!=null&&c.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0,a.frame=!0;break;case 39:o=!0,zg(u.data,2,n.pts,t.samples);break;case 32:o=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=we(e.params,this.readVPS(u.data)),this.initVPS=u.data),e.vps=[u.data];break;case 33:if(o=!0,l=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],u.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const h=this.readSPS(u.data);e.width=h.width,e.height=h.height,e.pixelRatio=h.pixelRatio,e.codec=h.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const g in h.params)e.params[g]=h.params[g]}this.pushParameterSet(e.sps,u.data,e.vps),a||(a=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),a.key=!0;break;case 34:if(o=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const h=this.readPPS(u.data);for(const g in h)e.params[g]=h[g]}this.pushParameterSet(e.pps,u.data,e.vps)}break;case 35:o=!0,e.audFound=!0,(d=a)!=null&&d.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;default:o=!1;break}a&&o&&a.units.push(u)}),s&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}pushParameterSet(e,t,n){(n&&n[0]===this.initVPS||!n&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let n=0;for(let s=0;s<e.byteLength;s++)s>=2&&e[s]===3&&e[s-1]===0&&e[s-2]===0||(t[n]=e[s],n++);return new Uint8Array(t.buffer,0,n)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new qi(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const n=t.readBits(3),s=t.readBoolean();return{numTemporalLayers:n+1,temporalIdNested:s}}readSPS(e){const t=new qi(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const n=t.readBits(3);t.readBoolean();const s=t.readBits(2),i=t.readBoolean(),a=t.readBits(5),o=t.readUByte(),l=t.readUByte(),u=t.readUByte(),c=t.readUByte(),d=t.readUByte(),f=t.readUByte(),h=t.readUByte(),g=t.readUByte(),p=t.readUByte(),v=t.readUByte(),m=t.readUByte(),y=[],S=[];for(let Se=0;Se<n;Se++)y.push(t.readBoolean()),S.push(t.readBoolean());if(n>0)for(let Se=n;Se<8;Se++)t.readBits(2);for(let Se=0;Se<n;Se++)y[Se]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),S[Se]&&t.readUByte();t.readUEG();const E=t.readUEG();E==3&&t.skipBits(1);const T=t.readUEG(),A=t.readUEG(),x=t.readBoolean();let w=0,b=0,I=0,M=0;x&&(w+=t.readUEG(),b+=t.readUEG(),I+=t.readUEG(),M+=t.readUEG());const K=t.readUEG(),z=t.readUEG(),X=t.readUEG(),Q=t.readBoolean();for(let Se=Q?0:n;Se<=n;Se++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let R=0;R<4;R++)for(let L=0;L<(R===3?2:6);L++)if(!t.readBoolean())t.readUEG();else{const V=Math.min(64,1<<4+(R<<1));R>1&&t.readEG();for(let W=0;W<V;W++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const k=t.readUEG();let F=0;for(let Se=0;Se<k;Se++){let R=!1;if(Se!==0&&(R=t.readBoolean()),R){Se===k&&t.readUEG(),t.readBoolean(),t.readUEG();let L=0;for(let $=0;$<=F;$++){const V=t.readBoolean();let W=!1;V||(W=t.readBoolean()),(V||W)&&L++}F=L}else{const L=t.readUEG(),$=t.readUEG();F=L+$;for(let V=0;V<L;V++)t.readUEG(),t.readBoolean();for(let V=0;V<$;V++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const Se=t.readUEG();for(let R=0;R<Se;R++){for(let L=0;L<X+4;L++)t.readBits(1);t.readBits(1)}}let B=0,G=1,ie=1,ne=!0,oe=1,le=0;t.readBoolean(),t.readBoolean();let Ie=!1;if(t.readBoolean()){if(t.readBoolean()){const H=t.readUByte(),ue=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],ce=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];H>0&&H<16?(G=ue[H-1],ie=ce[H-1]):H===255&&(G=t.readBits(16),ie=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),Ie=t.readBoolean(),Ie&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(oe=t.readBits(32),le=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const ce=t.readBoolean(),pe=t.readBoolean();let Ee=!1;(ce||pe)&&(Ee=t.readBoolean(),Ee&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),Ee&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let at=0;at<=n;at++){ne=t.readBoolean();const hr=ne||t.readBoolean();let Gt=!1;hr?t.readEG():Gt=t.readBoolean();const an=Gt?1:t.readUEG()+1;if(ce)for(let Ir=0;Ir<an;Ir++)t.readUEG(),t.readUEG(),Ee&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(pe)for(let Ir=0;Ir<an;Ir++)t.readUEG(),t.readUEG(),Ee&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),B=t.readUEG())}let Ye=T,pt=A;if(x){let Se=1,R=1;E===1?Se=R=2:E==2&&(Se=2),Ye=T-Se*b-Se*w,pt=A-R*M-R*I}const jt=s?["A","B","C"][s]:"",kt=o<<24|l<<16|u<<8|c;let mt=0;for(let Se=0;Se<32;Se++)mt=(mt|(kt>>Se&1)<<31-Se)>>>0;let sn=mt.toString(16);return a===1&&sn==="2"&&(sn="6"),{codecString:`hvc1.${jt}${a}.${sn}.${i?"H":"L"}${m}.B0`,params:{general_tier_flag:i,general_profile_idc:a,general_profile_space:s,general_profile_compatibility_flags:[o,l,u,c],general_constraint_indicator_flags:[d,f,h,g,p,v],general_level_idc:m,bit_depth:K+8,bit_depth_luma_minus8:K,bit_depth_chroma_minus8:z,min_spatial_segmentation_idc:B,chroma_format_idc:E,frame_rate:{fixed:ne,fps:le/oe}},width:Ye,height:pt,pixelRatio:[G,ie]}}readPPS(e){const t=new qi(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const s=t.readBoolean(),i=t.readBoolean();let a=1;return i&&s?a=0:i?a=3:s&&(a=2),{parallelismType:a}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const nt=188;class mn{constructor(e,t,n,s){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.logger=s,this.videoParser=null}static probe(e,t){const n=mn.syncOffset(e);return n>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${n}`),n!==-1}static syncOffset(e){const t=e.length;let n=Math.min(nt*5,t-nt)+1,s=0;for(;s<n;){let i=!1,a=-1,o=0;for(let l=s;l<t;l+=nt)if(e[l]===71&&(t-l===nt||e[l+nt]===71)){if(o++,a===-1&&(a=l,a!==0&&(n=Math.min(a+nt*99,e.length-nt)+1)),i||(i=Nd(e,l)===0),i&&o>1&&(a===0&&o>2||l+nt>n))return a}else{if(o)return-1;break}s++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:uE[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,n,s){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=mn.createTrack("video"),this._videoTrack.duration=s,this._audioTrack=mn.createTrack("audio",s),this._id3Track=mn.createTrack("id3"),this._txtTrack=mn.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=n}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:n}=this;e&&(e.pesData=null),t&&(t.pesData=null),n&&(n.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,n=!1,s=!1){n||(this.sampleAes=null);let i;const a=this._videoTrack,o=this._audioTrack,l=this._id3Track,u=this._txtTrack;let c=a.pid,d=a.pesData,f=o.pid,h=l.pid,g=o.pesData,p=l.pesData,v=null,m=this.pmtParsed,y=this._pmtId,S=e.length;if(this.remainderData&&(e=dr(this.remainderData,e),S=e.length,this.remainderData=null),S<nt&&!s)return this.remainderData=e,{audioTrack:o,videoTrack:a,id3Track:l,textTrack:u};const E=Math.max(0,mn.syncOffset(e));S-=(S-E)%nt,S<e.byteLength&&!s&&(this.remainderData=new Uint8Array(e.buffer,S,e.buffer.byteLength-S));let T=0;for(let x=E;x<S;x+=nt)if(e[x]===71){const w=!!(e[x+1]&64),b=Nd(e,x),I=(e[x+3]&48)>>4;let M;if(I>1){if(M=x+5+e[x+4],M===x+nt)continue}else M=x+4;switch(b){case c:w&&(d&&(i=_s(d,this.logger))&&(this.readyVideoParser(a.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(a,u,i,!1)),d={data:[],size:0}),d&&(d.data.push(e.subarray(M,x+nt)),d.size+=x+nt-M);break;case f:if(w){if(g&&(i=_s(g,this.logger)))switch(o.segmentCodec){case"aac":this.parseAACPES(o,i);break;case"mp3":this.parseMPEGPES(o,i);break;case"ac3":this.parseAC3PES(o,i);break}g={data:[],size:0}}g&&(g.data.push(e.subarray(M,x+nt)),g.size+=x+nt-M);break;case h:w&&(p&&(i=_s(p,this.logger))&&this.parseID3PES(l,i),p={data:[],size:0}),p&&(p.data.push(e.subarray(M,x+nt)),p.size+=x+nt-M);break;case 0:w&&(M+=e[M]+1),y=this._pmtId=Bb(e,M);break;case y:{w&&(M+=e[M]+1);const K=jb(e,M,this.typeSupported,n,this.observer,this.logger);c=K.videoPid,c>0&&(a.pid=c,a.segmentCodec=K.segmentVideoCodec),f=K.audioPid,f>0&&(o.pid=f,o.segmentCodec=K.segmentAudioCodec),h=K.id3Pid,h>0&&(l.pid=h),v!==null&&!m&&(this.logger.warn(`MPEG-TS PMT found at ${x} after unknown PID '${v}'. Backtracking to sync byte @${E} to parse all TS packets.`),v=null,x=E-188),m=this.pmtParsed=!0;break}case 17:case 8191:break;default:v=b;break}}else T++;T>0&&Fd(this.observer,new Error(`Found ${T} TS packet/s that do not start with 0x47`),void 0,this.logger),a.pesData=d,o.pesData=g,l.pesData=p;const A={audioTrack:o,videoTrack:a,id3Track:l,textTrack:u};return s&&this.extractRemainingSamples(A),A}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:n,id3Track:s,textTrack:i}=e,a=n.pesData,o=t.pesData,l=s.pesData;let u;if(a&&(u=_s(a,this.logger))?(this.readyVideoParser(n.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(n,i,u,!0),n.pesData=null)):n.pesData=a,o&&(u=_s(o,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,u);break;case"mp3":this.parseMPEGPES(t,u);break;case"ac3":this.parseAC3PES(t,u);break}t.pesData=null}else o!=null&&o.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=o;l&&(u=_s(l,this.logger))?(this.parseID3PES(s,u),s.pesData=null):s.pesData=l}demuxSampleAes(e,t,n){const s=this.demux(e,n,!0,!this.config.progressive),i=this.sampleAes=new Fb(this.observer,this.config,t);return this.decrypt(s,i)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new $b:e==="hevc"&&(this.videoParser=new Ub))}decrypt(e,t){return new Promise(n=>{const{audioTrack:s,videoTrack:i}=e;s.samples&&s.segmentCodec==="aac"?t.decryptAacSamples(s.samples,0,()=>{i.samples?t.decryptAvcSamples(i.samples,0,0,()=>{n(e)}):n(e)}):i.samples&&t.decryptAvcSamples(i.samples,0,0,()=>{n(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let n=0;const s=this.aacOverFlow;let i=t.data;if(s){this.aacOverFlow=null;const d=s.missing,f=s.sample.unit.byteLength;if(d===-1)i=dr(s.sample.unit,i);else{const h=f-d;s.sample.unit.set(i.subarray(0,d),h),e.samples.push(s.sample),n=s.missing}}let a,o;for(a=n,o=i.length;a<o-1&&!Ol(i,a);a++);if(a!==n){let d;const f=a<o-1;if(f?d=`AAC PES did not start with ADTS header,offset:${a}`:d="No ADTS header found in AAC PES",Fd(this.observer,new Error(d),f,this.logger),!f)return}WE(e,this.observer,i,a,this.audioCodec);let l;if(t.pts!==void 0)l=t.pts;else if(s){const d=zE(e.samplerate);l=s.sample.pts+d}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let u=0,c;for(;a<o;)if(c=qE(e,i,a,l,u),a+=c.length,c.missing){this.aacOverFlow=c;break}else for(u++;a<o-1&&!Ol(i,a);a++);}parseMPEGPES(e,t){const n=t.data,s=n.length;let i=0,a=0;const o=t.pts;if(o===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;a<s;)if(JE(n,a)){const l=QE(e,n,a,o,i);if(l)a+=l.length,i++;else break}else a++}parseAC3PES(e,t){{const n=t.data,s=t.pts;if(s===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const i=n.length;let a=0,o=0,l;for(;o<i&&(l=r_(e,n,o,s,a++))>0;)o+=l}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const n=we({},t,{type:this._videoTrack?Yt.emsg:Yt.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(n)}}function Nd(r,e){return((r[e+1]&31)<<8)+r[e+2]}function Bb(r,e){return(r[e+10]&31)<<8|r[e+11]}function jb(r,e,t,n,s,i){const a={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},o=(r[e+1]&15)<<8|r[e+2],l=e+3+o-4,u=(r[e+10]&15)<<8|r[e+11];for(e+=12+u;e<l;){const c=Nd(r,e),d=(r[e+3]&15)<<8|r[e+4];switch(r[e]){case 207:if(!n){Yu("ADTS AAC",i);break}case 15:a.audioPid===-1&&(a.audioPid=c);break;case 21:a.id3Pid===-1&&(a.id3Pid=c);break;case 219:if(!n){Yu("H.264",i);break}case 27:a.videoPid===-1&&(a.videoPid=c);break;case 3:case 4:!t.mpeg&&!t.mp3?i.log("MPEG audio found, not supported in this browser"):a.audioPid===-1&&(a.audioPid=c,a.segmentAudioCodec="mp3");break;case 193:if(!n){Yu("AC-3",i);break}case 129:t.ac3?a.audioPid===-1&&(a.audioPid=c,a.segmentAudioCodec="ac3"):i.log("AC-3 audio found, not supported in this browser");break;case 6:if(a.audioPid===-1&&d>0){let f=e+5,h=d;for(;h>2;){switch(r[f]){case 106:t.ac3!==!0?i.log("AC-3 audio found, not supported in this browser for now"):(a.audioPid=c,a.segmentAudioCodec="ac3");break}const p=r[f+1]+2;f+=p,h-=p}}break;case 194:case 135:return Fd(s,new Error("Unsupported EC-3 in M2TS found"),void 0,i),a;case 36:a.videoPid===-1&&(a.videoPid=c,a.segmentVideoCodec="hevc",i.log("HEVC in M2TS found"));break}e+=d+5}return a}function Fd(r,e,t,n){n.warn(`parsing error: ${e.message}`),r.emit(_.ERROR,_.ERROR,{type:se.MEDIA_ERROR,details:O.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function Yu(r,e){e.log(`${r} with AES-128-CBC encryption found in unencrypted stream`)}function _s(r,e){let t=0,n,s,i,a,o;const l=r.data;if(!r||r.size===0)return null;for(;l[0].length<19&&l.length>1;)l[0]=dr(l[0],l[1]),l.splice(1,1);if(n=l[0],(n[0]<<16)+(n[1]<<8)+n[2]===1){if(s=(n[4]<<8)+n[5],s&&s>r.size-6)return null;const c=n[7];c&192&&(a=(n[9]&14)*536870912+(n[10]&255)*4194304+(n[11]&254)*16384+(n[12]&255)*128+(n[13]&254)/2,c&64?(o=(n[14]&14)*536870912+(n[15]&255)*4194304+(n[16]&254)*16384+(n[17]&255)*128+(n[18]&254)/2,a-o>60*9e4&&(e.warn(`${Math.round((a-o)/9e4)}s delta between PTS and DTS, align them`),a=o)):o=a),i=n[8];let d=i+9;if(r.size<=d)return null;r.size-=d;const f=new Uint8Array(r.size);for(let h=0,g=l.length;h<g;h++){n=l[h];let p=n.byteLength;if(d)if(d>p){d-=p;continue}else n=n.subarray(d),p-=d,d=0;f.set(n,t),t+=p}return s&&(s-=i+3),{data:f,pts:a,dts:o,len:s}}return null}class Gb{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const dn=Math.pow(2,32)-1;class D{static init(){D.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in D.types)D.types.hasOwnProperty(e)&&(D.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);D.HDLR_TYPES={video:t,audio:n};const s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i=new Uint8Array([0,0,0,0,0,0,0,0]);D.STTS=D.STSC=D.STCO=i,D.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),D.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),D.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),D.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const a=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);D.FTYP=D.box(D.types.ftyp,a,l,a,o),D.DINF=D.box(D.types.dinf,D.box(D.types.dref,s))}static box(e,...t){let n=8,s=t.length;const i=s;for(;s--;)n+=t[s].byteLength;const a=new Uint8Array(n);for(a[0]=n>>24&255,a[1]=n>>16&255,a[2]=n>>8&255,a[3]=n&255,a.set(e,4),s=0,n=8;s<i;s++)a.set(t[s],n),n+=t[s].byteLength;return a}static hdlr(e){return D.box(D.types.hdlr,D.HDLR_TYPES[e])}static mdat(e){return D.box(D.types.mdat,e)}static mdhd(e,t){t*=e;const n=Math.floor(t/(dn+1)),s=Math.floor(t%(dn+1));return D.box(D.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255,s>>24,s>>16&255,s>>8&255,s&255,85,196,0,0]))}static mdia(e){return D.box(D.types.mdia,D.mdhd(e.timescale||0,e.duration||0),D.hdlr(e.type),D.minf(e))}static mfhd(e){return D.box(D.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?D.box(D.types.minf,D.box(D.types.smhd,D.SMHD),D.DINF,D.stbl(e)):D.box(D.types.minf,D.box(D.types.vmhd,D.VMHD),D.DINF,D.stbl(e))}static moof(e,t,n){return D.box(D.types.moof,D.mfhd(e),D.traf(n,t))}static moov(e){let t=e.length;const n=[];for(;t--;)n[t]=D.trak(e[t]);return D.box.apply(null,[D.types.moov,D.mvhd(e[0].timescale||0,e[0].duration||0)].concat(n).concat(D.mvex(e)))}static mvex(e){let t=e.length;const n=[];for(;t--;)n[t]=D.trex(e[t]);return D.box.apply(null,[D.types.mvex,...n])}static mvhd(e,t){t*=e;const n=Math.floor(t/(dn+1)),s=Math.floor(t%(dn+1)),i=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255,s>>24,s>>16&255,s>>8&255,s&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return D.box(D.types.mvhd,i)}static sdtp(e){const t=e.samples||[],n=new Uint8Array(4+t.length);let s,i;for(s=0;s<t.length;s++)i=t[s].flags,n[s+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return D.box(D.types.sdtp,n)}static stbl(e){return D.box(D.types.stbl,D.stsd(e),D.box(D.types.stts,D.STTS),D.box(D.types.stsc,D.STSC),D.box(D.types.stsz,D.STSZ),D.box(D.types.stco,D.STCO))}static avc1(e){let t=[],n=[],s,i,a;for(s=0;s<e.sps.length;s++)i=e.sps[s],a=i.byteLength,t.push(a>>>8&255),t.push(a&255),t=t.concat(Array.prototype.slice.call(i));for(s=0;s<e.pps.length;s++)i=e.pps[s],a=i.byteLength,n.push(a>>>8&255),n.push(a&255),n=n.concat(Array.prototype.slice.call(i));const o=D.box(D.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(n))),l=e.width,u=e.height,c=e.pixelRatio[0],d=e.pixelRatio[1];return D.box(D.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,l&255,u>>8&255,u&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,D.box(D.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),D.box(D.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,c&255,d>>24,d>>16&255,d>>8&255,d&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return D.box(D.types.mp4a,D.audioStsd(e),D.box(D.types.esds,D.esds(e)))}static mp3(e){return D.box(D.types[".mp3"],D.audioStsd(e))}static ac3(e){return D.box(D.types["ac-3"],D.audioStsd(e),D.box(D.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return D.box(D.types.stsd,D.STSD,D.mp4a(e));if(t==="ac3"&&e.config)return D.box(D.types.stsd,D.STSD,D.ac3(e));if(t==="mp3"&&e.codec==="mp3")return D.box(D.types.stsd,D.STSD,D.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return D.box(D.types.stsd,D.STSD,D.avc1(e));if(t==="hevc"&&e.vps)return D.box(D.types.stsd,D.STSD,D.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,n=(e.duration||0)*(e.timescale||0),s=e.width||0,i=e.height||0,a=Math.floor(n/(dn+1)),o=Math.floor(n%(dn+1));return D.box(D.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,a>>24,a>>16&255,a>>8&255,a&255,o>>24,o>>16&255,o>>8&255,o&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>8&255,s&255,0,0,i>>8&255,i&255,0,0]))}static traf(e,t){const n=D.sdtp(e),s=e.id,i=Math.floor(t/(dn+1)),a=Math.floor(t%(dn+1));return D.box(D.types.traf,D.box(D.types.tfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,s&255])),D.box(D.types.tfdt,new Uint8Array([1,0,0,0,i>>24,i>>16&255,i>>8&255,i&255,a>>24,a>>16&255,a>>8&255,a&255])),D.trun(e,n.length+16+20+8+16+8+8),n)}static trak(e){return e.duration=e.duration||4294967295,D.box(D.types.trak,D.tkhd(e),D.mdia(e))}static trex(e){const t=e.id;return D.box(D.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const n=e.samples||[],s=n.length,i=12+16*s,a=new Uint8Array(i);let o,l,u,c,d,f;for(t+=8+i,a.set([e.type==="video"?1:0,0,15,1,s>>>24&255,s>>>16&255,s>>>8&255,s&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),o=0;o<s;o++)l=n[o],u=l.duration,c=l.size,d=l.flags,f=l.cts,a.set([u>>>24&255,u>>>16&255,u>>>8&255,u&255,c>>>24&255,c>>>16&255,c>>>8&255,c&255,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|d.isNonSync,d.degradPrio&61440,d.degradPrio&15,f>>>24&255,f>>>16&255,f>>>8&255,f&255],12+16*o);return D.box(D.types.trun,a)}static initSegment(e){D.types||D.init();const t=D.moov(e);return dr(D.FTYP,t)}static hvc1(e){const t=e.params,n=[e.vps,e.sps,e.pps],s=4,i=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),s-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),n.length]);let a=i.length;for(let g=0;g<n.length;g+=1){a+=3;for(let p=0;p<n[g].length;p+=1)a+=2+n[g][p].length}const o=new Uint8Array(a);o.set(i,0),a=i.length;const l=n.length-1;for(let g=0;g<n.length;g+=1){o.set(new Uint8Array([32+g|(g===l?128:0),0,n[g].length]),a),a+=3;for(let p=0;p<n[g].length;p+=1)o.set(new Uint8Array([n[g][p].length>>8,n[g][p].length&255]),a),a+=2,o.set(n[g][p],a),a+=n[g][p].length}const u=D.box(D.types.hvcC,o),c=e.width,d=e.height,f=e.pixelRatio[0],h=e.pixelRatio[1];return D.box(D.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,c>>8&255,c&255,d>>8&255,d&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),u,D.box(D.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),D.box(D.types.pasp,new Uint8Array([f>>24,f>>16&255,f>>8&255,f&255,h>>24,h>>16&255,h>>8&255,h&255])))}}D.types=void 0;D.HDLR_TYPES=void 0;D.STTS=void 0;D.STSC=void 0;D.STCO=void 0;D.STSZ=void 0;D.VMHD=void 0;D.SMHD=void 0;D.STSD=void 0;D.FTYP=void 0;D.DINF=void 0;const s_=9e4;function lp(r,e,t=1,n=!1){const s=r*e*t;return n?Math.round(s):s}function Kb(r,e,t=1,n=!1){return lp(r,e,1/t,n)}function Ci(r,e=!1){return lp(r,1e3,1/s_,e)}function Hb(r,e=1){return lp(r,s_,1/e)}function Nm(r){const{baseTime:e,timescale:t,trackId:n}=r;return`${e/t} (${e}/${t}) trackId: ${n}`}const Vb=10*1e3,Wb=1024,zb=1152,qb=1536;let Ts=null,Zu=null;function Fm(r,e,t,n){return{duration:e,size:t,cts:n,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:r?2:1,isNonSync:r?0:1}}}class Zo extends fr{constructor(e,t,n,s){if(super("mp4-remuxer",s),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.ISGenerated=!1,Ts===null){const a=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Ts=a?parseInt(a[1]):0}if(Zu===null){const i=navigator.userAgent.match(/Safari\/(\d+)/i);Zu=i?parseInt(i[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;(!t||!e||e.trackId!==t.trackId||e.baseTime!==t.baseTime||e.timescale!==t.timescale)&&this.log(`Reset initPTS: ${t&&Nm(t)} > ${e&&Nm(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const n=e[0].pts,s=e.reduce((i,a)=>{let o=a.pts,l=o-i;return l<-4294967296&&(t=!0,o=zt(o,n),l=o-i),l>0?i:o},n);return t&&this.debug("PTS rollover detected"),s}remux(e,t,n,s,i,a,o,l){let u,c,d,f,h,g,p=i,v=i;const m=e.pid>-1,y=t.pid>-1,S=t.samples.length,E=e.samples.length>0,T=o&&S>0||S>1;if((!m||E)&&(!y||T)||this.ISGenerated||o){if(this.ISGenerated){var x,w,b,I;const X=this.videoTrackConfig;(X&&(t.width!==X.width||t.height!==X.height||((x=t.pixelRatio)==null?void 0:x[0])!==((w=X.pixelRatio)==null?void 0:w[0])||((b=t.pixelRatio)==null?void 0:b[1])!==((I=X.pixelRatio)==null?void 0:I[1]))||!X&&T||this.nextAudioTs===null&&E)&&this.resetInitSegment()}this.ISGenerated||(d=this.generateIS(e,t,i,a));const M=this.isVideoContiguous;let K=-1,z;if(T&&(K=Yb(t.samples),!M&&this.config.forceKeyFrameOnDiscontinuity))if(g=!0,K>0){this.warn(`Dropped ${K} out of ${S} video samples due to a missing keyframe`);const X=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(K),t.dropped+=K,v+=(t.samples[0].pts-X)/t.inputTimeScale,z=v}else K===-1&&(this.warn(`No keyframe found out of ${S} video samples`),g=!1);if(this.ISGenerated){if(E&&T){const X=this.getVideoStartPts(t.samples),N=(zt(e.samples[0].pts,X)-X)/t.inputTimeScale;p+=Math.max(0,N),v+=Math.max(0,-N)}if(E){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),d=this.generateIS(e,t,i,a)),c=this.remuxAudio(e,p,this.isAudioContiguous,a,y||T||l===ee.AUDIO?v:void 0),T){const X=c?c.endPTS-c.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),d=this.generateIS(e,t,i,a)),u=this.remuxVideo(t,v,M,X)}}else T&&(u=this.remuxVideo(t,v,M,0));u&&(u.firstKeyFrame=K,u.independent=K!==-1,u.firstKeyFramePTS=z)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(n.samples.length&&(h=i_(n,i,this._initPTS,this._initDTS)),s.samples.length&&(f=a_(s,i,this._initPTS))),{audio:c,video:u,initSegment:d,independent:g,text:f,id3:h}}computeInitPts(e,t,n,s){const i=Math.round(n*t);let a=zt(e,i);if(a<i+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(i-a)/t} ${s}`);a<i+t;)a+=8589934592;return a-i}generateIS(e,t,n,s){const i=e.samples,a=t.samples,o=this.typeSupported,l={},u=this._initPTS;let c=!u||s,d="audio/mp4",f,h,g,p=-1;if(c&&(f=h=1/0),e.config&&i.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":o.mpeg?(d="audio/mpeg",e.codec=""):o.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}l.audio={id:"audio",container:d,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&o.mpeg?new Uint8Array(0):D.initSegment([e]),metadata:{channelCount:e.channelCount}},c&&(p=e.id,g=e.inputTimeScale,!u||g!==u.timescale?f=h=this.computeInitPts(i[0].pts,g,n,"audio"):c=!1)}if(t.sps&&t.pps&&a.length){if(t.timescale=t.inputTimeScale,l.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:D.initSegment([t]),metadata:{width:t.width,height:t.height}},c)if(p=t.id,g=t.inputTimeScale,!u||g!==u.timescale){const v=this.getVideoStartPts(a),m=zt(a[0].dts,v),y=this.computeInitPts(m,g,n,"video"),S=this.computeInitPts(v,g,n,"video");h=Math.min(h,y),f=Math.min(f,S)}else c=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(l).length)return this.ISGenerated=!0,c?(u&&this.warn(`Timestamps at playlist time: ${s?"":"~"}${n} ${f/g} != initPTS: ${u.baseTime/u.timescale} (${u.baseTime}/${u.timescale}) trackId: ${u.trackId}`),this.log(`Found initPTS at playlist time: ${n} offset: ${f/g} (${f}/${g}) trackId: ${p}`),this._initPTS={baseTime:f,timescale:g,trackId:p},this._initDTS={baseTime:h,timescale:g,trackId:p}):f=g=void 0,{tracks:l,initPTS:f,timescale:g,trackId:p}}remuxVideo(e,t,n,s){const i=e.inputTimeScale,a=e.samples,o=[],l=a.length,u=this._initPTS,c=u.baseTime*i/u.timescale;let d=this.nextVideoTs,f=8,h=this.videoSampleDuration,g,p,v=Number.POSITIVE_INFINITY,m=Number.NEGATIVE_INFINITY,y=!1;if(!n||d===null){const B=c+t*i,G=a[0].pts-zt(a[0].dts,a[0].pts);Ts&&d!==null&&Math.abs(B-G-(d+c))<15e3?n=!0:d=B-G-c}const S=d+c;for(let B=0;B<l;B++){const G=a[B];G.pts=zt(G.pts,S),G.dts=zt(G.dts,S),G.dts<a[B>0?B-1:B].dts&&(y=!0)}y&&a.sort(function(B,G){const ie=B.dts-G.dts,ne=B.pts-G.pts;return ie||ne}),g=a[0].dts,p=a[a.length-1].dts;const E=p-g,T=E?Math.round(E/(l-1)):h||e.inputTimeScale/30;if(n){const B=g-S,G=B>T,ie=B<-1;if((G||ie)&&(G?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Ci(B,!0)} ms (${B}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Ci(-B,!0)} ms (${B}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!ie||S>=a[0].pts||Ts)){g=S;const ne=a[0].pts-B;if(G)a[0].dts=g,a[0].pts=ne;else{let oe=!0;for(let le=0;le<a.length&&!(a[le].dts>ne&&oe);le++){const Ie=a[le].pts;if(a[le].dts-=B,a[le].pts-=B,le<a.length-1){const Fe=a[le+1].pts,Ye=a[le].pts,pt=Fe<=Ye,jt=Fe<=Ie;oe=pt==jt}}}this.log(`Video: Initial PTS/DTS adjusted: ${Ci(ne,!0)}/${Ci(g,!0)}, delta: ${Ci(B,!0)} ms`)}}g=Math.max(0,g);let A=0,x=0,w=g;for(let B=0;B<l;B++){const G=a[B],ie=G.units,ne=ie.length;let oe=0;for(let le=0;le<ne;le++)oe+=ie[le].data.length;x+=oe,A+=ne,G.length=oe,G.dts<w?(G.dts=w,w+=T/4|0||1):w=G.dts,v=Math.min(G.pts,v),m=Math.max(G.pts,m)}p=a[l-1].dts;const b=x+4*A+8;let I;try{I=new Uint8Array(b)}catch(B){this.observer.emit(_.ERROR,_.ERROR,{type:se.MUX_ERROR,details:O.REMUX_ALLOC_ERROR,fatal:!1,error:B,bytes:b,reason:`fail allocating video mdat ${b}`});return}const M=new DataView(I.buffer);M.setUint32(0,b),I.set(D.types.mdat,4);let K=!1,z=Number.POSITIVE_INFINITY,X=Number.POSITIVE_INFINITY,Q=Number.NEGATIVE_INFINITY,N=Number.NEGATIVE_INFINITY;for(let B=0;B<l;B++){const G=a[B],ie=G.units;let ne=0;for(let Ie=0,Fe=ie.length;Ie<Fe;Ie++){const Ye=ie[Ie],pt=Ye.data,jt=Ye.data.byteLength;M.setUint32(f,jt),f+=4,I.set(pt,f),f+=jt,ne+=4+jt}let oe;if(B<l-1)h=a[B+1].dts-G.dts,oe=a[B+1].pts-G.pts;else{const Ie=this.config,Fe=B>0?G.dts-a[B-1].dts:T;if(oe=B>0?G.pts-a[B-1].pts:T,Ie.stretchShortVideoTrack&&this.nextAudioTs!==null){const Ye=Math.floor(Ie.maxBufferHole*i),pt=(s?v+s*i:this.nextAudioTs+c)-G.pts;pt>Ye?(h=pt-Fe,h<0?h=Fe:K=!0,this.log(`It is approximately ${pt/90} ms to the next segment; using duration ${h/90} ms for the last video frame.`)):h=Fe}else h=Fe}const le=Math.round(G.pts-G.dts);z=Math.min(z,h),Q=Math.max(Q,h),X=Math.min(X,oe),N=Math.max(N,oe),o.push(Fm(G.key,h,ne,le))}if(o.length){if(Ts){if(Ts<70){const B=o[0].flags;B.dependsOn=2,B.isNonSync=0}}else if(Zu&&N-X<Q-z&&T/Q<.025&&o[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let B=g;for(let G=0,ie=o.length;G<ie;G++){const ne=B+o[G].duration,oe=B+o[G].cts;if(G<ie-1){const le=ne+o[G+1].cts;o[G].duration=le-oe}else o[G].duration=G?o[G-1].duration:T;o[G].cts=0,B=ne}}}h=K||!h?T:h;const P=p+h;this.nextVideoTs=d=P-c,this.videoSampleDuration=h,this.isVideoContiguous=!0;const U={data1:D.moof(e.sequenceNumber++,g,we(e,{samples:o})),data2:I,startPTS:(v-c)/i,endPTS:(m+h-c)/i,startDTS:(g-c)/i,endDTS:d/i,type:"video",hasAudio:!1,hasVideo:!0,nb:o.length,dropped:e.dropped};return e.samples=[],e.dropped=0,U}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return zb;case"ac3":return qb;default:return Wb}}remuxAudio(e,t,n,s,i){const a=e.inputTimeScale,o=e.samplerate?e.samplerate:a,l=a/o,u=this.getSamplesPerFrame(e),c=u*l,d=this._initPTS,f=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,h=[],g=i!==void 0;let p=e.samples,v=f?0:8,m=this.nextAudioTs||-1;const y=d.baseTime*a/d.timescale,S=y+t*a;if(this.isAudioContiguous=n=n||p.length&&m>0&&(s&&Math.abs(S-(m+y))<9e3||Math.abs(zt(p[0].pts,S)-(m+y))<20*c),p.forEach(function(N){N.pts=zt(N.pts,S)}),!n||m<0){const N=p.length;if(p=p.filter(P=>P.pts>=0),N!==p.length&&this.warn(`Removed ${p.length-N} of ${N} samples (initPTS ${y} / ${a})`),!p.length)return;i===0?m=0:s&&!g?m=Math.max(0,S-y):m=p[0].pts-y}if(e.segmentCodec==="aac"){const N=this.config.maxAudioFramesDrift;for(let P=0,k=m+y;P<p.length;P++){const F=p[P],U=F.pts,B=U-k,G=Math.abs(1e3*B/a);if(B<=-N*c&&g)P===0&&(this.warn(`Audio frame @ ${(U/a).toFixed(3)}s overlaps marker by ${Math.round(1e3*B/a)} ms.`),this.nextAudioTs=m=U-y,k=U);else if(B>=N*c&&G<Vb&&g){let ie=Math.round(B/c);for(k=U-ie*c;k<0&&ie&&c;)ie--,k+=c;P===0&&(this.nextAudioTs=m=k-y),this.warn(`Injecting ${ie} audio frames @ ${((k-y)/a).toFixed(3)}s due to ${Math.round(1e3*B/a)} ms gap.`);for(let ne=0;ne<ie;ne++){let oe=Gb.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);oe||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),oe=F.unit.subarray()),p.splice(P,0,{unit:oe,pts:k}),k+=c,P++}}F.pts=k,k+=c}}let E=null,T=null,A,x=0,w=p.length;for(;w--;)x+=p[w].unit.byteLength;for(let N=0,P=p.length;N<P;N++){const k=p[N],F=k.unit;let U=k.pts;if(T!==null){const G=h[N-1];G.duration=Math.round((U-T)/l)}else if(n&&e.segmentCodec==="aac"&&(U=m+y),E=U,x>0){x+=v;try{A=new Uint8Array(x)}catch(G){this.observer.emit(_.ERROR,_.ERROR,{type:se.MUX_ERROR,details:O.REMUX_ALLOC_ERROR,fatal:!1,error:G,bytes:x,reason:`fail allocating audio mdat ${x}`});return}f||(new DataView(A.buffer).setUint32(0,x),A.set(D.types.mdat,4))}else return;A.set(F,v);const B=F.byteLength;v+=B,h.push(Fm(!0,u,B,0)),T=U}const b=h.length;if(!b)return;const I=h[h.length-1];m=T-y,this.nextAudioTs=m+l*I.duration;const M=f?new Uint8Array(0):D.moof(e.sequenceNumber++,E/l,we({},e,{samples:h}));e.samples=[];const K=(E-y)/a,z=this.nextAudioTs/a,Q={data1:M,data2:A,startPTS:K,endPTS:z,startDTS:K,endDTS:z,type:"audio",hasAudio:!0,hasVideo:!1,nb:b};return this.isAudioContiguous=!0,Q}}function zt(r,e){let t;if(e===null)return r;for(e<r?t=-8589934592:t=8589934592;Math.abs(r-e)>4294967296;)r+=t;return r}function Yb(r){for(let e=0;e<r.length;e++)if(r[e].key)return e;return-1}function i_(r,e,t,n){const s=r.samples.length;if(!s)return;const i=r.inputTimeScale;for(let o=0;o<s;o++){const l=r.samples[o];l.pts=zt(l.pts-t.baseTime*i/t.timescale,e*i)/i,l.dts=zt(l.dts-n.baseTime*i/n.timescale,e*i)/i}const a=r.samples;return r.samples=[],{samples:a}}function a_(r,e,t){const n=r.samples.length;if(!n)return;const s=r.inputTimeScale;for(let a=0;a<n;a++){const o=r.samples[a];o.pts=zt(o.pts-t.baseTime*s/t.timescale,e*s)/s}r.samples.sort((a,o)=>a.pts-o.pts);const i=r.samples;return r.samples=[],{samples:i}}class Zb extends fr{constructor(e,t,n,s){super("passthrough-remuxer",s),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,n,s){this.audioCodec=t,this.videoCodec=n,this.generateInitSegment(e,s),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:n,videoCodec:s}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:i,video:a}=this.initData=fE(e);if(t)Fw(e,t);else{const l=i||a;l!=null&&l.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${l.codec}")!`)}i&&(n=$m(i,be.AUDIO,this)),a&&(s=$m(a,be.VIDEO,this));const o={};i&&a?o.audiovideo={container:"video/mp4",codec:n+","+s,supplemental:a.supplemental,encrypted:a.encrypted,initSegment:e,id:"main"}:i?o.audio={container:"audio/mp4",codec:n,encrypted:i.encrypted,initSegment:e,id:"audio"}:a?o.video={container:"video/mp4",codec:s,supplemental:a.supplemental,encrypted:a.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=o}remux(e,t,n,s,i,a){var o,l;let{initPTS:u,lastEndTime:c}=this;const d={audio:void 0,video:void 0,text:s,id3:n,initSegment:void 0};J(c)||(c=this.lastEndTime=i||0);const f=t.samples;if(!f.length)return d;const h={initPTS:void 0,timescale:void 0,trackId:void 0};let g=this.initData;if((o=g)!=null&&o.length||(this.generateInitSegment(f),g=this.initData),!((l=g)!=null&&l.length))return this.warn("Failed to generate initSegment."),d;this.emitInitSegment&&(h.tracks=this.initTracks,this.emitInitSegment=!1);const p=Uw(f,g,this),v=g.audio?p[g.audio.id]:null,m=g.video?p[g.video.id]:null,y=vo(m,1/0),S=vo(v,1/0),E=vo(m,0,!0),T=vo(v,0,!0);let A=i,x=0;const w=v&&(!m||!u&&S<y||u&&u.trackId===g.audio.id),b=w?v:m;if(b){const k=b.timescale,F=b.start-i*k,U=w?g.audio.id:g.video.id;A=b.start/k,x=w?T-S:E-y,(a||!u)&&(Qb(u,A,i,x)||k!==u.timescale)&&(u&&this.warn(`Timestamps at playlist time: ${a?"":"~"}${i} ${F/k} != initPTS: ${u.baseTime/u.timescale} (${u.baseTime}/${u.timescale}) trackId: ${u.trackId}`),this.log(`Found initPTS at playlist time: ${i} offset: ${A-i} (${F}/${k}) trackId: ${U}`),u=null,h.initPTS=F,h.timescale=k,h.trackId=U)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${i}`);u?(h.initPTS=u.baseTime,h.timescale=u.timescale,h.trackId=u.trackId):((!h.timescale||h.trackId===void 0||h.initPTS===void 0)&&(this.warn("Could not set initPTS"),h.initPTS=A,h.timescale=1,h.trackId=-1),this.initPTS=u={baseTime:h.initPTS,timescale:h.timescale,trackId:h.trackId});const I=A-u.baseTime/u.timescale,M=I+x;x>0?this.lastEndTime=M:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const K=!!g.audio,z=!!g.video;let X="";K&&(X+="audio"),z&&(X+="video");const Q=(g.audio?g.audio.encrypted:!1)||(g.video?g.video.encrypted:!1),N={data1:f,startPTS:I,startDTS:I,endPTS:M,endDTS:M,type:X,hasAudio:K,hasVideo:z,nb:1,dropped:0,encrypted:Q};d.audio=K&&!z?N:void 0,d.video=z?N:void 0;const P=m==null?void 0:m.sampleCount;if(P){const k=m.keyFrameIndex,F=k!==-1;N.nb=P,N.dropped=k===0||this.isVideoContiguous?0:F?k:P,N.independent=F,N.firstKeyFrame=k,F&&m.keyFrameStart&&(N.firstKeyFramePTS=(m.keyFrameStart-u.baseTime)/u.timescale),this.isVideoContiguous||(d.independent=F),this.isVideoContiguous||(this.isVideoContiguous=F),N.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${k}/${P} dropped: ${N.dropped} start: ${N.firstKeyFramePTS||"NA"}`)}return d.initSegment=h,d.id3=i_(n,i,u,u),s.samples.length&&(d.text=a_(s,i,u)),d}}function vo(r,e,t=!1){return(r==null?void 0:r.start)!==void 0?(r.start+(t?r.duration:0))/r.timescale:e}function Qb(r,e,t,n){if(r===null)return!0;const s=Math.max(n,1),i=e-r.baseTime/r.timescale;return Math.abs(i-t)>s}function $m(r,e,t){const n=r.codec;return n&&n.length>4?n:e===be.AUDIO?n==="ec-3"||n==="ac-3"||n==="alac"?n:n==="fLaC"||n==="Opus"?Il(n,!1):(t.warn(`Unhandled audio codec "${n}" in mp4 MAP`),n||"mp4a"):(t.warn(`Unhandled video codec "${n}" in mp4 MAP`),n||"avc1")}let Vr;try{Vr=self.performance.now.bind(self.performance)}catch{Vr=Date.now}const Qo=[{demux:Nb,remux:Zb},{demux:mn,remux:Zo},{demux:Pb,remux:Zo},{demux:Ob,remux:Zo}];Qo.splice(2,0,{demux:Db,remux:Zo});class Um{constructor(e,t,n,s,i,a){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=n,this.id=i,this.logger=a}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,n,s){const i=n.transmuxing;i.executeStart=Vr();let a=new Uint8Array(e);const{currentTransmuxState:o,transmuxConfig:l}=this;s&&(this.currentTransmuxState=s);const{contiguous:u,discontinuity:c,trackSwitch:d,accurateTimeOffset:f,timeOffset:h,initSegmentChange:g}=s||o,{audioCodec:p,videoCodec:v,defaultInitPts:m,duration:y,initSegmentData:S}=l,E=Xb(a,t);if(E&&ri(E.method)){const w=this.getDecrypter(),b=Jg(E.method);if(w.isSync()){let I=w.softwareDecrypt(a,E.key.buffer,E.iv.buffer,b);if(n.part>-1){const K=w.flush();I=K&&K.buffer}if(!I)return i.executeEnd=Vr(),Qu(n);a=new Uint8Array(I)}else return this.asyncResult=!0,this.decryptionPromise=w.webCryptoDecrypt(a,E.key.buffer,E.iv.buffer,b).then(I=>{const M=this.push(I,null,n);return this.decryptionPromise=null,M}),this.decryptionPromise}const T=this.needsProbing(c,d);if(T){const w=this.configureTransmuxer(a);if(w)return this.logger.warn(`[transmuxer] ${w.message}`),this.observer.emit(_.ERROR,_.ERROR,{type:se.MEDIA_ERROR,details:O.FRAG_PARSING_ERROR,fatal:!1,error:w,reason:w.message}),i.executeEnd=Vr(),Qu(n)}(c||d||g||T)&&this.resetInitSegment(S,p,v,y,t),(c||g||T)&&this.resetInitialTimestamp(m),u||this.resetContiguity();const A=this.transmux(a,E,h,f,n);this.asyncResult=Ea(A);const x=this.currentTransmuxState;return x.contiguous=!0,x.discontinuity=!1,x.trackSwitch=!1,i.executeEnd=Vr(),A}flush(e){const t=e.transmuxing;t.executeStart=Vr();const{decrypter:n,currentTransmuxState:s,decryptionPromise:i}=this;if(i)return this.asyncResult=!0,i.then(()=>this.flush(e));const a=[],{timeOffset:o}=s;if(n){const d=n.flush();d&&a.push(this.push(d.buffer,null,e))}const{demuxer:l,remuxer:u}=this;if(!l||!u){t.executeEnd=Vr();const d=[Qu(e)];return this.asyncResult?Promise.resolve(d):d}const c=l.flush(o);return Ea(c)?(this.asyncResult=!0,c.then(d=>(this.flushRemux(a,d,e),a))):(this.flushRemux(a,c,e),this.asyncResult?Promise.resolve(a):a)}flushRemux(e,t,n){const{audioTrack:s,videoTrack:i,id3Track:a,textTrack:o}=t,{accurateTimeOffset:l,timeOffset:u}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${n.sn}${n.part>-1?" part: "+n.part:""} of ${this.id===ee.MAIN?"level":"track"} ${n.level}`);const c=this.remuxer.remux(s,i,a,o,u,l,!0,this.id);e.push({remuxResult:c,chunkMeta:n}),n.transmuxing.executeEnd=Vr()}resetInitialTimestamp(e){const{demuxer:t,remuxer:n}=this;!t||!n||(t.resetTimeStamp(e),n.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,n,s,i){const{demuxer:a,remuxer:o}=this;!a||!o||(a.resetInitSegment(e,t,n,s),o.resetInitSegment(e,t,n,i))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,n,s,i){let a;return t&&t.method==="SAMPLE-AES"?a=this.transmuxSampleAes(e,t,n,s,i):a=this.transmuxUnencrypted(e,n,s,i),a}transmuxUnencrypted(e,t,n,s){const{audioTrack:i,videoTrack:a,id3Track:o,textTrack:l}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(i,a,o,l,t,n,!1,this.id),chunkMeta:s}}transmuxSampleAes(e,t,n,s,i){return this.demuxer.demuxSampleAes(e,t,n).then(a=>({remuxResult:this.remuxer.remux(a.audioTrack,a.videoTrack,a.id3Track,a.textTrack,n,s,!1,this.id),chunkMeta:i}))}configureTransmuxer(e){const{config:t,observer:n,typeSupported:s}=this;let i;for(let d=0,f=Qo.length;d<f;d++){var a;if((a=Qo[d].demux)!=null&&a.probe(e,this.logger)){i=Qo[d];break}}if(!i)return new Error("Failed to find demuxer by probing fragment data");const o=this.demuxer,l=this.remuxer,u=i.remux,c=i.demux;(!l||!(l instanceof u))&&(this.remuxer=new u(n,t,s,this.logger)),(!o||!(o instanceof c))&&(this.demuxer=new c(n,t,s,this.logger),this.probe=c.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new Qg(this.config)),e}}function Xb(r,e){let t=null;return r.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const Qu=r=>({remuxResult:{},chunkMeta:r});function Ea(r){return"then"in r&&r.then instanceof Function}class Jb{constructor(e,t,n,s,i){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=n,this.duration=s,this.defaultInitPts=i||null}}class eR{constructor(e,t,n,s,i,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=n,this.trackSwitch=s,this.timeOffset=i,this.initSegmentChange=a}}let Bm=0;class o_{constructor(e,t,n,s){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=Bm++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=l=>{const u=l.data,c=this.hls;if(!(!c||!(u!=null&&u.event)||u.instanceNo!==this.instanceNo))switch(u.event){case"init":{var d;const f=(d=this.workerContext)==null?void 0:d.objectURL;f&&self.URL.revokeObjectURL(f);break}case"transmuxComplete":{this.handleTransmuxComplete(u.data);break}case"flush":{this.onFlush(u.data);break}case"workerLog":{c.logger[u.data.logType]&&c.logger[u.data.logType](u.data.message);break}default:{u.data=u.data||{},u.data.frag=this.frag,u.data.part=this.part,u.data.id=this.id,c.trigger(u.event,u.data);break}}},this.onWorkerError=l=>{if(!this.hls)return;const u=new Error(`${l.message}  (${l.filename}:${l.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(_.ERROR,{type:se.OTHER_ERROR,details:O.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:u})};const i=e.config;this.hls=e,this.id=t,this.useWorker=!!i.enableWorker,this.onTransmuxComplete=n,this.onFlush=s;const a=(l,u)=>{u=u||{},u.frag=this.frag||void 0,l===_.ERROR&&(u=u,u.parent=this.id,u.part=this.part,this.error=u.error),this.hls.trigger(l,u)};this.observer=new rp,this.observer.on(_.FRAG_DECRYPTED,a),this.observer.on(_.ERROR,a);const o=tm(i.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const l=this.hls.logger;if(i.workerPath||sb()){try{i.workerPath?(l.log(`loading Web Worker ${i.workerPath} for "${t}"`),this.workerContext=ab(i.workerPath)):(l.log(`injecting Web Worker for "${t}"`),this.workerContext=ib());const{worker:c}=this.workerContext;c.addEventListener("message",this.onWorkerMessage),c.addEventListener("error",this.onWorkerError),c.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:o,id:t,config:Re(i)})}catch(c){l.warn(`Error setting up "${t}" Web Worker, fallback to inline`,c),this.terminateWorker(),this.error=null,this.transmuxer=new Um(this.observer,o,i,"",t,e.logger)}return}}this.transmuxer=new Um(this.observer,o,i,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=Bm++;const t=this.hls.config,n=tm(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:n,id:this.id,config:Re(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),ob(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,n,s,i,a,o,l,u,c){var d,f;u.transmuxing.start=self.performance.now();const{instanceNo:h,transmuxer:g}=this,p=a?a.start:i.start,v=i.decryptdata,m=this.frag,y=!(m&&i.cc===m.cc),S=!(m&&u.level===m.level),E=m?u.sn-m.sn:-1,T=this.part?u.part-this.part.index:-1,A=E===0&&u.id>1&&u.id===(m==null?void 0:m.stats.chunkCount),x=!S&&(E===1||E===0&&(T===1||A&&T<=0)),w=self.performance.now();(S||E||i.stats.parsing.start===0)&&(i.stats.parsing.start=w),a&&(T||!x)&&(a.stats.parsing.start=w);const b=!(m&&((d=i.initSegment)==null?void 0:d.url)===((f=m.initSegment)==null?void 0:f.url)),I=new eR(y,x,l,S,p,b);if(!x||y||b){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${i.type} sn: ${u.sn}${u.part>-1?" part: "+u.part:""} ${this.id===ee.MAIN?"level":"track"}: ${u.level} id: ${u.id}
        discontinuity: ${y}
        trackSwitch: ${S}
        contiguous: ${x}
        accurateTimeOffset: ${l}
        timeOffset: ${p}
        initSegmentChange: ${b}`);const M=new Jb(n,s,t,o,c);this.configureTransmuxer(M)}if(this.frag=i,this.part=a,this.workerContext)this.workerContext.worker.postMessage({instanceNo:h,cmd:"demux",data:e,decryptdata:v,chunkMeta:u,state:I},e instanceof ArrayBuffer?[e]:[]);else if(g){const M=g.push(e,v,u,I);Ea(M)?M.then(K=>{this.handleTransmuxComplete(K)}).catch(K=>{this.transmuxerError(K,u,"transmuxer-interface push error")}):this.handleTransmuxComplete(M)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:n}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(n){const s=n.flush(e);Ea(s)?s.then(i=>{this.handleFlushResult(i,e)}).catch(i=>{this.transmuxerError(i,e,"transmuxer-interface flush error")}):this.handleFlushResult(s,e)}}transmuxerError(e,t,n){this.hls&&(this.error=e,this.hls.trigger(_.ERROR,{type:se.MEDIA_ERROR,details:O.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:n}))}handleFlushResult(e,t){e.forEach(n=>{this.handleTransmuxComplete(n)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:n}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):n&&n.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const jm=100;class tR extends tp{constructor(e,t,n){super(e,t,n,"audio-stream-controller",ee.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(_.LEVEL_LOADED,this.onLevelLoaded,this),e.on(_.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(_.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(_.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(_.BUFFER_RESET,this.onBufferReset,this),e.on(_.BUFFER_CREATED,this.onBufferCreated,this),e.on(_.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(_.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(_.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(_.FRAG_LOADING,this.onFragLoading,this),e.on(_.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(_.LEVEL_LOADED,this.onLevelLoaded,this),e.off(_.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(_.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(_.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(_.BUFFER_RESET,this.onBufferReset,this),e.off(_.BUFFER_CREATED,this.onBufferCreated,this),e.off(_.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(_.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(_.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(_.FRAG_LOADING,this.onFragLoading,this),e.off(_.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:n,initPTS:s,timescale:i,trackId:a}){if(n===ee.MAIN){const o=t.cc,l=this.fragCurrent;if(this.initPTS[o]={baseTime:s,timescale:i,trackId:a},this.log(`InitPTS for cc: ${o} found from main: ${s/i} (${s}/${i}) trackId: ${a}`),this.mainAnchor=t,this.state===j.WAITING_INIT_PTS){const u=this.waitingData;(!u&&!this.loadingParts||u&&u.frag.cc!==o)&&this.syncWithAnchor(t,u==null?void 0:u.frag)}else!this.hls.hasEnoughToStart&&l&&l.cc!==o?(l.abortRequests(),this.syncWithAnchor(t,l)):this.state===j.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var n;const s=((n=this.mainFragLoading)==null?void 0:n.frag)||null;if(t&&(s==null?void 0:s.cc)===t.cc)return;const i=(s||e).cc,a=this.getLevelDetails(),o=this.getLoadPosition(),l=xE(a,i,o);l&&(this.log(`Syncing with main frag at ${l.start} cc ${l.cc}`),this.startFragRequested=!1,this.nextLoadPosition=l.start,this.resetLoadingState(),this.state===j.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=j.STOPPED;return}const n=this.lastCurrentTime;this.stopLoad(),this.setInterval(jm),n>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${n.toFixed(3)}`),e=n,this.state=j.IDLE):this.state=j.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case j.IDLE:this.doTickIdle();break;case j.WAITING_TRACK:{const{levels:e,trackId:t}=this,n=e==null?void 0:e[t],s=n==null?void 0:n.details;if(s&&!this.waitForLive(n)){if(this.waitForCdnTuneIn(s))break;this.state=j.WAITING_INIT_PTS}break}case j.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case j.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:n,cache:s,complete:i}=e,a=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=j.FRAG_LOADING;const o=s.flush().buffer,l={frag:t,part:n,payload:o,networkDetails:null};this._handleFragmentLoadProgress(l),i&&super._handleFragmentLoadComplete(l)}else a&&a.cc!==e.frag.cc&&this.syncWithAnchor(a,e.frag)}else this.state=j.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:n,media:s,trackId:i}=this,a=t.config;if(!this.buffering||!s&&!this.primaryPrefetch&&(this.startFragRequested||!a.startFragPrefetch)||!(n!=null&&n[i]))return;const o=n[i],l=o.details;if(!l||this.waitForLive(o)||this.waitForCdnTuneIn(l)){this.state=j.WAITING_TRACK,this.startFragRequested=!1;return}const u=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&u&&(this.bufferFlushed=!1,this.afterBufferFlushed(u,be.AUDIO,ee.AUDIO));const c=this.getFwdBufferInfo(u,ee.AUDIO);if(c===null)return;if(!this.switchingTrack&&this._streamEnded(c,l)){t.trigger(_.BUFFER_EOS,{type:"audio"}),this.state=j.ENDED;return}const d=c.len,f=t.maxBufferLength,h=l.fragments,g=h[0].start,p=this.getLoadPosition(),v=this.flushing?p:c.end;if(this.switchingTrack&&s){const S=p;l.PTSKnown&&S<g&&(c.end>g||c.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),s.currentTime=g+.05)}if(d>=f&&!this.switchingTrack&&v<h[h.length-1].start)return;let m=this.getNextFragment(v,l);if(m&&this.isLoopLoading(m,v)&&(m=this.getNextFragmentLoopLoading(m,l,c,ee.MAIN,f)),!m){this.bufferFlushed=!0;return}let y=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&y&&qe(m)&&!m.endList&&(!l.live||!this.loadingParts&&v<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(y)===tt.OK&&(this.mainFragLoading=y=null),y&&qe(y))){if(m.start>y.end){const E=this.fragmentTracker.getFragAtPos(v,ee.MAIN);E&&E.end>y.end&&(y=E,this.mainFragLoading={frag:E,targetBufferTime:null})}if(m.start>y.end)return}this.loadFragment(m,o,v)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(n=>new va(n))}onAudioTrackSwitching(e,t){const n=!!t.url;this.trackId=t.id;const{fragCurrent:s}=this;s&&(s.abortRequests(),this.removeUnbufferedFrags(s.start)),this.resetLoadingState(),n?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==j.STOPPED&&(this.setInterval(jm),this.state=j.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const n=this.cachedTrackLoadedData;n&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(_.AUDIO_TRACK_LOADED,n))}onAudioTrackLoaded(e,t){var n;const{levels:s}=this,{details:i,id:a,groupId:o,track:l}=t;if(!s){this.warn(`Audio tracks reset while loading track ${a} "${l.name}" of "${o}"`);return}const u=this.mainDetails;if(!u||i.endCC>u.endCC||u.expired){this.cachedTrackLoadedData=t,this.state!==j.STOPPED&&(this.state=j.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${a} "${l.name}" of "${o}" loaded [${i.startSN},${i.endSN}]${i.lastPartSn?`[part-${i.lastPartSn}-${i.lastPartIndex}]`:""},duration:${i.totalduration}`);const c=s[a];let d=0;if(i.live||(n=c.details)!=null&&n.live){if(this.checkLiveUpdate(i),i.deltaUpdateFailed)return;if(c.details){var f;d=this.alignPlaylists(i,c.details,(f=this.levelLastLoaded)==null?void 0:f.details)}i.alignedSliding||(jE(i,u),i.alignedSliding||Dl(i,u),d=i.fragmentStart)}c.details=i,this.levelLastLoaded=c,this.startFragRequested||this.setStartPosition(u,d),this.hls.trigger(_.AUDIO_TRACK_UPDATED,{details:i,id:a,groupId:t.groupId}),this.state===j.WAITING_TRACK&&!this.waitForCdnTuneIn(i)&&(this.state=j.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const n=e.frag,{part:s,payload:i}=e,{config:a,trackId:o,levels:l}=this;if(!l){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}const u=l[o];if(!u){this.warn("Audio track is undefined on fragment load progress");return}const c=u.details;if(!c){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(n.start);return}const d=a.defaultAudioCodec||u.audioCodec||"mp4a.40.2";let f=this.transmuxer;f||(f=this.transmuxer=new o_(this.hls,ee.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const h=this.initPTS[n.cc],g=(t=n.initSegment)==null?void 0:t.data;if(h!==void 0){const v=s?s.index:-1,m=v!==-1,y=new Xg(n.level,n.sn,n.stats.chunkCount,i.byteLength,v,m);f.push(i,g,d,"",n,s,c.totalduration,!1,y,h)}else{this.log(`Unknown video PTS for cc ${n.cc}, waiting for video PTS before demuxing audio frag ${n.sn} of [${c.startSN} ,${c.endSN}],track ${o}`);const{cache:p}=this.waitingData=this.waitingData||{frag:n,part:s,cache:new GE,complete:!1};p.push(new Uint8Array(i)),this.state!==j.STOPPED&&(this.state=j.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const n=t.tracks.audio;n&&(this.mediaBuffer=n.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===ee.MAIN&&qe(t.frag)&&(this.mainFragLoading=t,this.state===j.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:n,part:s}=t;if(n.type!==ee.AUDIO){!this.audioOnly&&n.type===ee.MAIN&&!n.elementaryStreams.video&&!n.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${s?" p: "+s.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(qe(n)){this.fragPrevious=n;const i=this.switchingTrack;i&&(this.bufferedTrack=i,this.switchingTrack=null,this.hls.trigger(_.AUDIO_TRACK_SWITCHED,Te({},i)))}this.fragBufferedComplete(n,s),this.media&&this.tick()}onError(e,t){var n;if(t.fatal){this.state=j.ERROR;return}switch(t.details){case O.FRAG_GAP:case O.FRAG_PARSING_ERROR:case O.FRAG_DECRYPT_ERROR:case O.FRAG_LOAD_ERROR:case O.FRAG_LOAD_TIMEOUT:case O.KEY_LOAD_ERROR:case O.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ee.AUDIO,t);break;case O.AUDIO_TRACK_LOAD_ERROR:case O.AUDIO_TRACK_LOAD_TIMEOUT:case O.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===j.WAITING_TRACK&&((n=t.context)==null?void 0:n.type)===ve.AUDIO_TRACK&&(this.state=j.IDLE);break;case O.BUFFER_ADD_CODEC_ERROR:case O.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case O.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case O.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==be.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==be.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===j.ENDED&&(this.state=j.IDLE);const n=this.mediaBuffer||this.media;n&&(this.afterBufferFlushed(n,t,ee.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const n="audio",{hls:s}=this,{remuxResult:i,chunkMeta:a}=e,o=this.getCurrentContext(a);if(!o){this.resetWhenMissingContext(a);return}const{frag:l,part:u,level:c}=o,{details:d}=c,{audio:f,text:h,id3:g,initSegment:p}=i;if(this.fragContextChanged(l)||!d){this.fragmentTracker.removeFragment(l);return}if(this.state=j.PARSING,this.switchingTrack&&f&&this.completeAudioSwitch(this.switchingTrack),p!=null&&p.tracks){const v=l.initSegment||l;if(this.unhandledEncryptionError(p,l))return;this._bufferInitSegment(c,p.tracks,v,a),s.trigger(_.FRAG_PARSING_INIT_SEGMENT,{frag:v,id:n,tracks:p.tracks})}if(f){const{startPTS:v,endPTS:m,startDTS:y,endDTS:S}=f;u&&(u.elementaryStreams[be.AUDIO]={startPTS:v,endPTS:m,startDTS:y,endDTS:S}),l.setElementaryStreamInfo(be.AUDIO,v,m,y,S),this.bufferFragmentData(f,l,u,a)}if(g!=null&&(t=g.samples)!=null&&t.length){const v=we({id:n,frag:l,details:d},g);s.trigger(_.FRAG_PARSING_METADATA,v)}if(h){const v=we({id:n,frag:l,details:d},h);s.trigger(_.FRAG_PARSING_USERDATA,v)}}_bufferInitSegment(e,t,n,s){if(this.state!==j.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const i=t.audio;i.id=ee.AUDIO;const a=e.audioCodec;this.log(`Init audio buffer, container:${i.container}, codecs[level/parsed]=[${a}/${i.codec}]`),a&&a.split(",").length===1&&(i.levelCodec=a),this.hls.trigger(_.BUFFER_CODECS,t);const o=i.initSegment;if(o!=null&&o.byteLength){const l={type:"audio",frag:n,part:null,chunkMeta:s,parent:n.type,data:o};this.hls.trigger(_.BUFFER_APPENDING,l)}this.tickImmediate()}loadFragment(e,t,n){const s=this.fragmentTracker.getState(e);if(this.switchingTrack||s===tt.NOT_LOADED||s===tt.PARTIAL){var i;if(!qe(e))this._loadInitSegment(e,t);else if((i=t.details)!=null&&i.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=j.WAITING_INIT_PTS;const a=this.mainDetails;a&&a.fragmentStart!==t.details.fragmentStart&&Dl(t.details,a)}else super.loadFragment(e,t,n)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:n,assocLang:s,characteristics:i,audioCodec:a,channels:o}=this.bufferedTrack;ss({name:t,lang:n,assocLang:s,characteristics:i,audioCodec:a,channels:o},e,qn)||(Rl(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(_.AUDIO_TRACK_SWITCHED,Te({},e))}}class up extends fr{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,n){const s=t==null?void 0:t.renditionReports;if(s){let i=-1;for(let a=0;a<s.length;a++){const o=s[a];let l;try{l=new self.URL(o.URI,t.url).href}catch(u){this.warn(`Could not construct new URL for Rendition Report: ${u}`),l=o.URI||""}if(l===e){i=a;break}else l===e.substring(0,l.length)&&(i=a)}if(i!==-1){const a=s[i],o=parseInt(a["LAST-MSN"])||t.lastPartSn;let l=parseInt(a["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const c=Math.min(t.age-t.partTarget,t.targetduration);l>=0&&c>t.partTarget&&(l+=1)}const u=n&&rm(n);return new nm(o,l>=0?l:void 0,u)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(n){this.warn(`Could not construct new URL with HLS Delivery Directives: ${n}`)}return e}playlistLoaded(e,t,n){const{details:s,stats:i}=t,a=self.performance.now(),o=i.loading.first?Math.max(0,a-i.loading.first):0;s.advancedDateTime=Date.now()-o;const l=this.hls.config.timelineOffset;if(l!==s.appliedTimelineOffset){const c=Math.max(l||0,0);s.appliedTimelineOffset=c,s.fragments.forEach(d=>{d.setStart(d.playlistOffset+c)})}if(s.live||n!=null&&n.live){const c="levelInfo"in t?t.levelInfo:t.track;if(s.reloaded(n),n&&s.fragments.length>0){zI(n,s,this);const y=s.playlistParsingError;if(y){this.warn(y);const S=this.hls;if(!S.config.ignorePlaylistParsingErrors){var u;const{networkDetails:E}=t;S.trigger(_.ERROR,{type:se.NETWORK_ERROR,details:O.LEVEL_PARSING_ERROR,fatal:!1,url:s.url,error:y,reason:y.message,level:t.level||void 0,parent:(u=s.fragments[0])==null?void 0:u.type,networkDetails:E,stats:i});return}s.playlistParsingError=null}}s.requestScheduled===-1&&(s.requestScheduled=i.loading.start);const d=this.hls.mainForwardBufferInfo,f=d?d.end-d.len:0,h=(s.edge-f)*1e3,g=NE(s,h);if(s.requestScheduled+g<a?s.requestScheduled=a:s.requestScheduled+=g,this.log(`live playlist ${e} ${s.advanced?"REFRESHED "+s.lastPartSn+"-"+s.lastPartIndex:s.updated?"UPDATED":"MISSED"}`),!this.canLoad||!s.live)return;let p,v,m;if(s.canBlockReload&&s.endSN&&s.advanced){const y=this.hls.config.lowLatencyMode,S=s.lastPartSn,E=s.endSN,T=s.lastPartIndex,A=T!==-1,x=S===E;A?x?(v=E+1,m=y?0:T):(v=S,m=y?T+1:s.maxPartIndex):v=E+1;const w=s.age,b=w+s.ageHeader;let I=Math.min(b-s.partTarget,s.targetduration*1.5);if(I>0){if(b>s.targetduration*3)this.log(`Playlist last advanced ${w.toFixed(2)}s ago. Omitting segment and part directives.`),v=void 0,m=void 0;else if(n!=null&&n.tuneInGoal&&b-s.partTarget>n.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${n.tuneInGoal} to: ${I} with playlist age: ${s.age}`),I=0;else{const M=Math.floor(I/s.targetduration);if(v+=M,m!==void 0){const K=Math.round(I%s.targetduration/s.partTarget);m+=K}this.log(`CDN Tune-in age: ${s.ageHeader}s last advanced ${w.toFixed(2)}s goal: ${I} skip sn ${M} to part ${m}`)}s.tuneInGoal=I}if(p=this.getDeliveryDirectives(s,t.deliveryDirectives,v,m),y||!x){s.requestScheduled=a,this.loadingPlaylist(c,p);return}}else(s.canBlockReload||s.canSkipUntil)&&(p=this.getDeliveryDirectives(s,t.deliveryDirectives,v,m));p&&v!==void 0&&s.canBlockReload&&(s.requestScheduled=i.loading.first+Math.max(g-o*2,g/2)),this.scheduleLoading(c,p,s)}else this.clearTimer()}scheduleLoading(e,t,n){const s=n||e.details;if(!s){this.loadingPlaylist(e,t);return}const i=self.performance.now(),a=s.requestScheduled;if(i>=a){this.loadingPlaylist(e,t);return}const o=a-i;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(o)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),o)}getDeliveryDirectives(e,t,n,s){let i=rm(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(n=t.msn,s=t.part,i=qo.No),new nm(n,s,i)}checkRetry(e){const t=e.details,n=Ll(e),s=e.errorAction,{action:i,retryCount:a=0,retryConfig:o}=s||{},l=!!s&&!!o&&(i===ct.RetryRequest||!s.resolved&&i===ct.SendAlternateToPenaltyBox);if(l){var u;if(a>=o.maxNumRetry)return!1;if(n&&(u=e.context)!=null&&u.deliveryDirectives)this.warn(`Retrying playlist loading ${a+1}/${o.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const c=Zg(o,a);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),c),this.warn(`Retrying playlist loading ${a+1}/${o.maxNumRetry} after "${t}" in ${c}ms`)}e.levelRetry=!0,s.resolved=!0}return l}}function l_(r,e){if(r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(!_a(r[t].attrs,e[t].attrs))return!1;return!0}function _a(r,e,t){const n=r["STABLE-RENDITION-ID"];return n&&!t?n===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(s=>r[s]!==e[s])}function $d(r,e){return e.label.toLowerCase()===r.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(r.lang||"").toLowerCase())}class rR extends up{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(_.MANIFEST_LOADING,this.onManifestLoading,this),e.on(_.MANIFEST_PARSED,this.onManifestParsed,this),e.on(_.LEVEL_LOADING,this.onLevelLoading,this),e.on(_.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(_.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(_.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(_.MANIFEST_LOADING,this.onManifestLoading,this),e.off(_.MANIFEST_PARSED,this.onManifestParsed,this),e.off(_.LEVEL_LOADING,this.onLevelLoading,this),e.off(_.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(_.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(_.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:n,groupId:s,details:i}=t,a=this.tracksInGroup[n];if(!a||a.groupId!==s){this.warn(`Audio track with id:${n} and group:${s} not found in active group ${a==null?void 0:a.groupId}`);return}const o=a.details;a.details=t.details,this.log(`Audio track ${n} "${a.name}" lang:${a.lang} group:${s} loaded [${i.startSN}-${i.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,o)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.audioGroups||null,s=this.groupIds;let i=this.currentTrack;if(!n||(s==null?void 0:s.length)!==(n==null?void 0:n.length)||n!=null&&n.some(o=>(s==null?void 0:s.indexOf(o))===-1)){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(f=>!n||n.indexOf(f.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(f=>f.default)&&(this.selectDefaultTrack=!1),o.forEach((f,h)=>{f.id=h});else if(!i&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const l=this.hls.config.audioPreference;if(!i&&l){const f=Mr(l,o,qn);if(f>-1)i=o[f];else{const h=Mr(l,this.tracks);i=this.tracks[h]}}let u=this.findTrackId(i);u===-1&&i&&(u=this.findTrackId(null));const c={audioTracks:o};this.log(`Updating audio tracks, ${o.length} track(s) found in group(s): ${n==null?void 0:n.join(",")}`),this.hls.trigger(_.AUDIO_TRACKS_UPDATED,c);const d=this.trackId;if(u!==-1&&d===-1)this.setAudioTrack(u);else if(o.length&&d===-1){var a;const f=new Error(`No audio track selected for current audio group-ID(s): ${(a=this.groupIds)==null?void 0:a.join(",")} track count: ${o.length}`);this.warn(f.message),this.hls.trigger(_.ERROR,{type:se.MEDIA_ERROR,details:O.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:f})}}}onError(e,t){t.fatal||!t.context||t.context.type===ve.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const n=this.allAudioTracks;if(this.selectDefaultTrack=!1,n.length){const s=this.currentTrack;if(s&&ss(e,s,qn))return s;const i=Mr(e,this.tracksInGroup,qn);if(i>-1){const a=this.tracksInGroup[i];return this.setAudioTrack(i),a}else if(s){let a=t.loadLevel;a===-1&&(a=t.firstAutoLevel);const o=gI(e,t.levels,n,a,qn);if(o===-1)return null;t.nextLoadLevel=o}if(e.channels||e.audioCodec){const a=Mr(e,n);if(a>-1)return n[a]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const n=this.currentTrack,s=t[e],i=s.details&&!s.details.live;if(e===this.trackId&&s===n&&i||(this.log(`Switching to audio-track ${e} "${s.name}" lang:${s.lang} group:${s.groupId} channels:${s.channels}`),this.trackId=e,this.currentTrack=s,this.hls.trigger(_.AUDIO_TRACK_SWITCHING,Te({},s)),i))return;const a=this.switchParams(s.url,n==null?void 0:n.details,s.details);this.loadPlaylist(a)}findTrackId(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const s=t[n];if(!(this.selectDefaultTrack&&!s.default)&&(!e||ss(e,s,qn)))return n}if(e){const{name:n,lang:s,assocLang:i,characteristics:a,audioCodec:o,channels:l}=e;for(let u=0;u<t.length;u++){const c=t[u];if(ss({name:n,lang:s,assocLang:i,characteristics:a,audioCodec:o,channels:l},c,qn))return u}for(let u=0;u<t.length;u++){const c=t[u];if(_a(e.attrs,c.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return u}for(let u=0;u<t.length;u++){const c=t[u];if(_a(e.attrs,c.attrs,["LANGUAGE"]))return u}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&Rl(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=e.id,s=e.groupId,i=this.getUrlWithDirectives(e.url,t),a=e.details,o=a==null?void 0:a.age;this.log(`Loading audio-track ${n} "${e.name}" lang:${e.lang} group:${s}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${i}`),this.hls.trigger(_.AUDIO_TRACK_LOADING,{url:i,id:n,groupId:s,deliveryDirectives:t||null,track:e})}}class nR{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,n){if(this.queues===null||this.tracks===null)return;const s=this.queues[t];s.push(e),s.length===1&&!n&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const n={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(n,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const n={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(n)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const n=(t=e[0])==null?void 0:t.label;(n==="async-blocker"||n==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const s=t[0];try{s.execute()}catch(i){var n;if(s.onError(i),this.queues===null||this.tracks===null)return;const a=(n=this.tracks[e])==null?void 0:n.buffer;a!=null&&a.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,n;return(t=this.queues)!=null&&t[e]||(n=this.tracks)!=null&&n[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const n=(t=this.tracks)==null?void 0:t[e],s=n==null?void 0:n.buffer;return s?`SourceBuffer${s.updating?" updating":""}${n.ended?" ended":""}${n.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(n=>n.label).join(", "))||""}}const Gm=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,u_="HlsJsTrackRemovedError";class sR extends Error{constructor(e){super(e),this.name=u_}}class iR extends fr{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=n=>{var s;this.hls&&((s=this.mediaSource)==null?void 0:s.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=n=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=n=>{const{media:s,mediaSource:i}=this;n&&this.log("Media source opened"),!(!s||!i)&&(i.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(_.MEDIA_ATTACHED,{media:s,mediaSource:i}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:n,_objectUrl:s}=this;n!==s&&this.error(`Media element src was set while attaching MediaSource (${s} > ${n})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=bw(On(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(_.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(_.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(_.MANIFEST_LOADING,this.onManifestLoading,this),e.on(_.MANIFEST_PARSED,this.onManifestParsed,this),e.on(_.BUFFER_RESET,this.onBufferReset,this),e.on(_.BUFFER_APPENDING,this.onBufferAppending,this),e.on(_.BUFFER_CODECS,this.onBufferCodecs,this),e.on(_.BUFFER_EOS,this.onBufferEos,this),e.on(_.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(_.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(_.FRAG_PARSED,this.onFragParsed,this),e.on(_.FRAG_CHANGED,this.onFragChanged,this),e.on(_.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(_.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(_.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(_.MANIFEST_LOADING,this.onManifestLoading,this),e.off(_.MANIFEST_PARSED,this.onManifestParsed,this),e.off(_.BUFFER_RESET,this.onBufferReset,this),e.off(_.BUFFER_APPENDING,this.onBufferAppending,this),e.off(_.BUFFER_CODECS,this.onBufferCodecs,this),e.off(_.BUFFER_EOS,this.onBufferEos,this),e.off(_.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(_.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(_.FRAG_PARSED,this.onFragParsed,this),e.off(_.FRAG_CHANGED,this.onFragChanged,this),e.off(_.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const n={};if(this.operationQueue){const i=this.isUpdating();i||this.operationQueue.removeBlockers();const a=this.isQueued();(i||a)&&this.warn(`Transfering MediaSource with${a?" operations in queue":""}${i?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const s=this.transferData;return!this.sourceBufferCount&&s&&s.mediaSource===t?we(n,s.tracks):this.sourceBuffers.forEach(i=>{const[a]=i;a&&(n[a]=we({},this.tracks[a]),this.removeBuffer(a)),i[0]=i[1]=null}),{media:e,mediaSource:t,tracks:n}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var n;let s=2;(t.audio&&!t.video||!t.altAudio)&&(s=1),this.bufferCodecEventsTotal=s,this.log(`${s} bufferCodec event(s) expected.`),(n=this.transferData)!=null&&n.mediaSource&&this.sourceBufferCount&&s&&this.bufferCreated()}onMediaAttaching(e,t){const n=this.media=t.media;this.transferData=this.overrides=void 0;const s=On(this.appendSource);if(s){const i=!!t.mediaSource;(i||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const a=this.mediaSource=t.mediaSource||new s;if(this.assignMediaSource(a),i)this._objectUrl=n.src,this.attachTransferred();else{const o=this._objectUrl=self.URL.createObjectURL(a);if(this.appendSource)try{n.removeAttribute("src");const l=self.ManagedMediaSource;n.disableRemotePlayback=n.disableRemotePlayback||l&&a instanceof l,Km(n),aR(n,o),n.load()}catch{n.src=o}else n.src=o}n.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,n;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(n=e.constructor)==null?void 0:n.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const n=this.tracks,s=t.tracks,i=s?Object.keys(s):null,a=i?i.length:0,o=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(s&&i&&a){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${Re(n,(l,u)=>l==="initSegment"?void 0:u)};
transfer tracks: ${Re(s,(l,u)=>l==="initSegment"?void 0:u)}}`),!iE(s,n)){t.mediaSource=null,t.tracks=void 0;const l=e.currentTime,u=this.details,c=Math.max(l,(u==null?void 0:u.fragments[0].start)||0);if(c-l>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${l} -> ${c}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(s)}"->"${Object.keys(n)}") start time: ${c} currentTime: ${l}`),this.onMediaDetaching(_.MEDIA_DETACHING,{}),this.onMediaAttaching(_.MEDIA_ATTACHING,t),e.currentTime=c;return}this.transferData=void 0,i.forEach(l=>{const u=l,c=s[u];if(c){const d=c.buffer;if(d){const f=this.fragmentTracker,h=c.id;if(f.hasFragments(h)||f.hasParts(h)){const v=ge.getBuffered(d);f.detectEvictedFragments(u,v,h,null,!0)}const g=Xu(u),p=[u,d];this.sourceBuffers[g]=p,d.updating&&this.operationQueue&&this.operationQueue.prependBlocker(u),this.trackSourceBuffer(u,c)}}}),o(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),o()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const n=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:s,mediaSource:i,_objectUrl:a}=this;if(i){if(this.log(`media source ${n?"transferring":"detaching"}`),n)this.sourceBuffers.forEach(([o])=>{o&&this.removeBuffer(o)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const o=i.readyState==="open";try{const l=i.sourceBuffers;for(let u=l.length;u--;)o&&l[u].abort(),i.removeSourceBuffer(l[u]);o&&i.endOfStream()}catch(l){this.warn(`onMediaDetaching: ${l.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}i.removeEventListener("sourceopen",this._onMediaSourceOpen),i.removeEventListener("sourceended",this._onMediaSourceEnded),i.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(i.removeEventListener("startstreaming",this._onStartStreaming),i.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}s&&(s.removeEventListener("emptied",this._onMediaEmptied),n||(a&&self.URL.revokeObjectURL(a),this.mediaSrc===a?(s.removeAttribute("src"),this.appendSource&&Km(s),s.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(_.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const n=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),n)try{var s;(s=this.mediaSource)!=null&&s.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(n)}catch(i){this.warn(`onBufferReset ${e}`,i)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[Xu(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new nR(this.tracks)}onBufferCodecs(e,t){var n;const s=this.tracks,i=Object.keys(t);this.log(`BUFFER_CODECS: "${i}" (current SB count ${this.sourceBufferCount})`);const a="audiovideo"in t&&(s.audio||s.video)||s.audiovideo&&("audio"in t||"video"in t),o=!a&&this.sourceBufferCount&&this.media&&i.some(l=>!s[l]);if(a||o){this.warn(`Unsupported transition between "${Object.keys(s)}" and "${i}" SourceBuffers`);return}i.forEach(l=>{var u,c;const d=t[l],{id:f,codec:h,levelCodec:g,container:p,metadata:v,supplemental:m}=d;let y=s[l];const S=(u=this.transferData)==null||(u=u.tracks)==null?void 0:u[l],E=S!=null&&S.buffer?S:y,T=(E==null?void 0:E.pendingCodec)||(E==null?void 0:E.codec),A=E==null?void 0:E.levelCodec;y||(y=s[l]={buffer:void 0,listeners:[],codec:h,supplemental:m,container:p,levelCodec:g,metadata:v,id:f});const x=zo(T,A),w=x==null?void 0:x.replace(Gm,"$1");let b=zo(h,g);const I=(c=b)==null?void 0:c.replace(Gm,"$1");b&&x&&w!==I&&(l.slice(0,5)==="audio"&&(b=Il(b,this.appendSource)),this.log(`switching codec ${T} to ${b}`),b!==(y.pendingCodec||y.codec)&&(y.pendingCodec=b),y.container=p,this.appendChangeType(l,p,b))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((n=t.audio)==null?void 0:n.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const n=this.tracks[t];return e[t]={id:n.id,container:n.container,codec:n.codec,levelCodec:n.levelCodec},e},{})}appendChangeType(e,t,n){const s=`${t};codecs=${n}`,i={label:`change-type=${s}`,execute:()=>{const a=this.tracks[e];if(a){const o=a.buffer;o!=null&&o.changeType&&(this.log(`changing ${e} sourceBuffer type to ${s}`),o.changeType(s),a.codec=n,a.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:a=>{this.warn(`Failed to change ${e} SourceBuffer type`,a)}};this.append(i,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const n=e.start,s=n+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(n,ee.MAIN))==null?void 0:t.gap)===!0)return;const a={label:"block-audio",execute:()=>{var o;const l=this.tracks.video;(this.lastVideoAppendEnd>s||l!=null&&l.buffer&&ge.isBuffered(l.buffer,s)||((o=this.fragmentTracker.getAppendedFrag(s,ee.MAIN))==null?void 0:o.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn("Error executing block-audio operation",o)}};this.blockedAudioAppend={op:a,frag:e},this.append(a,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:n}=this,{data:s,type:i,parent:a,frag:o,part:l,chunkMeta:u,offset:c}=t,d=u.buffering[i],{sn:f,cc:h}=o,g=self.performance.now();d.start=g;const p=o.stats.buffering,v=l?l.stats.buffering:null;p.start===0&&(p.start=g),v&&v.start===0&&(v.start=g);const m=n.audio;let y=!1;i==="audio"&&(m==null?void 0:m.container)==="audio/mpeg"&&(y=!this.lastMpegAudioChunk||u.id===1||this.lastMpegAudioChunk.sn!==u.sn,this.lastMpegAudioChunk=u);const S=n.video,E=S==null?void 0:S.buffer;if(E&&f!=="initSegment"){const x=l||o,w=this.blockedAudioAppend;if(i==="audio"&&a!=="main"&&!this.blockedAudioAppend&&!(S.ending||S.ended)){const I=x.start+x.duration*.05,M=E.buffered,K=this.currentOp("video");!M.length&&!K?this.blockAudio(x):!K&&!ge.isBuffered(E,I)&&this.lastVideoAppendEnd<I&&this.blockAudio(x)}else if(i==="video"){const b=x.end;if(w){const I=w.frag.start;(b>I||b<this.lastVideoAppendEnd||ge.isBuffered(E,I))&&this.unblockAudio()}this.lastVideoAppendEnd=b}}const T=(l||o).start,A={label:`append-${i}`,execute:()=>{var x;d.executeStart=self.performance.now();const w=(x=this.tracks[i])==null?void 0:x.buffer;w&&(y?this.updateTimestampOffset(w,T,.1,i,f,h):c!==void 0&&J(c)&&this.updateTimestampOffset(w,c,1e-6,i,f,h)),this.appendExecutor(s,i)},onStart:()=>{},onComplete:()=>{const x=self.performance.now();d.executeEnd=d.end=x,p.first===0&&(p.first=x),v&&v.first===0&&(v.first=x);const w={};this.sourceBuffers.forEach(([b,I])=>{b&&(w[b]=ge.getBuffered(I))}),this.appendErrors[i]=0,i==="audio"||i==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(_.BUFFER_APPENDED,{type:i,frag:o,part:l,chunkMeta:u,parent:o.type,timeRanges:w})},onError:x=>{var w;const b={type:se.MEDIA_ERROR,parent:o.type,details:O.BUFFER_APPEND_ERROR,sourceBufferName:i,frag:o,part:l,chunkMeta:u,error:x,err:x,fatal:!1},I=(w=this.media)==null?void 0:w.error;if(x.code===DOMException.QUOTA_EXCEEDED_ERR||x.name=="QuotaExceededError"||"quota"in x)b.details=O.BUFFER_FULL_ERROR;else if(x.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!I)b.errorAction=ti(!0);else if(x.name===u_&&this.sourceBufferCount===0)b.errorAction=ti(!0);else{const M=++this.appendErrors[i];this.warn(`Failed ${M}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${i}" sourceBuffer (${I||"no media error"})`),(M>=this.hls.config.appendErrorMaxRetry||I)&&(b.fatal=!0)}this.hls.trigger(_.ERROR,b)}};this.log(`queuing "${i}" append sn: ${f}${l?" p: "+l.index:""} of ${o.type===ee.MAIN?"level":"track"} ${o.level} cc: ${h}`),this.append(A,i,this.isPending(this.tracks[i]))}getFlushOp(e,t,n){return this.log(`queuing "${e}" remove ${t}-${n}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,n)},onStart:()=>{},onComplete:()=>{this.hls.trigger(_.BUFFER_FLUSHED,{type:e})},onError:s=>{this.warn(`Failed to remove ${t}-${n} from "${e}" SourceBuffer`,s)}}}onBufferFlushing(e,t){const{type:n,startOffset:s,endOffset:i}=t;n?this.append(this.getFlushOp(n,s,i),n):this.sourceBuffers.forEach(([a])=>{a&&this.append(this.getFlushOp(a,s,i),a)})}onFragParsed(e,t){const{frag:n,part:s}=t,i=[],a=s?s.elementaryStreams:n.elementaryStreams;a[be.AUDIOVIDEO]?i.push("audiovideo"):(a[be.AUDIO]&&i.push("audio"),a[be.VIDEO]&&i.push("video"));const o=()=>{const l=self.performance.now();n.stats.buffering.end=l,s&&(s.stats.buffering.end=l);const u=s?s.stats:n.stats;this.hls.trigger(_.FRAG_BUFFERED,{frag:n,part:s,stats:u,id:n.type})};i.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${n.type} level: ${n.level} sn: ${n.sn}`),this.blockBuffers(o,i).catch(l=>{this.warn(`Fragment buffered callback ${l}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var n;this.sourceBuffers.forEach(([a])=>{if(a){const o=this.tracks[a];(!t.type||t.type===a)&&(o.ending=!0,o.ended||(o.ended=!0,this.log(`${a} buffer reached EOS`)))}});const s=((n=this.overrides)==null?void 0:n.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([a])=>{var o;return a&&!((o=this.tracks[a])!=null&&o.ended)})?s?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:a}=this;if(!a||a.readyState!=="open"){a&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${a.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),a.endOfStream(),this.hls.trigger(_.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(_.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===O.BUFFER_APPEND_ERROR&&t.frag){var n;const s=(n=t.errorAction)==null?void 0:n.nextAutoLevel;J(s)&&s!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:n}=this;if(!n||t===null||!this.sourceBufferCount)return;const s=e.config,i=n.currentTime,a=t.levelTargetDuration,o=t.live&&s.liveBackBufferLength!==null?s.liveBackBufferLength:s.backBufferLength;if(J(o)&&o>=0){const u=Math.max(o,a),c=Math.floor(i/a)*a-u;this.flushBackBuffer(i,a,c)}const l=s.frontBufferFlushThreshold;if(J(l)&&l>0){const u=Math.max(s.maxBufferLength,l),c=Math.max(u,a),d=Math.floor(i/a)*a+c;this.flushFrontBuffer(i,a,d)}}flushBackBuffer(e,t,n){this.sourceBuffers.forEach(([s,i])=>{if(i){const o=ge.getBuffered(i);if(o.length>0&&n>o.start(0)){var a;this.hls.trigger(_.BACK_BUFFER_REACHED,{bufferEnd:n});const l=this.tracks[s];if((a=this.details)!=null&&a.live)this.hls.trigger(_.LIVE_BACK_BUFFER_REACHED,{bufferEnd:n});else if(l!=null&&l.ended){this.log(`Cannot flush ${s} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(_.BUFFER_FLUSHING,{startOffset:0,endOffset:n,type:s})}}})}flushFrontBuffer(e,t,n){this.sourceBuffers.forEach(([s,i])=>{if(i){const a=ge.getBuffered(i),o=a.length;if(o<2)return;const l=a.start(o-1),u=a.end(o-1);if(n>l||e>=l&&e<=u)return;this.hls.trigger(_.BUFFER_FLUSHING,{startOffset:l,endOffset:1/0,type:s})}})}getDurationAndRange(){var e;const{details:t,mediaSource:n}=this;if(!t||!this.media||(n==null?void 0:n.readyState)!=="open")return null;const s=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&n.setLiveSeekableRange){const u=Math.max(0,t.fragmentStart),c=Math.max(u,s);return{duration:1/0,start:u,end:c}}return{duration:1/0}}const i=(e=this.overrides)==null?void 0:e.duration;if(i)return J(i)?{duration:i}:null;const a=this.media.duration,o=J(n.duration)?n.duration:0;return s>o&&s>a||!J(a)?{duration:s}:null}updateMediaSource({duration:e,start:t,end:n}){const s=this.mediaSource;!this.media||!s||s.readyState!=="open"||(s.duration!==e&&(J(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),s.duration=e),t!==void 0&&n!==void 0&&(this.log(`MediaSource duration is set to ${s.duration}. Setting seekable range to ${t}-${n}.`),s.setLiveSeekableRange(t,n)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:n}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${Re(n)}`),this.tracksReady){var s;const i=(s=this.transferData)==null?void 0:s.tracks;i&&Object.keys(i).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,n])=>{if(t){const s=this.tracks[t];e[t]={buffer:n,container:s.container,codec:s.codec,supplemental:s.supplemental,levelCodec:s.levelCodec,id:s.id,metadata:s.metadata}}}),this.hls.trigger(_.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(_.ERROR,{type:se.MEDIA_ERROR,details:O.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:n}=this;if(!n)throw new Error("createSourceBuffers called when mediaSource was null");for(const i in e){const a=i,o=e[a];if(this.isPending(o)){const l=this.getTrackCodec(o,a),u=`${o.container};codecs=${l}`;o.codec=l,this.log(`creating sourceBuffer(${u})${this.currentOp(a)?" Queued":""} ${Re(o)}`);try{const c=n.addSourceBuffer(u),d=Xu(a),f=[a,c];t[d]=f,o.buffer=c}catch(c){var s;this.error(`error while trying to add sourceBuffer: ${c.message}`),this.shiftAndExecuteNext(a),(s=this.operationQueue)==null||s.removeBlockers(),delete this.tracks[a],this.hls.trigger(_.ERROR,{type:se.MEDIA_ERROR,details:O.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:c,sourceBufferName:a,mimeType:u,parent:o.id});return}this.trackSourceBuffer(a,o)}}this.bufferCreated()}getTrackCodec(e,t){const n=e.supplemental;let s=e.codec;n&&(t==="video"||t==="audiovideo")&&pa(n,"video")&&(s=Yw(s,n));const i=zo(s,e.levelCodec);return i?t.slice(0,5)==="audio"?Il(i,this.appendSource):i:""}trackSourceBuffer(e,t){const n=t.buffer;if(!n)return;const s=this.getTrackCodec(t,e);this.tracks[e]={buffer:n,codec:s,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(i,a)=>{const o=a.removedRanges;o!=null&&o.length&&this.hls.trigger(_.BUFFER_FLUSHED,{type:i})})}get mediaSrc(){var e,t;const n=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return n==null?void 0:n.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const n=this.currentOp(e);n&&(n.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var n;const s=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(n=this.mediaSource)==null?void 0:n.readyState}`);this.error(`${s}`,t),this.hls.trigger(_.ERROR,{type:se.MEDIA_ERROR,details:O.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:s,fatal:!1});const i=this.currentOp(e);i&&i.onError(s)}updateTimestampOffset(e,t,n,s,i,a){const o=t-e.timestampOffset;Math.abs(o)>=n&&(this.log(`Updating ${s} SourceBuffer timestampOffset to ${t} (sn: ${i} cc: ${a})`),e.timestampOffset=t)}removeExecutor(e,t,n){const{media:s,mediaSource:i}=this,a=this.tracks[e],o=a==null?void 0:a.buffer;if(!s||!i||!o){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const l=J(s.duration)?s.duration:1/0,u=J(i.duration)?i.duration:1/0,c=Math.max(0,t),d=Math.min(n,l,u);d>c&&(!a.ending||a.ended)?(a.ended=!1,this.log(`Removing [${c},${d}] from the ${e} SourceBuffer`),o.remove(c,d)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const n=this.tracks[t],s=n==null?void 0:n.buffer;if(!s)throw new sR(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);n.ending=!1,n.ended=!1,s.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:n}=this,s=t.map(a=>this.appendBlocker(a));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(s).then(a=>{n===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var n;const s=(n=this.tracks[t])==null?void 0:n.buffer;!s||s.updating||this.shiftAndExecuteNext(t)})}append(e,t,n){this.operationQueue&&this.operationQueue.append(e,t,n)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,n){const s=this.tracks[e];if(!s)return;const i=s.buffer;if(!i)return;const a=n.bind(this,e);s.listeners.push({event:t,listener:a}),i.addEventListener(t,a)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const n=t.buffer;n&&(t.listeners.forEach(s=>{n.removeEventListener(s.event,s.listener)}),t.listeners.length=0)}}function Km(r){const e=r.querySelectorAll("source");[].slice.call(e).forEach(t=>{r.removeChild(t)})}function aR(r,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,r.appendChild(t)}function Xu(r){return r==="audio"?1:0}class cp{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(_.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(_.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(_.MANIFEST_PARSED,this.onManifestParsed,this),e.on(_.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(_.BUFFER_CODECS,this.onBufferCodecs,this),e.on(_.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(_.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(_.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(_.MANIFEST_PARSED,this.onManifestParsed,this),e.off(_.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(_.BUFFER_CODECS,this.onBufferCodecs,this),e.off(_.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const n=this.hls.levels[t.droppedLevel];this.isLevelAllowed(n)&&this.restrictedLevels.push({bitrate:n.bitrate,height:n.height,width:n.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const n=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,n.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&J(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,n=this.getMaxLevel(e.length-1);n!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${n}: ${e[n].height}p@${e[n].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=n,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const n=t.filter((s,i)=>this.isLevelAllowed(s)&&i<=e);return this.clientRect=null,cp.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const n=e.getBoundingClientRect();t.width=n.width,t.height=n.height,!t.width&&!t.height&&(t.width=n.right-n.left||e.width||0,t.height=n.bottom-n.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(n=>e.bitrate===n.bitrate&&e.width===n.width&&e.height===n.height)}static getMaxLevelByMediaSize(e,t,n){if(!(e!=null&&e.length))return-1;const s=(o,l)=>l?o.width!==l.width||o.height!==l.height:!0;let i=e.length-1;const a=Math.max(t,n);for(let o=0;o<e.length;o+=1){const l=e[o];if((l.width>=a||l.height>=a)&&s(l,e[o+1])){i=o;break}}return i}}const oR={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Pt=oR,lR={HLS:"h"},uR=lR;class Ur{constructor(e,t){Array.isArray(e)&&(e=e.map(n=>n instanceof Ur?n:new Ur(n))),this.value=e,this.params=t}}const cR="Dict";function dR(r){return Array.isArray(r)?JSON.stringify(r):r instanceof Map?"Map{}":r instanceof Set?"Set{}":typeof r=="object"?JSON.stringify(r):String(r)}function fR(r,e,t,n){return new Error(`failed to ${r} "${dR(e)}" as ${t}`,{cause:n})}function Br(r,e,t){return fR("serialize",r,e,t)}class c_{constructor(e){this.description=e}}const Hm="Bare Item",hR="Boolean";function gR(r){if(typeof r!="boolean")throw Br(r,hR);return r?"?1":"?0"}function pR(r){return btoa(String.fromCharCode(...r))}const mR="Byte Sequence";function vR(r){if(ArrayBuffer.isView(r)===!1)throw Br(r,mR);return`:${pR(r)}:`}const yR="Integer";function SR(r){return r<-999999999999999||999999999999999<r}function d_(r){if(SR(r))throw Br(r,yR);return r.toString()}function ER(r){return`@${d_(r.getTime()/1e3)}`}function f_(r,e){if(r<0)return-f_(-r,e);const t=Math.pow(10,e);if(Math.abs(r*t%1-.5)<Number.EPSILON){const s=Math.floor(r*t);return(s%2===0?s:s+1)/t}else return Math.round(r*t)/t}const _R="Decimal";function TR(r){const e=f_(r,3);if(Math.floor(Math.abs(e)).toString().length>12)throw Br(r,_R);const t=e.toString();return t.includes(".")?t:`${t}.0`}const xR="String",AR=/[\x00-\x1f\x7f]+/;function wR(r){if(AR.test(r))throw Br(r,xR);return`"${r.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function IR(r){return r.description||r.toString().slice(7,-1)}const bR="Token";function Vm(r){const e=IR(r);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw Br(e,bR);return e}function Ud(r){switch(typeof r){case"number":if(!J(r))throw Br(r,Hm);return Number.isInteger(r)?d_(r):TR(r);case"string":return wR(r);case"symbol":return Vm(r);case"boolean":return gR(r);case"object":if(r instanceof Date)return ER(r);if(r instanceof Uint8Array)return vR(r);if(r instanceof c_)return Vm(r);default:throw Br(r,Hm)}}const RR="Key";function Bd(r){if(/^[a-z*][a-z0-9\-_.*]*$/.test(r)===!1)throw Br(r,RR);return r}function dp(r){return r==null?"":Object.entries(r).map(([e,t])=>t===!0?`;${Bd(e)}`:`;${Bd(e)}=${Ud(t)}`).join("")}function h_(r){return r instanceof Ur?`${Ud(r.value)}${dp(r.params)}`:Ud(r)}function LR(r){return`(${r.value.map(h_).join(" ")})${dp(r.params)}`}function kR(r,e={whitespace:!0}){if(typeof r!="object"||r==null)throw Br(r,cR);const t=r instanceof Map?r.entries():Object.entries(r),n=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([s,i])=>{i instanceof Ur||(i=new Ur(i));let a=Bd(s);return i.value===!0?a+=dp(i.params):(a+="=",Array.isArray(i.value)?a+=LR(i):a+=h_(i)),a}).join(`,${n}`)}function g_(r,e){return kR(r,e)}const Lr="CMCD-Object",He="CMCD-Request",Gn="CMCD-Session",fn="CMCD-Status",CR={br:Lr,ab:Lr,d:Lr,ot:Lr,tb:Lr,tpb:Lr,lb:Lr,tab:Lr,lab:Lr,url:Lr,pb:He,bl:He,tbl:He,dl:He,ltc:He,mtp:He,nor:He,nrr:He,rc:He,sn:He,sta:He,su:He,ttfb:He,ttfbb:He,ttlb:He,cmsdd:He,cmsds:He,smrt:He,df:He,cs:He,ts:He,cid:Gn,pr:Gn,sf:Gn,sid:Gn,st:Gn,v:Gn,msd:Gn,bs:fn,bsd:fn,cdn:fn,rtp:fn,bg:fn,pt:fn,ec:fn,e:fn},PR={REQUEST:He};function DR(r){return Object.keys(r).reduce((e,t)=>{var n;return(n=r[t])===null||n===void 0||n.forEach(s=>e[s]=t),e},{})}function OR(r,e){const t={};if(!r)return t;const n=Object.keys(r),s=e?DR(e):{};return n.reduce((i,a)=>{var o;const l=CR[a]||s[a]||PR.REQUEST,u=(o=i[l])!==null&&o!==void 0?o:i[l]={};return u[a]=r[a],i},t)}function MR(r){return["ot","sf","st","e","sta"].includes(r)}function NR(r){return typeof r=="number"?J(r):r!=null&&r!==""&&r!==!1}const p_="event";function FR(r,e){const t=new URL(r),n=new URL(e);if(t.origin!==n.origin)return r;const s=t.pathname.split("/").slice(1),i=n.pathname.split("/").slice(1,-1);for(;s[0]===i[0];)s.shift(),i.shift();for(;i.length;)i.shift(),s.unshift("..");return s.join("/")+t.search+t.hash}const Xo=r=>Math.round(r),jd=(r,e)=>Array.isArray(r)?r.map(t=>jd(t,e)):r instanceof Ur&&typeof r.value=="string"?new Ur(jd(r.value,e),r.params):(e.baseUrl&&(r=FR(r,e.baseUrl)),e.version===1?encodeURIComponent(r):r),yo=r=>Xo(r/100)*100,$R=(r,e)=>{let t=r;return e.version>=2&&(r instanceof Ur&&typeof r.value=="string"?t=new Ur([r]):typeof r=="string"&&(t=[r])),jd(t,e)},UR={br:Xo,d:Xo,bl:yo,dl:yo,mtp:yo,nor:$R,rtp:yo,tb:Xo},m_="request",v_="response",fp=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],BR=["e"],jR=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function su(r){return jR.test(r)}function GR(r){return fp.includes(r)||BR.includes(r)||su(r)}const y_=["d","dl","nor","ot","rtp","su"];function KR(r){return fp.includes(r)||y_.includes(r)||su(r)}const HR=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function VR(r){return fp.includes(r)||y_.includes(r)||HR.includes(r)||su(r)}const WR=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function zR(r){return WR.includes(r)||su(r)}const qR={[v_]:VR,[p_]:GR,[m_]:KR};function S_(r,e={}){const t={};if(r==null||typeof r!="object")return t;const n=e.version||r.v||1,s=e.reportingMode||m_,i=n===1?zR:qR[s];let a=Object.keys(r).filter(i);const o=e.filter;typeof o=="function"&&(a=a.filter(o));const l=s===v_||s===p_;l&&!a.includes("ts")&&a.push("ts"),n>1&&!a.includes("v")&&a.push("v");const u=we({},UR,e.formatters),c={version:n,reportingMode:s,baseUrl:e.baseUrl};return a.sort().forEach(d=>{let f=r[d];const h=u[d];if(typeof h=="function"&&(f=h(f,c)),d==="v"){if(n===1)return;f=n}d=="pr"&&f===1||(l&&d==="ts"&&!J(f)&&(f=Date.now()),NR(f)&&(MR(d)&&typeof f=="string"&&(f=new c_(f)),t[d]=f))}),t}function YR(r,e={}){const t={};if(!r)return t;const n=S_(r,e),s=OR(n,e==null?void 0:e.customHeaderMap);return Object.entries(s).reduce((i,[a,o])=>{const l=g_(o,{whitespace:!1});return l&&(i[a]=l),i},t)}function ZR(r,e,t){return we(r,YR(e,t))}const QR="CMCD";function XR(r,e={}){return r?g_(S_(r,e),{whitespace:!1}):""}function JR(r,e={}){if(!r)return"";const t=XR(r,e);return encodeURIComponent(t)}function eL(r,e={}){if(!r)return"";const t=JR(r,e);return`${QR}=${t}`}const Wm=/CMCD=[^&#]+/;function tL(r,e,t){const n=eL(e,t);if(!n)return r;if(Wm.test(r))return r.replace(Wm,n);const s=r.includes("?")?"&":"?";return`${r}${s}${n}`}class rL{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=s=>{try{this.apply(s,{ot:Pt.MANIFEST,su:!this.initialized})}catch(i){this.hls.logger.warn("Could not generate manifest CMCD data.",i)}},this.applyFragmentData=s=>{try{const{frag:i,part:a}=s,o=this.hls.levels[i.level],l=this.getObjectType(i),u={d:(a||i).duration*1e3,ot:l};(l===Pt.VIDEO||l===Pt.AUDIO||l==Pt.MUXED)&&(u.br=o.bitrate/1e3,u.tb=this.getTopBandwidth(l)/1e3,u.bl=this.getBufferLength(l));const c=a?this.getNextPart(a):this.getNextFrag(i);c!=null&&c.url&&c.url!==i.url&&(u.nor=c.url),this.apply(s,u)}catch(i){this.hls.logger.warn("Could not generate segment CMCD data.",i)}},this.hls=e;const t=this.config=e.config,{cmcd:n}=t;n!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=n.sessionId||e.sessionId,this.cid=n.contentId,this.useHeaders=n.useHeaders===!0,this.includeKeys=n.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(_.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(_.MEDIA_DETACHED,this.onMediaDetached,this),e.on(_.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(_.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(_.MEDIA_DETACHED,this.onMediaDetached,this),e.off(_.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var n,s;this.audioBuffer=(n=t.tracks.audio)==null?void 0:n.buffer,this.videoBuffer=(s=t.tracks.video)==null?void 0:s.buffer}createData(){var e;return{v:1,sf:uR.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){we(t,this.createData());const n=t.ot===Pt.INIT||t.ot===Pt.VIDEO||t.ot===Pt.MUXED;this.starved&&n&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:s}=this;s&&(t=Object.keys(t).reduce((a,o)=>(s.includes(o)&&(a[o]=t[o]),a),{}));const i={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),ZR(e.headers,t,i)):e.url=tL(e.url,t,i)}getNextFrag(e){var t;const n=(t=this.hls.levels[e.level])==null?void 0:t.details;if(n){const s=e.sn-n.startSN;return n.fragments[s+1]}}getNextPart(e){var t;const{index:n,fragment:s}=e,i=(t=this.hls.levels[s.level])==null||(t=t.details)==null?void 0:t.partList;if(i){const{sn:a}=s;for(let o=i.length-1;o>=0;o--){const l=i[o];if(l.index===n&&l.fragment.sn===a)return i[o+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return Pt.TIMED_TEXT;if(e.sn==="initSegment")return Pt.INIT;if(t==="audio")return Pt.AUDIO;if(t==="main")return this.hls.audioTracks.length?Pt.VIDEO:Pt.MUXED}getTopBandwidth(e){let t=0,n;const s=this.hls;if(e===Pt.AUDIO)n=s.audioTracks;else{const i=s.maxAutoLevel,a=i>-1?i+1:s.levels.length;n=s.levels.slice(0,a)}return n.forEach(i=>{i.bitrate>t&&(t=i.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,n=e===Pt.AUDIO?this.audioBuffer:this.videoBuffer;return!n||!t?NaN:ge.bufferInfo(n,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,n=e||this.config.loader;return class{constructor(i){this.loader=void 0,this.loader=new n(i)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(i,a,o){t(i),this.loader.load(i,a,o)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,n=e||this.config.loader;return class{constructor(i){this.loader=void 0,this.loader=new n(i)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(i,a,o){t(i),this.loader.load(i,a,o)}}}}const nL=3e5;class sL extends fr{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(_.MANIFEST_LOADING,this.onManifestLoading,this),e.on(_.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(_.MANIFEST_PARSED,this.onManifestParsed,this),e.on(_.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(_.MANIFEST_LOADING,this.onManifestLoading,this),e.off(_.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(_.MANIFEST_PARSED,this.onManifestParsed,this),e.off(_.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(n=>n!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:n}=t;n!==null&&(this.pathwayId=n.pathwayId,this.uri=n.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:n}=t;if((n==null?void 0:n.action)===ct.SendAlternateToPenaltyBox&&n.flags===Wt.MoveAllAlternatesMatchingHost){const s=this.levels;let i=this._pathwayPriority,a=this.pathwayId;if(t.context){const{groupId:o,pathwayId:l,type:u}=t.context;o&&s?a=this.getPathwayForGroupId(o,u,a):l&&(a=l)}a in this.penalizedPathways||(this.penalizedPathways[a]=performance.now()),!i&&s&&(i=this.pathways()),i&&i.length>1&&(this.updatePathwayPriority(i),n.resolved=this.pathwayId!==a),t.details===O.BUFFER_APPEND_ERROR&&!t.fatal?n.resolved=!0:n.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${a} levels: ${s&&s.length} priorities: ${Re(i)} penalized: ${Re(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const n=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${n}"`),t=this.getLevelsForPathway(n),this.pathwayId=n}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const n=this.penalizedPathways,s=performance.now();Object.keys(n).forEach(i=>{s-n[i]>nL&&delete n[i]});for(let i=0;i<e.length;i++){const a=e[i];if(a in n)continue;if(a===this.pathwayId)return;const o=this.hls.nextLoadLevel,l=this.hls.levels[o];if(t=this.getLevelsForPathway(a),t.length>0){this.log(`Setting Pathway to "${a}"`),this.pathwayId=a,UE(t),this.hls.trigger(_.LEVELS_UPDATED,{levels:t});const u=this.hls.levels[o];l&&u&&this.levels&&(u.attrs["STABLE-VARIANT-ID"]!==l.attrs["STABLE-VARIANT-ID"]&&u.bitrate!==l.bitrate&&this.log(`Unstable Pathways change from bitrate ${l.bitrate} to ${u.bitrate}`),this.hls.nextLoadLevel=o);break}}}getPathwayForGroupId(e,t,n){const s=this.getLevelsForPathway(n).concat(this.levels||[]);for(let i=0;i<s.length;i++)if(t===ve.AUDIO_TRACK&&s[i].hasAudioGroup(e)||t===ve.SUBTITLE_TRACK&&s[i].hasSubtitleGroup(e))return s[i].pathwayId;return n}clonePathways(e){const t=this.levels;if(!t)return;const n={},s={};e.forEach(i=>{const{ID:a,"BASE-ID":o,"URI-REPLACEMENT":l}=i;if(t.some(c=>c.pathwayId===a))return;const u=this.getLevelsForPathway(o).map(c=>{const d=new $e(c.attrs);d["PATHWAY-ID"]=a;const f=d.AUDIO&&`${d.AUDIO}_clone_${a}`,h=d.SUBTITLES&&`${d.SUBTITLES}_clone_${a}`;f&&(n[d.AUDIO]=f,d.AUDIO=f),h&&(s[d.SUBTITLES]=h,d.SUBTITLES=h);const g=E_(c.uri,d["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",l),p=new va({attrs:d,audioCodec:c.audioCodec,bitrate:c.bitrate,height:c.height,name:c.name,url:g,videoCodec:c.videoCodec,width:c.width});if(c.audioGroups)for(let v=1;v<c.audioGroups.length;v++)p.addGroupId("audio",`${c.audioGroups[v]}_clone_${a}`);if(c.subtitleGroups)for(let v=1;v<c.subtitleGroups.length;v++)p.addGroupId("text",`${c.subtitleGroups[v]}_clone_${a}`);return p});t.push(...u),zm(this.audioTracks,n,l,a),zm(this.subtitleTracks,s,l,a)})}loadSteeringManifest(e){const t=this.hls.config,n=t.loader;this.loader&&this.loader.destroy(),this.loader=new n(t);let s;try{s=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(s.protocol!=="data:"){const c=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;s.searchParams.set("_HLS_pathway",this.pathwayId),s.searchParams.set("_HLS_throughput",""+c)}const i={responseType:"json",url:s.href},a=t.steeringManifestLoadPolicy.default,o=a.errorRetry||a.timeoutRetry||{},l={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},u={onSuccess:(c,d,f,h)=>{this.log(`Loaded steering manifest: "${s}"`);const g=c.data;if((g==null?void 0:g.VERSION)!==1){this.log(`Steering VERSION ${g.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=g.TTL;const{"RELOAD-URI":p,"PATHWAY-CLONES":v,"PATHWAY-PRIORITY":m}=g;if(p)try{this.uri=new self.URL(p,s).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${p}`);return}this.scheduleRefresh(this.uri||f.url),v&&this.clonePathways(v);const y={steeringManifest:g,url:s.toString()};this.hls.trigger(_.STEERING_MANIFEST_LOADED,y),m&&this.updatePathwayPriority(m)},onError:(c,d,f,h)=>{if(this.log(`Error loading steering manifest: ${c.code} ${c.text} (${d.url})`),this.stopLoad(),c.code===410){this.enabled=!1,this.log(`Steering manifest ${d.url} no longer available`);return}let g=this.timeToLoad*1e3;if(c.code===429){const p=this.loader;if(typeof(p==null?void 0:p.getResponseHeader)=="function"){const v=p.getResponseHeader("Retry-After");v&&(g=parseFloat(v)*1e3)}this.log(`Steering manifest ${d.url} rate limited`);return}this.scheduleRefresh(this.uri||d.url,g)},onTimeout:(c,d,f)=>{this.log(`Timeout loading steering manifest (${d.url})`),this.scheduleRefresh(this.uri||d.url)}};this.log(`Requesting steering manifest: ${s}`),this.loader.load(i,l,u)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var n;const s=(n=this.hls)==null?void 0:n.media;if(s&&!s.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function zm(r,e,t,n){r&&Object.keys(e).forEach(s=>{const i=r.filter(a=>a.groupId===s).map(a=>{const o=we({},a);return o.details=void 0,o.attrs=new $e(o.attrs),o.url=o.attrs.URI=E_(a.url,a.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),o.groupId=o.attrs["GROUP-ID"]=e[s],o.attrs["PATHWAY-ID"]=n,o});r.push(...i)})}function E_(r,e,t,n){const{HOST:s,PARAMS:i,[t]:a}=n;let o;e&&(o=a==null?void 0:a[e],o&&(r=o));const l=new self.URL(r);return s&&!o&&(l.host=s),i&&Object.keys(i).sort().forEach(u=>{u&&l.searchParams.set(u,i[u])}),l.href}class ni extends fr{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=ni.CDMCleanupPromise?[ni.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:n,initData:s}=t,i=`"${t.type}" event: init data type: "${n}"`;if(this.debug(i),s!==null){if(!this.keyFormatPromise){let a=Object.keys(this.keySystemAccessPromises);a.length||(a=Ni(this.config));const o=a.map(Hu).filter(l=>!!l);this.keyFormatPromise=this.getKeyFormatPromise(o)}this.keyFormatPromise.then(a=>{const o=Yo(a);if(n!=="sinf"||o!==je.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${n}" for selected key-system ${o}`);return}let l;try{const h=Je(new Uint8Array(s)),g=ep(JSON.parse(h).sinf),p=gE(g);if(!p)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");l=new Uint8Array(p.subarray(8,24))}catch(h){this.warn(`${i} Failed to parse sinf: ${h}`);return}const u=dt(l),{keyIdToKeySessionPromise:c,mediaKeySessions:d}=this;let f=c[u];for(let h=0;h<d.length;h++){const g=d[h],p=g.decryptdata;if(!p.keyId)continue;const v=dt(p.keyId);if(Cl(l,p.keyId)||p.uri.replace(/-/g,"").indexOf(u)!==-1){if(f=c[v],!f)continue;if(p.pssh)break;delete c[v],p.pssh=new Uint8Array(s),p.keyId=l,f=c[u]=f.then(()=>this.generateRequestWithPreferredKeySession(g,n,s,"encrypted-event-key-match")),f.catch(m=>this.handleError(m));break}}f||this.handleError(new Error(`Key ID ${u} not encountered in playlist. Key-system sessions ${d.length}.`))}).catch(a=>this.handleError(a))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(_.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(_.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(_.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(_.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(_.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(_.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(_.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(_.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(_.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(_.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:n}=this.config,s=t==null?void 0:t[e];if(s)return s.licenseUrl;if(e===je.WIDEVINE&&n)return n}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,n=t==null?void 0:t[e];if(n)return n.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,n=(a,o,l)=>!!a&&l.indexOf(a)===o,s=t.map(a=>a.audioCodec).filter(n),i=t.map(a=>a.videoCodec).filter(n);return s.length+i.length===0&&i.push("avc1.42e01e"),new Promise((a,o)=>{const l=u=>{const c=u.shift();this.getMediaKeysPromise(c,s,i).then(d=>a({keySystem:c,mediaKeys:d})).catch(d=>{u.length?l(u):d instanceof Ht?o(d):o(new Ht({type:se.KEY_SYSTEM_ERROR,details:O.KEY_SYSTEM_NO_ACCESS,error:d,fatal:!0},d.message))})};l(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:n}=this.config;if(typeof n!="function"){let s=`Configured requestMediaKeySystemAccess is not a function ${n}`;return CE===null&&self.location.protocol==="http:"&&(s=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(s))}return n(e,t)}getMediaKeysPromise(e,t,n){var s;const i=$I(e,t,n,this.config.drmSystemOptions||{});let a=this.keySystemAccessPromises[e],o=(s=a)==null?void 0:s.keySystemAccess;if(!o){this.log(`Requesting encrypted media "${e}" key-system access with config: ${Re(i)}`),o=this.requestMediaKeySystemAccess(e,i);const l=a=this.keySystemAccessPromises[e]={keySystemAccess:o};return o.catch(u=>{this.log(`Failed to obtain access to key-system "${e}": ${u}`)}),o.then(u=>{this.log(`Access for key-system "${u.keySystem}" obtained`);const c=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const d=l.mediaKeys=u.createMediaKeys().then(f=>(this.log(`Media-keys created for "${e}"`),l.hasMediaKeys=!0,c.then(h=>h?this.setMediaKeysServerCertificate(f,e,h):f)));return d.catch(f=>{this.error(`Failed to create media-keys for "${e}"}: ${f}`)}),d})}return o.then(()=>a.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:n}){this.log(`Creating key-system session "${t}" keyId: ${dt(e.keyId||[])} keyUri: ${e.uri}`);const s=n.createSession(),i={decryptdata:e,keySystem:t,mediaKeys:n,mediaKeysSession:s,keyStatus:"status-pending"};return this.mediaKeySessions.push(i),i}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const n=this.createMediaKeySessionContext(e),s=So(t),i="cenc";this.keyIdToKeySessionPromise[s]=this.generateRequestWithPreferredKeySession(n,i,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const n=e.mediaKeysSession;return this.log(`Updating key-session "${n.sessionId}" for keyId ${dt(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),n.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>Hu(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:n})=>this.attemptSetMediaKeys(t,n))}selectKeySystem(e){return new Promise((t,n)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:s})=>{const i=Hu(s);i?t(i):n(new Error(`Unable to find format for key-system "${s}"`))}).catch(n)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=Ni(this.config),n=e.map(Yo).filter(s=>!!s&&t.indexOf(s)!==-1);return this.selectKeySystem(n)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let n=0;n<t.length;n++){const s=iL(e,t[n]);if(s)return s}}loadKey(e){const t=e.keyInfo.decryptdata,n=So(t),s=this.bannedKeyIds[n];if(s||this.getKeyStatus(t)==="internal-error"){const o=qm(s||"internal-error",t);return this.handleError(o,e.frag),Promise.reject(o)}const i=`(keyId: ${n} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${i}`);const a=this.keyIdToKeySessionPromise[n];if(!a){const o=this.getKeySystemForKeyPromise(t).then(({keySystem:l,mediaKeys:u})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${i}`),this.attemptSetMediaKeys(l,u).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:l,mediaKeys:u,decryptdata:t}))))).then(l=>{const u="cenc",c=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(l,u,c,"playlist-key")});return o.catch(l=>this.handleError(l,e.frag)),this.keyIdToKeySessionPromise[n]=o,o}return a.catch(o=>{if(o instanceof Ht){const l=Te({},o.data);this.getKeyStatus(t)==="internal-error"&&(l.decryptdata=t);const u=new Ht(l,o.message);this.handleError(u,e.frag)}}),a}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof Ht){t&&(e.data.frag=t);const n=e.data.decryptdata;this.error(`${e.message}${n?` (${dt(n.keyId||[])})`:""}`),this.hls.trigger(_.ERROR,e.data)}else this.error(e.message),this.hls.trigger(_.ERROR,{type:se.KEY_SYSTEM_ERROR,details:O.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=So(e),n=this.keyIdToKeySessionPromise[t];if(!n){const s=Yo(e.keyFormat),i=s?[s]:Ni(this.config);return this.attemptKeySystemAccess(i)}return n}getKeySystemSelectionPromise(e){if(e.length||(e=Ni(this.config)),e.length===0)throw new Ht({type:se.KEY_SYSTEM_ERROR,details:O.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${Re({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaResolved=void 0,this.mediaKeys===t)return Promise.resolve();const n=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const s=Promise.all(n).then(()=>this.media?this.media.setMediaKeys(t):new Promise((i,a)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return a(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=t,this.media.setMediaKeys(t).then(i).catch(a)}}));return this.mediaKeys=t,this.setMediaKeysQueue.push(s),s.then(()=>{this.log(`Media-keys set for "${e}"`),n.push(s),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(i=>n.indexOf(i)===-1)})}generateRequestWithPreferredKeySession(e,t,n,s){var i;const a=(i=this.config.drmSystems)==null||(i=i[e.keySystem])==null?void 0:i.generateRequest;if(a)try{const g=a.call(this.hls,t,n,e);if(!g)throw new Error("Invalid response from configured generateRequest filter");t=g.initDataType,n=g.initData?g.initData:null,e.decryptdata.pssh=n?new Uint8Array(n):null}catch(g){if(this.warn(g.message),this.hls&&this.hls.config.debug)throw g}if(n===null)return this.log(`Skipping key-session request for "${s}" (no initData)`),Promise.resolve(e);const o=So(e.decryptdata),l=e.decryptdata.uri;this.log(`Generating key-session request for "${s}" keyId: ${o} URI: ${l} (init data type: ${t} length: ${n.byteLength})`);const u=new rp,c=e._onmessage=g=>{const p=e.mediaKeysSession;if(!p){u.emit("error",new Error("invalid state"));return}const{messageType:v,message:m}=g;this.log(`"${v}" message event for session "${p.sessionId}" message size: ${m.byteLength}`),v==="license-request"||v==="license-renewal"?this.renewLicense(e,m).catch(y=>{u.eventNames().length?u.emit("error",y):this.handleError(y)}):v==="license-release"?e.keySystem===je.FAIRPLAY&&this.updateKeySession(e,Dd("acknowledged")).then(()=>this.removeSession(e)).catch(y=>this.handleError(y)):this.warn(`unhandled media key message type "${v}"`)},d=(g,p)=>{p.keyStatus=g;let v;g.startsWith("usable")?u.emit("resolved"):g==="internal-error"||g==="output-restricted"||g==="output-downscaled"?v=qm(g,p.decryptdata):g==="expired"?v=new Error(`key expired (keyId: ${o})`):g==="released"?v=new Error("key released"):g==="status-pending"||this.warn(`unhandled key status change "${g}" (keyId: ${o})`),v&&(u.eventNames().length?u.emit("error",v):this.handleError(v))},f=e._onkeystatuseschange=g=>{if(!e.mediaKeysSession){u.emit("error",new Error("invalid state"));return}const v=this.getKeyStatuses(e);if(!Object.keys(v).some(E=>v[E]!=="status-pending"))return;if(v[o]==="expired"){this.log(`Expired key ${Re(v)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let y=v[o];if(y)d(y,e);else{var S;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(S=e.keyStatusTimeouts)[o]||(S[o]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const T=this.getKeyStatus(e.decryptdata);if(T&&T!=="status-pending")return this.log(`No status for keyId ${o} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${T} from other session.`),d(T,e);this.log(`key status for ${o} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),y="internal-error",d(y,e)},1e3)),this.log(`No status for keyId ${o} (${Re(v)}).`)}};At(e.mediaKeysSession,"message",c),At(e.mediaKeysSession,"keystatuseschange",f);const h=new Promise((g,p)=>{u.on("error",p),u.on("resolved",g)});return e.mediaKeysSession.generateRequest(t,n).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${o} URI: ${l}`)}).catch(g=>{throw new Ht({type:se.KEY_SYSTEM_ERROR,details:O.KEY_SYSTEM_NO_SESSION,error:g,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${g}`)}).then(()=>h).catch(g=>(u.removeAllListeners(),this.removeSession(e).then(()=>{throw g}))).then(()=>(u.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((n,s)=>{if(typeof s=="string"&&typeof n=="object"){const o=s;s=n,n=o}const i="buffer"in s?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):new Uint8Array(s);if(e.keySystem===je.PLAYREADY&&i.length===16){const o=dt(i);t[o]=n,LE(i)}const a=dt(i);n==="internal-error"&&(this.bannedKeyIds[a]=n),this.log(`key status change "${n}" for keyStatuses keyId: ${a} key-session "${e.mediaKeysSession.sessionId}"`),t[a]=n}),t}fetchServerCertificate(e){const t=this.config,n=t.loader,s=new n(t),i=this.getServerCertificateUrl(e);return i?(this.log(`Fetching server certificate for "${e}"`),new Promise((a,o)=>{const l={responseType:"arraybuffer",url:i},u=t.certLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(f,h,g,p)=>{a(f.data)},onError:(f,h,g,p)=>{o(new Ht({type:se.KEY_SYSTEM_ERROR,details:O.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:g,response:Te({url:l.url,data:void 0},f)},`"${e}" certificate request failed (${i}). Status: ${f.code} (${f.text})`))},onTimeout:(f,h,g)=>{o(new Ht({type:se.KEY_SYSTEM_ERROR,details:O.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:g,response:{url:l.url,data:void 0}},`"${e}" certificate request timed out (${i})`))},onAbort:(f,h,g)=>{o(new Error("aborted"))}};s.load(l,c,d)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,n){return new Promise((s,i)=>{e.setServerCertificate(n).then(a=>{this.log(`setServerCertificate ${a?"success":"not supported by CDM"} (${n.byteLength}) on "${t}"`),s(e)}).catch(a=>{i(new Ht({type:se.KEY_SYSTEM_ERROR,details:O.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:a,fatal:!0},a.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(n=>this.updateKeySession(e,new Uint8Array(n)).catch(s=>{throw new Ht({type:se.KEY_SYSTEM_ERROR,details:O.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:s,fatal:!1},s.message)}))}unpackPlayReadyKeyMessage(e,t){const n=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!n.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const s=new DOMParser().parseFromString(n,"application/xml"),i=s.querySelectorAll("HttpHeader");if(i.length>0){let c;for(let d=0,f=i.length;d<f;d++){var a,o;c=i[d];const h=(a=c.querySelector("name"))==null?void 0:a.textContent,g=(o=c.querySelector("value"))==null?void 0:o.textContent;h&&g&&e.setRequestHeader(h,g)}}const l=s.querySelector("Challenge"),u=l==null?void 0:l.textContent;if(!u)throw new Error("Cannot find <Challenge> in key message");return Dd(atob(u))}setupLicenseXHR(e,t,n,s){const i=this.config.licenseXhrSetup;return i?Promise.resolve().then(()=>{if(!n.decryptdata)throw new Error("Key removed");return i.call(this.hls,e,t,n,s)}).catch(a=>{if(!n.decryptdata)throw a;return e.open("POST",t,!0),i.call(this.hls,e,t,n,s)}).then(a=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:a||s})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:s}))}requestLicense(e,t){const n=this.config.keyLoadPolicy.default;return new Promise((s,i)=>{const a=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${a}`);const o=new XMLHttpRequest;o.responseType="arraybuffer",o.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return i(new Error("invalid state"));if(o.readyState===4)if(o.status===200){this._requestLicenseFailureCount=0;let l=o.response;this.log(`License received ${l instanceof ArrayBuffer?l.byteLength:l}`);const u=this.config.licenseResponseCallback;if(u)try{l=u.call(this.hls,o,a,e)}catch(c){this.error(c)}s(l)}else{const l=n.errorRetry,u=l?l.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>u||o.status>=400&&o.status<500)i(new Ht({type:se.KEY_SYSTEM_ERROR,details:O.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:o,response:{url:a,data:void 0,code:o.status,text:o.statusText}},`License Request XHR failed (${a}). Status: ${o.status} (${o.statusText})`));else{const c=u-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${c} attempts left`),this.requestLicense(e,t).then(s,i)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=o,this.setupLicenseXHR(o,a,e,t).then(({xhr:l,licenseChallenge:u})=>{e.keySystem==je.PLAYREADY&&(u=this.unpackPlayReadyKeyMessage(l,u)),l.send(u)}).catch(i)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const n=t.media;this.media=n,At(n,"encrypted",this.onMediaEncrypted),At(n,"waitingforkey",this.onWaitingForKey);const s=this.mediaResolved;s?s():this.mediaKeys=n.mediaKeys}onMediaDetached(){const e=this.media;e&&(Mt(e,"encrypted",this.onMediaEncrypted),Mt(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const t=this.mediaResolved;if(t&&t(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const n=this.media,s=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,Cn.clearKeyUriToKeyIdMap();const i=s.length;ni.CDMCleanupPromise=Promise.all(s.map(a=>this.removeSession(a)).concat((n==null||(e=n.setMediaKeys(null))==null?void 0:e.catch(a=>{this.log(`Could not clear media keys: ${a}`),this.hls&&this.hls.trigger(_.ERROR,{type:se.OTHER_ERROR,details:O.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${a}`)})}))||Promise.resolve())).catch(a=>{this.log(`Could not close sessions and clear media keys: ${a}`),this.hls&&this.hls.trigger(_.ERROR,{type:se.OTHER_ERROR,details:O.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${a}`)})}).then(()=>{i&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const n=t.reduce((s,i)=>(s.indexOf(i.keyFormat)===-1&&s.push(i.keyFormat),s),[]);this.log(`Selecting key-system from session-keys ${n.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(n)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:n,decryptdata:s}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${dt((s==null?void 0:s.keyId)||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),n&&n.readyState!==XMLHttpRequest.DONE&&n.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const i=this.mediaKeySessions.indexOf(e);i>-1&&this.mediaKeySessions.splice(i,1);const{keyStatusTimeouts:a}=e;a&&Object.keys(a).forEach(u=>self.clearTimeout(a[u]));const{drmSystemOptions:o}=this.config;return(BI(o)?new Promise((u,c)=>{self.setTimeout(()=>c(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(u).catch(c)}):Promise.resolve()).catch(u=>{this.log(`Could not remove session: ${u}`),this.hls&&this.hls.trigger(_.ERROR,{type:se.OTHER_ERROR,details:O.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${u}`)})}).then(()=>t.close()).catch(u=>{this.log(`Could not close session: ${u}`),this.hls&&this.hls.trigger(_.ERROR,{type:se.OTHER_ERROR,details:O.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${u}`)})})}return Promise.resolve()}}ni.CDMCleanupPromise=void 0;function So(r){if(!r)throw new Error("Could not read keyId of undefined decryptdata");if(r.keyId===null)throw new Error("keyId is null");return dt(r.keyId)}function iL(r,e){if(r.keyId&&e.mediaKeysSession.keyStatuses.has(r.keyId))return e.mediaKeysSession.keyStatuses.get(r.keyId);if(r.matches(e.decryptdata))return e.keyStatus}class Ht extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function qm(r,e){const t=r==="output-restricted",n=t?O.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:O.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new Ht({type:se.KEY_SYSTEM_ERROR,details:n,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${r}"`)}class aL{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(_.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(_.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(_.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(_.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const n=this.hls.config;if(n.capLevelOnFPSDrop){const s=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=s,s&&typeof s.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),n.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,n){const s=performance.now();if(t){if(this.lastTime){const i=s-this.lastTime,a=n-this.lastDroppedFrames,o=t-this.lastDecodedFrames,l=1e3*a/i,u=this.hls;if(u.trigger(_.FPS_DROP,{currentDropped:a,currentDecoded:o,totalDroppedFrames:n}),l>0&&a>u.config.fpsDroppedMonitoringThreshold*o){let c=u.currentLevel;u.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+c),c>0&&(u.autoLevelCapping===-1||u.autoLevelCapping>=c)&&(c=c-1,u.trigger(_.FPS_DROP_LEVEL_CAPPING,{level:c,droppedLevel:u.currentLevel}),u.autoLevelCapping=c,this.streamController.nextLevelSwitch())}}this.lastTime=s,this.lastDroppedFrames=n,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function __(r,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=r,e.dispatchEvent(t)}function T_(r,e){const t=r.mode;if(t==="disabled"&&(r.mode="hidden"),r.cues&&!r.cues.getCueById(e.id))try{if(r.addCue(e),!r.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(n){xe.debug(`[texttrack-utils]: ${n}`);try{const s=new self.TextTrackCue(e.startTime,e.endTime,e.text);s.id=e.id,r.addCue(s)}catch(s){xe.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${s}`)}}t==="disabled"&&(r.mode=t)}function zs(r,e){const t=r.mode;if(t==="disabled"&&(r.mode="hidden"),r.cues)for(let n=r.cues.length;n--;)e&&r.cues[n].removeEventListener("enter",e),r.removeCue(r.cues[n]);t==="disabled"&&(r.mode=t)}function Gd(r,e,t,n){const s=r.mode;if(s==="disabled"&&(r.mode="hidden"),r.cues&&r.cues.length>0){const i=lL(r.cues,e,t);for(let a=0;a<i.length;a++)(!n||n(i[a]))&&r.removeCue(i[a])}s==="disabled"&&(r.mode=s)}function oL(r,e){if(e<=r[0].startTime)return 0;const t=r.length-1;if(e>r[t].endTime)return-1;let n=0,s=t,i;for(;n<=s;)if(i=Math.floor((s+n)/2),e<r[i].startTime)s=i-1;else if(e>r[i].startTime&&n<t)n=i+1;else return i;return r[n].startTime-e<e-r[s].startTime?n:s}function lL(r,e,t){const n=[],s=oL(r,e);if(s>-1)for(let i=s,a=r.length;i<a;i++){const o=r[i];if(o.startTime>=e&&o.endTime<=t)n.push(o);else if(o.startTime>t)return n}return n}function Jo(r){const e=[];for(let t=0;t<r.length;t++){const n=r[t];(n.kind==="subtitles"||n.kind==="captions")&&n.label&&e.push(r[t])}return e}class uL extends up{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const n=Jo(this.media.textTracks);for(let i=0;i<n.length;i++)if(n[i].mode==="hidden")t=n[i];else if(n[i].mode==="showing"){t=n[i];break}const s=this.findTrackForTextTrack(t);this.subtitleTrack!==s&&this.setSubtitleTrack(s)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(_.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(_.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(_.MANIFEST_LOADING,this.onManifestLoading,this),e.on(_.MANIFEST_PARSED,this.onManifestParsed,this),e.on(_.LEVEL_LOADING,this.onLevelLoading,this),e.on(_.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(_.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(_.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(_.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(_.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(_.MANIFEST_LOADING,this.onManifestLoading,this),e.off(_.MANIFEST_PARSED,this.onManifestParsed,this),e.off(_.LEVEL_LOADING,this.onLevelLoading,this),e.off(_.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(_.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(_.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const n=this.media;if(!n)return;const s=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||n.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,s)return;Jo(n.textTracks).forEach(a=>{zs(a)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:n,groupId:s,details:i}=t,a=this.tracksInGroup[n];if(!a||a.groupId!==s){this.warn(`Subtitle track with id:${n} and group:${s} not found in active group ${a==null?void 0:a.groupId}`);return}const o=a.details;a.details=t.details,this.log(`Subtitle track ${n} "${a.name}" lang:${a.lang} group:${s} loaded [${i.startSN}-${i.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,o)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.subtitleGroups||null,s=this.groupIds;let i=this.currentTrack;if(!n||(s==null?void 0:s.length)!==(n==null?void 0:n.length)||n!=null&&n.some(a=>(s==null?void 0:s.indexOf(a))===-1)){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(c=>!n||n.indexOf(c.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(c=>c.default)&&(this.selectDefaultTrack=!1),a.forEach((c,d)=>{c.id=d});else if(!i&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const o=this.hls.config.subtitlePreference;if(!i&&o){this.selectDefaultTrack=!1;const c=Mr(o,a);if(c>-1)i=a[c];else{const d=Mr(o,this.tracks);i=this.tracks[d]}}let l=this.findTrackId(i);l===-1&&i&&(l=this.findTrackId(null));const u={subtitleTracks:a};this.log(`Updating subtitle tracks, ${a.length} track(s) found in "${n==null?void 0:n.join(",")}" group-id`),this.hls.trigger(_.SUBTITLE_TRACKS_UPDATED,u),l!==-1&&this.trackId===-1&&this.setSubtitleTrack(l)}}findTrackId(e){const t=this.tracksInGroup,n=this.selectDefaultTrack;for(let s=0;s<t.length;s++){const i=t[s];if(!(n&&!i.default||!n&&!e)&&(!e||ss(i,e)))return s}if(e){for(let s=0;s<t.length;s++){const i=t[s];if(_a(e.attrs,i.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return s}for(let s=0;s<t.length;s++){const i=t[s];if(_a(e.attrs,i.attrs,["LANGUAGE"]))return s}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const s=t[n];if($d(s,e))return n}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===ve.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const n=this.currentTrack;if(n&&ss(e,n))return n;const s=Mr(e,this.tracksInGroup);if(s>-1){const i=this.tracksInGroup[s];return this.setSubtitleTrack(s),i}else{if(n)return null;{const i=Mr(e,t);if(i>-1)return t[i]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=e.id,s=e.groupId,i=this.getUrlWithDirectives(e.url,t),a=e.details,o=a==null?void 0:a.age;this.log(`Loading subtitle ${n} "${e.name}" lang:${e.lang} group:${s}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${i}`),this.hls.trigger(_.SUBTITLE_TRACK_LOADING,{url:i,id:n,groupId:s,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=Jo(e.textTracks),n=this.currentTrack;let s;if(n&&(s=t.filter(i=>$d(n,i))[0],s||this.warn(`Unable to find subtitle TextTrack with name "${n.name}" and language "${n.lang}"`)),[].slice.call(t).forEach(i=>{i.mode!=="disabled"&&i!==s&&(i.mode="disabled")}),s){const i=this.subtitleDisplay?"showing":"hidden";s.mode!==i&&(s.mode=i)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!J(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const n=this.currentTrack,s=t[e]||null;if(this.trackId=e,this.currentTrack=s,this.toggleTrackModes(),!s){this.hls.trigger(_.SUBTITLE_TRACK_SWITCH,{id:e});return}const i=!!s.details&&!s.details.live;if(e===this.trackId&&s===n&&i)return;this.log(`Switching to subtitle-track ${e}`+(s?` "${s.name}" lang:${s.lang} group:${s.groupId}`:""));const{id:a,groupId:o="",name:l,type:u,url:c}=s;this.hls.trigger(_.SUBTITLE_TRACK_SWITCH,{id:a,groupId:o,name:l,type:u,url:c});const d=this.switchParams(s.url,n==null?void 0:n.details,s.details);this.loadPlaylist(d)}}function cL(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{const i=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(s=="x"?i:i&3|8).toString(16)})}}}function Yi(r){let e=5381,t=r.length;for(;t;)e=e*33^r.charCodeAt(--t);return(e>>>0).toString()}const si=.025;let Ml=function(r){return r[r.Point=0]="Point",r[r.Range=1]="Range",r}({});function dL(r,e,t){return`${r.identifier}-${t+1}-${Yi(e)}`}class fL{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const n=this.playoutLimit;return e<=0||isNaN(n)?!1:n===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>n}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return Ju(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,n=Ju(t,e);return t-n<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=J(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return Ju(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<si))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?Ml.Range:Ml.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return hL(this)}}function Ju(r,e){return r-e.start<e.duration/2&&!(Math.abs(r-(e.start+e.duration))<si)?e.start:e.start+e.duration}function x_(r,e,t){const n=new self.URL(r,t);return n.protocol!=="data:"&&n.searchParams.set("_HLS_primary_id",e),n}function ec(r,e){for(;(t=r.assetList[++e])!=null&&t.error;)var t;return e}function hL(r){return`["${r.identifier}" ${r.cue.pre?"<pre>":r.cue.post?"<post>":""}${r.timelineStart.toFixed(2)}-${r.resumeTime.toFixed(2)}]`}function ks(r){const e=r.timelineStart,t=r.duration||0;return`["${r.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class gL{constructor(e,t,n,s){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(_.PLAYOUT_LIMIT_REACHED,{})};const i=this.hls=new e(t);this.interstitial=n,this.assetItem=s;const a=()=>{this.hasDetails=!0};i.once(_.LEVEL_LOADED,a),i.once(_.AUDIO_TRACK_LOADED,a),i.once(_.SUBTITLE_TRACK_LOADED,a),i.on(_.MEDIA_ATTACHING,(o,{media:l})=>{this.removeMediaListeners(),this.mediaAttached=l,this.interstitial.playoutLimit&&(l.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&i.on(_.BUFFER_APPENDED,()=>{const c=this.bufferedEnd;this.reachedPlayout(c)&&(this._bufferedEosTime=c,i.trigger(_.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=x_(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const n=Math.min(this._bufferedEosTime||1/0,this.duration),s=this.timelineOffset,i=ge.bufferInfo(e,s,0);return this.getAssetTime(i.end)>=n-.02}reachedPlayout(e){const n=this.interstitial.playoutLimit;return this.startOffset+e>=n}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=ge.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const n=t-this.startOffset;if(n>0&&n<e)return n}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const n=e-t;if(Math.abs(n)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,n=this.duration;return Math.min(Math.max(0,e-t),n)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=n=>delete n.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,n){var s;(s=this.hls)==null||s.on(e,t)}once(e,t,n){var s;(s=this.hls)==null||s.once(e,t)}off(e,t,n){var s;(s=this.hls)==null||s.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${ks(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const Ym=.033;class pL extends fr{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((n,s)=>e<=s.startOffset&&t>s.startOffset?(delete s.error,n+1):n,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let n=-1;e.nextEvent?n=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(n=this.findEventIndex(e.previousEvent.identifier)+1);const s=this.items;if(s)for(s[n]||(t===void 0&&(t=e.start),n=this.findItemIndexAtTime(t));n>=0&&(i=s[n])!=null&&i.event;){var i;n--}return n}findItemIndexAtTime(e,t){const n=this.items;if(n)for(let s=0;s<n.length;s++){let i=n[s];if(t&&t!=="primary"&&(i=i[t]),e===i.start||e>i.start&&e<i.end)return s}return-1}findJumpRestrictedIndex(e,t){const n=this.items;if(n)for(let s=e;s<=t&&n[s];s++){const i=n[s].event;if(i!=null&&i.restrictions.jump&&!i.appendInPlace)return s}return-1}findEventIndex(e){const t=this.items;if(t)for(let s=t.length;s--;){var n;if(((n=t[s].event)==null?void 0:n.identifier)===e)return s}return-1}findAssetIndex(e,t){const n=e.assetList,s=n.length;if(s>1)for(let i=0;i<s;i++){const a=n[i];if(!a.error){const o=a.timelineStart;if(t===o||t>o&&(t<o+(a.duration||0)||i===s-1))return i}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const n=t.assetList,s=n[n.length-1];if(s)return s.identifier}return null}parseInterstitialDateRanges(e,t){const n=e.main.details,{dateRanges:s}=n,i=this.events,a=this.parseDateRanges(s,{url:n.url},t),o=Object.keys(s),l=i?i.filter(u=>!o.includes(u.identifier)):[];a.length&&a.sort((u,c)=>{const d=u.cue.pre,f=u.cue.post,h=c.cue.pre,g=c.cue.post;if(d&&!h)return-1;if(h&&!d||f&&!g)return 1;if(g&&!f)return-1;if(!d&&!h&&!f&&!g){const p=u.startTime,v=c.startTime;if(p!==v)return p-v}return u.dateRange.tagOrder-c.dateRange.tagOrder}),this.events=a,l.forEach(u=>{this.removeEvent(u)}),this.updateSchedule(e,l)}updateSchedule(e,t=[],n=!1){const s=this.events||[];if(s.length||t.length||this.length<2){const i=this.items,a=this.parseSchedule(s,e);(n||t.length||(i==null?void 0:i.length)!==a.length||a.some((l,u)=>Math.abs(l.playout.start-i[u].playout.start)>.005||Math.abs(l.playout.end-i[u].playout.end)>.005))&&(this.items=a,this.onScheduleUpdate(t,i))}}parseDateRanges(e,t,n){const s=[],i=Object.keys(e);for(let a=0;a<i.length;a++){const o=i[a],l=e[o];if(l.isInterstitial){let u=this.eventMap[o];u?u.setDateRange(l):(u=new fL(l,t),this.eventMap[o]=u,n===!1&&(u.appendInPlace=n)),s.push(u)}}return s}parseSchedule(e,t){const n=[],s=t.main.details,i=s.live?1/0:s.edge;let a=0;if(e=e.filter(l=>!l.error&&!(l.cue.once&&l.hasPlayed)),e.length){this.resolveOffsets(e,t);let l=0,u=0;if(e.forEach((c,d)=>{const f=c.cue.pre,h=c.cue.post,g=e[d-1]||null,p=c.appendInPlace,v=h?i:c.startOffset,m=c.duration,y=c.timelineOccupancy===Ml.Range?m:0,S=c.resumptionOffset,E=(g==null?void 0:g.startTime)===v,T=v+c.cumulativeDuration;let A=p?T+m:v+S;if(f||!h&&v<=0){const w=u;u+=y,c.timelineStart=T;const b=a;a+=m,n.push({event:c,start:T,end:A,playout:{start:b,end:a},integrated:{start:w,end:u}})}else if(v<=i){if(!E){const I=v-l;if(I>Ym){const M=l,K=u;u+=I;const z=a;a+=I;const X={previousEvent:e[d-1]||null,nextEvent:c,start:M,end:M+I,playout:{start:z,end:a},integrated:{start:K,end:u}};n.push(X)}else I>0&&g&&(g.cumulativeDuration+=I,n[n.length-1].end=v)}h&&(A=T),c.timelineStart=T;const w=u;u+=y;const b=a;a+=m,n.push({event:c,start:T,end:A,playout:{start:b,end:a},integrated:{start:w,end:u}})}else return;const x=c.resumeTime;h||x>i?l=i:l=x}),l<i){var o;const c=l,d=u,f=i-l;u+=f;const h=a;a+=f,n.push({previousEvent:((o=n[n.length-1])==null?void 0:o.event)||null,nextEvent:null,start:l,end:c+f,playout:{start:h,end:a},integrated:{start:d,end:u}})}this.setDurations(i,a,u)}else n.push({previousEvent:null,nextEvent:null,start:0,end:i,playout:{start:0,end:i},integrated:{start:0,end:i}}),this.setDurations(i,i,i);return n}setDurations(e,t,n){this.durations={primary:e,playout:t,integrated:n}}resolveOffsets(e,t){const n=t.main.details,s=n.live?1/0:n.edge;let i=0,a=-1;e.forEach((o,l)=>{const u=o.cue.pre,c=o.cue.post,d=u?0:c?s:o.startTime;this.updateAssetDurations(o),a===d?o.cumulativeDuration=i:(i=0,a=d),!c&&o.snapOptions.in&&(o.resumeAnchor=cs(null,n.fragments,o.startOffset+o.resumptionOffset,0,0)||void 0),o.appendInPlace&&!o.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(o,t)||(o.appendInPlace=!1)),!o.appendInPlace&&l+1<e.length&&e[l+1].startTime-e[l].resumeTime<Ym&&(e[l+1].appendInPlace=!1,e[l+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${o}`));const h=J(o.resumeOffset)?o.resumeOffset:o.duration;i+=h})}primaryCanResumeInPlaceAt(e,t){const n=e.resumeTime,s=e.startTime+e.resumptionOffset;return Math.abs(n-s)>si?(this.log(`"${e.identifier}" resumption ${n} not aligned with estimated timeline end ${s}`),!1):!Object.keys(t).some(a=>{const o=t[a].details,l=o.edge;if(n>=l)return this.log(`"${e.identifier}" resumption ${n} past ${a} playlist end ${l}`),!1;const u=cs(null,o.fragments,n);if(!u)return this.log(`"${e.identifier}" resumption ${n} does not align with any fragments in ${a} playlist (${o.fragStart}-${o.fragmentEnd})`),!0;const c=a==="audio"?.175:0;return Math.abs(u.start-n)<si+c||Math.abs(u.end-n)<si+c?!1:(this.log(`"${e.identifier}" resumption ${n} not aligned with ${a} fragment bounds (${u.start}-${u.end} sn: ${u.sn} cc: ${u.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let n=0,s=!1,i=!1;for(let a=0;a<e.assetList.length;a++){const o=e.assetList[a],l=t+n;o.startOffset=n,o.timelineStart=l,s||(s=o.duration===null),i||(i=!!o.error);const u=o.error?0:o.duration||0;n+=u}s&&!i?e.duration=Math.max(n,e.duration):e.duration=n}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function pr(r){return`[${r.event?'"'+r.event.identifier+'"':"primary"}: ${r.start.toFixed(2)}-${r.end.toFixed(2)}]`}class mL{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const n=e.assetListUrl;let s;try{s=x_(n,this.hls.sessionId,e.baseUrl)}catch(f){const h=this.assignAssetListError(e,O.ASSET_LIST_LOAD_ERROR,f,n);this.hls.trigger(_.ERROR,h);return}t&&s.protocol!=="data:"&&s.searchParams.set("_HLS_start_offset",""+t);const i=this.hls.config,a=i.loader,o=new a(i),l={responseType:"json",url:s.href},u=i.interstitialAssetListLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(f,h,g,p)=>{const v=f.data,m=v==null?void 0:v.ASSETS;if(!Array.isArray(m)){const y=this.assignAssetListError(e,O.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),g.url,h,p);this.hls.trigger(_.ERROR,y);return}e.assetListResponse=v,this.hls.trigger(_.ASSET_LIST_LOADED,{event:e,assetListResponse:v,networkDetails:p})},onError:(f,h,g,p)=>{const v=this.assignAssetListError(e,O.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${f.code} ${f.text} (${h.url})`),h.url,p,g);this.hls.trigger(_.ERROR,v)},onTimeout:(f,h,g)=>{const p=this.assignAssetListError(e,O.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${h.url})`),h.url,f,g);this.hls.trigger(_.ERROR,p)}};return o.load(l,c,d),this.hls.trigger(_.ASSET_LIST_LOADING,{event:e}),o}assignAssetListError(e,t,n,s,i,a){return e.error=n,{type:se.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:s,error:n,networkDetails:a,stats:i}}}function Zm(r){var e;r==null||(e=r.play())==null||e.catch(()=>{})}function Eo(r,e){return`[${r}] Advancing timeline position to ${e}`}class vL extends fr{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const n=this.currentTime;if(n===void 0||this.playbackDisabled||!this.schedule)return;const s=n-this.timelinePos;if(Math.abs(s)<1/7056e5)return;const a=s<=-.01;this.timelinePos=n,this.bufferedPos=n;const o=this.playingItem;if(!o){this.checkBuffer();return}if(a&&this.schedule.resetErrorsInRange(n,n-s)&&this.updateSchedule(!0),this.checkBuffer(),a&&n<o.start||n>=o.end){var l;const h=this.findItemIndex(o);let g=this.schedule.findItemIndexAtTime(n);if(g===-1&&(g=h+(a?-1:1),this.log(`seeked ${a?"back ":""}to position not covered by schedule ${n} (resolving from ${h} to ${g})`)),!this.isInterstitial(o)&&(l=this.media)!=null&&l.paused&&(this.shouldPlay=!1),!a&&g>h){const p=this.schedule.findJumpRestrictedIndex(h+1,g);if(p>h){this.setSchedulePosition(p);return}}this.setSchedulePosition(g);return}const u=this.playingAsset;if(!u){if(this.playingLastItem&&this.isInterstitial(o)){const h=o.event.assetList[0];h&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(n,h))}return}const c=u.timelineStart,d=u.duration||0;if(a&&n<c||n>=c+d){var f;(f=o.event)!=null&&f.appendInPlace&&(this.clearAssetPlayers(o.event,o),this.flushFrontBuffer(n)),this.setScheduleToAssetAtTime(n,u)}},this.onTimeupdate=()=>{const n=this.currentTime;if(n===void 0||this.playbackDisabled)return;if(n>this.timelinePos)this.timelinePos=n,n>this.bufferedPos&&this.checkBuffer();else return;const s=this.playingItem;if(!s||this.playingLastItem)return;if(n>=s.end){this.timelinePos=s.end;const o=this.findItemIndex(s);this.setSchedulePosition(o+1)}const i=this.playingAsset;if(!i)return;const a=i.timelineStart+(i.duration||0);n>=a&&this.setScheduleToAssetAtTime(n,i)},this.onScheduleUpdate=(n,s)=>{const i=this.schedule;if(!i)return;const a=this.playingItem,o=i.events||[],l=i.items||[],u=i.durations,c=n.map(p=>p.identifier),d=!!(o.length||c.length);(d||s)&&this.log(`INTERSTITIALS_UPDATED (${o.length}): ${o}
Schedule: ${l.map(p=>pr(p))} pos: ${this.timelinePos}`),c.length&&this.log(`Removed events ${c}`);let f=null,h=null;a&&(f=this.updateItem(a,this.timelinePos),this.itemsMatch(a,f)?this.playingItem=f:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const g=this.bufferingItem;if(g&&(h=this.updateItem(g,this.bufferedPos),this.itemsMatch(g,h)?this.bufferingItem=h:g.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(g.event,null))),n.forEach(p=>{p.assetList.forEach(v=>{this.clearAssetPlayer(v.identifier,null)})}),this.playerQueue.forEach(p=>{if(p.interstitial.appendInPlace){const v=p.assetItem.timelineStart,m=p.timelineOffset-v;if(m)try{p.timelineOffset=v}catch(y){Math.abs(m)>si&&this.warn(`${y} ("${p.assetId}" ${p.timelineOffset}->${v})`)}}}),d||s){if(this.hls.trigger(_.INTERSTITIALS_UPDATED,{events:o.slice(0),schedule:l.slice(0),durations:u,removedIds:c}),this.isInterstitial(a)&&c.includes(a.event.identifier)){this.warn(`Interstitial "${a.event.identifier}" removed while playing`),this.primaryFallback(a.event);return}a&&this.trimInPlace(f,a),g&&h!==f&&this.trimInPlace(h,g),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new mL(e),this.schedule=new pL(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(_.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(_.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(_.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(_.MANIFEST_LOADING,this.onManifestLoading,this),e.on(_.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(_.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(_.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(_.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(_.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(_.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(_.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(_.BUFFER_APPENDED,this.onBufferAppended,this),e.on(_.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(_.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(_.MEDIA_ENDED,this.onMediaEnded,this),e.on(_.ERROR,this.onError,this),e.on(_.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(_.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(_.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(_.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(_.MANIFEST_LOADING,this.onManifestLoading,this),e.off(_.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(_.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(_.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(_.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(_.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(_.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(_.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(_.BUFFER_CODECS,this.onBufferCodecs,this),e.off(_.BUFFER_APPENDED,this.onBufferAppended,this),e.off(_.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(_.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(_.MEDIA_ENDED,this.onMediaEnded,this),e.off(_.ERROR,this.onError,this),e.off(_.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){Mt(e,"play",this.onPlay),Mt(e,"pause",this.onPause),Mt(e,"seeking",this.onSeeking),Mt(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const n=this.media=t.media;At(n,"seeking",this.onSeeking),At(n,"timeupdate",this.onTimeupdate),At(n,"play",this.onPlay),At(n,"pause",this.onPause)}onMediaAttached(e,t){const n=this.effectivePlayingItem,s=this.detachedData;if(this.detachedData=null,n===null)this.checkStart();else if(!s){this.clearScheduleState();const i=this.findItemIndex(n);this.setSchedulePosition(i)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const n=!!t.transferMedia,s=this.media;if(this.media=null,!n&&(s&&this.removeMediaListeners(s),this.detachedData)){const i=this.getBufferingPlayer();i&&(this.log(`Removing schedule state for detachedData and ${i}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,i.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,n=d=>d&&e.getAssetPlayer(d.identifier),s=(d,f,h,g,p)=>{if(d){let v=d[f].start;const m=d.event;if(m){if(f==="playout"||m.timelineOccupancy!==Ml.Point){const y=n(h);(y==null?void 0:y.interstitial)===m&&(v+=y.assetItem.startOffset+y[p])}}else{const y=g==="bufferedPos"?a():e[g];v+=y-d.start}return v}return 0},i=(d,f)=>{var h;if(d!==0&&f!=="primary"&&(h=e.schedule)!=null&&h.length){var g;const p=e.schedule.findItemIndexAtTime(d),v=(g=e.schedule.items)==null?void 0:g[p];if(v){const m=v[f].start-v.start;return d+m}}return d},a=()=>{const d=e.bufferedPos;return d===Number.MAX_VALUE?o("primary"):Math.max(d,0)},o=d=>{var f,h;return(f=e.primaryDetails)!=null&&f.live?e.primaryDetails.edge:((h=e.schedule)==null?void 0:h.durations[d])||0},l=(d,f)=>{var h,g;const p=e.effectivePlayingItem;if(p!=null&&(h=p.event)!=null&&h.restrictions.skip||!e.schedule)return;e.log(`seek to ${d} "${f}"`);const v=e.effectivePlayingItem,m=e.schedule.findItemIndexAtTime(d,f),y=(g=e.schedule.items)==null?void 0:g[m],S=e.getBufferingPlayer(),E=S==null?void 0:S.interstitial,T=E==null?void 0:E.appendInPlace,A=v&&e.itemsMatch(v,y);if(v&&(T||A)){const x=n(e.playingAsset),w=(x==null?void 0:x.media)||e.primaryMedia;if(w){const b=f==="primary"?w.currentTime:s(v,f,e.playingAsset,"timelinePos","currentTime"),I=d-b,M=(T?b:w.currentTime)+I;if(M>=0&&(!x||T||M<=x.duration)){w.currentTime=M;return}}}if(y){let x=d;if(f!=="primary"){const b=y[f].start,I=d-b;x=y.start+I}const w=!e.isInterstitial(y);if((!e.isInterstitial(v)||v.event.appendInPlace)&&(w||y.event.appendInPlace)){const b=e.media||(T?S==null?void 0:S.media:null);b&&(b.currentTime=x)}else if(v){const b=e.findItemIndex(v);if(m>b){const M=e.schedule.findJumpRestrictedIndex(b+1,m);if(M>b){e.setSchedulePosition(M);return}}let I=0;if(w)e.timelinePos=x,e.checkBuffer();else{const M=y.event.assetList,K=d-(y[f]||y).start;for(let z=M.length;z--;){const X=M[z];if(X.duration&&K>=X.startOffset&&K<X.startOffset+X.duration){I=z;break}}}e.setSchedulePosition(m,I)}}},u=()=>{const d=e.effectivePlayingItem;if(e.isInterstitial(d))return d;const f=t();return e.isInterstitial(f)?f:null},c={get bufferedEnd(){const d=t(),f=e.bufferingItem;if(f&&f===d){var h;return s(f,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-f.playout.start||((h=e.bufferingAsset)==null?void 0:h.startOffset)||0}return 0},get currentTime(){const d=u(),f=e.effectivePlayingItem;return f&&f===d?s(f,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-f.playout.start:0},set currentTime(d){const f=u(),h=e.effectivePlayingItem;h&&h===f&&l(d+h.playout.start,"playout")},get duration(){const d=u();return d?d.playout.end-d.playout.start:0},get assetPlayers(){var d;const f=(d=u())==null?void 0:d.event.assetList;return f?f.map(h=>e.getAssetPlayer(h.identifier)):[]},get playingIndex(){var d;const f=(d=u())==null?void 0:d.event;return f&&e.effectivePlayingAsset?f.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return u()}};return this.manager={get events(){var d;return((d=e.schedule)==null||(d=d.events)==null?void 0:d.slice(0))||[]},get schedule(){var d;return((d=e.schedule)==null||(d=d.items)==null?void 0:d.slice(0))||[]},get interstitialPlayer(){return u()?c:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const d=t();return e.findItemIndex(d)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const d=e.effectivePlayingItem;return e.findItemIndex(d)},primary:{get bufferedEnd(){return a()},get currentTime(){const d=e.timelinePos;return d>0?d:0},set currentTime(d){l(d,"primary")},get duration(){return o("primary")},get seekableStart(){var d;return((d=e.primaryDetails)==null?void 0:d.fragmentStart)||0}},integrated:{get bufferedEnd(){return s(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return s(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(d){l(d,"integrated")},get duration(){return o("integrated")},get seekableStart(){var d;return i(((d=e.primaryDetails)==null?void 0:d.fragmentStart)||0,"integrated")}},skip:()=>{const d=e.effectivePlayingItem,f=d==null?void 0:d.event;if(f&&!f.restrictions.skip){const h=e.findItemIndex(d);if(f.appendInPlace){const g=d.playout.start+d.event.duration;l(g+.001,"playout")}else e.advanceAfterAssetEnded(f,h,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,n=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!n?!1:this.findItemIndex(t)===n.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const n=this.waitingItem||this.playingItem;if(this.isInterstitial(n)&&!n.event.appendInPlace)return;let s=this.media;!s&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(s=this.primaryMedia);const i=(t=s)==null?void 0:t.currentTime;if(!(i===void 0||!J(i)))return i}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const n=this.getAssetPlayer(e);n&&this.transferMediaFromPlayer(n,t)}transferMediaFromPlayer(e,t){const n=e.interstitial.appendInPlace,s=e.media;if(n&&s===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&s){this.detachedData={media:s};return}const i=e.transferMedia();this.log(`transfer MediaSource from ${e} ${Re(i)}`),this.detachedData=i}else t&&s&&(this.shouldPlay||(this.shouldPlay=!s.paused))}transferMediaTo(e,t){var n,s;if(e.media===t)return;let i=null;const a=this.hls,o=e!==a,l=o&&e.interstitial.appendInPlace,u=(n=this.detachedData)==null?void 0:n.mediaSource;let c;if(a.media)l&&(i=a.transferMedia(),this.detachedData=i),c="Primary";else if(u){const g=this.getBufferingPlayer();g?(i=g.transferMedia(),c=`${g}`):c="detached MediaSource"}else c="detached media";if(!i){if(u)i=this.detachedData,this.log(`using detachedData: MediaSource ${Re(i)}`);else if(!this.detachedData||a.media===t){const g=this.playerQueue;g.length>1&&g.forEach(p=>{if(o&&p.interstitial.appendInPlace!==l){const v=p.interstitial;this.clearInterstitial(p.interstitial,null),v.appendInPlace=!1,v.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${v}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const d=i&&"mediaSource"in i&&((s=i.mediaSource)==null?void 0:s.readyState)!=="closed",f=d&&i?i:t;this.log(`${d?"transfering MediaSource":"attaching media"} to ${o?e:"Primary"} from ${c} (media.currentTime: ${t.currentTime})`);const h=this.schedule;if(f===i&&h){const g=o&&e.assetId===h.assetIdAtEnd;f.overrides={duration:h.duration,endOfStream:!o||g,cueRemoval:!o}}e.attachMedia(f)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e==null?void 0:e.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const n=this.timelinePos,s=this.effectivePlayingItem;if(n===-1){const i=this.hls.startPosition;if(this.log(Eo("checkStart",i)),this.timelinePos=i,t.length&&t[0].cue.pre){const a=e.findEventIndex(t[0].identifier);this.setSchedulePosition(a)}else if(i>=0||!this.primaryLive){const a=this.timelinePos=i>0?i:0,o=e.findItemIndexAtTime(a);this.setSchedulePosition(o)}}else if(s&&!this.playingItem){const i=e.findItemIndex(s);this.setSchedulePosition(i)}}advanceAssetBuffering(e,t){const n=e.event,s=n.findAssetIndex(t),i=ec(n,s);if(!n.isAssetPastPlayoutLimit(i))this.bufferedToEvent(e,i);else if(this.schedule){var a;const o=(a=this.schedule.items)==null?void 0:a[this.findItemIndex(e)+1];o&&this.bufferedToItem(o)}}advanceAfterAssetEnded(e,t,n){const s=ec(e,n);if(e.isAssetPastPlayoutLimit(s)){if(this.schedule){const i=this.schedule.items;if(i){const a=t+1,o=i.length;if(a>=o){this.setSchedulePosition(-1);return}const l=e.resumeTime;this.timelinePos<l&&(this.log(Eo("advanceAfterAssetEnded",l)),this.timelinePos=l,e.appendInPlace&&this.advanceInPlace(l),this.checkBuffer(this.bufferedPos<l)),this.setSchedulePosition(a)}}}else{if(e.appendInPlace){const i=e.assetList[s];i&&this.advanceInPlace(i.timelineStart)}this.setSchedulePosition(t,s)}}setScheduleToAssetAtTime(e,t){const n=this.schedule;if(!n)return;const s=t.parentIdentifier,i=n.getEvent(s);if(i){const a=n.findEventIndex(s),o=n.findAssetIndex(i,e);this.advanceAfterAssetEnded(i,a,o-1)}}setSchedulePosition(e,t){var n;const s=(n=this.schedule)==null?void 0:n.items;if(!s||this.playbackDisabled)return;const i=e>=0?s[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${i&&pr(i)}) pos: ${this.timelinePos}`);const a=this.waitingItem||this.playingItem,o=this.playingLastItem;if(this.isInterstitial(a)){const c=a.event,d=this.playingAsset,f=d==null?void 0:d.identifier,h=f?this.getAssetPlayer(f):null;if(h&&f&&(!this.eventItemsMatch(a,i)||t!==void 0&&f!==c.assetList[t].identifier)){var l;const g=c.findAssetIndex(d);if(this.log(`INTERSTITIAL_ASSET_ENDED ${g+1}/${c.assetList.length} ${ks(d)}`),this.endedAsset=d,this.playingAsset=null,this.hls.trigger(_.INTERSTITIAL_ASSET_ENDED,{asset:d,assetListIndex:g,event:c,schedule:s.slice(0),scheduleIndex:e,player:h}),a!==this.playingItem){this.itemsMatch(a,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(c,this.findItemIndex(this.playingItem),g);return}this.retreiveMediaSource(f,i),h.media&&!((l=this.detachedData)!=null&&l.mediaSource)&&h.detachMedia()}if(!this.eventItemsMatch(a,i)&&(this.endedItem=a,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${c} ${pr(a)}`),c.hasPlayed=!0,this.hls.trigger(_.INTERSTITIAL_ENDED,{event:c,schedule:s.slice(0),scheduleIndex:e}),c.cue.once)){var u;this.updateSchedule();const g=(u=this.schedule)==null?void 0:u.items;if(i&&g){const p=this.findItemIndex(i);this.advanceSchedule(p,g,t,a,o)}return}}this.advanceSchedule(e,s,t,a,o)}advanceSchedule(e,t,n,s,i){const a=this.schedule;if(!a)return;const o=t[e]||null,l=this.primaryMedia,u=this.playerQueue;if(u.length&&u.forEach(c=>{const d=c.interstitial,f=a.findEventIndex(d.identifier);(f<e||f>e+1)&&this.clearInterstitial(d,o)}),this.isInterstitial(o)){this.timelinePos=Math.min(Math.max(this.timelinePos,o.start),o.end);const c=o.event;if(n===void 0){n=a.findAssetIndex(c,this.timelinePos);const g=ec(c,n-1);if(c.isAssetPastPlayoutLimit(g)||c.appendInPlace&&this.timelinePos===o.end){this.advanceAfterAssetEnded(c,e,n);return}n=g}const d=this.waitingItem;this.assetsBuffered(o,l)||this.setBufferingItem(o);let f=this.preloadAssets(c,n);if(this.eventItemsMatch(o,d||s)||(this.waitingItem=o,this.log(`INTERSTITIAL_STARTED ${pr(o)} ${c.appendInPlace?"append in place":""}`),this.hls.trigger(_.INTERSTITIAL_STARTED,{event:c,schedule:t.slice(0),scheduleIndex:e})),!c.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${c}`);return}if(c.assetListLoader&&(c.assetListLoader.destroy(),c.assetListLoader=void 0),!l){this.log(`Waiting for attachMedia to start Interstitial ${c}`);return}this.waitingItem=this.endedItem=null,this.playingItem=o;const h=c.assetList[n];if(!h){this.advanceAfterAssetEnded(c,e,n||0);return}if(f||(f=this.getAssetPlayer(h.identifier)),f===null||f.destroyed){const g=c.assetList.length;this.warn(`asset ${n+1}/${g} player destroyed ${c}`),f=this.createAssetPlayer(c,h,n),f.loadSource()}if(!this.eventItemsMatch(o,this.bufferingItem)&&c.appendInPlace&&this.isAssetBuffered(h))return;this.startAssetPlayer(f,n,t,e,l),this.shouldPlay&&Zm(f.media)}else o?(this.resumePrimary(o,e,s),this.shouldPlay&&Zm(this.hls.media)):i&&this.isInterstitial(s)&&(this.endedItem=null,this.playingItem=s,s.event.appendInPlace||this.attachPrimary(a.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,n){var s,i;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${pr(e)}`),!((s=this.detachedData)!=null&&s.mediaSource)){let o=this.timelinePos;(o<e.start||o>=e.end)&&(o=this.getPrimaryResumption(e,t),this.log(Eo("resumePrimary",o)),this.timelinePos=o),this.attachPrimary(o,e)}if(!n)return;const a=(i=this.schedule)==null?void 0:i.items;a&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${pr(e)}`),this.hls.trigger(_.INTERSTITIALS_PRIMARY_RESUMED,{schedule:a.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const n=e.start;if(this.primaryLive){const s=this.primaryDetails;if(t===0)return this.hls.startPosition;if(s&&(n<s.fragmentStart||n>s.edge))return this.hls.liveSyncPosition||-1}return n}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:ge.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,n){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const s=this.primaryMedia;if(!s)return;const i=this.hls;i.media?this.checkBuffer():(this.transferMediaTo(i,s),n&&this.startLoadingPrimaryAt(e,n)),n||(this.log(Eo("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,n))}startLoadingPrimaryAt(e,t){var n;const s=this.hls;!s.loadingEnabled||!s.media||Math.abs((((n=s.mainForwardBufferInfo)==null?void 0:n.start)||s.media.currentTime)-e)>.5?s.startLoad(e,t):s.bufferingEnabled||s.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(_.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(_.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const n=this.hls.levels[t.level];if(!n.details)return;const s=Te(Te({},this.mediaSelection||this.altSelection),{},{main:n});this.mediaSelection=s,this.schedule.parseInterstitialDateRanges(s,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const n=this.hls.audioTracks[t.id],s=this.mediaSelection;if(!s){this.altSelection=Te(Te({},this.altSelection),{},{audio:n});return}const i=Te(Te({},s),{},{audio:n});this.mediaSelection=i}onSubtitleTrackUpdated(e,t){const n=this.hls.subtitleTracks[t.id],s=this.mediaSelection;if(!s){this.altSelection=Te(Te({},this.altSelection),{},{subtitles:n});return}const i=Te(Te({},s),{},{subtitles:n});this.mediaSelection=i}onAudioTrackSwitching(e,t){const n=im(t);this.playerQueue.forEach(({hls:s})=>s&&(s.setAudioOption(t)||s.setAudioOption(n)))}onSubtitleTrackSwitch(e,t){const n=im(t);this.playerQueue.forEach(({hls:s})=>s&&(s.setSubtitleOption(t)||t.id!==-1&&s.setSubtitleOption(n)))}onBufferCodecs(e,t){const n=t.tracks;n&&(this.requiredTracks=n)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const n=this.playingItem;if(n&&!this.itemsMatch(n,this.bufferingItem)&&!this.isInterstitial(n)){const s=this.timelinePos;this.bufferedPos=s,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let s=0;s<t.length;s++){const i=t[s];if(i.cue.post){var n;const a=this.schedule.findEventIndex(i.identifier),o=(n=this.schedule.items)==null?void 0:n[a];this.isInterstitial(o)&&this.eventItemsMatch(o,this.bufferingItem)&&this.bufferedToItem(o,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const n=this.findItemIndex(t);this.setSchedulePosition(n+1)}else this.shouldPlay=!1}updateItem(e,t){var n;const s=(n=this.schedule)==null?void 0:n.items;if(e&&s){const i=this.findItemIndex(e,t);return s[i]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((i,a)=>{e.event.isAssetPastPlayoutLimit(a)&&this.clearAssetPlayer(i.identifier,null)});const n=e.end+.25,s=ge.bufferInfo(this.primaryMedia,n,0);(s.end>n||(s.nextStart||0)>n)&&(this.log(`trim buffered interstitial ${pr(e)} (was ${pr(t)})`),this.attachPrimary(n,null,!0),this.flushFrontBuffer(n))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var n;return!!t&&(e===t||e.event.identifier===((n=t.event)==null?void 0:n.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const n=this.mediaSelection;n&&((t=this.schedule)==null||t.updateSchedule(n,[],e))}checkBuffer(e){var t;const n=(t=this.schedule)==null?void 0:t.items;if(!n)return;const s=ge.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=s.len<1),this.updateBufferedPos(s.end,n,e)}updateBufferedPos(e,t,n){const s=this.schedule,i=this.bufferingItem;if(this.bufferedPos>e||!s)return;if(t.length===1&&this.itemsMatch(t[0],i)){this.bufferedPos=e;return}const a=this.playingItem,o=this.findItemIndex(a);let l=s.findItemIndexAtTime(e);if(this.bufferedPos<e){var u;const c=this.findItemIndex(i),d=Math.min(c+1,t.length-1),f=t[d];if((l===-1&&i&&e>=i.end||(u=f.event)!=null&&u.appendInPlace&&e+.01>=f.start)&&(l=d),this.isInterstitial(i)){const h=i.event;if(d-o>1&&h.appendInPlace===!1||h.assetList.length===0&&h.assetListLoader)return}if(this.bufferedPos=e,l>c&&l>o)this.bufferedToItem(f);else{const h=this.primaryDetails;this.primaryLive&&h&&e>h.edge-h.targetduration&&f.start<h.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(f)&&this.preloadAssets(f.event,0)}}else n&&a&&!this.itemsMatch(a,i)&&(l===o?this.bufferedToItem(a):l===o+1&&this.bufferedToItem(t[l]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(s=>{const i=this.getAssetPlayer(s.identifier);return!(i!=null&&i.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,n=this.schedule;if(!this.itemsMatch(e,t)&&n){const{items:s,events:i}=n;if(!s||!i)return t;const a=this.isInterstitial(e),o=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const l=o?o.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${pr(e)}`+(t?` (${l.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(a){const u=n.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((c,d)=>{const f=this.getAssetPlayer(c.identifier);f&&(d===u&&f.loadSource(),f.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(u=>u.pauseBuffering());this.hls.trigger(_.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:i.slice(0),schedule:s.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const n=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(n!==null){this.bufferingAsset=null;const s=this.detachedData;s?s.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),n=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(n)}bufferedToEvent(e,t){const n=e.event,s=n.assetList.length===0&&!n.assetListLoader,i=n.cue.once;if(s||!i){const a=this.preloadAssets(n,t);if(a!=null&&a.interstitial.appendInPlace){const o=this.primaryMedia;o&&this.bufferAssetPlayer(a,o)}}}preloadAssets(e,t){const n=e.assetUrl,s=e.assetList.length,i=s===0&&!e.assetListLoader,a=e.cue.once;if(i){const l=e.timelineStart;if(e.appendInPlace){var o;const f=this.playingItem;!this.isInterstitial(f)&&(f==null||(o=f.nextEvent)==null?void 0:o.identifier)===e.identifier&&this.flushFrontBuffer(l+.25)}let u,c=0;if(!this.playingItem&&this.primaryLive&&(c=this.hls.startPosition,c===-1&&(c=this.hls.liveSyncPosition||0)),c&&!(e.cue.pre||e.cue.post)){const f=c-l;f>0&&(u=Math.round(f*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${n?1:s} ${e}${u?` live-start: ${c} start-offset: ${u}`:""}`),n)return this.createAsset(e,0,0,l,e.duration,n);const d=this.assetListLoader.loadAssetList(e,u);d&&(e.assetListLoader=d)}else if(!a&&s){for(let u=t;u<s;u++){const c=e.assetList[u],d=this.getAssetPlayerQueueIndex(c.identifier);(d===-1||this.playerQueue[d].destroyed)&&!c.error&&this.createAssetPlayer(e,c,u)}const l=e.assetList[t];if(l){const u=this.getAssetPlayer(l.identifier);return u&&u.loadSource(),u}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(s=>{this.hls.trigger(_.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:s})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let n=0;n<t.length;n++)if(e===t[n].assetId)return n;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let n=0;n<e.length;n++)if(e[n].media===t)return e[n]}return null}createAsset(e,t,n,s,i,a){const o={parentIdentifier:e.identifier,identifier:dL(e,a,t),duration:i,startOffset:n,timelineStart:s,uri:a};return this.createAssetPlayer(e,o,t)}createAssetPlayer(e,t,n){const s=this.hls,i=s.userConfig;let a=i.videoPreference;const o=s.loadLevelObj||s.levels[s.currentLevel];(a||o)&&(a=we({},a),o.videoCodec&&(a.videoCodec=o.videoCodec),o.videoRange&&(a.allowedVideoRanges=[o.videoRange]));const l=s.audioTracks[s.audioTrack],u=s.subtitleTracks[s.subtitleTrack];let c=0;if(this.primaryLive||e.appendInPlace){const E=this.timelinePos-t.timelineStart;if(E>1){const T=t.duration;T&&E<T&&(c=E)}}const d=t.identifier,f=Te(Te({},i),{},{maxMaxBufferLength:Math.min(180,s.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:s.sessionId,assetPlayerId:d,abrEwmaDefaultEstimate:s.bandwidthEstimate,interstitialsController:void 0,startPosition:c,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:a,audioPreference:l||i.audioPreference,subtitlePreference:u||i.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(f.timelineOffset=t.timelineStart));const h=f.cmcd;h!=null&&h.sessionId&&h.contentId&&(f.cmcd=we({},h,{contentId:Yi(t.uri)})),this.getAssetPlayer(d)&&this.warn(`Duplicate date range identifier ${e} and asset ${d}`);const g=new gL(this.HlsPlayerClass,f,e,t);this.playerQueue.push(g),e.assetList[n]=t;let p=!0;const v=E=>{if(E.live){var T;const w=new Error(`Interstitials MUST be VOD assets ${e}`),b={fatal:!0,type:se.OTHER_ERROR,details:O.INTERSTITIAL_ASSET_ITEM_ERROR,error:w},I=((T=this.schedule)==null?void 0:T.findEventIndex(e.identifier))||-1;this.handleAssetItemError(b,e,I,n,w.message);return}const A=E.edge-E.fragmentStart,x=t.duration;(p||x===null||A>x)&&(p=!1,this.log(`Interstitial asset "${d}" duration change ${x} > ${A}`),t.duration=A,this.updateSchedule())};g.on(_.LEVEL_UPDATED,(E,{details:T})=>v(T)),g.on(_.LEVEL_PTS_UPDATED,(E,{details:T})=>v(T)),g.on(_.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const m=(E,T)=>{const A=this.getAssetPlayer(d);if(A&&T.tracks){A.off(_.BUFFER_CODECS,m),A.tracks=T.tracks;const x=this.primaryMedia;this.bufferingAsset===A.assetItem&&x&&!A.media&&this.bufferAssetPlayer(A,x)}};g.on(_.BUFFER_CODECS,m);const y=()=>{var E;const T=this.getAssetPlayer(d);if(this.log(`buffered to end of asset ${T}`),!T||!this.schedule)return;const A=this.schedule.findEventIndex(e.identifier),x=(E=this.schedule.items)==null?void 0:E[A];this.isInterstitial(x)&&this.advanceAssetBuffering(x,t)};g.on(_.BUFFERED_TO_END,y);const S=E=>()=>{if(!this.getAssetPlayer(d)||!this.schedule)return;this.shouldPlay=!0;const A=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,A,E)};return g.once(_.MEDIA_ENDED,S(n)),g.once(_.PLAYOUT_LIMIT_REACHED,S(1/0)),g.on(_.ERROR,(E,T)=>{if(!this.schedule)return;const A=this.getAssetPlayer(d);if(T.details===O.BUFFER_STALLED_ERROR){if(A!=null&&A.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(T,e,this.schedule.findEventIndex(e.identifier),n,`Asset player error ${T.error} ${e}`)}),g.on(_.DESTROYING,()=>{if(!this.getAssetPlayer(d)||!this.schedule)return;const T=new Error(`Asset player destroyed unexpectedly ${d}`),A={fatal:!0,type:se.OTHER_ERROR,details:O.INTERSTITIAL_ASSET_ITEM_ERROR,error:T};this.handleAssetItemError(A,e,this.schedule.findEventIndex(e.identifier),n,T.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${ks(t)}`),this.hls.trigger(_.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:n,event:e,player:g}),g}clearInterstitial(e,t){this.clearAssetPlayers(e,t),e.reset()}clearAssetPlayers(e,t){e.assetList.forEach(n=>{this.clearAssetPlayer(n.identifier,t)})}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const n=this.playerQueue[t];this.transferMediaFromPlayer(n,null),n.resetDetails()}}clearAssetPlayer(e,t){const n=this.getAssetPlayerQueueIndex(e);if(n!==-1){const s=this.playerQueue[n];this.log(`clear ${s} toSegment: ${t&&pr(t)}`),this.transferMediaFromPlayer(s,t),this.playerQueue.splice(n,1),s.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,n,s,i){const{interstitial:a,assetItem:o,assetId:l}=e,u=a.assetList.length,c=this.playingAsset;this.endedAsset=null,this.playingAsset=o,(!c||c.identifier!==l)&&(c&&(this.clearAssetPlayer(c.identifier,n[s]),delete c.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${u} ${ks(o)}`),this.hls.trigger(_.INTERSTITIAL_ASSET_STARTED,{asset:o,assetListIndex:t,event:a,schedule:n.slice(0),scheduleIndex:s,player:e})),this.bufferAssetPlayer(e,i)}bufferAssetPlayer(e,t){var n,s;if(!this.schedule)return;const{interstitial:i,assetItem:a}=e,o=this.schedule.findEventIndex(i.identifier),l=(n=this.schedule.items)==null?void 0:n[o];if(!l)return;e.loadSource(),this.setBufferingItem(l),this.bufferingAsset=a;const u=this.getBufferingPlayer();if(u===e)return;const c=i.appendInPlace;if(c&&(u==null?void 0:u.interstitial.appendInPlace)===!1)return;const d=(u==null?void 0:u.tracks)||((s=this.detachedData)==null?void 0:s.tracks)||this.requiredTracks;if(c&&a!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(d&&!iE(d,e.tracks)){const f=new Error(`Asset ${ks(a)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(d)}')`),h={fatal:!0,type:se.OTHER_ERROR,details:O.INTERSTITIAL_ASSET_ITEM_ERROR,error:f},g=i.findAssetIndex(a);this.handleAssetItemError(h,i,o,g,f.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,n=this.primaryMedia;if(!t||!n)return;const s=n.currentTime,i=t.findAssetIndex(e,s),a=e.assetList[i];if(a){const o=this.getAssetPlayer(a.identifier);if(o){const l=o.currentTime||s-a.timelineStart,u=o.duration-l;if(this.warn(`Stalled at ${l} of ${l+u} in ${o} ${e} (media.currentTime: ${s})`),l&&(u/n.playbackRate<.5||o.bufferedInPlaceToEnd(n))&&o.hls){const c=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,c,i)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,n,s,i){if(e.details===O.BUFFER_STALLED_ERROR)return;const a=t.assetList[s]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${a&&ks(a)} ${e.error}`),!this.schedule)return;const o=(a==null?void 0:a.identifier)||"",l=this.getAssetPlayerQueueIndex(o),u=this.playerQueue[l]||null,c=this.schedule.items,d=we({},e,{fatal:!1,errorAction:ti(!0),asset:a,assetListIndex:s,event:t,schedule:c,scheduleIndex:n,player:u});if(this.hls.trigger(_.INTERSTITIAL_ASSET_ERROR,d),!e.fatal)return;const f=this.playingAsset,h=this.bufferingAsset,g=new Error(i);if(a&&(this.clearAssetPlayer(o,null),a.error=g),!t.assetList.some(p=>!p.error))t.error=g;else for(let p=s;p<t.assetList.length;p++)this.resetAssetPlayer(t.assetList[p].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):f&&f.identifier===o?this.advanceAfterAssetEnded(t,n,s):h&&h.identifier===o&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,h)}primaryFallback(e){const t=e.timelineStart,n=this.effectivePlayingItem;let s=this.timelinePos;if(n){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${s} playing: ${pr(n)} error: ${e.error}`),s===-1&&(s=this.hls.startPosition);const a=this.updateItem(n,s);this.itemsMatch(n,a)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t))}else if(s===-1){this.checkStart();return}if(!this.schedule)return;const i=this.schedule.findItemIndexAtTime(s);this.setSchedulePosition(i)}onAssetListLoaded(e,t){var n,s;const i=t.event,a=i.identifier,o=t.assetListResponse.ASSETS;if(!((n=this.schedule)!=null&&n.hasEvent(a)))return;const l=i.timelineStart,u=i.duration;let c=0;o.forEach((p,v)=>{const m=parseFloat(p.DURATION);this.createAsset(i,v,c,l+c,m,p.URI),c+=m}),i.duration=c,this.log(`Loaded asset-list with duration: ${c} (was: ${u}) ${i}`);const d=this.waitingItem,f=(d==null?void 0:d.event.identifier)===a;this.updateSchedule();const h=(s=this.bufferingItem)==null?void 0:s.event;if(f){var g;const p=this.schedule.findEventIndex(a),v=(g=this.schedule.items)==null?void 0:g[p];if(v){if(!this.playingItem&&this.timelinePos>v.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==p){i.error=new Error(`Interstitial ${o.length?"no longer within playback range":"asset-list is empty"} ${this.timelinePos} ${i}`),this.log(i.error.message),this.updateSchedule(!0),this.primaryFallback(i);return}this.setBufferingItem(v)}this.setSchedulePosition(p)}else if((h==null?void 0:h.identifier)===a){const p=i.assetList[0];if(p){const v=this.getAssetPlayer(p.identifier);if(h.appendInPlace){const m=this.primaryMedia;v&&m&&this.bufferAssetPlayer(v,m)}else v&&v.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case O.ASSET_LIST_PARSING_ERROR:case O.ASSET_LIST_LOAD_ERROR:case O.ASSET_LIST_LOAD_TIMEOUT:{const n=t.interstitial;n&&(this.updateSchedule(!0),this.primaryFallback(n));break}case O.BUFFER_STALLED_ERROR:{const n=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(n)&&n.event.appendInPlace){this.handleInPlaceStall(n.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const Qm=500;class yL extends tp{constructor(e,t,n){super(e,t,n,"subtitle-stream-controller",ee.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(_.LEVEL_LOADED,this.onLevelLoaded,this),e.on(_.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(_.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(_.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(_.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(_.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(_.LEVEL_LOADED,this.onLevelLoaded,this),e.off(_.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(_.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(_.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(_.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(_.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=j.IDLE,this.setInterval(Qm),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:n,success:s}=t;if(this.fragContextChanged(n)||(qe(n)&&(this.fragPrevious=n),this.state=j.IDLE),!s)return;const i=this.tracksBuffered[this.currentTrackId];if(!i)return;let a;const o=n.start;for(let u=0;u<i.length;u++)if(o>=i[u].start&&o<=i[u].end){a=i[u];break}const l=n.start+n.duration;a?a.end=l:(a={start:o,end:l},i.push(a)),this.fragmentTracker.fragBuffered(n),this.fragBufferedComplete(n,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:n,endOffset:s}=t;if(n===0&&s!==Number.POSITIVE_INFINITY){const i=s-1;if(i<=0)return;t.endOffsetSubtitles=Math.max(0,i),this.tracksBuffered.forEach(a=>{for(let o=0;o<a.length;){if(a[o].end<=i){a.shift();continue}else if(a[o].start<i)a[o].start=i;else break;o++}}),this.fragmentTracker.removeFragmentsInRange(n,i,ee.SUBTITLE)}}onError(e,t){const n=t.frag;(n==null?void 0:n.type)===ee.SUBTITLE&&(t.details===O.FRAG_GAP&&this.fragmentTracker.fragBuffered(n,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==j.STOPPED&&(this.state=j.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&l_(this.levels,t)){this.levels=t.map(n=>new va(n));return}this.tracksBuffered=[],this.levels=t.map(n=>{const s=new va(n);return this.tracksBuffered[s.id]=[],s}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,ee.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var n;if(this.currentTrackId=t.id,!((n=this.levels)!=null&&n.length)||this.currentTrackId===-1){this.clearInterval();return}const s=this.levels[this.currentTrackId];s!=null&&s.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,s&&this.state!==j.STOPPED&&this.setInterval(Qm)}onSubtitleTrackLoaded(e,t){var n;const{currentTrackId:s,levels:i}=this,{details:a,id:o}=t;if(!i){this.warn(`Subtitle tracks were reset while loading level ${o}`);return}const l=i[o];if(o>=i.length||!l)return;this.log(`Subtitle track ${o} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""},duration:${a.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let u=0;if(a.live||(n=l.details)!=null&&n.live){if(a.deltaUpdateFailed)return;const d=this.mainDetails;if(!d){this.startFragRequested=!1;return}const f=d.fragments[0];if(!l.details)a.hasProgramDateTime&&d.hasProgramDateTime?(Dl(a,d),u=a.fragmentStart):f&&(u=f.start,Md(a,u));else{var c;u=this.alignPlaylists(a,l.details,(c=this.levelLastLoaded)==null?void 0:c.details),u===0&&f&&(u=f.start,Md(a,u))}d&&!this.startFragRequested&&this.setStartPosition(d,u)}l.details=a,this.levelLastLoaded=l,o===s&&(this.hls.trigger(_.SUBTITLE_TRACK_UPDATED,{details:a,id:o,groupId:t.groupId}),this.tick(),a.live&&!this.fragCurrent&&this.media&&this.state===j.IDLE&&(cs(null,a.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:n}=e,s=t.decryptdata,i=this.hls;if(!this.fragContextChanged(t)&&n&&n.byteLength>0&&s!=null&&s.key&&s.iv&&ri(s.method)){const a=performance.now();this.decrypter.decrypt(new Uint8Array(n),s.key.buffer,s.iv.buffer,Jg(s.method)).catch(o=>{throw i.trigger(_.ERROR,{type:se.MEDIA_ERROR,details:O.FRAG_DECRYPT_ERROR,fatal:!1,error:o,reason:o.message,frag:t}),o}).then(o=>{const l=performance.now();i.trigger(_.FRAG_DECRYPTED,{frag:t,payload:o,stats:{tstart:a,tdecrypt:l}})}).catch(o=>{this.warn(`${o.name}: ${o.message}`),this.state=j.IDLE})}}doTick(){if(!this.media){this.state=j.IDLE;return}if(this.state===j.IDLE){const{currentTrackId:e,levels:t}=this,n=t==null?void 0:t[e];if(!n||!t.length||!n.details||this.waitForLive(n))return;const{config:s}=this,i=this.getLoadPosition(),a=ge.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],i,s.maxBufferHole),{end:o,len:l}=a,u=n.details,c=this.hls.maxBufferLength+u.levelTargetDuration;if(l>c)return;const d=u.fragments,f=d.length,h=u.edge;let g=null;const p=this.fragPrevious;if(o<h){const y=s.maxFragLookUpTolerance,S=o>h-y?0:y;g=cs(p,d,Math.max(d[0].start,o),S),!g&&p&&p.start<d[0].start&&(g=d[0])}else g=d[f-1];if(g=this.filterReplacedPrimary(g,n.details),!g)return;const v=g.sn-u.startSN,m=d[v-1];if(m&&m.cc===g.cc&&this.fragmentTracker.getState(m)===tt.NOT_LOADED&&(g=m),this.fragmentTracker.getState(g)===tt.NOT_LOADED){const y=this.mapToInitFragWhenRequired(g);y&&this.loadFragment(y,n,o)}}}loadFragment(e,t,n){qe(e)?super.loadFragment(e,t,n):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new SL(this.tracksBuffered[this.currentTrackId]||[])}}class SL{constructor(e){this.buffered=void 0;const t=(n,s,i)=>{if(s=s>>>0,s>i-1)throw new DOMException(`Failed to execute '${n}' on 'TimeRanges': The index provided (${s}) is greater than the maximum bound (${i})`);return e[s][n]};this.buffered={get length(){return e.length},end(n){return t("end",n,e.length)},start(n){return t("start",n,e.length)}}}}const EL={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},A_=r=>String.fromCharCode(EL[r]||r),vr=15,Gr=100,_L={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},TL={17:2,18:4,21:6,22:8,23:10,19:13,20:15},xL={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},AL={25:2,26:4,29:6,30:8,31:10,27:13,28:15},wL=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class IL{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const n=typeof t=="function"?t():t;xe.log(`${this.time} [${e}] ${n}`)}}}const Kn=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].toString(16));return t};class w_{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let n=0;n<t.length;n++){const s=t[n];e.hasOwnProperty(s)&&(this[s]=e[s])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class bL{constructor(){this.uchar=" ",this.penState=new w_}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class RL{constructor(e){this.chars=[],this.pos=0,this.currPenState=new w_,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<Gr;t++)this.chars.push(new bL);this.logger=e}equals(e){for(let t=0;t<Gr;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<Gr;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<Gr;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Gr&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Gr)}moveCursor(e){const t=this.pos+e;if(e>1)for(let n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=A_(e);if(this.pos>=Gr){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<Gr;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let n=0;n<Gr;n++){const s=this.chars[n].uchar;s!==" "&&(t=!1),e.push(s)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class tc{constructor(e){this.rows=[],this.currRow=vr-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<vr;t++)this.rows.push(new RL(e));this.logger=e}reset(){for(let e=0;e<vr;e++)this.rows[e].clear();this.currRow=vr-1}equals(e){let t=!0;for(let n=0;n<vr;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t}copy(e){for(let t=0;t<vr;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<vr;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+Re(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let o=0;o<vr;o++)this.rows[o].clear();const i=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){const o=a.rows[i].cueStartTime,l=this.logger.time;if(o!==null&&l!==null&&o<l)for(let u=0;u<this.nrRollUpRows;u++)this.rows[t-this.nrRollUpRows+u+1].copy(a.rows[i+u])}}this.currRow=t;const n=this.rows[this.currRow];if(e.indent!==null){const i=e.indent,a=Math.max(i-1,0);n.setCursor(e.indent),e.color=n.chars[a].penState.foreground}const s={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(s)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+Re(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let n="",s=-1;for(let i=0;i<vr;i++){const a=this.rows[i].getTextString();a&&(s=i+1,e?t.push("Row "+s+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(e?n="["+t.join(" | ")+"]":n=t.join(`
`)),n}getTextAndFormat(){return this.rows}}class Xm{constructor(e,t,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new tc(n),this.nonDisplayedMemory=new tc(n),this.lastOutputScreen=new tc(n),this.currRollUpRow=this.displayedMemory.rows[vr-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[vr-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let n=0;n<e.length;n++)this.writeScreen.insertChar(e[n]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const n=Math.floor(e/2)-16,s=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=s[n]}this.logger.log(2,"MIDROW: "+Re(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class Jm{constructor(e,t,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory=kL(),this.logger=void 0;const s=this.logger=new IL;this.channels=[null,new Xm(e,t,s),new Xm(e+1,n,s)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let n=0;n<t.length;n+=2){const s=t[n]&127,i=t[n+1]&127;let a=!1,o=null;if(s===0&&i===0)continue;this.logger.log(3,()=>"["+Kn([t[n],t[n+1]])+"] -> ("+Kn([s,i])+")");const l=this.cmdHistory;if(s>=16&&s<=31){if(LL(s,i,l)){_o(null,null,l),this.logger.log(3,()=>"Repeated command ("+Kn([s,i])+") is dropped");continue}_o(s,i,this.cmdHistory),a=this.parseCmd(s,i),a||(a=this.parseMidrow(s,i)),a||(a=this.parsePAC(s,i)),a||(a=this.parseBackgroundAttributes(s,i))}else _o(null,null,l);if(!a&&(o=this.parseChars(s,i),o)){const c=this.currentChannel;c&&c>0?this.channels[c].insertChars(o):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!a&&!o&&this.logger.log(2,()=>"Couldn't parse cleaned data "+Kn([s,i])+" orig: "+Kn([t[n],t[n+1]]))}}parseCmd(e,t){const n=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,s=(e===23||e===31)&&t>=33&&t<=35;if(!(n||s))return!1;const i=e===20||e===21||e===23?1:2,a=this.channels[i];return e===20||e===21||e===28||e===29?t===32?a.ccRCL():t===33?a.ccBS():t===34?a.ccAOF():t===35?a.ccAON():t===36?a.ccDER():t===37?a.ccRU(2):t===38?a.ccRU(3):t===39?a.ccRU(4):t===40?a.ccFON():t===41?a.ccRDC():t===42?a.ccTR():t===43?a.ccRTD():t===44?a.ccEDM():t===45?a.ccCR():t===46?a.ccENM():t===47&&a.ccEOC():a.ccTO(t-32),this.currentChannel=i,!0}parseMidrow(e,t){let n=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?n=1:n=2,n!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const s=this.channels[n];return s?(s.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+Kn([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let n;const s=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,i=(e===16||e===24)&&t>=64&&t<=95;if(!(s||i))return!1;const a=e<=23?1:2;t>=64&&t<=95?n=a===1?_L[e]:xL[e]:n=a===1?TL[e]:AL[e];const o=this.channels[a];return o?(o.setPAC(this.interpretPAC(n,t)),this.currentChannel=a,!0):!1}interpretPAC(e,t){let n;const s={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?n=t-96:n=t-64,s.underline=(n&1)===1,n<=13?s.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(s.italics=!0,s.color="white"):s.indent=Math.floor((n-16)/2)*4,s}parseChars(e,t){let n,s=null,i=null;if(e>=25?(n=2,i=e-8):(n=1,i=e),i>=17&&i<=19){let a;i===17?a=t+80:i===18?a=t+112:a=t+144,this.logger.log(2,()=>"Special char '"+A_(a)+"' in channel "+n),s=[a]}else e>=32&&e<=127&&(s=t===0?[e]:[e,t]);return s&&this.logger.log(3,()=>"Char codes =  "+Kn(s).join(",")),s}parseBackgroundAttributes(e,t){const n=(e===16||e===24)&&t>=32&&t<=47,s=(e===23||e===31)&&t>=45&&t<=47;if(!(n||s))return!1;let i;const a={};e===16||e===24?(i=Math.floor((t-32)/2),a.background=wL[i],t%2===1&&(a.background=a.background+"_semi")):t===45?a.background="transparent":(a.foreground="black",t===47&&(a.underline=!0));const o=e<=23?1:2;return this.channels[o].setBkgData(a),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}_o(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const n=this.channels[t];n&&n.cueSplitAtTime(e)}}}function _o(r,e,t){t.a=r,t.b=e}function LL(r,e,t){return t.a===r&&t.b===e}function kL(){return{a:null,b:null}}var hp=function(){if(Pl!=null&&Pl.VTTCue)return self.VTTCue;const r=["","lr","rl"],e=["start","middle","end","left","right"];function t(o,l){if(typeof l!="string"||!Array.isArray(o))return!1;const u=l.toLowerCase();return~o.indexOf(u)?u:!1}function n(o){return t(r,o)}function s(o){return t(e,o)}function i(o,...l){let u=1;for(;u<arguments.length;u++){const c=arguments[u];for(const d in c)o[d]=c[d]}return o}function a(o,l,u){const c=this,d={enumerable:!0};c.hasBeenReset=!1;let f="",h=!1,g=o,p=l,v=u,m=null,y="",S=!0,E="auto",T="start",A=50,x="middle",w=50,b="middle";Object.defineProperty(c,"id",i({},d,{get:function(){return f},set:function(I){f=""+I}})),Object.defineProperty(c,"pauseOnExit",i({},d,{get:function(){return h},set:function(I){h=!!I}})),Object.defineProperty(c,"startTime",i({},d,{get:function(){return g},set:function(I){if(typeof I!="number")throw new TypeError("Start time must be set to a number.");g=I,this.hasBeenReset=!0}})),Object.defineProperty(c,"endTime",i({},d,{get:function(){return p},set:function(I){if(typeof I!="number")throw new TypeError("End time must be set to a number.");p=I,this.hasBeenReset=!0}})),Object.defineProperty(c,"text",i({},d,{get:function(){return v},set:function(I){v=""+I,this.hasBeenReset=!0}})),Object.defineProperty(c,"region",i({},d,{get:function(){return m},set:function(I){m=I,this.hasBeenReset=!0}})),Object.defineProperty(c,"vertical",i({},d,{get:function(){return y},set:function(I){const M=n(I);if(M===!1)throw new SyntaxError("An invalid or illegal string was specified.");y=M,this.hasBeenReset=!0}})),Object.defineProperty(c,"snapToLines",i({},d,{get:function(){return S},set:function(I){S=!!I,this.hasBeenReset=!0}})),Object.defineProperty(c,"line",i({},d,{get:function(){return E},set:function(I){if(typeof I!="number"&&I!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");E=I,this.hasBeenReset=!0}})),Object.defineProperty(c,"lineAlign",i({},d,{get:function(){return T},set:function(I){const M=s(I);if(!M)throw new SyntaxError("An invalid or illegal string was specified.");T=M,this.hasBeenReset=!0}})),Object.defineProperty(c,"position",i({},d,{get:function(){return A},set:function(I){if(I<0||I>100)throw new Error("Position must be between 0 and 100.");A=I,this.hasBeenReset=!0}})),Object.defineProperty(c,"positionAlign",i({},d,{get:function(){return x},set:function(I){const M=s(I);if(!M)throw new SyntaxError("An invalid or illegal string was specified.");x=M,this.hasBeenReset=!0}})),Object.defineProperty(c,"size",i({},d,{get:function(){return w},set:function(I){if(I<0||I>100)throw new Error("Size must be between 0 and 100.");w=I,this.hasBeenReset=!0}})),Object.defineProperty(c,"align",i({},d,{get:function(){return b},set:function(I){const M=s(I);if(!M)throw new SyntaxError("An invalid or illegal string was specified.");b=M,this.hasBeenReset=!0}})),c.displayState=void 0}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a}();class CL{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function I_(r){function e(n,s,i,a){return(n|0)*3600+(s|0)*60+(i|0)+parseFloat(a||0)}const t=r.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class PL{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,n){for(let s=0;s<n.length;++s)if(t===n[s]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const n=parseFloat(t);if(n>=0&&n<=100)return this.set(e,n),!0}return!1}}function b_(r,e,t,n){const s=n?r.split(n):[r];for(const i in s){if(typeof s[i]!="string")continue;const a=s[i].split(t);if(a.length!==2)continue;const o=a[0],l=a[1];e(o,l)}}const Kd=new hp(0,0,""),To=Kd.align==="middle"?"middle":"center";function DL(r,e,t){const n=r;function s(){const o=I_(r);if(o===null)throw new Error("Malformed timestamp: "+n);return r=r.replace(/^[^\sa-zA-Z-]+/,""),o}function i(o,l){const u=new PL;b_(o,function(f,h){let g;switch(f){case"region":for(let p=t.length-1;p>=0;p--)if(t[p].id===h){u.set(f,t[p].region);break}break;case"vertical":u.alt(f,h,["rl","lr"]);break;case"line":g=h.split(","),u.integer(f,g[0]),u.percent(f,g[0])&&u.set("snapToLines",!1),u.alt(f,g[0],["auto"]),g.length===2&&u.alt("lineAlign",g[1],["start",To,"end"]);break;case"position":g=h.split(","),u.percent(f,g[0]),g.length===2&&u.alt("positionAlign",g[1],["start",To,"end","line-left","line-right","auto"]);break;case"size":u.percent(f,h);break;case"align":u.alt(f,h,["start",To,"end","left","right"]);break}},/:/,/\s/),l.region=u.get("region",null),l.vertical=u.get("vertical","");let c=u.get("line","auto");c==="auto"&&Kd.line===-1&&(c=-1),l.line=c,l.lineAlign=u.get("lineAlign","start"),l.snapToLines=u.get("snapToLines",!0),l.size=u.get("size",100),l.align=u.get("align",To);let d=u.get("position","auto");d==="auto"&&Kd.position===50&&(d=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=d}function a(){r=r.replace(/^\s+/,"")}if(a(),e.startTime=s(),a(),r.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+n);r=r.slice(3),a(),e.endTime=s(),a(),i(r,e)}function R_(r){return r.replace(/<br(?: \/)?>/gi,`
`)}class OL{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new CL,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function n(){let i=t.buffer,a=0;for(i=R_(i);a<i.length&&i[a]!=="\r"&&i[a]!==`
`;)++a;const o=i.slice(0,a);return i[a]==="\r"&&++a,i[a]===`
`&&++a,t.buffer=i.slice(a),o}function s(i){b_(i,function(a,o){},/:/)}try{let i="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;i=n();const o=i.match(/^()?WEBVTT([ \t].*)?$/);if(!(o!=null&&o[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let a=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(a?a=!1:i=n(),t.state){case"HEADER":/:/.test(i)?s(i):i||(t.state="ID");continue;case"NOTE":i||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(i)){t.state="NOTE";break}if(!i)continue;if(t.cue=new hp(0,0,""),t.state="CUE",i.indexOf("-->")===-1){t.cue.id=i;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{DL(i,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const o=i.indexOf("-->")!==-1;if(!i||o&&(a=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=i}continue;case"BADCUE":i||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const ML=/\r\n|\n\r|\n|\r/g,rc=function(e,t,n=0){return e.slice(n,n+t.length)===t},NL=function(e){let t=parseInt(e.slice(-3));const n=parseInt(e.slice(-6,-4)),s=parseInt(e.slice(-9,-7)),i=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!J(t)||!J(n)||!J(s)||!J(i))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*n,t+=60*1e3*s,t+=60*60*1e3*i,t};function gp(r,e,t){return Yi(r.toString())+Yi(e.toString())+Yi(t)}const FL=function(e,t,n){let s=e[t],i=e[s.prevCC];if(!i||!i.new&&s.new){e.ccOffset=e.presentationOffset=s.start,s.new=!1;return}for(;(a=i)!=null&&a.new;){var a;e.ccOffset+=s.start-i.start,s.new=!1,s=i,i=e[s.prevCC]}e.presentationOffset=n};function $L(r,e,t,n,s,i,a){const o=new OL,l=er(new Uint8Array(r)).trim().replace(ML,`
`).split(`
`),u=[],c=e?Hb(e.baseTime,e.timescale):0;let d="00:00.000",f=0,h=0,g,p=!0;o.oncue=function(v){const m=t[n];let y=t.ccOffset;const S=(f-c)/9e4;if(m!=null&&m.new&&(h!==void 0?y=t.ccOffset=m.start:FL(t,n,S)),S){if(!e){g=new Error("Missing initPTS for VTT MPEGTS");return}y=S-t.presentationOffset}const E=v.endTime-v.startTime,T=zt((v.startTime+y-h)*9e4,s*9e4)/9e4;v.startTime=Math.max(T,0),v.endTime=Math.max(T+E,0);const A=v.text.trim();v.text=decodeURIComponent(encodeURIComponent(A)),v.id||(v.id=gp(v.startTime,v.endTime,A)),v.endTime>0&&u.push(v)},o.onparsingerror=function(v){g=v},o.onflush=function(){if(g){a(g);return}i(u)},l.forEach(v=>{if(p)if(rc(v,"X-TIMESTAMP-MAP=")){p=!1,v.slice(16).split(",").forEach(m=>{rc(m,"LOCAL:")?d=m.slice(6):rc(m,"MPEGTS:")&&(f=parseInt(m.slice(7)))});try{h=NL(d)/1e3}catch(m){g=m}return}else v===""&&(p=!1);o.parse(v+`
`)}),o.flush()}const nc="stpp.ttml.im1t",L_=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,k_=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,UL={left:"start",center:"center",right:"end",start:"start",end:"end"};function ev(r,e,t,n){const s=me(new Uint8Array(r),["mdat"]);if(s.length===0){n(new Error("Could not parse IMSC1 mdat"));return}const i=s.map(o=>er(o)),a=Kb(e.baseTime,1,e.timescale);try{i.forEach(o=>t(BL(o,a)))}catch(o){n(o)}}function BL(r,e){const s=new DOMParser().parseFromString(r,"text/xml").getElementsByTagName("tt")[0];if(!s)throw new Error("Invalid ttml");const i={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},a=Object.keys(i).reduce((d,f)=>(d[f]=s.getAttribute(`ttp:${f}`)||i[f],d),{}),o=s.getAttribute("xml:space")!=="preserve",l=tv(sc(s,"styling","style")),u=tv(sc(s,"layout","region")),c=sc(s,"body","[begin]");return[].map.call(c,d=>{const f=C_(d,o);if(!f||!d.hasAttribute("begin"))return null;const h=ac(d.getAttribute("begin"),a),g=ac(d.getAttribute("dur"),a);let p=ac(d.getAttribute("end"),a);if(h===null)throw rv(d);if(p===null){if(g===null)throw rv(d);p=h+g}const v=new hp(h-e,p-e,f);v.id=gp(v.startTime,v.endTime,v.text);const m=u[d.getAttribute("region")],y=l[d.getAttribute("style")],S=jL(m,y,l),{textAlign:E}=S;if(E){const T=UL[E];T&&(v.lineAlign=T),v.align=E}return we(v,S),v}).filter(d=>d!==null)}function sc(r,e,t){const n=r.getElementsByTagName(e)[0];return n?[].slice.call(n.querySelectorAll(t)):[]}function tv(r){return r.reduce((e,t)=>{const n=t.getAttribute("xml:id");return n&&(e[n]=t),e},{})}function C_(r,e){return[].slice.call(r.childNodes).reduce((t,n,s)=>{var i;return n.nodeName==="br"&&s?t+`
`:(i=n.childNodes)!=null&&i.length?C_(n,e):e?t+n.textContent.trim().replace(/\s+/g," "):t+n.textContent},"")}function jL(r,e,t){const n="http://www.w3.org/ns/ttml#styling";let s=null;const i=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=r!=null&&r.hasAttribute("style")?r.getAttribute("style"):null;return a&&t.hasOwnProperty(a)&&(s=t[a]),i.reduce((o,l)=>{const u=ic(e,n,l)||ic(r,n,l)||ic(s,n,l);return u&&(o[l]=u),o},{})}function ic(r,e,t){return r&&r.hasAttributeNS(e,t)?r.getAttributeNS(e,t):null}function rv(r){return new Error(`Could not parse ttml timestamp ${r}`)}function ac(r,e){if(!r)return null;let t=I_(r);return t===null&&(L_.test(r)?t=GL(r,e):k_.test(r)&&(t=KL(r,e))),t}function GL(r,e){const t=L_.exec(r),n=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+n/e.frameRate}function KL(r,e){const t=k_.exec(r),n=Number(t[1]);switch(t[2]){case"h":return n*3600;case"m":return n*60;case"ms":return n*1e3;case"f":return n/e.frameRate;case"t":return n/e.tickRate}return n}class xo{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,n){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class HL{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=sv(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(_.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(_.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(_.MANIFEST_LOADING,this.onManifestLoading,this),e.on(_.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(_.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(_.FRAG_LOADING,this.onFragLoading,this),e.on(_.FRAG_LOADED,this.onFragLoaded,this),e.on(_.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(_.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(_.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(_.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(_.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(_.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(_.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(_.MANIFEST_LOADING,this.onManifestLoading,this),e.off(_.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(_.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(_.FRAG_LOADING,this.onFragLoading,this),e.off(_.FRAG_LOADED,this.onFragLoaded,this),e.off(_.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(_.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(_.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(_.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(_.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new xo(this,"textTrack1"),t=new xo(this,"textTrack2"),n=new xo(this,"textTrack3"),s=new xo(this,"textTrack4");this.cea608Parser1=new Jm(1,e,t),this.cea608Parser2=new Jm(3,n,s)}addCues(e,t,n,s,i){let a=!1;for(let o=i.length;o--;){const l=i[o],u=VL(l[0],l[1],t,n);if(u>=0&&(l[0]=Math.min(l[0],t),l[1]=Math.max(l[1],n),a=!0,u/(n-t)>.5))return}if(a||i.push([t,n]),this.config.renderTextTracksNatively){const o=this.captionsTracks[e];this.Cues.newCue(o,t,n,s)}else{const o=this.Cues.newCue(null,t,n,s);this.hls.trigger(_.CUES_PARSED,{type:"captions",cues:o,track:e})}}onInitPtsFound(e,{frag:t,id:n,initPTS:s,timescale:i,trackId:a}){const{unparsedVttFrags:o}=this;n===ee.MAIN&&(this.initPTS[t.cc]={baseTime:s,timescale:i,trackId:a}),o.length&&(this.unparsedVttFrags=[],o.forEach(l=>{this.initPTS[l.frag.cc]?this.onFragLoaded(_.FRAG_LOADED,l):this.hls.trigger(_.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:l.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:n}=this;if(n)for(let s=0;s<n.textTracks.length;s++){const i=n.textTracks[s];if(nv(i,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return i}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:n,media:s}=this,{label:i,languageCode:a}=t[e],o=this.getExistingTrack(i,a);if(o)n[e]=o,zs(n[e]),__(n[e],s);else{const l=this.createTextTrack("captions",i,a);l&&(l[e]=!0,n[e]=l)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const n=t.label,s={_id:e,label:n,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=s,this.hls.trigger(_.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[s]})}createTextTrack(e,t,n){const s=this.media;if(s)return s.addTextTrack(e,t,n)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const n=!!t.transferMedia;if(this.media=null,n)return;const{captionsTracks:s}=this;Object.keys(s).forEach(i=>{zs(s[i]),delete s[i]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=sv(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let n=0;n<t.length;n++)zs(t[n])}onSubtitleTracksUpdated(e,t){const n=t.subtitleTracks||[],s=n.some(i=>i.textCodec===nc);if(this.config.enableWebVTT||s&&this.config.enableIMSC1){if(l_(this.tracks,n)){this.tracks=n;return}if(this.textTracks=[],this.tracks=n,this.config.renderTextTracksNatively){const a=this.media,o=a?Jo(a.textTracks):null;if(this.tracks.forEach((l,u)=>{let c;if(o){let d=null;for(let f=0;f<o.length;f++)if(o[f]&&nv(o[f],l)){d=o[f],o[f]=null;break}d&&(c=d)}if(c)zs(c);else{const d=P_(l);c=this.createTextTrack(d,l.name,l.lang),c&&(c.mode="disabled")}c&&this.textTracks.push(c)}),o!=null&&o.length){const l=o.filter(u=>u!==null).map(u=>u.label);l.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${l.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const a=this.tracks.map(o=>({label:o.name,kind:o.type.toLowerCase(),default:o.default,subtitleTrack:o}));this.hls.trigger(_.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:a})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(n=>{const s=/(?:CC|SERVICE)([1-4])/.exec(n.instreamId);if(!s)return;const i=`textTrack${s[1]}`,a=this.captionsProperties[i];a&&(a.label=n.name,n.lang&&(a.languageCode=n.lang),a.media=n)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===ee.MAIN){var n,s;const{cea608Parser1:i,cea608Parser2:a,lastSn:o}=this,{cc:l,sn:u}=t.frag,c=(n=(s=t.part)==null?void 0:s.index)!=null?n:-1;i&&a&&(u!==o+1||u===o&&c!==this.lastPartIndex+1||l!==this.lastCc)&&(i.reset(),a.reset()),this.lastCc=l,this.lastSn=u,this.lastPartIndex=c}}onFragLoaded(e,t){const{frag:n,payload:s}=t;if(n.type===ee.SUBTITLE)if(s.byteLength){const i=n.decryptdata,a="stats"in t;if(i==null||!i.encrypted||a){const o=this.tracks[n.level],l=this.vttCCs;l[n.cc]||(l[n.cc]={start:n.start,prevCC:this.prevCC,new:!0},this.prevCC=n.cc),o&&o.textCodec===nc?this._parseIMSC1(n,s):this._parseVTTs(t)}}else this.hls.trigger(_.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const n=this.hls;ev(t,this.initPTS[e.cc],s=>{this._appendCues(s,e.level),n.trigger(_.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},s=>{n.logger.log(`Failed to parse IMSC1: ${s}`),n.trigger(_.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:s})})}_parseVTTs(e){var t;const{frag:n,payload:s}=e,{initPTS:i,unparsedVttFrags:a}=this,o=i.length-1;if(!i[n.cc]&&o===-1){a.push(e);return}const l=this.hls,u=(t=n.initSegment)!=null&&t.data?dr(n.initSegment.data,new Uint8Array(s)).buffer:s;$L(u,this.initPTS[n.cc],this.vttCCs,n.cc,n.start,c=>{this._appendCues(c,n.level),l.trigger(_.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:n})},c=>{const d=c.message==="Missing initPTS for VTT MPEGTS";d?a.push(e):this._fallbackToIMSC1(n,s),l.logger.log(`Failed to parse VTT cue: ${c}`),!(d&&o>n.cc)&&l.trigger(_.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:c})})}_fallbackToIMSC1(e,t){const n=this.tracks[e.level];n.textCodec||ev(t,this.initPTS[e.cc],()=>{n.textCodec=nc,this._parseIMSC1(e,t)},()=>{n.textCodec="wvtt"})}_appendCues(e,t){const n=this.hls;if(this.config.renderTextTracksNatively){const s=this.textTracks[t];if(!s||s.mode==="disabled")return;e.forEach(i=>T_(s,i))}else{const s=this.tracks[t];if(!s)return;const i=s.default?"default":"subtitles"+t;n.trigger(_.CUES_PARSED,{type:"subtitles",cues:e,track:i})}}onFragDecrypted(e,t){const{frag:n}=t;n.type===ee.SUBTITLE&&this.onFragLoaded(_.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:n,samples:s}=t;if(!(n.type===ee.MAIN&&this.closedCaptionsForLevel(n)==="NONE"))for(let i=0;i<s.length;i++){const a=s[i].bytes;if(a){this.cea608Parser1||this.initCea608Parsers();const o=this.extractCea608Data(a);this.cea608Parser1.addData(s[i].pts,o[0]),this.cea608Parser2.addData(s[i].pts,o[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:n,endOffsetSubtitles:s,type:i}){const{media:a}=this;if(!(!a||a.currentTime<n)){if(!i||i==="video"){const{captionsTracks:o}=this;Object.keys(o).forEach(l=>Gd(o[l],t,n))}if(this.config.renderTextTracksNatively&&t===0&&s!==void 0){const{textTracks:o}=this;Object.keys(o).forEach(l=>Gd(o[l],t,s))}}}extractCea608Data(e){const t=[[],[]],n=e[0]&31;let s=2;for(let i=0;i<n;i++){const a=e[s++],o=127&e[s++],l=127&e[s++];if(o===0&&l===0)continue;if((4&a)!==0){const c=3&a;(c===0||c===1)&&(t[c].push(o),t[c].push(l))}}return t}}function P_(r){return r.characteristics&&/transcribes-spoken-dialog/gi.test(r.characteristics)&&/describes-music-and-sound/gi.test(r.characteristics)?"captions":"subtitles"}function nv(r,e){return!!r&&r.kind===P_(e)&&$d(e,r)}function VL(r,e,t,n){return Math.min(e,n)-Math.max(r,t)}function sv(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const WL=/\s/,zL={newCue(r,e,t,n){const s=[];let i,a,o,l,u;const c=self.VTTCue||self.TextTrackCue;for(let f=0;f<n.rows.length;f++)if(i=n.rows[f],o=!0,l=0,u="",!i.isEmpty()){var d;for(let p=0;p<i.chars.length;p++)WL.test(i.chars[p].uchar)&&o?l++:(u+=i.chars[p].uchar,o=!1);i.cueStartTime=e,e===t&&(t+=1e-4),l>=16?l--:l++;const h=R_(u.trim()),g=gp(e,t,h);r!=null&&(d=r.cues)!=null&&d.getCueById(g)||(a=new c(e,t,h),a.id=g,a.line=f+1,a.align="left",a.position=10+Math.min(80,Math.floor(l*8/32)*10),s.push(a))}return r&&s.length&&(s.sort((f,h)=>f.line==="auto"||h.line==="auto"?0:f.line>8&&h.line>8?h.line-f.line:f.line-h.line),s.forEach(f=>T_(r,f))),s}};function qL(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const YL=/(\d+)-(\d+)\/(\d+)/;class iv{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||JL,this.controller=new self.AbortController,this.stats=new Wg}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,n){const s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();const i=ZL(e,this.controller.signal),a=e.responseType==="arraybuffer",o=a?"byteLength":"length",{maxTimeToFirstByteMs:l,maxLoadTimeMs:u}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=n,this.request=this.fetchSetup(e,i),self.clearTimeout(this.requestTimeout),t.timeout=l&&J(l)?l:u,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(s,e,this.response))},t.timeout),(Ea(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(d=>{var f;this.response=this.loader=d;const h=Math.max(self.performance.now(),s.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=u,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(s,e,this.response))},u-(h-s.loading.start)),!d.ok){const{status:p,statusText:v}=d;throw new ek(v||"fetch, bad network response",p,d)}s.loading.first=h,s.total=XL(d.headers)||s.total;const g=(f=this.callbacks)==null?void 0:f.onProgress;return g&&J(t.highWaterMark)?this.loadProgressively(d,s,e,t.highWaterMark,g):a?d.arrayBuffer():e.responseType==="json"?d.json():d.text()}).then(d=>{var f,h;const g=this.response;if(!g)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first);const p=d[o];p&&(s.loaded=s.total=p);const v={url:g.url,data:d,code:g.status},m=(f=this.callbacks)==null?void 0:f.onProgress;m&&!J(t.highWaterMark)&&m(s,e,d,g),(h=this.callbacks)==null||h.onSuccess(v,s,e,g)}).catch(d=>{var f;if(self.clearTimeout(this.requestTimeout),s.aborted)return;const h=d&&d.code||0,g=d?d.message:null;(f=this.callbacks)==null||f.onError({code:h,text:g},e,d?d.details:null,s)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,n,s=0,i){const a=new GE,o=e.body.getReader(),l=()=>o.read().then(u=>{if(u.done)return a.dataLength&&i(t,n,a.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const c=u.value,d=c.length;return t.loaded+=d,d<s||a.dataLength?(a.push(c),a.dataLength>=s&&i(t,n,a.flush().buffer,e)):i(t,n,c.buffer,e),l()}).catch(()=>Promise.reject());return l()}}function ZL(r,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(we({},r.headers))};return r.rangeEnd&&t.headers.set("Range","bytes="+r.rangeStart+"-"+String(r.rangeEnd-1)),t}function QL(r){const e=YL.exec(r);if(e)return parseInt(e[2])-parseInt(e[1])+1}function XL(r){const e=r.get("Content-Range");if(e){const n=QL(e);if(J(n))return n}const t=r.get("Content-Length");if(t)return parseInt(t)}function JL(r,e){return new self.Request(r.url,e)}class ek extends Error{constructor(e,t,n){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=n}}const tk=/^age:\s*[\d.]+\s*$/im;class D_{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Wg,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,n){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=n,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const n=this.loader=new self.XMLHttpRequest,s=this.stats;s.loading.first=0,s.loaded=0,s.aborted=!1;const i=this.xhrSetup;i?Promise.resolve().then(()=>{if(!(this.loader!==n||this.stats.aborted))return i(n,t.url)}).catch(a=>{if(!(this.loader!==n||this.stats.aborted))return n.open("GET",t.url,!0),i(n,t.url)}).then(()=>{this.loader!==n||this.stats.aborted||this.openAndSendXhr(n,t,e)}).catch(a=>{var o;(o=this.callbacks)==null||o.onError({code:n.status,text:a.message},t,n,s)}):this.openAndSendXhr(n,t,e)}openAndSendXhr(e,t,n){e.readyState||e.open("GET",t.url,!0);const s=t.headers,{maxTimeToFirstByteMs:i,maxLoadTimeMs:a}=n.loadPolicy;if(s)for(const o in s)e.setRequestHeader(o,s[o]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),n.timeout=i&&J(i)?i:a,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:n}=this;if(!e||!t)return;const s=t.readyState,i=this.config;if(!n.aborted&&s>=2&&(n.loading.first===0&&(n.loading.first=Math.max(self.performance.now(),n.loading.start),i.timeout!==i.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),i.timeout=i.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.loadPolicy.maxLoadTimeMs-(n.loading.first-n.loading.start)))),s===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const u=t.status,c=t.responseType==="text"?t.responseText:null;if(u>=200&&u<300){const g=c??t.response;if(g!=null){var a,o;n.loading.end=Math.max(self.performance.now(),n.loading.first);const p=t.responseType==="arraybuffer"?g.byteLength:g.length;n.loaded=n.total=p,n.bwEstimate=n.total*8e3/(n.loading.end-n.loading.first);const v=(a=this.callbacks)==null?void 0:a.onProgress;v&&v(n,e,g,t);const m={url:t.responseURL,data:g,code:u};(o=this.callbacks)==null||o.onSuccess(m,n,e,t);return}}const d=i.loadPolicy.errorRetry,f=n.retry,h={url:e.url,data:void 0,code:u};if(kl(d,f,!1,h))this.retry(d);else{var l;xe.error(`${u} while loading ${e.url}`),(l=this.callbacks)==null||l.onError({code:u,text:t.statusText},e,t,n)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(kl(e,t,!0))this.retry(e);else{var n;xe.warn(`timeout while loading ${(n=this.context)==null?void 0:n.url}`);const s=this.callbacks;s&&(this.abortInternal(),s.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:n}=this;this.retryDelay=Zg(e,n.retry),n.retry++,xe.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${n.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&tk.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const rk={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},nk=Te(Te({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:D_,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:pI,bufferController:iR,capLevelController:cp,errorController:EI,fpsController:aL,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:CE,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:rk},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},sk()),{},{subtitleStreamController:yL,subtitleTrackController:uL,timelineController:HL,audioStreamController:tR,audioTrackController:rR,emeController:ni,cmcdController:rL,contentSteeringController:sL,interstitialsController:vL});function sk(){return{cueHandler:zL,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function ik(r,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const n=Hd(r),s=["manifest","level","frag"],i=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return s.forEach(a=>{const o=`${a==="level"?"playlist":a}LoadPolicy`,l=e[o]===void 0,u=[];i.forEach(c=>{const d=`${a}Loading${c}`,f=e[d];if(f!==void 0&&l){u.push(d);const h=n[o].default;switch(e[o]={default:h},c){case"TimeOut":h.maxLoadTimeMs=f,h.maxTimeToFirstByteMs=f;break;case"MaxRetry":h.errorRetry.maxNumRetry=f,h.timeoutRetry.maxNumRetry=f;break;case"RetryDelay":h.errorRetry.retryDelayMs=f,h.timeoutRetry.retryDelayMs=f;break;case"MaxRetryTimeout":h.errorRetry.maxRetryDelayMs=f,h.timeoutRetry.maxRetryDelayMs=f;break}}}),u.length&&t.warn(`hls.js config: "${u.join('", "')}" setting(s) are deprecated, use "${o}": ${Re(e[o])}`)}),Te(Te({},n),e)}function Hd(r){return r&&typeof r=="object"?Array.isArray(r)?r.map(Hd):Object.keys(r).reduce((e,t)=>(e[t]=Hd(r[t]),e),{}):r}function ak(r,e){const t=r.loader;t!==iv&&t!==D_?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),r.progressive=!1):qL()&&(r.loader=iv,r.progressive=!0,r.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const el=2,ok=.1,lk=.05,uk=100;class ck extends IE{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var n;(n=this.media)!=null&&n.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var n;this.ended=((n=this.media)==null?void 0:n.currentTime)||1,this.hls.trigger(_.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(_.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(_.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(_.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(_.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(_.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(_.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(uk),this.mediaSource=t.mediaSource;const n=this.media=t.media;At(n,"playing",this.onMediaPlaying),At(n,"waiting",this.onMediaWaiting),At(n,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:n}=this;n&&(Mt(n,"playing",this.onMediaPlaying),Mt(n,"waiting",this.onMediaWaiting),Mt(n,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var n,s;const i=(n=this.hls)==null?void 0:n.config;if(!i)return;const a=this.media;if(!a)return;const{seeking:o}=a,l=this.seeking&&!o,u=!this.seeking&&o,c=a.paused&&!o||a.ended||a.playbackRate===0;if(this.seeking=o,e!==t){t&&(this.ended=0),this.moved=!0,o||(this.nudgeRetry=0,i.nudgeOnVideoHole&&!c&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(u||l){l&&this.stallResolved(e);return}if(c){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&a.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(_.MEDIA_ENDED,{stalled:!1}));return}if(!ge.getBuffered(a).length){this.nudgeRetry=0;return}const d=ge.bufferInfo(a,e,0),f=d.nextStart||0,h=this.fragmentTracker;if(o&&h&&this.hls){const A=av(this.hls.inFlightFragments,e),x=d.len>el,w=!f||A||f-e>el&&!h.getPartialFragment(e);if(x||w)return;this.moved=!1}const g=(s=this.hls)==null?void 0:s.latestLevelDetails;if(!this.moved&&this.stalled!==null&&h){if(!(d.len>0)&&!f)return;const x=Math.max(f,d.start||0)-e,b=!!(g!=null&&g.live)?g.targetduration*2:el,I=Ao(e,h);if(x>0&&(x<=b||I)){a.paused||this._trySkipBufferHole(I);return}}const p=i.detectStallWithCurrentTimeMs,v=self.performance.now(),m=this.waiting;let y=this.stalled;if(y===null)if(m>0&&v-m<p)y=this.stalled=m;else{this.stalled=v;return}const S=v-y;if(!o&&(S>=p||m)&&this.hls){var E;if(((E=this.mediaSource)==null?void 0:E.readyState)==="ended"&&!(g!=null&&g.live)&&Math.abs(e-((g==null?void 0:g.edge)||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(_.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(d),!this.media||!this.hls)return}const T=ge.bufferInfo(a,e,i.maxBufferHole);this._tryFixBufferStall(T,S,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const n=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(n)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(_.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var n;const s=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(n=this.buffered.audio)!=null&&n.length&&s&&s.length>1&&e>s.end(0)){const i=ge.bufferedInfo(ge.timeRangesToArray(this.buffered.audio),e,0);if(i.len>1&&t>=i.start){const a=ge.timeRangesToArray(s),o=ge.bufferedInfo(a,t,0).bufferedIndex;if(o>-1&&o<a.length-1){const l=ge.bufferedInfo(a,e,0).bufferedIndex,u=a[o].end,c=a[o+1].start;if((l===-1||l>o)&&c-u<1&&e-u<2){const d=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${u} -> ${c} buffered index: ${l}`);this.warn(d.message),this.media.currentTime+=1e-6;let f=Ao(e,this.fragmentTracker);f&&"fragment"in f?f=f.fragment:f||(f=void 0);const h=ge.bufferInfo(this.media,e,0);this.hls.trigger(_.ERROR,{type:se.MEDIA_ERROR,details:O.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:d,reason:d.message,frag:f,buffer:h.len,bufferInfo:h})}}}}}_tryFixBufferStall(e,t,n){var s,i;const{fragmentTracker:a,media:o}=this,l=(s=this.hls)==null?void 0:s.config;if(!o||!a||!l)return;const u=(i=this.hls)==null?void 0:i.latestLevelDetails,c=Ao(n,a);if((c||u!=null&&u.live&&n<u.fragmentStart)&&(this._trySkipBufferHole(c)||!this.media))return;const d=e.buffered,f=this.adjacentTraversal(e,n);(d&&d.length>1&&e.len>l.maxBufferHole||e.nextStart&&(e.nextStart-n<l.maxBufferHole||f))&&(t>l.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const n=this.fragmentTracker,s=e.nextStart;if(n&&s){const i=n.getFragAtPos(t,ee.MAIN),a=n.getFragAtPos(s,ee.MAIN);if(i&&a)return a.sn-i.sn<2}return!1}_reportStall(e){const{hls:t,media:n,stallReported:s,stalled:i}=this;if(!s&&i!==null&&n&&t){this.stallReported=!0;const a=new Error(`Playback stalling at @${n.currentTime} due to low buffer (${Re(e)})`);this.warn(a.message),t.trigger(_.ERROR,{type:se.MEDIA_ERROR,details:O.BUFFER_STALLED_ERROR,fatal:!1,error:a,buffer:e.len,bufferInfo:e,stalled:{start:i}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:n,media:s}=this,i=(t=this.hls)==null?void 0:t.config;if(!s||!n||!i)return 0;const a=s.currentTime,o=ge.bufferInfo(s,a,0),l=a<o.start?o.start:o.nextStart;if(l&&this.hls){const c=o.len<=i.maxBufferHole,d=o.len>0&&o.len<1&&s.readyState<3,f=l-a;if(f>0&&(c||d)){if(f>i.maxBufferHole){let g=!1;if(a===0){const p=n.getAppendedFrag(0,ee.MAIN);p&&l<p.end&&(g=!0)}if(!g&&e){var u;if(!((u=this.hls.loadLevelObj)!=null&&u.details)||av(this.hls.inFlightFragments,l))return 0;let v=!1,m=e.end;for(;m<l;){const y=Ao(m,n);if(y)m+=y.duration;else{v=!0;break}}if(v)return 0}}const h=Math.max(l+lk,a+ok);if(this.warn(`skipping hole, adjusting currentTime from ${a} to ${h}`),this.moved=!0,s.currentTime=h,!(e!=null&&e.gap)){const g=new Error(`fragment loaded with buffer holes, seeking from ${a} to ${h}`),p={type:se.MEDIA_ERROR,details:O.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:g,reason:g.message,buffer:o.len,bufferInfo:o};e&&("fragment"in e?p.part=e:p.frag=e),this.hls.trigger(_.ERROR,p)}return h}}return 0}_tryNudgeBuffer(e){const{hls:t,media:n,nudgeRetry:s}=this,i=t==null?void 0:t.config;if(!n||!i)return 0;const a=n.currentTime;if(this.nudgeRetry++,s<i.nudgeMaxRetry){const o=a+(s+1)*i.nudgeOffset,l=new Error(`Nudging 'currentTime' from ${a} to ${o}`);this.warn(l.message),n.currentTime=o,t.trigger(_.ERROR,{type:se.MEDIA_ERROR,details:O.BUFFER_NUDGE_ON_STALL,error:l,fatal:!1,buffer:e.len,bufferInfo:e})}else{const o=new Error(`Playhead still not moving while enough data buffered @${a} after ${i.nudgeMaxRetry} nudges`);this.error(o.message),t.trigger(_.ERROR,{type:se.MEDIA_ERROR,details:O.BUFFER_STALLED_ERROR,error:o,fatal:!0,buffer:e.len,bufferInfo:e})}}}function av(r,e){const t=ov(r.main);if(t&&t.start<=e)return t;const n=ov(r.audio);return n&&n.start<=e?n:null}function ov(r){if(!r)return null;switch(r.state){case j.IDLE:case j.STOPPED:case j.ENDED:case j.ERROR:return null}return r.frag}function Ao(r,e){return e.getAppendedFrag(r,ee.MAIN)||e.getPartialFragment(r)}const dk=.25;function Vd(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function oc(r,e,t,n,s){let i=new r(e,t,"");try{i.value=n,s&&(i.type=s)}catch{i=new r(e,t,Re(s?Te({type:s},n):n))}return i}const wo=(()=>{const r=Vd();try{r&&new r(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class fk{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(_.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(_.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(_.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(_.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(_.MANIFEST_LOADING,this.onManifestLoading,this),e.on(_.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(_.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(_.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(_.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(_.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(_.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(_.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(_.MANIFEST_LOADING,this.onManifestLoading,this),e.off(_.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(_.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(_.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(_.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var n;this.media=t.media,((n=t.overrides)==null?void 0:n.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&zs(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const n=e[t];if(n.kind==="metadata"&&n.label==="id3")return __(n,this.media),n}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:n,enableID3MetadataCues:s}=this.hls.config;if(!n&&!s)return;const{samples:i}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const a=Vd();if(a)for(let o=0;o<i.length;o++){const l=i[o].type;if(l===Yt.emsg&&!n||!s)continue;const u=YE(i[o].data),c=i[o].pts;let d=c+i[o].duration;d>wo&&(d=wo),d-c<=0&&(d=c+dk);for(let h=0;h<u.length;h++){const g=u[h];if(!ZE(g)){this.updateId3CueEnds(c,l);const p=oc(a,c,d,g,l);p&&this.id3Track.addCue(p)}}}}updateId3CueEnds(e,t){var n;const s=(n=this.id3Track)==null?void 0:n.cues;if(s)for(let i=s.length;i--;){const a=s[i];a.type===t&&a.startTime<e&&a.endTime===wo&&(a.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:n,type:s}){const{id3Track:i,hls:a}=this;if(!a)return;const{config:{enableEmsgMetadataCues:o,enableID3MetadataCues:l}}=a;if(i&&(o||l)){let u;s==="audio"?u=c=>c.type===Yt.audioId3&&l:s==="video"?u=c=>c.type===Yt.emsg&&o:u=c=>c.type===Yt.audioId3&&l||c.type===Yt.emsg&&o,Gd(i,t,n,u)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:n,timelineOffset:s,enableDateRangeMetadataCues:i,interstitialsController:a}=this.hls.config;if(!i)return;const o=Vd();if(n&&s&&!a){const{fragmentStart:p,fragmentEnd:v}=e;let m=this.assetCue;m?(m.startTime=p,m.endTime=v):o&&(m=this.assetCue=oc(o,p,v,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),m&&(m.id=n,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(m),m.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:l}=this,{dateRanges:u}=e,c=Object.keys(u);let d=this.dateRangeCuesAppended;if(l&&t){var f;if((f=l.cues)!=null&&f.length){const p=Object.keys(d).filter(v=>!c.includes(v));for(let v=p.length;v--;){var h;const m=p[v],y=(h=d[m])==null?void 0:h.cues;delete d[m],y&&Object.keys(y).forEach(S=>{const E=y[S];if(E){E.removeEventListener("enter",this.onEventCueEnter);try{l.removeCue(E)}catch{}}})}}else d=this.dateRangeCuesAppended={}}const g=e.fragments[e.fragments.length-1];if(!(c.length===0||!J(g==null?void 0:g.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let p=0;p<c.length;p++){const v=c[p],m=u[v],y=m.startTime,S=d[v],E=(S==null?void 0:S.cues)||{};let T=(S==null?void 0:S.durationKnown)||!1,A=wo;const{duration:x,endDate:w}=m;if(w&&x!==null)A=y+x,T=!0;else if(m.endOnNext&&!T){const I=c.reduce((M,K)=>{if(K!==m.id){const z=u[K];if(z.class===m.class&&z.startDate>m.startDate&&(!M||m.startDate<M.startDate))return z}return M},null);I&&(A=I.startTime,T=!0)}const b=Object.keys(m.attr);for(let I=0;I<b.length;I++){const M=b[I];if(!DI(M))continue;const K=E[M];if(K)T&&!(S!=null&&S.durationKnown)?K.endTime=A:Math.abs(K.startTime-y)>.01&&(K.startTime=y,K.endTime=A);else if(o){let z=m.attr[M];OI(M)&&(z=aE(z));const Q=oc(o,y,A,{key:M,data:z},Yt.dateRange);Q&&(Q.id=v,this.id3Track.addCue(Q),E[M]=Q,a&&(M==="X-ASSET-LIST"||M==="X-ASSET-URL")&&Q.addEventListener("enter",this.onEventCueEnter))}}d[v]={cues:E,dateRange:m,durationKnown:T}}}}}class hk{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,n=this.levelDetails;if(!t||!n)return;this.currentTime=t.currentTime;const s=this.computeLatency();if(s===null)return;this._latency=s;const{lowLatencyMode:i,maxLiveSyncPlaybackRate:a}=this.config;if(!i||a===1||!n.live)return;const o=this.targetLatency;if(o===null)return;const l=s-o,u=Math.min(this.maxLatency,o+n.targetduration);if(l<u&&l>.05&&this.forwardBufferLength>1){const d=Math.min(2,Math.max(1,a)),f=Math.round(2/(1+Math.exp(-.75*l-this.edgeStalled))*20)/20,h=Math.min(d,Math.max(1,f));this.changeMediaPlaybackRate(t,h)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:n,targetduration:s}=e,{liveSyncDuration:i,liveSyncDurationCount:a,lowLatencyMode:o}=this.config,l=this.hls.userConfig;let u=o&&n||t;(this._targetLatencyUpdated||l.liveSyncDuration||l.liveSyncDurationCount||u===0)&&(u=i!==void 0?i:a*s);const c=s;return u+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,c)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const n=this.levelDetails;if(n===null)return null;const s=n.edge,i=e-t-this.edgeStalled,a=s-n.totalduration,o=s-(this.config.lowLatencyMode&&n.partTarget||n.targetduration);return Math.min(Math.max(a,i),o)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const n=e.buffered.length;return(n?e.buffered.end(n-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(_.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(_.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(_.MANIFEST_LOADING,this.onManifestLoading,this),e.on(_.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(_.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(_.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(_.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(_.MANIFEST_LOADING,this.onManifestLoading,this),e.off(_.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(_.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var n;t.details===O.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(n=this.levelDetails)!=null&&n.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var n,s;e.playbackRate!==t&&((n=this.hls)==null||n.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(s=this.targetLatency)==null?void 0:s.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class gk extends up{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(_.MANIFEST_LOADING,this.onManifestLoading,this),e.on(_.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(_.LEVEL_LOADED,this.onLevelLoaded,this),e.on(_.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(_.FRAG_BUFFERED,this.onFragBuffered,this),e.on(_.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(_.MANIFEST_LOADING,this.onManifestLoading,this),e.off(_.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(_.LEVEL_LOADED,this.onLevelLoaded,this),e.off(_.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(_.FRAG_BUFFERED,this.onFragBuffered,this),e.off(_.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const n=this.hls.config.preferManagedMediaSource,s=[],i={},a={};let o=!1,l=!1,u=!1;t.levels.forEach(c=>{const d=c.attrs;let{audioCodec:f,videoCodec:h}=c;f&&(c.audioCodec=f=Il(f,n)||void 0),h&&(h=c.videoCodec=Zw(h));const{width:g,height:p,unknownCodecs:v}=c,m=(v==null?void 0:v.length)||0;if(o||(o=!!(g&&p)),l||(l=!!h),u||(u=!!f),m||f&&!this.isAudioSupported(f)||h&&!this.isVideoSupported(h)){this.log(`Some or all CODECS not supported "${d.CODECS}"`);return}const{CODECS:y,"FRAME-RATE":S,"HDCP-LEVEL":E,"PATHWAY-ID":T,RESOLUTION:A,"VIDEO-RANGE":x}=d,b=`${`${T||"."}-`}${c.bitrate}-${A}-${S}-${y}-${x}-${E}`;if(i[b])if(i[b].uri!==c.url&&!c.attrs["PATHWAY-ID"]){const I=a[b]+=1;c.attrs["PATHWAY-ID"]=new Array(I+1).join(".");const M=this.createLevel(c);i[b]=M,s.push(M)}else i[b].addGroupId("audio",d.AUDIO),i[b].addGroupId("text",d.SUBTITLES);else{const I=this.createLevel(c);i[b]=I,a[b]=1,s.push(I)}}),this.filterAndSortMediaOptions(s,t,o,l,u)}createLevel(e){const t=new va(e),n=e.supplemental;if(n!=null&&n.videoCodec&&!this.isVideoSupported(n.videoCodec)){const s=new Error(`SUPPLEMENTAL-CODECS not supported "${n.videoCodec}"`);this.log(s.message),t.supportedResult=yE(s,[])}return t}isAudioSupported(e){return pa(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return pa(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,n,s,i){var a;let o=[],l=[],u=e;const c=((a=t.stats)==null?void 0:a.parsing)||{};if((n||s)&&i&&(u=u.filter(({videoCodec:y,videoRange:S,width:E,height:T})=>(!!y||!!(E&&T))&&aI(S))),u.length===0){Promise.resolve().then(()=>{if(this.hls){let y="no level with compatible codecs found in manifest",S=y;t.levels.length&&(S=`one or more CODECS in variant not supported: ${Re(t.levels.map(T=>T.attrs.CODECS).filter((T,A,x)=>x.indexOf(T)===A))}`,this.warn(S),y+=` (${S})`);const E=new Error(y);this.hls.trigger(_.ERROR,{type:se.MEDIA_ERROR,details:O.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:E,reason:S})}}),c.end=performance.now();return}t.audioTracks&&(o=t.audioTracks.filter(y=>!y.audioCodec||this.isAudioSupported(y.audioCodec)),lv(o)),t.subtitles&&(l=t.subtitles,lv(l));const d=u.slice(0);u.sort((y,S)=>{if(y.attrs["HDCP-LEVEL"]!==S.attrs["HDCP-LEVEL"])return(y.attrs["HDCP-LEVEL"]||"")>(S.attrs["HDCP-LEVEL"]||"")?1:-1;if(n&&y.height!==S.height)return y.height-S.height;if(y.frameRate!==S.frameRate)return y.frameRate-S.frameRate;if(y.videoRange!==S.videoRange)return bl.indexOf(y.videoRange)-bl.indexOf(S.videoRange);if(y.videoCodec!==S.videoCodec){const E=J0(y.videoCodec),T=J0(S.videoCodec);if(E!==T)return T-E}if(y.uri===S.uri&&y.codecSet!==S.codecSet){const E=wl(y.codecSet),T=wl(S.codecSet);if(E!==T)return T-E}return y.averageBitrate!==S.averageBitrate?y.averageBitrate-S.averageBitrate:0});let f=d[0];if(this.steering&&(u=this.steering.filterParsedLevels(u),u.length!==d.length)){for(let y=0;y<d.length;y++)if(d[y].pathwayId===u[0].pathwayId){f=d[y];break}}this._levels=u;for(let y=0;y<u.length;y++)if(u[y]===f){var h;this._firstLevel=y;const S=f.bitrate,E=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${u.length} level(s) found, first bitrate: ${S}`),((h=this.hls.userConfig)==null?void 0:h.abrEwmaDefaultEstimate)===void 0){const T=Math.min(S,this.hls.config.abrEwmaDefaultEstimateMax);T>E&&E===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=T)}break}const g=i&&!s,p=this.hls.config,v=!!(p.audioStreamController&&p.audioTrackController),m={levels:u,audioTracks:o,subtitleTracks:l,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:i,video:s,altAudio:v&&!g&&o.some(y=>!!y.url)};c.end=performance.now(),this.hls.trigger(_.MANIFEST_PARSED,m)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const c=new Error("invalid level idx"),d=e<0;if(this.hls.trigger(_.ERROR,{type:se.OTHER_ERROR,details:O.LEVEL_SWITCH_ERROR,level:e,fatal:d,error:c,reason:c.message}),d)return;e=Math.min(e,t.length-1)}const n=this.currentLevelIndex,s=this.currentLevel,i=s?s.attrs["PATHWAY-ID"]:void 0,a=t[e],o=a.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=a,n===e&&s&&i===o)return;this.log(`Switching to level ${e} (${a.height?a.height+"p ":""}${a.videoRange?a.videoRange+" ":""}${a.codecSet?a.codecSet+" ":""}@${a.bitrate})${o?" with Pathway "+o:""} from level ${n}${i?" with Pathway "+i:""}`);const l={level:e,attrs:a.attrs,details:a.details,bitrate:a.bitrate,averageBitrate:a.averageBitrate,maxBitrate:a.maxBitrate,realBitrate:a.realBitrate,width:a.width,height:a.height,codecSet:a.codecSet,audioCodec:a.audioCodec,videoCodec:a.videoCodec,audioGroups:a.audioGroups,subtitleGroups:a.subtitleGroups,loaded:a.loaded,loadError:a.loadError,fragmentError:a.fragmentError,name:a.name,id:a.id,uri:a.uri,url:a.url,urlId:0,audioGroupIds:a.audioGroupIds,textGroupIds:a.textGroupIds};this.hls.trigger(_.LEVEL_SWITCHING,l);const u=a.details;if(!u||u.live){const c=this.switchParams(a.uri,s==null?void 0:s.details,u);this.loadPlaylist(c)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),n=e.filter(s=>t.indexOf(s)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=n}}onError(e,t){t.fatal||!t.context||t.context.type===ve.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===ee.MAIN){const n=t.elementaryStreams;if(!Object.keys(n).some(i=>!!n[i]))return;const s=this._levels[t.level];s!=null&&s.loadError&&(this.log(`Resetting level error count of ${s.loadError} on frag buffered`),s.loadError=0)}}onLevelLoaded(e,t){var n;const{level:s,details:i}=t,a=t.levelInfo;if(!a){var o;this.warn(`Invalid level index ${s}`),(o=t.deliveryDirectives)!=null&&o.skip&&(i.deltaUpdateFailed=!0);return}if(a===this.currentLevel||t.withoutMultiVariant){a.fragmentError===0&&(a.loadError=0);let l=a.details;l===t.details&&l.advanced&&(l=void 0),this.playlistLoaded(s,t,l)}else(n=t.deliveryDirectives)!=null&&n.skip&&(i.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=this.getUrlWithDirectives(e.uri,t),s=this.currentLevelIndex,i=e.attrs["PATHWAY-ID"],a=e.details,o=a==null?void 0:a.age;this.log(`Loading level index ${s}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${i?" Pathway "+i:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${n}`),this.hls.trigger(_.LEVEL_LOADING,{url:n,level:s,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const n=this._levels.filter((i,a)=>a!==e?!0:(this.steering&&this.steering.removeLevel(i),i===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,i.details&&i.details.fragments.forEach(o=>o.level=-1)),!1));UE(n),this._levels=n,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const s=n.length-1;this._firstLevel=Math.min(this._firstLevel,s),this._startLevel&&(this._startLevel=Math.min(this._startLevel,s)),this.hls.trigger(_.LEVELS_UPDATED,{levels:n})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:n}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(_.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:n}))}}function lv(r){const e={};r.forEach(t=>{const n=t.groupId||"";t.id=e[n]=e[n]||0,e[n]++})}function O_(){return self.SourceBuffer||self.WebKitSourceBuffer}function M_(){if(!On())return!1;const e=O_();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function pk(){if(!M_())return!1;const r=On();return typeof(r==null?void 0:r.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>r.isTypeSupported(ma(e,"video")))||["mp4a.40.2","fLaC"].some(e=>r.isTypeSupported(ma(e,"audio"))))}function mk(){var r;const e=O_();return typeof(e==null||(r=e.prototype)==null?void 0:r.changeType)=="function"}const vk=100;class yk extends tp{constructor(e,t,n){super(e,t,n,"stream-controller",ee.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const s=this.media,i=s?s.currentTime:null;if(i===null||!J(i)||(this.log(`Media seeked to ${i.toFixed(3)}`),!this.getBufferedFrag(i)))return;const a=this.getFwdBufferInfoAtPos(s,i,ee.MAIN,0);if(a===null||a.len===0){this.warn(`Main forward buffer length at ${i} on "seeked" event ${a?a.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(_.MANIFEST_PARSED,this.onManifestParsed,this),e.on(_.LEVEL_LOADING,this.onLevelLoading,this),e.on(_.LEVEL_LOADED,this.onLevelLoaded,this),e.on(_.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(_.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(_.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(_.BUFFER_CREATED,this.onBufferCreated,this),e.on(_.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(_.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(_.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(_.MANIFEST_PARSED,this.onManifestParsed,this),e.off(_.LEVEL_LOADED,this.onLevelLoaded,this),e.off(_.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(_.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(_.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(_.BUFFER_CREATED,this.onBufferCreated,this),e.off(_.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(_.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(_.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:n,hls:s}=this;if(this.stopLoad(),this.setInterval(vk),this.level=-1,!this.startFragRequested){let i=s.startLevel;i===-1&&(s.config.testBandwidth&&this.levels.length>1?(i=0,this.bitrateTest=!0):i=s.firstAutoLevel),s.nextLoadLevel=i,this.level=s.loadLevel,this._hasEnoughToStart=!!t}n>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${n.toFixed(3)}`),e=n),this.state=j.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=j.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case j.WAITING_LEVEL:{const{levels:e,level:t}=this,n=e==null?void 0:e[t],s=n==null?void 0:n.details;if(s&&(!s.live||this.levelLastLoaded===n&&!this.waitForLive(n))){if(this.waitForCdnTuneIn(s))break;this.state=j.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=j.IDLE;break}break}case j.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===j.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:n,media:s}=this;if(t===null||!s&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const i=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(n!=null&&n[i]))return;const a=n[i],o=this.getMainFwdBufferInfo();if(o===null)return;const l=this.getLevelDetails();if(l&&this._streamEnded(o,l)){const p={};this.altAudio===2&&(p.type="video"),this.hls.trigger(_.BUFFER_EOS,p),this.state=j.ENDED;return}if(!this.buffering)return;e.loadLevel!==i&&e.manualLevel===-1&&this.log(`Adapting to level ${i} from level ${this.level}`),this.level=e.nextLoadLevel=i;const u=a.details;if(!u||this.state===j.WAITING_LEVEL||this.waitForLive(a)){this.level=i,this.state=j.WAITING_LEVEL,this.startFragRequested=!1;return}const c=o.len,d=this.getMaxBufferLength(a.maxBitrate);if(c>=d)return;this.backtrackFragment&&this.backtrackFragment.start>o.end&&(this.backtrackFragment=null);const f=this.backtrackFragment?this.backtrackFragment.start:o.end;let h=this.getNextFragment(f,u);if(this.couldBacktrack&&!this.fragPrevious&&h&&qe(h)&&this.fragmentTracker.getState(h)!==tt.OK){var g;const v=((g=this.backtrackFragment)!=null?g:h).sn-u.startSN,m=u.fragments[v-1];m&&h.cc===m.cc&&(h=m,this.fragmentTracker.removeFragment(m))}else this.backtrackFragment&&o.len&&(this.backtrackFragment=null);if(h&&this.isLoopLoading(h,f)){if(!h.gap){const v=this.audioOnly&&!this.altAudio?be.AUDIO:be.VIDEO,m=(v===be.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;m&&this.afterBufferFlushed(m,v,ee.MAIN)}h=this.getNextFragmentLoopLoading(h,u,o,ee.MAIN,d)}h&&(h.initSegment&&!h.initSegment.data&&!this.bitrateTest&&(h=h.initSegment),this.loadFragment(h,a,f))}loadFragment(e,t,n){const s=this.fragmentTracker.getState(e);s===tt.NOT_LOADED||s===tt.PARTIAL?qe(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,n):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,ee.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let n;const s=this.getAppendedFrag(t.currentTime);s&&s.start>1&&this.flushMainBuffer(0,s.start-1);const i=this.getLevelDetails();if(i!=null&&i.live){const o=this.getMainFwdBufferInfo();if(!o||o.len<i.targetduration*2)return}if(!t.paused&&e){const o=this.hls.nextLoadLevel,l=e[o],u=this.fragLastKbps;u&&this.fragCurrent?n=this.fragCurrent.duration*l.maxBitrate/(1e3*u)+1:n=0}else n=0;const a=this.getBufferedFrag(t.currentTime+n);if(a){const o=this.followingBufferedFrag(a);if(o){this.abortCurrentFrag();const l=o.maxStartPTS?o.maxStartPTS:o.start,u=o.duration,c=Math.max(a.end,l+Math.min(Math.max(u-this.config.maxFragLookUpTolerance,u*(this.couldBacktrack?.5:.125)),u*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(c,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case j.KEY_LOADING:case j.FRAG_LOADING:case j.FRAG_LOADING_WAITING_RETRY:case j.PARSING:case j.PARSED:this.state=j.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const n=t.media;At(n,"playing",this.onMediaPlaying),At(n,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:n}=this;n&&(Mt(n,"playing",this.onMediaPlaying),Mt(n,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(_.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let n=!1,s=!1;for(let i=0;i<t.levels.length;i++){const a=t.levels[i].audioCodec;a&&(n=n||a.indexOf("mp4a.40.2")!==-1,s=s||a.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=n&&s&&!mk(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:n}=this;if(!n||this.state!==j.IDLE)return;const s=t.levelInfo;(!s.details||s.details.live&&(this.levelLastLoaded!==s||s.details.expired)||this.waitForCdnTuneIn(s.details))&&(this.state=j.WAITING_LEVEL)}onLevelLoaded(e,t){var n;const{levels:s,startFragRequested:i}=this,a=t.level,o=t.details,l=o.totalduration;if(!s){this.warn(`Levels were reset while loading level ${a}`);return}this.log(`Level ${a} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""}, cc [${o.startCC}, ${o.endCC}] duration:${l}`);const u=t.levelInfo,c=this.fragCurrent;c&&(this.state===j.FRAG_LOADING||this.state===j.FRAG_LOADING_WAITING_RETRY)&&c.level!==t.level&&c.loader&&this.abortCurrentFrag();let d=0;if(o.live||(n=u.details)!=null&&n.live){var f;if(this.checkLiveUpdate(o),o.deltaUpdateFailed)return;d=this.alignPlaylists(o,u.details,(f=this.levelLastLoaded)==null?void 0:f.details)}if(u.details=o,this.levelLastLoaded=u,i||this.setStartPosition(o,d),this.hls.trigger(_.LEVEL_UPDATED,{details:o,level:a}),this.state===j.WAITING_LEVEL){if(this.waitForCdnTuneIn(o))return;this.state=j.IDLE}i&&o.live&&this.synchronizeToLiveEdge(o),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:n}=this;if(!n)return;const s=this.hls.liveSyncPosition,i=this.getLoadPosition(),a=e.fragmentStart,o=e.edge,l=i>=a-t.maxFragLookUpTolerance&&i<=o;if(s!==null&&n.duration>s&&(i<s||!l)){const c=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!l&&n.readyState<4||i<o-c)&&(this._hasEnoughToStart||(this.nextLoadPosition=s),n.readyState))if(this.warn(`Playback: ${i.toFixed(3)} is located too far from the end of live sliding playlist: ${o}, reset currentTime to : ${s.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var u;const d=ge.bufferInfo(n,s,0);if(!((u=d.buffered)!=null&&u.length)){n.currentTime=s;return}if(d.start<=i){n.currentTime=s;return}const{nextStart:h}=ge.bufferedInfo(d.buffered,i,0);h&&(n.currentTime=h)}else n.currentTime=s}}_handleFragmentLoadProgress(e){var t;const n=e.frag,{part:s,payload:i}=e,{levels:a}=this;if(!a){this.warn(`Levels were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}const o=a[n.level];if(!o){this.warn(`Level ${n.level} not found on progress`);return}const l=o.details;if(!l){this.warn(`Dropping fragment ${n.sn} of level ${n.level} after level details were reset`),this.fragmentTracker.removeFragment(n);return}const u=o.videoCodec,c=l.PTSKnown||!l.live,d=(t=n.initSegment)==null?void 0:t.data,f=this._getAudioCodec(o),h=this.transmuxer=this.transmuxer||new o_(this.hls,ee.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),g=s?s.index:-1,p=g!==-1,v=new Xg(n.level,n.sn,n.stats.chunkCount,i.byteLength,g,p),m=this.initPTS[n.cc];h.push(i,d,f,u,n,s,l.totalduration,c,v,m)}onAudioTrackSwitching(e,t){const n=this.hls,s=this.altAudio!==0;if(Rl(t.url,n))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const a=this.fragCurrent;a&&(this.log("Switching to main audio track, cancel main fragment load"),a.abortRequests(),this.fragmentTracker.removeFragment(a)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(s){this.altAudio=0,this.fragmentTracker.removeAllFragments(),n.once(_.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(_.AUDIO_TRACK_SWITCHED,t)}),n.trigger(_.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}n.trigger(_.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const n=Rl(t.url,this.hls);if(n){const s=this.videoBuffer;s&&this.mediaBuffer!==s&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=s)}this.altAudio=n?2:0,this.tick()}onBufferCreated(e,t){const n=t.tracks;let s,i,a=!1;for(const o in n){const l=n[o];if(l.id==="main"){if(i=o,s=l,o==="video"){const u=n[o];u&&(this.videoBuffer=u.buffer)}}else a=!0}a&&s?(this.log(`Alternate track found, use ${i}.buffered to schedule main fragment loading`),this.mediaBuffer=s.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:n,part:s}=t,i=n.type===ee.MAIN;if(i){if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${s?" p: "+s.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}`),this.state===j.PARSED&&(this.state=j.IDLE);return}const o=s?s.stats:n.stats;this.fragLastKbps=Math.round(8*o.total/(o.buffering.end-o.loading.first)),qe(n)&&(this.fragPrevious=n),this.fragBufferedComplete(n,s)}const a=this.media;a&&(!this._hasEnoughToStart&&ge.getBuffered(a).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),i&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var n;if(t.fatal){this.state=j.ERROR;return}switch(t.details){case O.FRAG_GAP:case O.FRAG_PARSING_ERROR:case O.FRAG_DECRYPT_ERROR:case O.FRAG_LOAD_ERROR:case O.FRAG_LOAD_TIMEOUT:case O.KEY_LOAD_ERROR:case O.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ee.MAIN,t);break;case O.LEVEL_LOAD_ERROR:case O.LEVEL_LOAD_TIMEOUT:case O.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===j.WAITING_LEVEL&&((n=t.context)==null?void 0:n.type)===ve.LEVEL&&(this.state=j.IDLE);break;case O.BUFFER_ADD_CODEC_ERROR:case O.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case O.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case O.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=j.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==be.AUDIO||!this.altAudio){const n=(t===be.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;n&&(this.afterBufferFlushed(n,t,ee.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let n=this.startPosition;if(n>=0&&t<n){if(e.seeking){this.log(`could not seek to ${n}, already seeking at ${t}`);return}const s=this.timelineOffset;s&&n&&(n+=s);const i=this.getLevelDetails(),a=ge.getBuffered(e),o=a.length?a.start(0):0,l=o-n,u=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||l>0&&(l<u||this.loadingParts&&l<2*((i==null?void 0:i.partTarget)||0)))&&(this.log(`adjusting start position by ${l} to match buffer start`),n+=l,this.startPosition=n),t<n&&(this.log(`seek to target start position ${n} from current time ${t} buffer start ${o}`),e.currentTime=n)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(n=>{const{hls:s}=this,i=n==null?void 0:n.frag;if(!i||this.fragContextChanged(i))return;t.fragmentError=0,this.state=j.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const a=i.stats;a.parsing.start=a.parsing.end=a.buffering.start=a.buffering.end=self.performance.now(),s.trigger(_.FRAG_LOADED,n),i.bitrateTest=!1}).catch(n=>{this.state===j.STOPPED||this.state===j.ERROR||(this.warn(n),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:n}=this,{remuxResult:s,chunkMeta:i}=e,a=this.getCurrentContext(i);if(!a){this.resetWhenMissingContext(i);return}const{frag:o,part:l,level:u}=a,{video:c,text:d,id3:f,initSegment:h}=s,{details:g}=u,p=this.altAudio?void 0:s.audio;if(this.fragContextChanged(o)){this.fragmentTracker.removeFragment(o);return}if(this.state=j.PARSING,h){const v=h.tracks;if(v){const E=o.initSegment||o;if(this.unhandledEncryptionError(h,o))return;this._bufferInitSegment(u,v,E,i),n.trigger(_.FRAG_PARSING_INIT_SEGMENT,{frag:E,id:t,tracks:v})}const m=h.initPTS,y=h.timescale,S=this.initPTS[o.cc];if(J(m)&&(!S||S.baseTime!==m||S.timescale!==y)){const E=h.trackId;this.initPTS[o.cc]={baseTime:m,timescale:y,trackId:E},n.trigger(_.INIT_PTS_FOUND,{frag:o,id:t,initPTS:m,timescale:y,trackId:E})}}if(c&&g){p&&c.type==="audiovideo"&&this.logMuxedErr(o);const v=g.fragments[o.sn-1-g.startSN],m=o.sn===g.startSN,y=!v||o.cc>v.cc;if(s.independent!==!1){const{startPTS:S,endPTS:E,startDTS:T,endDTS:A}=c;if(l)l.elementaryStreams[c.type]={startPTS:S,endPTS:E,startDTS:T,endDTS:A};else if(c.firstKeyFrame&&c.independent&&i.id===1&&!y&&(this.couldBacktrack=!0),c.dropped&&c.independent){const x=this.getMainFwdBufferInfo(),w=(x?x.end:this.getLoadPosition())+this.config.maxBufferHole,b=c.firstKeyFramePTS?c.firstKeyFramePTS:S;if(!m&&w<b-this.config.maxBufferHole&&!y){this.backtrack(o);return}else y&&(o.gap=!0);o.setElementaryStreamInfo(c.type,o.start,E,o.start,A,!0)}else m&&S-(g.appliedTimelineOffset||0)>el&&(o.gap=!0);o.setElementaryStreamInfo(c.type,S,E,T,A),this.backtrackFragment&&(this.backtrackFragment=o),this.bufferFragmentData(c,o,l,i,m||y)}else if(m||y)o.gap=!0;else{this.backtrack(o);return}}if(p){const{startPTS:v,endPTS:m,startDTS:y,endDTS:S}=p;l&&(l.elementaryStreams[be.AUDIO]={startPTS:v,endPTS:m,startDTS:y,endDTS:S}),o.setElementaryStreamInfo(be.AUDIO,v,m,y,S),this.bufferFragmentData(p,o,l,i)}if(g&&f!=null&&f.samples.length){const v={id:t,frag:o,details:g,samples:f.samples};n.trigger(_.FRAG_PARSING_METADATA,v)}if(g&&d){const v={id:t,frag:o,details:g,samples:d.samples};n.trigger(_.FRAG_PARSING_USERDATA,v)}}logMuxedErr(e){this.warn(`${qe(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,n,s){if(this.state!==j.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(n));const{audio:i,video:a,audiovideo:o}=t;if(i){const u=e.audioCodec;let c=zo(i.codec,u);c==="mp4a"&&(c="mp4a.40.5");const d=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){c&&(c.indexOf("mp4a.40.5")!==-1?c="mp4a.40.2":c="mp4a.40.5");const f=i.metadata;f&&"channelCount"in f&&(f.channelCount||1)!==1&&d.indexOf("firefox")===-1&&(c="mp4a.40.5")}c&&c.indexOf("mp4a.40.5")!==-1&&d.indexOf("android")!==-1&&i.container!=="audio/mpeg"&&(c="mp4a.40.2",this.log(`Android: force audio codec to ${c}`)),u&&u!==c&&this.log(`Swapping manifest audio codec "${u}" for "${c}"`),i.levelCodec=c,i.id=ee.MAIN,this.log(`Init audio buffer, container:${i.container}, codecs[selected/level/parsed]=[${c||""}/${u||""}/${i.codec}]`),delete t.audiovideo}if(a){a.levelCodec=e.videoCodec,a.id=ee.MAIN;const u=a.codec;if((u==null?void 0:u.length)===4)switch(u){case"hvc1":case"hev1":a.codec="hvc1.1.6.L120.90";break;case"av01":a.codec="av01.0.04M.08";break;case"avc1":a.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${a.container}, codecs[level/parsed]=[${e.videoCodec||""}/${u}]${a.codec!==u?" parsed-corrected="+a.codec:""}${a.supplemental?" supplemental="+a.supplemental:""}`),delete t.audiovideo}o&&(this.log(`Init audiovideo buffer, container:${o.container}, codecs[level/parsed]=[${e.codecs}/${o.codec}]`),delete t.video,delete t.audio);const l=Object.keys(t);if(l.length){if(this.hls.trigger(_.BUFFER_CODECS,t),!this.hls)return;l.forEach(u=>{const d=t[u].initSegment;d!=null&&d.byteLength&&this.hls.trigger(_.BUFFER_APPENDING,{type:u,data:d,frag:n,part:null,chunkMeta:s,parent:n.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,ee.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,n=e==null?void 0:e[t];return n?this.getMaxBufferLength(n.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=j.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const n=e.currentTime;if(ge.isBuffered(e,n)?t=this.getAppendedFrag(n):ge.isBuffered(e,n+.1)&&(t=this.getAppendedFrag(n+.1)),t){this.backtrackFragment=null;const s=this.fragPlaying,i=t.level;(!s||t.sn!==s.sn||s.level!==i)&&(this.fragPlaying=t,this.hls.trigger(_.FRAG_CHANGED,{frag:t}),(!s||s.level!==i)&&this.hls.trigger(_.LEVEL_SWITCHED,{level:i}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return J(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(J(t)){const n=this.getLevelDetails(),s=this.currentFrag||(n?cs(null,n.fragments,t):null);if(s){const i=s.programDateTime;if(i!==null){const a=i+(t-s.start)*1e3;return new Date(a)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class Sk extends fr{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const n in this.keyIdToKeyInfo){const s=this.keyIdToKeyInfo[n].loader;if(s){var t;if(e&&e!==((t=s.context)==null?void 0:t.frag.type))return;s.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=O.KEY_LOAD_ERROR,n,s,i){return new Hr({type:se.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:i,error:n,networkDetails:s})}loadClear(e,t,n){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let s=0,i=t.length;s<i;s++){const a=t[s];if(e.cc<=a.cc&&(!qe(e)||!qe(a)||e.sn<a.sn)||!n&&s==i-1)return this.emeController.selectKeySystemFormat(a).then(o=>{if(!this.emeController)return;a.setKeyFormat(o);const l=Yo(o);if(l)return this.emeController.getKeySystemAccess([l])})}if(this.config.requireKeySystemAccessOnStart){const s=Ni(this.config);if(s.length)return this.emeController.getKeySystemAccess(s)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var n,s;t&&e.setKeyFormat(t);const i=e.decryptdata;if(!i){const u=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,O.KEY_LOAD_ERROR,u))}const a=i.uri;if(!a)return Promise.reject(this.createKeyLoadError(e,O.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${a}"`)));const o=lc(i);let l=this.keyIdToKeyInfo[o];if((n=l)!=null&&n.decryptdata.key)return i.key=l.decryptdata.key,Promise.resolve({frag:e,keyInfo:l});if(this.emeController&&(s=l)!=null&&s.keyLoadPromise)switch(this.emeController.getKeyStatus(l.decryptdata)){case"usable":case"usable-in-future":return l.keyLoadPromise.then(c=>{const{keyInfo:d}=c;return i.key=d.decryptdata.key,{frag:e,keyInfo:d}})}switch(this.log(`${this.keyIdToKeyInfo[o]?"Rel":"L"}oading${i.keyId?" keyId: "+dt(i.keyId):""} URI: ${i.uri} from ${e.type} ${e.level}`),l=this.keyIdToKeyInfo[o]={decryptdata:i,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},i.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return i.keyFormat==="identity"?this.loadKeyHTTP(l,e):this.loadKeyEME(l,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(l,e);default:return Promise.reject(this.createKeyLoadError(e,O.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${i.method}"`)))}}loadKeyEME(e,t){const n={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var s;if(!e.decryptdata.keyId&&(s=t.initSegment)!=null&&s.data){const a=$w(t.initSegment.data);if(a.length){let o=a[0];o.some(l=>l!==0)?(this.log(`Using keyId found in init segment ${dt(o)}`),Cn.setKeyIdForUri(e.decryptdata.uri,o)):(o=Cn.addKeyIdForUri(e.decryptdata.uri),this.log(`Generating keyId to patch media ${dt(o)}`)),e.decryptdata.keyId=o}}if(!e.decryptdata.keyId&&!qe(t))return Promise.resolve(n);const i=this.emeController.loadKey(n);return(e.keyLoadPromise=i.then(a=>(e.mediaKeySessionContext=a,n))).catch(a=>{throw e.keyLoadPromise=null,"data"in a&&(a.data.frag=t),a})}return Promise.resolve(n)}loadKeyHTTP(e,t){const n=this.config,s=n.loader,i=new s(n);return t.keyLoader=e.loader=i,e.keyLoadPromise=new Promise((a,o)=>{const l={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},u=n.keyLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(f,h,g,p)=>{const{frag:v,keyInfo:m}=g,y=lc(m.decryptdata);if(!v.decryptdata||m!==this.keyIdToKeyInfo[y])return o(this.createKeyLoadError(v,O.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),p));m.decryptdata.key=v.decryptdata.key=new Uint8Array(f.data),v.keyLoader=null,m.loader=null,a({frag:v,keyInfo:m})},onError:(f,h,g,p)=>{this.resetLoader(h),o(this.createKeyLoadError(t,O.KEY_LOAD_ERROR,new Error(`HTTP Error ${f.code} loading key ${f.text}`),g,Te({url:l.url,data:void 0},f)))},onTimeout:(f,h,g)=>{this.resetLoader(h),o(this.createKeyLoadError(t,O.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),g))},onAbort:(f,h,g)=>{this.resetLoader(h),o(this.createKeyLoadError(t,O.INTERNAL_ABORTED,new Error("key loading aborted"),g))}};i.load(l,c,d)})}resetLoader(e){const{frag:t,keyInfo:n,url:s}=e,i=n.loader;t.keyLoader===i&&(t.keyLoader=null,n.loader=null);const a=lc(n.decryptdata)||s;delete this.keyIdToKeyInfo[a],i&&i.destroy()}}function lc(r){if(r.keyFormat!==ft.FAIRPLAY){const e=r.keyId;if(e)return dt(e)}return r.uri}function uv(r){const{type:e}=r;switch(e){case ve.AUDIO_TRACK:return ee.AUDIO;case ve.SUBTITLE_TRACK:return ee.SUBTITLE;default:return ee.MAIN}}function uc(r,e){let t=r.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class Ek{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(_.MANIFEST_LOADING,this.onManifestLoading,this),e.on(_.LEVEL_LOADING,this.onLevelLoading,this),e.on(_.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(_.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(_.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(_.MANIFEST_LOADING,this.onManifestLoading,this),e.off(_.LEVEL_LOADING,this.onLevelLoading,this),e.off(_.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(_.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(_.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,n=t.pLoader,s=t.loader,i=n||s,a=new i(t);return this.loaders[e.type]=a,a}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:n}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:ve.MANIFEST,url:n,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:n,level:s,pathwayId:i,url:a,deliveryDirectives:o,levelInfo:l}=t;this.load({id:n,level:s,pathwayId:i,responseType:"text",type:ve.LEVEL,url:a,deliveryDirectives:o,levelOrTrack:l})}onAudioTrackLoading(e,t){const{id:n,groupId:s,url:i,deliveryDirectives:a,track:o}=t;this.load({id:n,groupId:s,level:null,responseType:"text",type:ve.AUDIO_TRACK,url:i,deliveryDirectives:a,levelOrTrack:o})}onSubtitleTrackLoading(e,t){const{id:n,groupId:s,url:i,deliveryDirectives:a,track:o}=t;this.load({id:n,groupId:s,level:null,responseType:"text",type:ve.SUBTITLE_TRACK,url:i,deliveryDirectives:a,levelOrTrack:o})}onLevelsUpdated(e,t){const n=this.loaders[ve.LEVEL];if(n){const s=n.context;s&&!t.levels.some(i=>i===s.levelOrTrack)&&(n.abort(),delete this.loaders[ve.LEVEL])}}load(e){var t;const n=this.hls.config;let s=this.getInternalLoader(e);if(s){const u=this.hls.logger,c=s.context;if(c&&c.levelOrTrack===e.levelOrTrack&&(c.url===e.url||c.deliveryDirectives&&!e.deliveryDirectives)){c.url===e.url?u.log(`[playlist-loader]: ignore ${e.url} ongoing request`):u.log(`[playlist-loader]: ignore ${e.url} in favor of ${c.url}`);return}u.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),s.abort()}let i;if(e.type===ve.MANIFEST?i=n.manifestLoadPolicy.default:i=we({},n.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),s=this.createInternalLoader(e),J((t=e.deliveryDirectives)==null?void 0:t.part)){let u;if(e.type===ve.LEVEL&&e.level!==null?u=this.hls.levels[e.level].details:e.type===ve.AUDIO_TRACK&&e.id!==null?u=this.hls.audioTracks[e.id].details:e.type===ve.SUBTITLE_TRACK&&e.id!==null&&(u=this.hls.subtitleTracks[e.id].details),u){const c=u.partTarget,d=u.targetduration;if(c&&d){const f=Math.max(c*3,d*.8)*1e3;i=we({},i,{maxTimeToFirstByteMs:Math.min(f,i.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(f,i.maxTimeToFirstByteMs)})}}}const a=i.errorRetry||i.timeoutRetry||{},o={loadPolicy:i,timeout:i.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},l={onSuccess:(u,c,d,f)=>{const h=this.getInternalLoader(d);this.resetInternalLoader(d.type);const g=u.data;c.parsing.start=performance.now(),Nr.isMediaPlaylist(g)||d.type!==ve.MANIFEST?this.handleTrackOrLevelPlaylist(u,c,d,f||null,h):this.handleMasterPlaylist(u,c,d,f)},onError:(u,c,d,f)=>{this.handleNetworkError(c,d,!1,u,f)},onTimeout:(u,c,d)=>{this.handleNetworkError(c,d,!0,void 0,u)}};s.load(e,o,l)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:n}=this.hls;(e||n)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,n,s){const i=this.hls,a=e.data,o=uc(e,n),l=Nr.parseMasterPlaylist(a,o);if(l.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,n,l.playlistParsingError,s,t);return}const{contentSteering:u,levels:c,sessionData:d,sessionKeys:f,startTimeOffset:h,variableList:g}=l;this.variableList=g,c.forEach(y=>{const{unknownCodecs:S}=y;if(S){const{preferManagedMediaSource:E}=this.hls.config;let{audioCodec:T,videoCodec:A}=y;for(let x=S.length;x--;){const w=S[x];pa(w,"audio",E)?(y.audioCodec=T=T?`${T},${w}`:w,hi.audio[T.substring(0,4)]=2,S.splice(x,1)):pa(w,"video",E)&&(y.videoCodec=A=A?`${A},${w}`:w,hi.video[A.substring(0,4)]=2,S.splice(x,1))}}});const{AUDIO:p=[],SUBTITLES:v,"CLOSED-CAPTIONS":m}=Nr.parseMasterPlaylistMedia(a,o,l);p.length&&!p.some(S=>!S.url)&&c[0].audioCodec&&!c[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),p.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new $e({}),bitrate:0,url:""})),i.trigger(_.MANIFEST_LOADED,{levels:c,audioTracks:p,subtitles:v,captions:m,contentSteering:u,url:o,stats:t,networkDetails:s,sessionData:d,sessionKeys:f,startTimeOffset:h,variableList:g})}handleTrackOrLevelPlaylist(e,t,n,s,i){const a=this.hls,{id:o,level:l,type:u}=n,c=uc(e,n),d=J(l)?l:J(o)?o:0,f=uv(n),h=Nr.parseLevelPlaylist(e.data,c,d,f,0,this.variableList);if(u===ve.MANIFEST){const g={attrs:new $e({}),bitrate:0,details:h,name:"",url:c};h.requestScheduled=t.loading.start+NE(h,0),a.trigger(_.MANIFEST_LOADED,{levels:[g],audioTracks:[],url:c,stats:t,networkDetails:s,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),n.levelDetails=h,this.handlePlaylistLoaded(h,e,t,n,s,i)}handleManifestParsingError(e,t,n,s,i){this.hls.trigger(_.ERROR,{type:se.NETWORK_ERROR,details:O.MANIFEST_PARSING_ERROR,fatal:t.type===ve.MANIFEST,url:e.url,err:n,error:n,reason:n.message,response:e,context:t,networkDetails:s,stats:i})}handleNetworkError(e,t,n=!1,s,i){let a=`A network ${n?"timeout":"error"+(s?" (status "+s.code+")":"")} occurred while loading ${e.type}`;e.type===ve.LEVEL?a+=`: ${e.level} id: ${e.id}`:(e.type===ve.AUDIO_TRACK||e.type===ve.SUBTITLE_TRACK)&&(a+=` id: ${e.id} group-id: "${e.groupId}"`);const o=new Error(a);this.hls.logger.warn(`[playlist-loader]: ${a}`);let l=O.UNKNOWN,u=!1;const c=this.getInternalLoader(e);switch(e.type){case ve.MANIFEST:l=n?O.MANIFEST_LOAD_TIMEOUT:O.MANIFEST_LOAD_ERROR,u=!0;break;case ve.LEVEL:l=n?O.LEVEL_LOAD_TIMEOUT:O.LEVEL_LOAD_ERROR,u=!1;break;case ve.AUDIO_TRACK:l=n?O.AUDIO_TRACK_LOAD_TIMEOUT:O.AUDIO_TRACK_LOAD_ERROR,u=!1;break;case ve.SUBTITLE_TRACK:l=n?O.SUBTITLE_TRACK_LOAD_TIMEOUT:O.SUBTITLE_LOAD_ERROR,u=!1;break}c&&this.resetInternalLoader(e.type);const d={type:se.NETWORK_ERROR,details:l,fatal:u,url:e.url,loader:c,context:e,error:o,networkDetails:t,stats:i};if(s){const f=(t==null?void 0:t.url)||e.url;d.response=Te({url:f,data:void 0},s)}this.hls.trigger(_.ERROR,d)}handlePlaylistLoaded(e,t,n,s,i,a){const o=this.hls,{type:l,level:u,levelOrTrack:c,id:d,groupId:f,deliveryDirectives:h}=s,g=uc(t,s),p=uv(s);let v=typeof s.level=="number"&&p===ee.MAIN?u:void 0;const m=e.playlistParsingError;if(m){if(this.hls.logger.warn(`${m} ${e.url}`),!o.config.ignorePlaylistParsingErrors){o.trigger(_.ERROR,{type:se.NETWORK_ERROR,details:O.LEVEL_PARSING_ERROR,fatal:!1,url:g,error:m,reason:m.message,response:t,context:s,level:v,parent:p,networkDetails:i,stats:n});return}e.playlistParsingError=null}if(!e.fragments.length){const y=e.playlistParsingError=new Error("No Segments found in Playlist");o.trigger(_.ERROR,{type:se.NETWORK_ERROR,details:O.LEVEL_EMPTY_ERROR,fatal:!1,url:g,error:y,reason:y.message,response:t,context:s,level:v,parent:p,networkDetails:i,stats:n});return}switch(e.live&&a&&(a.getCacheAge&&(e.ageHeader=a.getCacheAge()||0),(!a.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),l){case ve.MANIFEST:case ve.LEVEL:if(v){if(!c)v=0;else if(c!==o.levels[v]){const y=o.levels.indexOf(c);y>-1&&(v=y)}}o.trigger(_.LEVEL_LOADED,{details:e,levelInfo:c||o.levels[0],level:v||0,id:d||0,stats:n,networkDetails:i,deliveryDirectives:h,withoutMultiVariant:l===ve.MANIFEST});break;case ve.AUDIO_TRACK:o.trigger(_.AUDIO_TRACK_LOADED,{details:e,track:c,id:d||0,groupId:f||"",stats:n,networkDetails:i,deliveryDirectives:h});break;case ve.SUBTITLE_TRACK:o.trigger(_.SUBTITLE_TRACK_LOADED,{details:e,track:c,id:d||0,groupId:f||"",stats:n,networkDetails:i,deliveryDirectives:h});break}}}class xt{static get version(){return ya}static isMSESupported(){return M_()}static isSupported(){return pk()}static getMediaSource(){return On()}static get Events(){return _}static get MetadataSchema(){return Yt}static get ErrorTypes(){return se}static get ErrorDetails(){return O}static get DefaultConfig(){return xt.defaultConfig?xt.defaultConfig:nk}static set DefaultConfig(e){xt.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new rp,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=Iw(e.debug||!1,"Hls instance",e.assetPlayerId),n=this.config=ik(xt.DefaultConfig,e,t);this.userConfig=e,n.progressive&&ak(n,t);const{abrController:s,bufferController:i,capLevelController:a,errorController:o,fpsController:l}=n,u=new o(this),c=this.abrController=new s(this),d=new _I(this),f=n.interstitialsController,h=f?this.interstitialsController=new f(this,xt):null,g=this.bufferController=new i(this,d),p=this.capLevelController=new a(this),v=new l(this),m=new Ek(this),y=n.contentSteeringController,S=y?new y(this):null,E=this.levelController=new gk(this,S),T=new fk(this),A=new Sk(this.config,this.logger),x=this.streamController=new yk(this,d,A),w=this.gapController=new ck(this,d);p.setStreamController(x),v.setStreamController(x);const b=[m,E,x];h&&b.splice(1,0,h),S&&b.splice(1,0,S),this.networkControllers=b;const I=[c,g,w,p,v,T,d];this.audioTrackController=this.createController(n.audioTrackController,b);const M=n.audioStreamController;M&&b.push(this.audioStreamController=new M(this,d,A)),this.subtitleTrackController=this.createController(n.subtitleTrackController,b);const K=n.subtitleStreamController;K&&b.push(this.subtititleStreamController=new K(this,d,A)),this.createController(n.timelineController,I),A.emeController=this.emeController=this.createController(n.emeController,I),this.cmcdController=this.createController(n.cmcdController,I),this.latencyController=this.createController(hk,I),this.coreComponents=I,b.push(u);const z=u.onErrorOut;typeof z=="function"&&this.on(_.ERROR,z,u),this.on(_.MANIFEST_LOADED,m.onManifestLoaded,m)}createController(e,t){if(e){const n=new e(this);return t&&t.push(n),n}return null}on(e,t,n=this){this._emitter.on(e,t,n)}once(e,t,n=this){this._emitter.once(e,t,n)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,n=this,s){this._emitter.off(e,t,n,s)}listeners(e){return this._emitter.listeners(e)}emit(e,t,n){return this._emitter.emit(e,t,n)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(n){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+n.message+'". Here is a stacktrace:',n),!this.triggeringException){this.triggeringException=!0;const s=e===_.ERROR;this.trigger(_.ERROR,{type:se.OTHER_ERROR,details:O.INTERNAL_EXCEPTION,fatal:s,event:e,error:n}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(_.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const i=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(_.ERROR,{type:se.OTHER_ERROR,details:O.ATTACH_MEDIA_ERROR,fatal:!0,error:i});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,n=t?e.media:e,s=t?e:{media:n};this._media=n,this.trigger(_.MEDIA_ATTACHING,s)}detachMedia(){this.logger.log("detachMedia"),this.trigger(_.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(_.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,n=this._url,s=this._url=Vg.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${s}`),t&&n&&(n!==s||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(_.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let n=0;n<this.networkControllers.length&&(this.networkControllers[n].startLoad(e,t),!(!this.started||!this.networkControllers));n++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[ee.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[ee.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[ee.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e==null?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=cL()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){iI(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const n=e.length;for(let s=0;s<n;s++)if(e[s].maxBitrate>=t)return s;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:n}=this;let s;if(t===-1&&e!=null&&e.length?s=e.length-1:s=t,n)for(let i=s;i--;){const a=e[i].attrs["HDCP-LEVEL"];if(a&&a<=n)return i}return s}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const n=_E(t);return SE(e,n,navigator.mediaCapabilities)}}xt.defaultConfig=void 0;const Or=()=>window&&window.electronAPI,N_=()=>window.Capacitor!==void 0,_k="modulepreload",Tk=function(r,e){return new URL(r,e).href},cv={},F_=function(e,t,n){let s=Promise.resolve();if(t&&t.length>0){const a=document.getElementsByTagName("link"),o=document.querySelector("meta[property=csp-nonce]"),l=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));s=Promise.allSettled(t.map(u=>{if(u=Tk(u,n),u in cv)return;cv[u]=!0;const c=u.endsWith(".css"),d=c?'[rel="stylesheet"]':"";if(!!n)for(let g=a.length-1;g>=0;g--){const p=a[g];if(p.href===u&&(!c||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${u}"]${d}`))return;const h=document.createElement("link");if(h.rel=c?"stylesheet":_k,c||(h.as="script"),h.crossOrigin="",h.href=u,l&&h.setAttribute("nonce",l),document.head.appendChild(h),c)return new Promise((g,p)=>{h.addEventListener("load",g),h.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${u}`)))})}))}function i(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return s.then(a=>{for(const o of a||[])o.status==="rejected"&&i(o.reason);return e().catch(i)})},dv=async r=>{if(Or()){const{ipcRenderer:e}=window.require("electron");return await e.invoke("fetch-content",r)}else if(N_()){const{Http:e}=await F_(async()=>{const{Http:n}=await import("./index-DlcESI5x.js");return{Http:n}},__vite__mapDeps([0,1]),import.meta.url),t=await e.get({url:r});return typeof t.data=="string"?t.data:JSON.stringify(t.data)}else return await(await fetch(r)).text()},$_=async r=>{if(Or())await window.electronAPI.invoke("open-external-player",r,"vlc");else if(N_()){const{App:e}=await F_(async()=>{const{App:t}=await import("./index-DjOSsFYa.js");return{App:t}},__vite__mapDeps([2,1]),import.meta.url);await e.openUrl({url:r})}else window.open(r,"_blank")},xk=async(r,e,t)=>{if(Or()){const{ipcRenderer:n}=window.require("electron");return await n.invoke("delete-channel-from-file",r,e,t)}else return{success:!1,error:"File editing is only supported in Desktop mode"}},xs={FFMPEG:"ffmpeg",VLC_EXTERNAL:"vlc"},Ak=({channel:r,videoRef:e,autoSkipEnabled:t,onPlaybackError:n})=>{const s=re.useRef(null),i=re.useRef(null),a=re.useRef(null),o=re.useRef(null),[l,u]=re.useState(!1),[c,d]=re.useState(null),[f,h]=re.useState(()=>localStorage.getItem("player-mode")||xs.FFMPEG),[g,p]=re.useState(()=>{const N=localStorage.getItem("player-volume");return N?parseFloat(N):1}),[v,m]=re.useState(!1),[y,S]=re.useState(""),[E,T]=re.useState({available:!1,downloading:!1,progress:0}),[A,x]=re.useState(!1);re.useEffect(()=>{if(Or()){window.electronAPI.invoke("get-ffmpeg-status").then(P=>{T(P),P.available||(console.log("FFmpeg not found, starting auto-download..."),window.electronAPI.invoke("download-ffmpeg"))});const N=window.electronAPI.on("ffmpeg-download-progress",(P,k)=>{T(F=>({...F,downloading:!0,...k})),k.status==="complete"&&T({available:!0,downloading:!1})});return()=>{N&&N()}}},[]);const w=re.useCallback(async()=>{if(i.current&&(clearTimeout(i.current),i.current=null),a.current&&(clearTimeout(a.current),a.current=null),s.current&&(s.current.destroy(),s.current=null),Or()&&A)try{await window.electronAPI.invoke("stop-ffmpeg-transcode")}catch{}x(!1)},[A]),b=re.useCallback(async N=>{if(N)try{await $_(N)}catch(P){console.error("External player error:",P)}},[]),I=re.useCallback(()=>{const N=f===xs.VLC_EXTERNAL?xs.FFMPEG:xs.VLC_EXTERNAL;h(N),localStorage.setItem("player-mode",N)},[f]),M=re.useCallback(N=>/\.(mkv|mp4|avi|mov|wmv|flv|webm)(\?|$)/i.test(N),[]),K=re.useCallback(async(N,P)=>{if(!Or()||!E.available)return!1;console.log("Using FFmpeg transcoding for:",N),x(!0),S("Transcoding...");try{const k=await window.electronAPI.invoke("start-ffmpeg-transcode",N);if(N!==o.current)return console.log("Aborting FFmpeg playback - URL changed"),!1;if(!k.success)return console.error("FFmpeg failed:",k.error),x(!1),!1;if(console.log("FFmpeg HLS ready:",k.hlsUrl),S(""),xt.isSupported()){const F=new xt({enableWorker:!0,lowLatencyMode:!1,backBufferLength:90,maxBufferLength:60,maxMaxBufferLength:120,maxBufferHole:2.5,manifestLoadingTimeOut:2e4,manifestLoadingMaxRetry:10,levelLoadingTimeOut:2e4,levelLoadingMaxRetry:10,fragLoadingTimeOut:3e4,fragLoadingMaxRetry:10,autoStartLoad:!0});return s.current=F,F.attachMedia(P),F.loadSource(k.hlsUrl),F.on(xt.Events.MANIFEST_PARSED,()=>{u(!1),P.play().catch(()=>{})}),F.on(xt.Events.ERROR,(U,B)=>{B.fatal&&(console.error("HLS error on transcoded stream:",B),F.destroy(),s.current=null,x(!1),d("Stream error. Try VLC."),u(!1))}),!0}}catch(k){console.error("FFmpeg error:",k),x(!1)}return!1},[E.available]),z=re.useCallback(async N=>{const P=e.current;if(!(!P||!N)){if(f===xs.VLC_EXTERNAL){console.log("VLC ON, opening in VLC"),u(!1),b(N);return}if(Or()&&M(N)){console.log("VOD file detected, opening in VLC..."),u(!1),b(N);return}if(await w(),N!==o.current){console.log("Aborting playChannel - URL changed");return}if(P.pause(),P.removeAttribute("src"),P.load(),d(null),u(!0),Or()){if(!E.available){d("FFmpeg downloading... Please wait."),u(!1);return}await K(N,P)||(d("Playback failed. Try VLC."),u(!1),t&&n&&(a.current=setTimeout(()=>{n()},3e3)))}else if(console.log("Direct playback attempt:",N),xt.isSupported()){const k=new xt({enableWorker:!0,lowLatencyMode:!0});s.current=k,k.loadSource(N),k.attachMedia(P),k.on(xt.Events.MANIFEST_PARSED,()=>{u(!1),P.play().catch(()=>{})}),k.on(xt.Events.ERROR,(F,U)=>{U.fatal&&(console.error("HLS Direct Error:",U),k.destroy(),s.current=null,P.src=N,P.play().catch(()=>{d("Playback failed. Try External Player."),u(!1)}))})}else P.src=N,P.play().catch(k=>{console.error("Native play error:",k),d("Playback failed. Try External Player."),u(!1)})}},[w,K,M,f,E.available,b,t,n]);return re.useEffect(()=>{const N=e.current;if(!N||!r)return;const P=()=>{console.log("Video stalled, will retry..."),S("Buffering..."),i.current=setTimeout(()=>{r!=null&&r.url&&(console.log("Retrying after stall..."),z(r.url))},5e3)},k=()=>{console.log("Stream ended, reloading..."),r!=null&&r.url&&setTimeout(()=>z(r.url),1e3)},F=()=>{S("Buffering...")},U=()=>{S(""),u(!1),a.current&&(clearTimeout(a.current),a.current=null)},B=()=>{console.log("Video error occurred"),t&&n&&(a.current=setTimeout(()=>{n()},3e3))},G=setInterval(()=>{if(N.buffered.length>0){const ne=N.buffered.end(N.buffered.length-1)-N.currentTime;ne>0&&S(`Buffer: ${ne.toFixed(1)}s`)}},2e3);return N.addEventListener("stalled",P),N.addEventListener("ended",k),N.addEventListener("waiting",F),N.addEventListener("playing",U),N.addEventListener("error",B),()=>{clearInterval(G),N.removeEventListener("stalled",P),N.removeEventListener("ended",k),N.removeEventListener("waiting",F),N.removeEventListener("playing",U),N.removeEventListener("error",B)}},[r,z,t,n]),re.useEffect(()=>{if(!r){o.current=null,w(),e.current&&(e.current.pause(),e.current.removeAttribute("src")),d(null),u(!1);return}if(!(r.url.includes("get.php")||r.url.includes("type=m3u")))return o.current=r.url,z(r.url),()=>w()},[r]),re.useEffect(()=>{e.current&&(e.current.volume=v?0:g)},[g,v]),{isLoading:l,error:c,playerMode:f,PLAYER_MODES:xs,ffmpegStatus:E,isTranscoding:A,bufferInfo:y,volume:g,isMuted:v,toggleVlcMode:I,openInVLC:b,handleVolumeChange:N=>{const P=parseFloat(N.target.value);p(P),m(P===0),localStorage.setItem("player-volume",P.toString())},retryPlay:()=>(r==null?void 0:r.url)&&z(r.url),setVolume:p,setIsMuted:m}},wk=({channel:r,onPlaybackError:e,autoSkipEnabled:t,onToggleAutoSkip:n})=>{const s=re.useRef(null),[i,a]=re.useState(!1),{isLoading:o,error:l,playerMode:u,PLAYER_MODES:c,ffmpegStatus:d,isTranscoding:f,bufferInfo:h,volume:g,isMuted:p,toggleVlcMode:v,openInVLC:m,handleVolumeChange:y,retryPlay:S,setIsMuted:E}=Ak({channel:r,videoRef:s,autoSkipEnabled:t,onPlaybackError:e}),T=u===c.VLC_EXTERNAL;return r?C.jsxs("div",{className:"flex-1 bg-gray-900 flex flex-col",children:[C.jsxs("div",{className:"flex-1 relative bg-black flex items-center justify-center",children:[C.jsx("video",{ref:s,controls:!0,autoPlay:!0,playsInline:!0,preload:"auto",className:"w-full h-full object-contain",style:{backgroundColor:"#000"}}),o&&C.jsx("div",{className:"absolute inset-0 bg-black/70 flex items-center justify-center",children:C.jsxs("div",{className:"text-center",children:[C.jsx(_d,{className:"animate-spin text-orange-500 mx-auto mb-3",size:48}),C.jsx("p",{className:"text-white text-lg",children:f?"Transcoding...":"Loading..."}),C.jsx("p",{className:"text-gray-400 text-sm mt-1 mb-4",children:r.name}),C.jsxs("button",{onClick:()=>m(r==null?void 0:r.url),className:"bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 text-sm mx-auto",children:[C.jsx(Mu,{size:16})," Open in VLC"]})]})}),l&&!o&&C.jsx("div",{className:"absolute inset-0 bg-black/80 flex items-center justify-center",children:C.jsxs("div",{className:"text-center p-6",children:[C.jsx($1,{className:"text-red-500 mx-auto mb-3",size:48}),C.jsx("p",{className:"text-white text-lg mb-4",children:l}),d.downloading&&C.jsxs("div",{className:"mb-4 w-64 mx-auto",children:[C.jsxs("div",{className:"flex justify-between text-sm text-gray-300 mb-1",children:[C.jsx("span",{children:d.status==="extracting"?"Kuruluyor...":"ndiriliyor..."}),C.jsxs("span",{children:[d.progress||0,"%"]})]}),C.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2.5",children:C.jsx("div",{className:"bg-purple-500 h-2.5 rounded-full transition-all duration-300",style:{width:`${d.progress||0}%`}})}),C.jsx("p",{className:"text-xs text-gray-400 mt-2",children:"FFmpeg indiriliyor, ltfen bekleyin..."})]}),t&&!d.downloading&&C.jsxs("p",{className:"text-yellow-400 text-sm mb-4 flex items-center justify-center gap-2",children:[C.jsx(F0,{size:16})," Skipping to next channel in 3s..."]}),C.jsxs("div",{className:"flex gap-2 justify-center",children:[C.jsxs("button",{onClick:S,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2",children:[C.jsx(Z1,{size:18})," Retry"]}),C.jsxs("button",{onClick:()=>m(r==null?void 0:r.url),className:"bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg flex items-center gap-2",children:[C.jsx(Mu,{size:18})," VLC"]})]})]})})]}),C.jsxs("div",{className:"p-3 bg-gray-800 border-t border-gray-700",children:[C.jsxs("div",{className:"flex items-center justify-between gap-4",children:[C.jsxs("div",{className:"flex-1 min-w-0",children:[C.jsx("h2",{className:"text-sm font-semibold text-white truncate",children:r.name}),C.jsx("p",{className:"text-xs text-gray-400 truncate",children:r.group})]}),C.jsxs("div",{className:"flex items-center gap-2",children:[C.jsx("button",{onClick:()=>E(!p),className:"text-gray-400 hover:text-white",children:p?C.jsx(tw,{size:18}):C.jsx(ew,{size:18})}),C.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:p?0:g,onChange:y,className:"w-20 h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-orange-500"})]}),C.jsxs("div",{className:"flex items-center gap-2",children:[C.jsxs("button",{onClick:n,className:`px-2 py-1.5 rounded text-xs flex items-center gap-1 transition-colors ${t?"bg-green-600 hover:bg-green-700 text-white":"bg-gray-700 hover:bg-gray-600 text-gray-300"}`,title:t?"Auto-skip ON - Skip to next channel on error":"Auto-skip OFF - Stay on failed channel",children:[C.jsx(F0,{size:14}),"Skip: ",t?"ON":"OFF"]}),C.jsxs("button",{onClick:v,className:`px-2 py-1.5 rounded text-xs flex items-center gap-1 transition-colors ${T?"bg-orange-600 hover:bg-orange-700 text-white":"bg-gray-700 hover:bg-gray-600 text-gray-300"}`,title:T?"VLC ON - Click to use built-in player":"VLC OFF - Click to use VLC",children:[C.jsx(N0,{size:14}),"VLC: ",T?"ON":"OFF"]}),C.jsx("button",{onClick:()=>a(!i),className:`px-3 py-1.5 rounded text-xs ${i?"bg-blue-600 text-white":"bg-gray-700 hover:bg-gray-600 text-white"}`,title:"Show stream info",children:C.jsx(q1,{size:14})}),C.jsx("button",{onClick:()=>(r==null?void 0:r.url)&&navigator.clipboard.writeText(r.url),className:"bg-gray-700 hover:bg-gray-600 text-white px-3 py-1.5 rounded text-xs",title:"Copy URL",children:C.jsx(H1,{size:14})}),C.jsxs("button",{onClick:()=>m(r==null?void 0:r.url),className:"bg-orange-500 hover:bg-orange-600 text-white px-3 py-1.5 rounded text-xs flex items-center gap-1",children:[C.jsx(Mu,{size:14})," VLC"]})]})]}),i&&C.jsxs("div",{className:"mt-2 p-2 bg-gray-900 rounded text-xs text-gray-400",children:[C.jsxs("div",{className:"flex justify-between mb-1",children:[C.jsx("span",{children:"URL:"}),C.jsx("span",{className:"text-orange-400",children:h||"Ready"})]}),C.jsx("div",{className:"font-mono break-all",children:r.url}),f&&C.jsx("div",{className:"mt-1 text-purple-400",children:"FFmpeg transcoding active"})]})]})]}):C.jsxs("div",{className:"flex-1 bg-gray-900 flex flex-col items-center justify-center text-gray-500",children:[C.jsx("span",{className:"text-6xl mb-4",children:""}),C.jsx("p",{className:"text-lg mb-2",children:"Select a channel to play"}),C.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Double-click to open in VLC"}),C.jsxs("button",{onClick:v,className:`px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-colors ${T?"bg-orange-600 hover:bg-orange-700 text-white":"bg-gray-700 hover:bg-gray-600 text-gray-300"}`,children:[C.jsx(N0,{size:16}),"VLC: ",T?"ON":"OFF"]}),C.jsx("p",{className:"text-xs text-gray-600 mt-2",children:T?"Opens channels in external VLC":"FFmpeg transcoding (built-in player)"}),d.downloading&&C.jsxs("div",{className:"mt-4 bg-gray-800 rounded-lg px-4 py-3 w-64",children:[C.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[C.jsx(_d,{className:"animate-spin text-purple-500",size:16}),C.jsx("span",{className:"text-sm text-gray-300",children:d.status==="extracting"?"FFmpeg kuruluyor...":"FFmpeg indiriliyor..."}),C.jsxs("span",{className:"text-sm text-purple-400 ml-auto",children:[d.progress||0,"%"]})]}),C.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2",children:C.jsx("div",{className:"bg-purple-500 h-2 rounded-full transition-all duration-300",style:{width:`${d.progress||0}%`}})})]})]})},Io=({title:r,icon:e,color:t,onClick:n,count:s})=>C.jsxs("button",{onClick:n,className:`group relative overflow-hidden rounded-xl p-6 transition-all duration-300 hover:scale-105 hover:shadow-2xl focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 ${t} h-64 flex flex-col items-center justify-center gap-4`,children:[C.jsx("div",{className:"absolute inset-0 bg-black/10 transition-colors group-hover:bg-transparent"}),C.jsx("div",{className:"relative z-10 flex h-24 w-24 items-center justify-center rounded-full bg-white/20 backdrop-blur-sm transition-transform duration-300 group-hover:scale-110",children:C.jsx(e,{size:48,className:"text-white drop-shadow-lg"})}),C.jsxs("div",{className:"relative z-10 text-center",children:[C.jsx("h3",{className:"text-2xl font-black tracking-wide text-white drop-shadow-md uppercase",children:r}),s!==void 0&&C.jsxs("span",{className:"mt-2 block text-sm font-medium text-white/90",children:[s," Items"]})]}),C.jsx("div",{className:"absolute -left-full top-0 h-full w-1/2 -skew-x-12 bg-white/10 blur-2xl transition-all duration-700 group-hover:left-full"})]}),Ik=({categories:r,onSelectCategory:e,onLoadNewPlaylist:t})=>{var n,s,i,a,o,l;return console.log("CategorySelection rendering with:",{live:(n=r==null?void 0:r.live)==null?void 0:n.length,movie:(s=r==null?void 0:r.movie)==null?void 0:s.length,series:(i=r==null?void 0:r.series)==null?void 0:i.length}),C.jsxs("div",{className:"flex min-h-screen w-full flex-col bg-[#0f172a] p-8",children:[C.jsxs("div",{className:"mb-12 text-center relative",children:[C.jsxs("button",{onClick:t,className:"absolute top-0 right-0 flex items-center gap-2 px-4 py-2 bg-gray-800 hover:bg-gray-700 text-gray-300 rounded-lg transition-colors",title:"Load new playlist",children:[C.jsx(Td,{size:18}),C.jsx("span",{className:"text-sm",children:"New Playlist"})]}),C.jsx("h1",{className:"text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500 mb-2",children:"Categories"}),C.jsx("p",{className:"text-gray-400",children:"Select the content type you want to watch"})]}),C.jsxs("div",{className:"mx-auto grid max-w-6xl w-full grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4",children:[C.jsx(Io,{title:"LIVE TV",icon:J1,color:"bg-gradient-to-br from-red-600 to-red-800 ring-red-500",count:((a=r==null?void 0:r.live)==null?void 0:a.length)||0,onClick:()=>e("live")}),C.jsx(Io,{title:"MOVIES",icon:V1,color:"bg-gradient-to-br from-amber-500 to-yellow-600 ring-amber-500",count:((o=r==null?void 0:r.movie)==null?void 0:o.length)||0,onClick:()=>e("movie")}),C.jsx(Io,{title:"SERIES",icon:G1,color:"bg-gradient-to-br from-fuchsia-500 to-pink-600 ring-fuchsia-500",count:((l=r==null?void 0:r.series)==null?void 0:l.length)||0,onClick:()=>e("series")}),C.jsx(Io,{title:"CATCH UP",icon:K1,color:"bg-gradient-to-br from-green-500 to-emerald-700 ring-green-500",count:0,onClick:()=>e("all")})]})]})};var Wd={exports:{}},zd={exports:{}},qd={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=t;function t(n){if(n==null)throw new TypeError("Expected a string but received a ".concat(n));if(n.constructor.name!=="String")throw new TypeError("Expected a string but received a ".concat(n.constructor.name))}r.exports=e.default,r.exports.default=e.default})(qd,qd.exports);var Y=qd.exports;(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=s;var t=n(Y);function n(i){return i&&i.__esModule?i:{default:i}}function s(i){return(0,t.default)(i),i=Date.parse(i),isNaN(i)?null:new Date(i)}r.exports=e.default,r.exports.default=e.default})(zd,zd.exports);var pp=zd.exports,Yd={exports:{}},yi={},Zd={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=t;function t(n){return n==null}r.exports=e.default,r.exports.default=e.default})(Zd,Zd.exports);var U_=Zd.exports,De={};Object.defineProperty(De,"__esModule",{value:!0});De.farsiLocales=De.englishLocales=De.dotDecimal=De.decimal=De.commaDecimal=De.bengaliLocales=De.arabicLocales=De.alphanumeric=De.alpha=void 0;var Ut=De.alpha={"en-US":/^[A-Z]+$/i,"az-AZ":/^[A-VXYZ]+$/i,"bg-BG":/^[-]+$/i,"cs-CZ":/^[A-Z]+$/i,"da-DK":/^[A-Z]+$/i,"de-DE":/^[A-Z]+$/i,"el-GR":/^[-]+$/i,"es-ES":/^[A-Z]+$/i,"fa-IR":/^[]+$/i,"fi-FI":/^[A-Z]+$/i,"fr-FR":/^[A-Z]+$/i,"it-IT":/^[A-Z]+$/i,"ja-JP":/^[----]+$/i,"nb-NO":/^[A-Z]+$/i,"nl-NL":/^[A-Z]+$/i,"nn-NO":/^[A-Z]+$/i,"hu-HU":/^[A-Z]+$/i,"pl-PL":/^[A-Z]+$/i,"pt-PT":/^[A-Z]+$/i,"ru-RU":/^[-]+$/i,"kk-KZ":/^[-\u04D8\u04B0\u0406\u04A2\u0492\u04AE\u049A\u04E8\u04BA]+$/i,"sl-SI":/^[A-Z]+$/i,"sk-SK":/^[A-Z]+$/i,"sr-RS@latin":/^[A-Z]+$/i,"sr-RS":/^[-]+$/i,"sv-SE":/^[A-Z]+$/i,"th-TH":/^[-\s]+$/i,"tr-TR":/^[A-Z]+$/i,"uk-UA":/^[-I]+$/i,"vi-VN":/^[A-Z]+$/i,"ko-KR":/^[---]*$/,"ku-IQ":/^[]+$/i,ar:/^[]+$/,he:/^[-]+$/,fa:/^['']+$/i,bn:/^['']+$/,eo:/^[ABCD-GHIJK-PRSTUVZ]+$/i,"hi-IN":/^[\u0900-\u0961]+[\u0972-\u097F]*$/i,"si-LK":/^[\u0D80-\u0DFF]+$/,"ta-IN":/^[\u0B80-\u0BFF]+$/i,"te-IN":/^[\u0C00-\u0C7F]+$/i,"kn-IN":/^[\u0C80-\u0CFF]+$/i,"ml-IN":/^[\u0D00-\u0D7F]+$/i,"gu-IN":/^[\u0A80-\u0AFF]+$/i,"pa-IN":/^[\u0A00-\u0A7F]+$/i,"or-IN":/^[\u0B00-\u0B7F]+$/i},Bt=De.alphanumeric={"en-US":/^[0-9A-Z]+$/i,"az-AZ":/^[0-9A-VXYZ]+$/i,"bg-BG":/^[0-9-]+$/i,"cs-CZ":/^[0-9A-Z]+$/i,"da-DK":/^[0-9A-Z]+$/i,"de-DE":/^[0-9A-Z]+$/i,"el-GR":/^[0-9-]+$/i,"es-ES":/^[0-9A-Z]+$/i,"fi-FI":/^[0-9A-Z]+$/i,"fr-FR":/^[0-9A-Z]+$/i,"it-IT":/^[0-9A-Z]+$/i,"ja-JP":/^[0-9-----]+$/i,"hu-HU":/^[0-9A-Z]+$/i,"nb-NO":/^[0-9A-Z]+$/i,"nl-NL":/^[0-9A-Z]+$/i,"nn-NO":/^[0-9A-Z]+$/i,"pl-PL":/^[0-9A-Z]+$/i,"pt-PT":/^[0-9A-Z]+$/i,"ru-RU":/^[0-9-]+$/i,"kk-KZ":/^[0-9-\u04D8\u04B0\u0406\u04A2\u0492\u04AE\u049A\u04E8\u04BA]+$/i,"sl-SI":/^[0-9A-Z]+$/i,"sk-SK":/^[0-9A-Z]+$/i,"sr-RS@latin":/^[0-9A-Z]+$/i,"sr-RS":/^[0-9-]+$/i,"sv-SE":/^[0-9A-Z]+$/i,"th-TH":/^[-\s]+$/i,"tr-TR":/^[0-9A-Z]+$/i,"uk-UA":/^[0-9-I]+$/i,"ko-KR":/^[0-9---]*$/,"ku-IQ":/^[0-9]+$/i,"vi-VN":/^[0-9A-Z]+$/i,ar:/^[0-9]+$/,he:/^[0-9-]+$/,fa:/^['0-9']+$/i,bn:/^['']+$/,eo:/^[0-9ABCD-GHIJK-PRSTUVZ]+$/i,"hi-IN":/^[\u0900-\u0963]+[\u0966-\u097F]*$/i,"si-LK":/^[0-9\u0D80-\u0DFF]+$/,"ta-IN":/^[0-9\u0B80-\u0BFF.]+$/i,"te-IN":/^[0-9\u0C00-\u0C7F.]+$/i,"kn-IN":/^[0-9\u0C80-\u0CFF.]+$/i,"ml-IN":/^[0-9\u0D00-\u0D7F.]+$/i,"gu-IN":/^[0-9\u0A80-\u0AFF.]+$/i,"pa-IN":/^[0-9\u0A00-\u0A7F.]+$/i,"or-IN":/^[0-9\u0B00-\u0B7F.]+$/i},It=De.decimal={"en-US":".",ar:""},fv=De.englishLocales=["AU","GB","HK","IN","NZ","ZA","ZM"];for(var bo,cc=0;cc<fv.length;cc++)bo="en-".concat(fv[cc]),Ut[bo]=Ut["en-US"],Bt[bo]=Bt["en-US"],It[bo]=It["en-US"];var hv=De.arabicLocales=["AE","BH","DZ","EG","IQ","JO","KW","LB","LY","MA","QM","QA","SA","SD","SY","TN","YE"];for(var Ro,dc=0;dc<hv.length;dc++)Ro="ar-".concat(hv[dc]),Ut[Ro]=Ut.ar,Bt[Ro]=Bt.ar,It[Ro]=It.ar;var gv=De.farsiLocales=["IR","AF"];for(var fc,hc=0;hc<gv.length;hc++)fc="fa-".concat(gv[hc]),Bt[fc]=Bt.fa,It[fc]=It.ar;var pv=De.bengaliLocales=["BD","IN"];for(var Lo,gc=0;gc<pv.length;gc++)Lo="bn-".concat(pv[gc]),Ut[Lo]=Ut.bn,Bt[Lo]=Bt.bn,It[Lo]=It["en-US"];var mv=De.dotDecimal=["ar-EG","ar-LB","ar-LY"],vv=De.commaDecimal=["bg-BG","cs-CZ","da-DK","de-DE","el-GR","en-ZM","eo","es-ES","fr-CA","fr-FR","gu-IN","hi-IN","hu-HU","id-ID","it-IT","kk-KZ","kn-IN","ku-IQ","ml-IN","nb-NO","nl-NL","nn-NO","or-IN","pa-IN","pl-PL","pt-PT","ru-RU","si-LK","sl-SI","sr-RS","sr-RS@latin","sv-SE","ta-IN","te-IN","tr-TR","uk-UA","vi-VN"];for(var pc=0;pc<mv.length;pc++)It[mv[pc]]=It["en-US"];for(var mc=0;mc<vv.length;mc++)It[vv[mc]]=",";Ut["fr-CA"]=Ut["fr-FR"];Bt["fr-CA"]=Bt["fr-FR"];Ut["pt-BR"]=Ut["pt-PT"];Bt["pt-BR"]=Bt["pt-PT"];It["pt-BR"]=It["pt-PT"];Ut["pl-Pl"]=Ut["pl-PL"];Bt["pl-Pl"]=Bt["pl-PL"];It["pl-Pl"]=It["pl-PL"];Ut["fa-AF"]=Ut.fa;Object.defineProperty(yi,"__esModule",{value:!0});yi.default=Rk;yi.locales=void 0;var bk=j_(Y),ko=j_(U_),B_=De;function j_(r){return r&&r.__esModule?r:{default:r}}function Rk(r,e){(0,bk.default)(r),e=e||{};var t=new RegExp("^(?:[-+])?(?:[0-9]+)?(?:\\".concat(e.locale?B_.decimal[e.locale]:".","[0-9]*)?(?:[eE][\\+\\-]?(?:[0-9]+))?$"));if(r===""||r==="."||r===","||r==="-"||r==="+")return!1;var n=parseFloat(r.replace(",","."));return t.test(r)&&(!e.hasOwnProperty("min")||(0,ko.default)(e.min)||n>=e.min)&&(!e.hasOwnProperty("max")||(0,ko.default)(e.max)||n<=e.max)&&(!e.hasOwnProperty("lt")||(0,ko.default)(e.lt)||n<e.lt)&&(!e.hasOwnProperty("gt")||(0,ko.default)(e.gt)||n>e.gt)}yi.locales=Object.keys(B_.decimal);(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=s;var t=n(yi);function n(i){return i&&i.__esModule?i:{default:i}}function s(i){return(0,t.default)(i)?parseFloat(i):NaN}r.exports=e.default,r.exports.default=e.default})(Yd,Yd.exports);var G_=Yd.exports,Qd={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=s;var t=n(Y);function n(i){return i&&i.__esModule?i:{default:i}}function s(i,a){return(0,t.default)(i),parseInt(i,a||10)}r.exports=e.default,r.exports.default=e.default})(Qd,Qd.exports);var Lk=Qd.exports,Xd={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=s;var t=n(Y);function n(i){return i&&i.__esModule?i:{default:i}}function s(i,a){return(0,t.default)(i),a?i==="1"||/^true$/i.test(i):i!=="0"&&!/^false$/i.test(i)&&i!==""}r.exports=e.default,r.exports.default=e.default})(Xd,Xd.exports);var kk=Xd.exports,Jd={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=s;var t=n(Y);function n(i){return i&&i.__esModule?i:{default:i}}function s(i,a){return(0,t.default)(i),i===a}r.exports=e.default,r.exports.default=e.default})(Jd,Jd.exports);var Ck=Jd.exports,ef={exports:{}},tf={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=n;function t(s){"@babel/helpers - typeof";return t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},t(s)}function n(s){return t(s)==="object"&&s!==null?typeof s.toString=="function"?s=s.toString():s="[object Object]":(s===null||typeof s>"u"||isNaN(s)&&!s.length)&&(s=""),String(s)}r.exports=e.default,r.exports.default=e.default})(tf,tf.exports);var K_=tf.exports,rf={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=t;function t(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=arguments.length>1?arguments[1]:void 0;for(var i in s)typeof n[i]>"u"&&(n[i]=s[i]);return n}r.exports=e.default,r.exports.default=e.default})(rf,rf.exports);var Lt=rf.exports;(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var t=i(Y),n=i(K_),s=i(Lt);function i(l){return l&&l.__esModule?l:{default:l}}var a={ignoreCase:!1,minOccurrences:1};function o(l,u,c){return(0,t.default)(l),c=(0,s.default)(c,a),c.ignoreCase?l.toLowerCase().split((0,n.default)(u).toLowerCase()).length>c.minOccurrences:l.split((0,n.default)(u)).length>c.minOccurrences}r.exports=e.default,r.exports.default=e.default})(ef,ef.exports);var Pk=ef.exports,nf={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=s;var t=n(Y);function n(i){return i&&i.__esModule?i:{default:i}}function s(i,a,o){return(0,t.default)(i),Object.prototype.toString.call(a)!=="[object RegExp]"&&(a=new RegExp(a,o)),!!i.match(a)}r.exports=e.default,r.exports.default=e.default})(nf,nf.exports);var Dk=nf.exports,sf={exports:{}},af={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=n;function t(s){return Object.prototype.toString.call(s)==="[object RegExp]"}function n(s,i){for(var a=0;a<i.length;a++){var o=i[a];if(s===o||t(o)&&o.test(s))return!0}return!1}r.exports=e.default,r.exports.default=e.default})(af,af.exports);var H_=af.exports,of={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;var t=n(Y);function n(a){return a&&a.__esModule?a:{default:a}}function s(a){"@babel/helpers - typeof";return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},s(a)}function i(a,o){(0,t.default)(a);var l,u;s(o)==="object"?(l=o.min||0,u=o.max):(l=arguments[1],u=arguments[2]);var c=encodeURI(a).split(/%..|./).length-1;return c>=l&&(typeof u>"u"||c<=u)}r.exports=e.default,r.exports.default=e.default})(of,of.exports);var V_=of.exports,lf={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=a;var t=s(Y),n=s(Lt);function s(o){return o&&o.__esModule?o:{default:o}}var i={require_tld:!0,allow_underscores:!1,allow_trailing_dot:!1,allow_numeric_tld:!1,allow_wildcard:!1,ignore_max_length:!1};function a(o,l){(0,t.default)(o),l=(0,n.default)(l,i),l.allow_trailing_dot&&o[o.length-1]==="."&&(o=o.substring(0,o.length-1)),l.allow_wildcard===!0&&o.indexOf("*.")===0&&(o=o.substring(2));var u=o.split("."),c=u[u.length-1];return l.require_tld&&(u.length<2||!l.allow_numeric_tld&&!/^([a-z\u00A1-\u00A8\u00AA-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]{2,}|xn[a-z0-9-]{2,})$/i.test(c)||/\s/.test(c))||!l.allow_numeric_tld&&/^\d+$/.test(c)?!1:u.every(function(d){return!(d.length>63&&!l.ignore_max_length||!/^[a-z_\u00a1-\uffff0-9-]+$/i.test(d)||/[\uff01-\uff5e]/.test(d)||/^-|-$/.test(d)||!l.allow_underscores&&/_/.test(d))})}r.exports=e.default,r.exports.default=e.default})(lf,lf.exports);var mp=lf.exports,uf={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=c;var t=n(Y);function n(d){return d&&d.__esModule?d:{default:d}}function s(d){"@babel/helpers - typeof";return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(f){return typeof f}:function(f){return f&&typeof Symbol=="function"&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f},s(d)}var i="(?:[0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])",a="(".concat(i,"[.]){3}").concat(i),o=new RegExp("^".concat(a,"$")),l="(?:[0-9a-fA-F]{1,4})",u=new RegExp("^("+"(?:".concat(l,":){7}(?:").concat(l,"|:)|")+"(?:".concat(l,":){6}(?:").concat(a,"|:").concat(l,"|:)|")+"(?:".concat(l,":){5}(?::").concat(a,"|(:").concat(l,"){1,2}|:)|")+"(?:".concat(l,":){4}(?:(:").concat(l,"){0,1}:").concat(a,"|(:").concat(l,"){1,3}|:)|")+"(?:".concat(l,":){3}(?:(:").concat(l,"){0,2}:").concat(a,"|(:").concat(l,"){1,4}|:)|")+"(?:".concat(l,":){2}(?:(:").concat(l,"){0,3}:").concat(a,"|(:").concat(l,"){1,5}|:)|")+"(?:".concat(l,":){1}(?:(:").concat(l,"){0,4}:").concat(a,"|(:").concat(l,"){1,6}|:)|")+"(?::((?::".concat(l,"){0,5}:").concat(a,"|(?::").concat(l,"){1,7}|:))")+")(%[0-9a-zA-Z.]{1,})?$");function c(d){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};(0,t.default)(d);var h=(s(f)==="object"?f.version:arguments[1])||"";return h?h.toString()==="4"?o.test(d):h.toString()==="6"?u.test(d):!1:c(d,{version:4})||c(d,{version:6})}r.exports=e.default,r.exports.default=e.default})(uf,uf.exports);var iu=uf.exports;(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=y;var t=l(Y),n=l(H_),s=l(V_),i=l(mp),a=l(iu),o=l(Lt);function l(S){return S&&S.__esModule?S:{default:S}}var u={allow_display_name:!1,allow_underscores:!1,require_display_name:!1,allow_utf8_local_part:!0,require_tld:!0,blacklisted_chars:"",ignore_max_length:!1,host_blacklist:[],host_whitelist:[]},c=/^([^\x00-\x1F\x7F-\x9F\cX]+)</i,d=/^[a-z\d!#\$%&'\*\+\-\/=\?\^_`{\|}~]+$/i,f=/^[a-z\d]+$/,h=/^([\s\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e]|(\\[\x01-\x09\x0b\x0c\x0d-\x7f]))*$/i,g=/^[a-z\d!#\$%&'\*\+\-\/=\?\^_`{\|}~\u00A1-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+$/i,p=/^([\s\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|(\\[\x01-\x09\x0b\x0c\x0d-\x7f\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))*$/i,v=254;function m(S){var E=S.replace(/^"(.+)"$/,"$1");if(!E.trim())return!1;var T=/[\.";<>]/.test(E);if(T){if(E===S)return!1;var A=E.split('"').length===E.split('\\"').length;if(!A)return!1}return!0}function y(S,E){if((0,t.default)(S),E=(0,o.default)(E,u),E.require_display_name||E.allow_display_name){var T=S.match(c);if(T){var A=T[1];if(S=S.replace(A,"").replace(/(^<|>$)/g,""),A.endsWith(" ")&&(A=A.slice(0,-1)),!m(A))return!1}else if(E.require_display_name)return!1}if(!E.ignore_max_length&&S.length>v)return!1;var x=S.split("@"),w=x.pop(),b=w.toLowerCase();if(E.host_blacklist.length>0&&(0,n.default)(b,E.host_blacklist)||E.host_whitelist.length>0&&!(0,n.default)(b,E.host_whitelist))return!1;var I=x.join("@");if(E.domain_specific_validation&&(b==="gmail.com"||b==="googlemail.com")){I=I.toLowerCase();var M=I.split("+")[0];if(!(0,s.default)(M.replace(/\./g,""),{min:6,max:30}))return!1;for(var K=M.split("."),z=0;z<K.length;z++)if(!f.test(K[z]))return!1}if(E.ignore_max_length===!1&&(!(0,s.default)(I,{max:64})||!(0,s.default)(w,{max:254})))return!1;if(!(0,i.default)(w,{require_tld:E.require_tld,ignore_max_length:E.ignore_max_length,allow_underscores:E.allow_underscores})){if(!E.allow_ip_domain)return!1;if(!(0,a.default)(w)){if(!w.startsWith("[")||!w.endsWith("]"))return!1;var X=w.slice(1,-1);if(X.length===0||!(0,a.default)(X))return!1}}if(E.blacklisted_chars&&I.search(new RegExp("[".concat(E.blacklisted_chars,"]+"),"g"))!==-1)return!1;if(I[0]==='"'&&I[I.length-1]==='"')return I=I.slice(1,I.length-1),E.allow_utf8_local_part?p.test(I):h.test(I);for(var Q=E.allow_utf8_local_part?g:d,N=I.split("."),P=0;P<N.length;P++)if(!Q.test(N[P]))return!1;return!0}r.exports=e.default,r.exports.default=e.default})(sf,sf.exports);var W_=sf.exports,cf={exports:{}},df={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=function(s,i){return s.indexOf(i)!==-1};e.default=t,r.exports=e.default,r.exports.default=e.default})(df,df.exports);var z_=df.exports;(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=m;var t=l(Y),n=l(H_),s=l(z_),i=l(mp),a=l(iu),o=l(Lt);function l(y){return y&&y.__esModule?y:{default:y}}function u(y,S){return g(y)||h(y,S)||d(y,S)||c()}function c(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function d(y,S){if(y){if(typeof y=="string")return f(y,S);var E={}.toString.call(y).slice(8,-1);return E==="Object"&&y.constructor&&(E=y.constructor.name),E==="Map"||E==="Set"?Array.from(y):E==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(E)?f(y,S):void 0}}function f(y,S){(S==null||S>y.length)&&(S=y.length);for(var E=0,T=Array(S);E<S;E++)T[E]=y[E];return T}function h(y,S){var E=y==null?null:typeof Symbol<"u"&&y[Symbol.iterator]||y["@@iterator"];if(E!=null){var T,A,x,w,b=[],I=!0,M=!1;try{if(x=(E=E.call(y)).next,S!==0)for(;!(I=(T=x.call(E)).done)&&(b.push(T.value),b.length!==S);I=!0);}catch(K){M=!0,A=K}finally{try{if(!I&&E.return!=null&&(w=E.return(),Object(w)!==w))return}finally{if(M)throw A}}return b}}function g(y){if(Array.isArray(y))return y}var p={protocols:["http","https","ftp"],require_tld:!0,require_protocol:!1,require_host:!0,require_port:!1,require_valid_protocol:!0,allow_underscores:!1,allow_trailing_dot:!1,allow_protocol_relative_urls:!1,allow_fragments:!0,allow_query_components:!0,validate_length:!0,max_allowed_length:2084},v=/^\[([^\]]+)\](?::([0-9]+))?$/;function m(y,S){if((0,t.default)(y),!y||/[\s<>]/.test(y)||y.indexOf("mailto:")===0||(S=(0,o.default)(S,p),S.validate_length&&y.length>S.max_allowed_length)||!S.allow_fragments&&(0,s.default)(y,"#")||!S.allow_query_components&&((0,s.default)(y,"?")||(0,s.default)(y,"&")))return!1;var E,T,A,x,w,b,I,M;I=y.split("#"),y=I.shift(),I=y.split("?"),y=I.shift();var K=y.match(/^([a-z][a-z0-9+\-.]*):/i),z=!1,X=function(jt){return z=!0,E=jt.toLowerCase(),S.require_valid_protocol&&S.protocols.indexOf(E)===-1?!1:y.substring(K[0].length)};if(K){var Q=K[1],N=y.substring(K[0].length),P=N.slice(0,2)==="//";if(P){if(y=X(Q),y===!1)return!1}else{var k=N.indexOf("/"),F=k===-1?N:N.substring(0,k),U=F.indexOf("@");if(U!==-1){var B=F.substring(0,U),G=/^[a-zA-Z0-9\-_.%:]*$/,ie=G.test(B);if(ie){if(S.require_protocol)return!1}else if(y=X(Q),y===!1)return!1}else{var ne=/^[0-9]/.test(N);if(ne){if(S.require_protocol)return!1}else if(y=X(Q),y===!1)return!1}}}else if(S.require_protocol)return!1;if(y.slice(0,2)==="//"){if(!z&&!S.allow_protocol_relative_urls)return!1;y=y.slice(2)}if(y==="")return!1;if(I=y.split("/"),y=I.shift(),y===""&&!S.require_host)return!0;if(I=y.split("@"),I.length>1){if(S.disallow_auth||I[0]===""||(T=I.shift(),T.indexOf(":")>=0&&T.split(":").length>2))return!1;var oe=T.split(":"),le=u(oe,2),Ie=le[0],Fe=le[1];if(Ie===""&&Fe==="")return!1}x=I.join("@"),b=null,M=null;var Ye=x.match(v);if(Ye?(A="",M=Ye[1],b=Ye[2]||null):(I=x.split(":"),A=I.shift(),I.length&&(b=I.join(":"))),b!==null&&b.length>0){if(w=parseInt(b,10),!/^[0-9]+$/.test(b)||w<=0||w>65535)return!1}else if(S.require_port)return!1;return S.host_whitelist?(0,n.default)(A,S.host_whitelist):A===""&&!S.require_host?!0:!(!(0,a.default)(A)&&!(0,i.default)(A,S)&&(!M||!(0,a.default)(M,6))||(A=A||M,S.host_blacklist&&(0,n.default)(A,S.host_blacklist)))}r.exports=e.default,r.exports.default=e.default})(cf,cf.exports);var Ok=cf.exports,ff={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=c;var t=n(Y);function n(d){return d&&d.__esModule?d:{default:d}}var s=/^(?:[0-9a-fA-F]{2}([-:\s]))([0-9a-fA-F]{2}\1){4}([0-9a-fA-F]{2})$/,i=/^([0-9a-fA-F]){12}$/,a=/^([0-9a-fA-F]{4}\.){2}([0-9a-fA-F]{4})$/,o=/^(?:[0-9a-fA-F]{2}([-:\s]))([0-9a-fA-F]{2}\1){6}([0-9a-fA-F]{2})$/,l=/^([0-9a-fA-F]){16}$/,u=/^([0-9a-fA-F]{4}\.){3}([0-9a-fA-F]{4})$/;function c(d,f){return(0,t.default)(d),f!=null&&f.eui&&(f.eui=String(f.eui)),f!=null&&f.no_colons||f!=null&&f.no_separators?f.eui==="48"?i.test(d):f.eui==="64"?l.test(d):i.test(d)||l.test(d):(f==null?void 0:f.eui)==="48"?s.test(d)||a.test(d):(f==null?void 0:f.eui)==="64"?o.test(d)||u.test(d):c(d,{eui:"48"})||c(d,{eui:"64"})}r.exports=e.default,r.exports.default=e.default})(ff,ff.exports);var Mk=ff.exports,hf={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=l;var t=s(Y),n=s(iu);function s(u){return u&&u.__esModule?u:{default:u}}var i=/^\d{1,3}$/,a=32,o=128;function l(u){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";(0,t.default)(u);var d=u.split("/");if(d.length!==2||!i.test(d[1])||d[1].length>1&&d[1].startsWith("0"))return!1;var f=(0,n.default)(d[0],c);if(!f)return!1;var h=null;switch(String(c)){case"4":h=a;break;case"6":h=o;break;default:h=(0,n.default)(d[0],"6")?o:a}return d[1]<=h&&d[1]>=0}r.exports=e.default,r.exports.default=e.default})(hf,hf.exports);var Nk=hf.exports,gf={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=g;var t=n(Lt);function n(p){return p&&p.__esModule?p:{default:p}}function s(p,v){return o(p)||a(p,v)||u(p,v)||i()}function i(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function a(p,v){var m=p==null?null:typeof Symbol<"u"&&p[Symbol.iterator]||p["@@iterator"];if(m!=null){var y,S,E,T,A=[],x=!0,w=!1;try{if(E=(m=m.call(p)).next,v!==0)for(;!(x=(y=E.call(m)).done)&&(A.push(y.value),A.length!==v);x=!0);}catch(b){w=!0,S=b}finally{try{if(!x&&m.return!=null&&(T=m.return(),Object(T)!==T))return}finally{if(w)throw S}}return A}}function o(p){if(Array.isArray(p))return p}function l(p,v){var m=typeof Symbol<"u"&&p[Symbol.iterator]||p["@@iterator"];if(!m){if(Array.isArray(p)||(m=u(p))||v){m&&(p=m);var y=0,S=function(){};return{s:S,n:function(){return y>=p.length?{done:!0}:{done:!1,value:p[y++]}},e:function(w){throw w},f:S}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var E,T=!0,A=!1;return{s:function(){m=m.call(p)},n:function(){var w=m.next();return T=w.done,w},e:function(w){A=!0,E=w},f:function(){try{T||m.return==null||m.return()}finally{if(A)throw E}}}}function u(p,v){if(p){if(typeof p=="string")return c(p,v);var m={}.toString.call(p).slice(8,-1);return m==="Object"&&p.constructor&&(m=p.constructor.name),m==="Map"||m==="Set"?Array.from(p):m==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(m)?c(p,v):void 0}}function c(p,v){(v==null||v>p.length)&&(v=p.length);for(var m=0,y=Array(v);m<v;m++)y[m]=p[m];return y}var d={format:"YYYY/MM/DD",delimiters:["/","-"],strictMode:!1};function f(p){return/(^(y{4}|y{2})[.\/-](m{1,2})[.\/-](d{1,2})$)|(^(m{1,2})[.\/-](d{1,2})[.\/-]((y{4}|y{2})$))|(^(d{1,2})[.\/-](m{1,2})[.\/-]((y{4}|y{2})$))/gi.test(p)}function h(p,v){for(var m=[],y=Math.max(p.length,v.length),S=0;S<y;S++)m.push([p[S],v[S]]);return m}function g(p,v){if(typeof v=="string"?v=(0,t.default)({format:v},d):v=(0,t.default)(v,d),typeof p=="string"&&f(v.format)){if(v.strictMode&&p.length!==v.format.length)return!1;var m=v.delimiters.find(function(Q){return v.format.indexOf(Q)!==-1}),y=v.strictMode?m:v.delimiters.find(function(Q){return p.indexOf(Q)!==-1}),S=h(p.split(y),v.format.toLowerCase().split(m)),E={},T=l(S),A;try{for(T.s();!(A=T.n()).done;){var x=s(A.value,2),w=x[0],b=x[1];if(!w||!b||w.length!==b.length)return!1;E[b.charAt(0)]=w}}catch(Q){T.e(Q)}finally{T.f()}var I=E.y;if(I.startsWith("-"))return!1;if(E.y.length===2){var M=parseInt(E.y,10);if(isNaN(M))return!1;var K=new Date().getFullYear()%100;M<K?I="20".concat(E.y):I="19".concat(E.y)}var z=E.m;E.m.length===1&&(z="0".concat(E.m));var X=E.d;return E.d.length===1&&(X="0".concat(E.d)),new Date("".concat(I,"-").concat(z,"-").concat(X,"T00:00:00.000Z")).getUTCDate()===+E.d}return v.strictMode?!1:Object.prototype.toString.call(p)==="[object Date]"&&isFinite(p)}r.exports=e.default,r.exports.default=e.default})(gf,gf.exports);var q_=gf.exports,pf={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=a;var t=n(Lt);function n(o){return o&&o.__esModule?o:{default:o}}var s={hourFormat:"hour24",mode:"default"},i={hour24:{default:/^([01]?[0-9]|2[0-3]):([0-5][0-9])$/,withSeconds:/^([01]?[0-9]|2[0-3]):([0-5][0-9]):([0-5][0-9])$/,withOptionalSeconds:/^([01]?[0-9]|2[0-3]):([0-5][0-9])(?::([0-5][0-9]))?$/},hour12:{default:/^(0?[1-9]|1[0-2]):([0-5][0-9]) (A|P)M$/,withSeconds:/^(0?[1-9]|1[0-2]):([0-5][0-9]):([0-5][0-9]) (A|P)M$/,withOptionalSeconds:/^(0?[1-9]|1[0-2]):([0-5][0-9])(?::([0-5][0-9]))? (A|P)M$/}};function a(o,l){return l=(0,t.default)(l,s),typeof o!="string"?!1:i[l.hourFormat][l.mode].test(o)}r.exports=e.default,r.exports.default=e.default})(pf,pf.exports);var Fk=pf.exports,mf={exports:{}},vf={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=function(s,i){return s.some(function(a){return i===a})};e.default=t,r.exports=e.default,r.exports.default=e.default})(vf,vf.exports);var Da=vf.exports;(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=l;var t=s(Y),n=s(Da);function s(u){return u&&u.__esModule?u:{default:u}}var i={loose:!1},a=["true","false","1","0"],o=[].concat(a,["yes","no"]);function l(u){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:i;return(0,t.default)(u),c.loose?(0,n.default)(o,u.toLowerCase()):(0,n.default)(a,u)}r.exports=e.default,r.exports.default=e.default})(mf,mf.exports);var $k=mf.exports,yf={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=y;var t=n(Y);function n(S){return S&&S.__esModule?S:{default:S}}var s="([A-Za-z]{3}(-[A-Za-z]{3}){0,2})",i="(([a-zA-Z]{2,3}(-".concat(s,")?)|([a-zA-Z]{5,8}))"),a="([A-Za-z]{4})",o="([A-Za-z]{2}|\\d{3})",l="([A-Za-z0-9]{5,8}|(\\d[A-Z-a-z0-9]{3}))",u="(\\d|[A-W]|[Y-Z]|[a-w]|[y-z])",c="(".concat(u,"(-[A-Za-z0-9]{2,8})+)"),d="(x(-[A-Za-z0-9]{1,8})+)",f="((en-GB-oed)|(i-ami)|(i-bnn)|(i-default)|(i-enochian)|(i-hak)|(i-klingon)|(i-lux)|(i-mingo)|(i-navajo)|(i-pwn)|(i-tao)|(i-tay)|(i-tsu)|(sgn-BE-FR)|(sgn-BE-NL)|(sgn-CH-DE))",h="((art-lojban)|(cel-gaulish)|(no-bok)|(no-nyn)|(zh-guoyu)|(zh-hakka)|(zh-min)|(zh-min-nan)|(zh-xiang))",g="(".concat(f,"|").concat(h,")"),p="(-|_)",v="".concat(i,"(").concat(p).concat(a,")?(").concat(p).concat(o,")?(").concat(p).concat(l,")*(").concat(p).concat(c,")*(").concat(p).concat(d,")?"),m=new RegExp("(^".concat(d,"$)|(^").concat(g,"$)|(^").concat(v,"$)"));function y(S){return(0,t.default)(S),m.test(S)}r.exports=e.default,r.exports.default=e.default})(yf,yf.exports);var Uk=yf.exports,Sf={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;var t=n(Y);function n(a){return a&&a.__esModule?a:{default:a}}var s=/^(?!(1[3-9])|(20)|(3[3-9])|(4[0-9])|(5[0-9])|(60)|(7[3-9])|(8[1-9])|(9[0-2])|(9[3-9]))[0-9]{9}$/;function i(a){if((0,t.default)(a),!s.test(a))return!1;for(var o=0,l=0;l<a.length;l++)l%3===0?o+=a[l]*3:l%3===1?o+=a[l]*7:o+=a[l]*1;return o%10===0}r.exports=e.default,r.exports.default=e.default})(Sf,Sf.exports);var Bk=Sf.exports,Oa={};Object.defineProperty(Oa,"__esModule",{value:!0});Oa.default=Kk;Oa.locales=void 0;var jk=Gk(Y),Ef=De;function Gk(r){return r&&r.__esModule?r:{default:r}}function Kk(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"en-US",t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};(0,jk.default)(r);var n=r,s=t.ignore;if(s)if(s instanceof RegExp)n=n.replace(s,"");else if(typeof s=="string")n=n.replace(new RegExp("[".concat(s.replace(/[-[\]{}()*+?.,\\^$|#\\s]/g,"\\$&"),"]"),"g"),"");else throw new Error("ignore should be instance of a String or RegExp");if(e in Ef.alpha)return Ef.alpha[e].test(n);throw new Error("Invalid locale '".concat(e,"'"))}Oa.locales=Object.keys(Ef.alpha);var Ma={};Object.defineProperty(Ma,"__esModule",{value:!0});Ma.default=Wk;Ma.locales=void 0;var Hk=Vk(Y),_f=De;function Vk(r){return r&&r.__esModule?r:{default:r}}function Wk(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"en-US",t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};(0,Hk.default)(r);var n=r,s=t.ignore;if(s)if(s instanceof RegExp)n=n.replace(s,"");else if(typeof s=="string")n=n.replace(new RegExp("[".concat(s.replace(/[-[\]{}()*+?.,\\^$|#\\s]/g,"\\$&"),"]"),"g"),"");else throw new Error("ignore should be instance of a String or RegExp");if(e in _f.alphanumeric)return _f.alphanumeric[e].test(n);throw new Error("Invalid locale '".concat(e,"'"))}Ma.locales=Object.keys(_f.alphanumeric);var Tf={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=a;var t=s(Y),n=De;function s(o){return o&&o.__esModule?o:{default:o}}var i=/^[0-9]+$/;function a(o,l){return(0,t.default)(o),l&&l.no_symbols?i.test(o):new RegExp("^[+-]?([0-9]*[".concat((l||{}).locale?n.decimal[l.locale]:".","])?[0-9]+$")).test(o)}r.exports=e.default,r.exports.default=e.default})(Tf,Tf.exports);var zk=Tf.exports,Na={};Object.defineProperty(Na,"__esModule",{value:!0});Na.default=Zk;Na.locales=void 0;var qk=Yk(Y);function Yk(r){return r&&r.__esModule?r:{default:r}}var xf={AM:/^[A-Z]{2}\d{7}$/,AR:/^[A-Z]{3}\d{6}$/,AT:/^[A-Z]\d{7}$/,AU:/^[A-Z]\d{7}$/,AZ:/^[A-Z]{1}\d{8}$/,BE:/^[A-Z]{2}\d{6}$/,BG:/^\d{9}$/,BR:/^[A-Z]{2}\d{6}$/,BY:/^[A-Z]{2}\d{7}$/,CA:/^[A-Z]{2}\d{6}$|^[A-Z]\d{6}[A-Z]{2}$/,CH:/^[A-Z]\d{7}$/,CN:/^G\d{8}$|^E(?![IO])[A-Z0-9]\d{7}$/,CY:/^[A-Z](\d{6}|\d{8})$/,CZ:/^\d{8}$/,DE:/^[CFGHJKLMNPRTVWXYZ0-9]{9}$/,DK:/^\d{9}$/,DZ:/^\d{9}$/,EE:/^([A-Z]\d{7}|[A-Z]{2}\d{7})$/,ES:/^[A-Z0-9]{2}([A-Z0-9]?)\d{6}$/,FI:/^[A-Z]{2}\d{7}$/,FR:/^\d{2}[A-Z]{2}\d{5}$/,GB:/^\d{9}$/,GR:/^[A-Z]{2}\d{7}$/,HR:/^\d{9}$/,HU:/^[A-Z]{2}(\d{6}|\d{7})$/,IE:/^[A-Z0-9]{2}\d{7}$/,IN:/^[A-Z]{1}-?\d{7}$/,ID:/^[A-C]\d{7}$/,IR:/^[A-Z]\d{8}$/,IS:/^(A)\d{7}$/,IT:/^[A-Z0-9]{2}\d{7}$/,JM:/^[Aa]\d{7}$/,JP:/^[A-Z]{2}\d{7}$/,KR:/^[MS]\d{8}$/,KZ:/^[a-zA-Z]\d{7}$/,LI:/^[a-zA-Z]\d{5}$/,LT:/^[A-Z0-9]{8}$/,LU:/^[A-Z0-9]{8}$/,LV:/^[A-Z0-9]{2}\d{7}$/,LY:/^[A-Z0-9]{8}$/,MT:/^\d{7}$/,MZ:/^([A-Z]{2}\d{7})|(\d{2}[A-Z]{2}\d{5})$/,MY:/^[AHK]\d{8}$/,MX:/^\d{10,11}$/,NL:/^[A-Z]{2}[A-Z0-9]{6}\d$/,NZ:/^([Ll]([Aa]|[Dd]|[Ff]|[Hh])|[Ee]([Aa]|[Pp])|[Nn])\d{6}$/,PH:/^([A-Z](\d{6}|\d{7}[A-Z]))|([A-Z]{2}(\d{6}|\d{7}))$/,PK:/^[A-Z]{2}\d{7}$/,PL:/^[A-Z]{2}\d{7}$/,PT:/^[A-Z]\d{6}$/,RO:/^\d{8,9}$/,RU:/^\d{9}$/,SE:/^\d{8}$/,SL:/^(P)[A-Z]\d{7}$/,SK:/^[0-9A-Z]\d{7}$/,TH:/^[A-Z]{1,2}\d{6,7}$/,TR:/^[A-Z]\d{8}$/,UA:/^[A-Z]{2}\d{6}$/,US:/^\d{9}$|^[A-Z]\d{8}$/,ZA:/^[TAMD]\d{8}$/};Na.locales=Object.keys(xf);function Zk(r,e){(0,qk.default)(r);var t=r.replace(/\s/g,"").toUpperCase();return e.toUpperCase()in xf&&xf[e].test(t)}var Af={exports:{}},wf={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var t=s(Y),n=s(U_);function s(l){return l&&l.__esModule?l:{default:l}}var i=/^(?:[-+]?(?:0|[1-9][0-9]*))$/,a=/^[-+]?[0-9]+$/;function o(l,u){(0,t.default)(l),u=u||{};var c=u.allow_leading_zeroes===!1?i:a,d=!u.hasOwnProperty("min")||(0,n.default)(u.min)||l>=u.min,f=!u.hasOwnProperty("max")||(0,n.default)(u.max)||l<=u.max,h=!u.hasOwnProperty("lt")||(0,n.default)(u.lt)||l<u.lt,g=!u.hasOwnProperty("gt")||(0,n.default)(u.gt)||l>u.gt;return c.test(l)&&d&&f&&h&&g}r.exports=e.default,r.exports.default=e.default})(wf,wf.exports);var vp=wf.exports;(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=s;var t=n(vp);function n(i){return i&&i.__esModule?i:{default:i}}function s(i){return(0,t.default)(i,{allow_leading_zeroes:!1,min:0,max:65535})}r.exports=e.default,r.exports.default=e.default})(Af,Af.exports);var Qk=Af.exports,If={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=s;var t=n(Y);function n(i){return i&&i.__esModule?i:{default:i}}function s(i){return(0,t.default)(i),i===i.toLowerCase()}r.exports=e.default,r.exports.default=e.default})(If,If.exports);var Xk=If.exports,bf={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=s;var t=n(Y);function n(i){return i&&i.__esModule?i:{default:i}}function s(i){return(0,t.default)(i),i===i.toUpperCase()}r.exports=e.default,r.exports.default=e.default})(bf,bf.exports);var Jk=bf.exports,Rf={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=a;var t=n(Y);function n(o){return o&&o.__esModule?o:{default:o}}var s=/^[0-9]{15}$/,i=/^\d{2}-\d{6}-\d{6}-\d{1}$/;function a(o,l){(0,t.default)(o),l=l||{};var u=s;if(l.allow_hyphens&&(u=i),!u.test(o))return!1;o=o.replace(/-/g,"");for(var c=0,d=2,f=14,h=0;h<f;h++){var g=o.substring(f-h-1,f-h),p=parseInt(g,10)*d;p>=10?c+=p%10+1:c+=p,d===1?d+=1:d-=1}var v=(10-c%10)%10;return v===parseInt(o.substring(14,15),10)}r.exports=e.default,r.exports.default=e.default})(Rf,Rf.exports);var eC=Rf.exports,Lf={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;var t=n(Y);function n(a){return a&&a.__esModule?a:{default:a}}var s=/^[\x00-\x7F]+$/;function i(a){return(0,t.default)(a),s.test(a)}r.exports=e.default,r.exports.default=e.default})(Lf,Lf.exports);var tC=Lf.exports,Si={};Object.defineProperty(Si,"__esModule",{value:!0});Si.default=iC;Si.fullWidth=void 0;var rC=nC(Y);function nC(r){return r&&r.__esModule?r:{default:r}}var sC=Si.fullWidth=/[^\u0020-\u007E\uFF61-\uFF9F\uFFA0-\uFFDC\uFFE8-\uFFEE0-9a-zA-Z]/;function iC(r){return(0,rC.default)(r),sC.test(r)}var Ei={};Object.defineProperty(Ei,"__esModule",{value:!0});Ei.default=uC;Ei.halfWidth=void 0;var aC=oC(Y);function oC(r){return r&&r.__esModule?r:{default:r}}var lC=Ei.halfWidth=/[\u0020-\u007E\uFF61-\uFF9F\uFFA0-\uFFDC\uFFE8-\uFFEE0-9a-zA-Z]/;function uC(r){return(0,aC.default)(r),lC.test(r)}var kf={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=a;var t=i(Y),n=Si,s=Ei;function i(o){return o&&o.__esModule?o:{default:o}}function a(o){return(0,t.default)(o),n.fullWidth.test(o)&&s.halfWidth.test(o)}r.exports=e.default,r.exports.default=e.default})(kf,kf.exports);var cC=kf.exports,Cf={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;var t=n(Y);function n(a){return a&&a.__esModule?a:{default:a}}var s=/[^\x00-\x7F]/;function i(a){return(0,t.default)(a),s.test(a)}r.exports=e.default,r.exports.default=e.default})(Cf,Cf.exports);var dC=Cf.exports,Pf={exports:{}},Df={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=t;function t(n,s){var i=n.join("");return new RegExp(i,s)}r.exports=e.default,r.exports.default=e.default})(Df,Df.exports);var fC=Df.exports;(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=a;var t=s(Y),n=s(fC);function s(o){return o&&o.__esModule?o:{default:o}}var i=(0,n.default)(["^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)","(?:-((?:0|[1-9]\\d*|\\d*[a-z-][0-9a-z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-z-][0-9a-z-]*))*))","?(?:\\+([0-9a-z-]+(?:\\.[0-9a-z-]+)*))?$"],"i");function a(o){return(0,t.default)(o),i.test(o)}r.exports=e.default,r.exports.default=e.default})(Pf,Pf.exports);var hC=Pf.exports,Of={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;var t=n(Y);function n(a){return a&&a.__esModule?a:{default:a}}var s=/[\uD800-\uDBFF][\uDC00-\uDFFF]/;function i(a){return(0,t.default)(a),s.test(a)}r.exports=e.default,r.exports.default=e.default})(Of,Of.exports);var gC=Of.exports,Mf={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=c;var t=a(Lt),n=a(Y),s=a(Da),i=De;function a(d){return d&&d.__esModule?d:{default:d}}function o(d){var f=new RegExp("^[-+]?([0-9]+)?(\\".concat(i.decimal[d.locale],"[0-9]{").concat(d.decimal_digits,"})").concat(d.force_decimal?"":"?","$"));return f}var l={force_decimal:!1,decimal_digits:"1,",locale:"en-US"},u=["","-","+"];function c(d,f){if((0,n.default)(d),f=(0,t.default)(f,l),f.locale in i.decimal)return!(0,s.default)(u,d.replace(/ /g,""))&&o(f).test(d);throw new Error("Invalid locale '".concat(f.locale,"'"))}r.exports=e.default,r.exports.default=e.default})(Mf,Mf.exports);var pC=Mf.exports,Nf={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;var t=n(Y);function n(a){return a&&a.__esModule?a:{default:a}}var s=/^(0x|0h)?[0-9A-F]+$/i;function i(a){return(0,t.default)(a),s.test(a)}r.exports=e.default,r.exports.default=e.default})(Nf,Nf.exports);var Y_=Nf.exports,Ff={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;var t=n(Y);function n(a){return a&&a.__esModule?a:{default:a}}var s=/^(0o)?[0-7]+$/i;function i(a){return(0,t.default)(a),s.test(a)}r.exports=e.default,r.exports.default=e.default})(Ff,Ff.exports);var mC=Ff.exports,$f={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;var t=s(Y),n=s(G_);function s(a){return a&&a.__esModule?a:{default:a}}function i(a,o){return(0,t.default)(a),(0,n.default)(a)%parseInt(o,10)===0}r.exports=e.default,r.exports.default=e.default})($f,$f.exports);var vC=$f.exports,Uf={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;var t=n(Y);function n(a){return a&&a.__esModule?a:{default:a}}var s=/^#?([0-9A-F]{3}|[0-9A-F]{4}|[0-9A-F]{6}|[0-9A-F]{8})$/i;function i(a){return(0,t.default)(a),s.test(a)}r.exports=e.default,r.exports.default=e.default})(Uf,Uf.exports);var yC=Uf.exports,Bf={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=c;var t=n(Y);function n(d){return d&&d.__esModule?d:{default:d}}function s(d){"@babel/helpers - typeof";return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(f){return typeof f}:function(f){return f&&typeof Symbol=="function"&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f},s(d)}var i=/^rgb\((([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5]),){2}([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\)$/,a=/^rgba\((([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5]),){3}(0?\.\d\d?|1(\.0)?|0(\.0)?)\)$/,o=/^rgb\((([0-9]%|[1-9][0-9]%|100%),){2}([0-9]%|[1-9][0-9]%|100%)\)$/,l=/^rgba\((([0-9]%|[1-9][0-9]%|100%),){3}(0?\.\d\d?|1(\.0)?|0(\.0)?)\)$/,u=/^rgba?/;function c(d,f){(0,t.default)(d);var h=!1,g=!0;if(s(f)!=="object"?arguments.length>=2&&(g=arguments[1]):(h=f.allowSpaces!==void 0?f.allowSpaces:h,g=f.includePercentValues!==void 0?f.includePercentValues:g),h){if(!u.test(d))return!1;d=d.replace(/\s/g,"")}return g?i.test(d)||a.test(d)||o.test(d)||l.test(d):i.test(d)||a.test(d)}r.exports=e.default,r.exports.default=e.default})(Bf,Bf.exports);var SC=Bf.exports,jf={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=a;var t=n(Y);function n(o){return o&&o.__esModule?o:{default:o}}var s=/^hsla?\(((\+|\-)?([0-9]+(\.[0-9]+)?(e(\+|\-)?[0-9]+)?|\.[0-9]+(e(\+|\-)?[0-9]+)?))(deg|grad|rad|turn)?(,(\+|\-)?([0-9]+(\.[0-9]+)?(e(\+|\-)?[0-9]+)?|\.[0-9]+(e(\+|\-)?[0-9]+)?)%){2}(,((\+|\-)?([0-9]+(\.[0-9]+)?(e(\+|\-)?[0-9]+)?|\.[0-9]+(e(\+|\-)?[0-9]+)?)%?))?\)$/i,i=/^hsla?\(((\+|\-)?([0-9]+(\.[0-9]+)?(e(\+|\-)?[0-9]+)?|\.[0-9]+(e(\+|\-)?[0-9]+)?))(deg|grad|rad|turn)?(\s(\+|\-)?([0-9]+(\.[0-9]+)?(e(\+|\-)?[0-9]+)?|\.[0-9]+(e(\+|\-)?[0-9]+)?)%){2}\s?(\/\s((\+|\-)?([0-9]+(\.[0-9]+)?(e(\+|\-)?[0-9]+)?|\.[0-9]+(e(\+|\-)?[0-9]+)?)%?)\s?)?\)$/i;function a(o){(0,t.default)(o);var l=o.replace(/\s+/g," ").replace(/\s?(hsla?\(|\)|,)\s?/ig,"$1");return l.indexOf(",")!==-1?s.test(l):i.test(l)}r.exports=e.default,r.exports.default=e.default})(jf,jf.exports);var EC=jf.exports,Gf={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;var t=n(Y);function n(a){return a&&a.__esModule?a:{default:a}}var s=/^[A-Z]{2}[0-9A-Z]{3}\d{2}\d{5}$/;function i(a){return(0,t.default)(a),s.test(a)}r.exports=e.default,r.exports.default=e.default})(Gf,Gf.exports);var _C=Gf.exports,Fa={};Object.defineProperty(Fa,"__esModule",{value:!0});Fa.default=IC;Fa.locales=void 0;var TC=Z_(Y),yv=Z_(Da);function Z_(r){return r&&r.__esModule?r:{default:r}}var Nl={AD:/^(AD[0-9]{2})\d{8}[A-Z0-9]{12}$/,AE:/^(AE[0-9]{2})\d{3}\d{16}$/,AL:/^(AL[0-9]{2})\d{8}[A-Z0-9]{16}$/,AT:/^(AT[0-9]{2})\d{16}$/,AZ:/^(AZ[0-9]{2})[A-Z0-9]{4}\d{20}$/,BA:/^(BA[0-9]{2})\d{16}$/,BE:/^(BE[0-9]{2})\d{12}$/,BG:/^(BG[0-9]{2})[A-Z]{4}\d{6}[A-Z0-9]{8}$/,BH:/^(BH[0-9]{2})[A-Z]{4}[A-Z0-9]{14}$/,BR:/^(BR[0-9]{2})\d{23}[A-Z]{1}[A-Z0-9]{1}$/,BY:/^(BY[0-9]{2})[A-Z0-9]{4}\d{20}$/,CH:/^(CH[0-9]{2})\d{5}[A-Z0-9]{12}$/,CR:/^(CR[0-9]{2})\d{18}$/,CY:/^(CY[0-9]{2})\d{8}[A-Z0-9]{16}$/,CZ:/^(CZ[0-9]{2})\d{20}$/,DE:/^(DE[0-9]{2})\d{18}$/,DK:/^(DK[0-9]{2})\d{14}$/,DO:/^(DO[0-9]{2})[A-Z]{4}\d{20}$/,DZ:/^(DZ\d{24})$/,EE:/^(EE[0-9]{2})\d{16}$/,EG:/^(EG[0-9]{2})\d{25}$/,ES:/^(ES[0-9]{2})\d{20}$/,FI:/^(FI[0-9]{2})\d{14}$/,FO:/^(FO[0-9]{2})\d{14}$/,FR:/^(FR[0-9]{2})\d{10}[A-Z0-9]{11}\d{2}$/,GB:/^(GB[0-9]{2})[A-Z]{4}\d{14}$/,GE:/^(GE[0-9]{2})[A-Z0-9]{2}\d{16}$/,GI:/^(GI[0-9]{2})[A-Z]{4}[A-Z0-9]{15}$/,GL:/^(GL[0-9]{2})\d{14}$/,GR:/^(GR[0-9]{2})\d{7}[A-Z0-9]{16}$/,GT:/^(GT[0-9]{2})[A-Z0-9]{4}[A-Z0-9]{20}$/,HR:/^(HR[0-9]{2})\d{17}$/,HU:/^(HU[0-9]{2})\d{24}$/,IE:/^(IE[0-9]{2})[A-Z]{4}\d{14}$/,IL:/^(IL[0-9]{2})\d{19}$/,IQ:/^(IQ[0-9]{2})[A-Z]{4}\d{15}$/,IR:/^(IR[0-9]{2})0\d{2}0\d{18}$/,IS:/^(IS[0-9]{2})\d{22}$/,IT:/^(IT[0-9]{2})[A-Z]{1}\d{10}[A-Z0-9]{12}$/,JO:/^(JO[0-9]{2})[A-Z]{4}\d{22}$/,KW:/^(KW[0-9]{2})[A-Z]{4}[A-Z0-9]{22}$/,KZ:/^(KZ[0-9]{2})\d{3}[A-Z0-9]{13}$/,LB:/^(LB[0-9]{2})\d{4}[A-Z0-9]{20}$/,LC:/^(LC[0-9]{2})[A-Z]{4}[A-Z0-9]{24}$/,LI:/^(LI[0-9]{2})\d{5}[A-Z0-9]{12}$/,LT:/^(LT[0-9]{2})\d{16}$/,LU:/^(LU[0-9]{2})\d{3}[A-Z0-9]{13}$/,LV:/^(LV[0-9]{2})[A-Z]{4}[A-Z0-9]{13}$/,MA:/^(MA[0-9]{26})$/,MC:/^(MC[0-9]{2})\d{10}[A-Z0-9]{11}\d{2}$/,MD:/^(MD[0-9]{2})[A-Z0-9]{20}$/,ME:/^(ME[0-9]{2})\d{18}$/,MK:/^(MK[0-9]{2})\d{3}[A-Z0-9]{10}\d{2}$/,MR:/^(MR[0-9]{2})\d{23}$/,MT:/^(MT[0-9]{2})[A-Z]{4}\d{5}[A-Z0-9]{18}$/,MU:/^(MU[0-9]{2})[A-Z]{4}\d{19}[A-Z]{3}$/,MZ:/^(MZ[0-9]{2})\d{21}$/,NL:/^(NL[0-9]{2})[A-Z]{4}\d{10}$/,NO:/^(NO[0-9]{2})\d{11}$/,PK:/^(PK[0-9]{2})[A-Z0-9]{4}\d{16}$/,PL:/^(PL[0-9]{2})\d{24}$/,PS:/^(PS[0-9]{2})[A-Z]{4}[A-Z0-9]{21}$/,PT:/^(PT[0-9]{2})\d{21}$/,QA:/^(QA[0-9]{2})[A-Z]{4}[A-Z0-9]{21}$/,RO:/^(RO[0-9]{2})[A-Z]{4}[A-Z0-9]{16}$/,RS:/^(RS[0-9]{2})\d{18}$/,SA:/^(SA[0-9]{2})\d{2}[A-Z0-9]{18}$/,SC:/^(SC[0-9]{2})[A-Z]{4}\d{20}[A-Z]{3}$/,SE:/^(SE[0-9]{2})\d{20}$/,SI:/^(SI[0-9]{2})\d{15}$/,SK:/^(SK[0-9]{2})\d{20}$/,SM:/^(SM[0-9]{2})[A-Z]{1}\d{10}[A-Z0-9]{12}$/,SV:/^(SV[0-9]{2})[A-Z0-9]{4}\d{20}$/,TL:/^(TL[0-9]{2})\d{19}$/,TN:/^(TN[0-9]{2})\d{20}$/,TR:/^(TR[0-9]{2})\d{5}[A-Z0-9]{17}$/,UA:/^(UA[0-9]{2})\d{6}[A-Z0-9]{19}$/,VA:/^(VA[0-9]{2})\d{18}$/,VG:/^(VG[0-9]{2})[A-Z]{4}\d{16}$/,XK:/^(XK[0-9]{2})\d{16}$/};function xC(r){var e=r.filter(function(t){return!(t in Nl)});return!(e.length>0)}function AC(r,e){var t=r.replace(/[\s\-]+/gi,"").toUpperCase(),n=t.slice(0,2).toUpperCase(),s=n in Nl;if(e.whitelist){if(!xC(e.whitelist))return!1;var i=(0,yv.default)(e.whitelist,n);if(!i)return!1}if(e.blacklist){var a=(0,yv.default)(e.blacklist,n);if(a)return!1}return s&&Nl[n].test(t)}function wC(r){var e=r.replace(/[^A-Z0-9]+/gi,"").toUpperCase(),t=e.slice(4)+e.slice(0,4),n=t.replace(/[A-Z]/g,function(i){return i.charCodeAt(0)-55}),s=n.match(/\d{1,7}/g).reduce(function(i,a){return Number(i+a)%97},"");return s===1}function IC(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(0,TC.default)(r),AC(r,e)&&wC(r)}Fa.locales=Object.keys(Nl);var Kf={exports:{}},_i={};Object.defineProperty(_i,"__esModule",{value:!0});_i.CountryCodes=void 0;_i.default=LC;var bC=RC(Y);function RC(r){return r&&r.__esModule?r:{default:r}}var Q_=new Set(["AD","AE","AF","AG","AI","AL","AM","AO","AQ","AR","AS","AT","AU","AW","AX","AZ","BA","BB","BD","BE","BF","BG","BH","BI","BJ","BL","BM","BN","BO","BQ","BR","BS","BT","BV","BW","BY","BZ","CA","CC","CD","CF","CG","CH","CI","CK","CL","CM","CN","CO","CR","CU","CV","CW","CX","CY","CZ","DE","DJ","DK","DM","DO","DZ","EC","EE","EG","EH","ER","ES","ET","FI","FJ","FK","FM","FO","FR","GA","GB","GD","GE","GF","GG","GH","GI","GL","GM","GN","GP","GQ","GR","GS","GT","GU","GW","GY","HK","HM","HN","HR","HT","HU","ID","IE","IL","IM","IN","IO","IQ","IR","IS","IT","JE","JM","JO","JP","KE","KG","KH","KI","KM","KN","KP","KR","KW","KY","KZ","LA","LB","LC","LI","LK","LR","LS","LT","LU","LV","LY","MA","MC","MD","ME","MF","MG","MH","MK","ML","MM","MN","MO","MP","MQ","MR","MS","MT","MU","MV","MW","MX","MY","MZ","NA","NC","NE","NF","NG","NI","NL","NO","NP","NR","NU","NZ","OM","PA","PE","PF","PG","PH","PK","PL","PM","PN","PR","PS","PT","PW","PY","QA","RE","RO","RS","RU","RW","SA","SB","SC","SD","SE","SG","SH","SI","SJ","SK","SL","SM","SN","SO","SR","SS","ST","SV","SX","SY","SZ","TC","TD","TF","TG","TH","TJ","TK","TL","TM","TN","TO","TR","TT","TV","TW","TZ","UA","UG","UM","US","UY","UZ","VA","VC","VE","VG","VI","VN","VU","WF","WS","YE","YT","ZA","ZM","ZW"]);function LC(r){return(0,bC.default)(r),Q_.has(r.toUpperCase())}_i.CountryCodes=Q_;(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=a;var t=s(Y),n=_i;function s(o){return o&&o.__esModule?o:{default:o}}var i=/^[A-Za-z]{6}[A-Za-z0-9]{2}([A-Za-z0-9]{3})?$/;function a(o){(0,t.default)(o);var l=o.slice(4,6).toUpperCase();return!n.CountryCodes.has(l)&&l!=="XK"?!1:i.test(o)}r.exports=e.default,r.exports.default=e.default})(Kf,Kf.exports);var kC=Kf.exports,Hf={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;var t=n(Y);function n(a){return a&&a.__esModule?a:{default:a}}var s=/^[a-f0-9]{32}$/;function i(a){return(0,t.default)(a),s.test(a)}r.exports=e.default,r.exports.default=e.default})(Hf,Hf.exports);var CC=Hf.exports,Vf={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;var t=n(Y);function n(a){return a&&a.__esModule?a:{default:a}}var s={md5:32,md4:32,sha1:40,sha256:64,sha384:96,sha512:128,ripemd128:32,ripemd160:40,tiger128:32,tiger160:40,tiger192:48,crc32:8,crc32b:8};function i(a,o){(0,t.default)(a);var l=new RegExp("^[a-fA-F0-9]{".concat(s[o],"}$"));return l.test(a)}r.exports=e.default,r.exports.default=e.default})(Vf,Vf.exports);var PC=Vf.exports,Wf={exports:{}},zf={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=u;var t=s(Y),n=s(Lt);function s(c){return c&&c.__esModule?c:{default:c}}var i=/^[A-Za-z0-9+/]+={0,2}$/,a=/^[A-Za-z0-9+/]+$/,o=/^[A-Za-z0-9_-]+={0,2}$/,l=/^[A-Za-z0-9_-]+$/;function u(c,d){var f;if((0,t.default)(c),d=(0,n.default)(d,{urlSafe:!1,padding:!((f=d)!==null&&f!==void 0&&f.urlSafe)}),c==="")return!0;if(d.padding&&c.length%4!==0)return!1;var h;return d.urlSafe?h=d.padding?o:l:h=d.padding?i:a,(!d.padding||c.length%4===0)&&h.test(c)}r.exports=e.default,r.exports.default=e.default})(zf,zf.exports);var X_=zf.exports;(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;var t=s(Y),n=s(X_);function s(a){return a&&a.__esModule?a:{default:a}}function i(a){(0,t.default)(a);var o=a.split("."),l=o.length;return l!==3?!1:o.reduce(function(u,c){return u&&(0,n.default)(c,{urlSafe:!0})},!0)}r.exports=e.default,r.exports.default=e.default})(Wf,Wf.exports);var DC=Wf.exports,qf={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=l;var t=i(Y),n=i(Da),s=i(Lt);function i(u){return u&&u.__esModule?u:{default:u}}function a(u){"@babel/helpers - typeof";return a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(c){return typeof c}:function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c},a(u)}var o={allow_primitives:!1};function l(u,c){(0,t.default)(u);try{c=(0,s.default)(c,o);var d=[];c.allow_primitives&&(d=[null,!1,!0]);var f=JSON.parse(u);return(0,n.default)(d,f)||!!f&&a(f)==="object"}catch{}return!1}r.exports=e.default,r.exports.default=e.default})(qf,qf.exports);var OC=qf.exports,Yf={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=a;var t=s(Y),n=s(Lt);function s(o){return o&&o.__esModule?o:{default:o}}var i={ignore_whitespace:!1};function a(o,l){return(0,t.default)(o),l=(0,n.default)(l,i),(l.ignore_whitespace?o.trim().length:o.length)===0}r.exports=e.default,r.exports.default=e.default})(Yf,Yf.exports);var MC=Yf.exports,Zf={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;var t=n(Y);function n(a){return a&&a.__esModule?a:{default:a}}function s(a){"@babel/helpers - typeof";return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},s(a)}function i(a,o){(0,t.default)(a);var l,u;s(o)==="object"?(l=o.min||0,u=o.max):(l=arguments[1]||0,u=arguments[2]);var c=a.match(/[^\uFE0F\uFE0E][\uFE0F\uFE0E]/g)||[],d=a.match(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g)||[],f=a.length-c.length-d.length,h=f>=l&&(typeof u>"u"||f<=u);return h&&Array.isArray(o==null?void 0:o.discreteLengths)?o.discreteLengths.some(function(g){return g===f}):h}r.exports=e.default,r.exports.default=e.default})(Zf,Zf.exports);var NC=Zf.exports,Qf={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=s;var t=n(Y);function n(i){return i&&i.__esModule?i:{default:i}}function s(i){return(0,t.default)(i),/^[0-7][0-9A-HJKMNP-TV-Z]{25}$/i.test(i)}r.exports=e.default,r.exports.default=e.default})(Qf,Qf.exports);var FC=Qf.exports,Xf={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;var t=n(Y);function n(a){return a&&a.__esModule?a:{default:a}}var s={1:/^[0-9A-F]{8}-[0-9A-F]{4}-1[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,2:/^[0-9A-F]{8}-[0-9A-F]{4}-2[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,3:/^[0-9A-F]{8}-[0-9A-F]{4}-3[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,4:/^[0-9A-F]{8}-[0-9A-F]{4}-4[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,5:/^[0-9A-F]{8}-[0-9A-F]{4}-5[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,6:/^[0-9A-F]{8}-[0-9A-F]{4}-6[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,7:/^[0-9A-F]{8}-[0-9A-F]{4}-7[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,8:/^[0-9A-F]{8}-[0-9A-F]{4}-8[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i,nil:/^00000000-0000-0000-0000-000000000000$/i,max:/^ffffffff-ffff-ffff-ffff-ffffffffffff$/i,loose:/^[0-9A-F]{8}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{12}$/i,all:/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i};function i(a,o){return(0,t.default)(a),o==null&&(o="all"),o in s?s[o].test(a):!1}r.exports=e.default,r.exports.default=e.default})(Xf,Xf.exports);var $C=Xf.exports,Jf={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;var t=s(Y),n=s(Y_);function s(a){return a&&a.__esModule?a:{default:a}}function i(a){return(0,t.default)(a),(0,n.default)(a)&&a.length===24}r.exports=e.default,r.exports.default=e.default})(Jf,Jf.exports);var UC=Jf.exports,eh={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;var t=n(pp);function n(a){return a&&a.__esModule?a:{default:a}}function s(a){"@babel/helpers - typeof";return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},s(a)}function i(a,o){var l=(s(o)==="object"?o.comparisonDate:o)||Date().toString(),u=(0,t.default)(l),c=(0,t.default)(a);return!!(c&&u&&c>u)}r.exports=e.default,r.exports.default=e.default})(eh,eh.exports);var BC=eh.exports,th={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;var t=n(pp);function n(a){return a&&a.__esModule?a:{default:a}}function s(a){"@babel/helpers - typeof";return s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},s(a)}function i(a,o){var l=(s(o)==="object"?o.comparisonDate:o)||Date().toString(),u=(0,t.default)(l),c=(0,t.default)(a);return!!(c&&u&&c<u)}r.exports=e.default,r.exports.default=e.default})(th,th.exports);var jC=th.exports,rh={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=a;var t=s(Y),n=s(K_);function s(o){return o&&o.__esModule?o:{default:o}}function i(o){"@babel/helpers - typeof";return i=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(l){return typeof l}:function(l){return l&&typeof Symbol=="function"&&l.constructor===Symbol&&l!==Symbol.prototype?"symbol":typeof l},i(o)}function a(o,l){(0,t.default)(o);var u;if(Object.prototype.toString.call(l)==="[object Array]"){var c=[];for(u in l)({}).hasOwnProperty.call(l,u)&&(c[u]=(0,n.default)(l[u]));return c.indexOf(o)>=0}else{if(i(l)==="object")return l.hasOwnProperty(o);if(l&&typeof l.indexOf=="function")return l.indexOf(o)>=0}return!1}r.exports=e.default,r.exports.default=e.default})(rh,rh.exports);var GC=rh.exports,nh={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=s;var t=n(Y);function n(i){return i&&i.__esModule?i:{default:i}}function s(i){(0,t.default)(i);for(var a=i.replace(/[- ]+/g,""),o=0,l,u,c,d=a.length-1;d>=0;d--)l=a.substring(d,d+1),u=parseInt(l,10),c?(u*=2,u>=10?o+=u%10+1:o+=u):o+=u,c=!c;return!!(o%10===0&&a)}r.exports=e.default,r.exports.default=e.default})(nh,nh.exports);var J_=nh.exports,sh={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var t=s(Y),n=s(J_);function s(l){return l&&l.__esModule?l:{default:l}}var i={amex:/^3[47][0-9]{13}$/,dinersclub:/^3(?:0[0-5]|[68][0-9])[0-9]{11}$/,discover:/^6(?:011|5[0-9][0-9])[0-9]{12,15}$/,jcb:/^(?:2131|1800|35\d{3})\d{11}$/,mastercard:/^5[1-5][0-9]{2}|(222[1-9]|22[3-9][0-9]|2[3-6][0-9]{2}|27[01][0-9]|2720)[0-9]{12}$/,unionpay:/^(6[27][0-9]{14}|^(81[0-9]{14,17}))$/,visa:/^(?:4[0-9]{12})(?:[0-9]{3,6})?$/},a=function(){var l=[];for(var u in i)i.hasOwnProperty(u)&&l.push(i[u]);return l}();function o(l){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};(0,t.default)(l);var c=u.provider,d=l.replace(/[- ]+/g,"");if(c&&c.toLowerCase()in i){if(!i[c.toLowerCase()].test(d))return!1}else{if(c&&!(c.toLowerCase()in i))throw new Error("".concat(c," is not a valid credit card provider."));if(!a.some(function(f){return f.test(d)}))return!1}return(0,n.default)(l)}r.exports=e.default,r.exports.default=e.default})(sh,sh.exports);var KC=sh.exports,ih={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var t=i(Y),n=i(Da),s=i(vp);function i(l){return l&&l.__esModule?l:{default:l}}var a={PL:function(u){(0,t.default)(u);var c={1:1,2:3,3:7,4:9,5:1,6:3,7:7,8:9,9:1,10:3,11:0};if(u!=null&&u.length===11&&(0,s.default)(u,{allow_leading_zeroes:!0})){var d=u.split("").slice(0,-1),f=d.reduce(function(p,v,m){return p+Number(v)*c[m+1]},0),h=f%10,g=Number(u.charAt(u.length-1));if(h===0&&g===0||g===10-h)return!0}return!1},ES:function(u){(0,t.default)(u);var c=/^[0-9X-Z][0-9]{7}[TRWAGMYFPDXBNJZSQVHLCKE]$/,d={X:0,Y:1,Z:2},f=["T","R","W","A","G","M","Y","F","P","D","X","B","N","J","Z","S","Q","V","H","L","C","K","E"],h=u.trim().toUpperCase();if(!c.test(h))return!1;var g=h.slice(0,-1).replace(/[X,Y,Z]/g,function(p){return d[p]});return h.endsWith(f[g%23])},FI:function(u){if((0,t.default)(u),u.length!==11||!u.match(/^\d{6}[\-A\+]\d{3}[0-9ABCDEFHJKLMNPRSTUVWXY]{1}$/))return!1;var c="0123456789ABCDEFHJKLMNPRSTUVWXY",d=parseInt(u.slice(0,6),10)*1e3+parseInt(u.slice(7,10),10),f=d%31,h=c[f];return h===u.slice(10,11)},IN:function(u){var c=/^[1-9]\d{3}\s?\d{4}\s?\d{4}$/,d=[[0,1,2,3,4,5,6,7,8,9],[1,2,3,4,0,6,7,8,9,5],[2,3,4,0,1,7,8,9,5,6],[3,4,0,1,2,8,9,5,6,7],[4,0,1,2,3,9,5,6,7,8],[5,9,8,7,6,0,4,3,2,1],[6,5,9,8,7,1,0,4,3,2],[7,6,5,9,8,2,1,0,4,3],[8,7,6,5,9,3,2,1,0,4],[9,8,7,6,5,4,3,2,1,0]],f=[[0,1,2,3,4,5,6,7,8,9],[1,5,7,6,2,8,3,0,9,4],[5,8,0,3,7,9,6,1,4,2],[8,9,1,6,0,4,3,5,2,7],[9,4,5,3,1,2,6,8,7,0],[4,2,8,6,5,7,3,9,0,1],[2,7,9,3,8,0,6,4,1,5],[7,0,4,6,9,1,3,2,5,8]],h=u.trim();if(!c.test(h))return!1;var g=0,p=h.replace(/\s/g,"").split("").map(Number).reverse();return p.forEach(function(v,m){g=d[g][f[m%8][v]]}),g===0},IR:function(u){if(!u.match(/^\d{10}$/)||(u="0000".concat(u).slice(u.length-6),parseInt(u.slice(3,9),10)===0))return!1;for(var c=parseInt(u.slice(9,10),10),d=0,f=0;f<9;f++)d+=parseInt(u.slice(f,f+1),10)*(10-f);return d%=11,d<2&&c===d||d>=2&&c===11-d},IT:function(u){return u.length!==9||u==="CA00000AA"?!1:u.search(/C[A-Z]\d{5}[A-Z]{2}/i)>-1},NO:function(u){var c=u.trim();if(isNaN(Number(c))||c.length!==11||c==="00000000000")return!1;var d=c.split("").map(Number),f=(11-(3*d[0]+7*d[1]+6*d[2]+1*d[3]+8*d[4]+9*d[5]+4*d[6]+5*d[7]+2*d[8])%11)%11,h=(11-(5*d[0]+4*d[1]+3*d[2]+2*d[3]+7*d[4]+6*d[5]+5*d[6]+4*d[7]+3*d[8]+2*f)%11)%11;return!(f!==d[9]||h!==d[10])},TH:function(u){if(!u.match(/^[1-8]\d{12}$/))return!1;for(var c=0,d=0;d<12;d++)c+=parseInt(u[d],10)*(13-d);return u[12]===((11-c%11)%10).toString()},LK:function(u){var c=/^[1-9]\d{8}[vx]$/i,d=/^[1-9]\d{11}$/i;return u.length===10&&c.test(u)?!0:!!(u.length===12&&d.test(u))},"he-IL":function(u){var c=/^\d{9}$/,d=u.trim();if(!c.test(d))return!1;for(var f=d,h=0,g,p=0;p<f.length;p++)g=Number(f[p])*(p%2+1),h+=g>9?g-9:g;return h%10===0},"ar-LY":function(u){var c=/^(1|2)\d{11}$/,d=u.trim();return!!c.test(d)},"ar-TN":function(u){var c=/^\d{8}$/,d=u.trim();return!!c.test(d)},"zh-CN":function(u){var c=["11","12","13","14","15","21","22","23","31","32","33","34","35","36","37","41","42","43","44","45","46","50","51","52","53","54","61","62","63","64","65","71","81","82","91"],d=["7","9","10","5","8","4","2","1","6","3","7","9","10","5","8","4","2"],f=["1","0","X","9","8","7","6","5","4","3","2"],h=function(T){return(0,n.default)(c,T)},g=function(T){var A=parseInt(T.substring(0,4),10),x=parseInt(T.substring(4,6),10),w=parseInt(T.substring(6),10),b=new Date(A,x-1,w);return b>new Date?!1:b.getFullYear()===A&&b.getMonth()===x-1&&b.getDate()===w},p=function(T){for(var A=T.substring(0,17),x=0,w=0;w<17;w++)x+=parseInt(A.charAt(w),10)*parseInt(d[w],10);var b=x%11;return f[b]},v=function(T){return p(T)===T.charAt(17).toUpperCase()},m=function(T){var A=/^[1-9]\d{7}((0[1-9])|(1[0-2]))((0[1-9])|([1-2][0-9])|(3[0-1]))\d{3}$/.test(T);if(!A)return!1;var x=T.substring(0,2);if(A=h(x),!A)return!1;var w="19".concat(T.substring(6,12));return A=g(w),!!A},y=function(T){var A=/^[1-9]\d{5}[1-9]\d{3}((0[1-9])|(1[0-2]))((0[1-9])|([1-2][0-9])|(3[0-1]))\d{3}(\d|x|X)$/.test(T);if(!A)return!1;var x=T.substring(0,2);if(A=h(x),!A)return!1;var w=T.substring(6,14);return A=g(w),A?v(T):!1},S=function(T){var A=/^\d{15}|(\d{17}(\d|x|X))$/.test(T);return A?T.length===15?m(T):y(T):!1};return S(u)},"zh-HK":function(u){u=u.trim();var c=/^[A-Z]{1,2}[0-9]{6}((\([0-9A]\))|(\[[0-9A]\])|([0-9A]))$/,d=/^[0-9]$/;if(u=u.toUpperCase(),!c.test(u))return!1;u=u.replace(/\[|\]|\(|\)/g,""),u.length===8&&(u="3".concat(u));for(var f=0,h=0;h<=7;h++){var g=void 0;d.test(u[h])?g=u[h]:g=(u[h].charCodeAt(0)-55)%11,f+=g*(9-h)}f%=11;var p;return f===0?p="0":f===1?p="A":p=String(11-f),p===u[u.length-1]},"zh-TW":function(u){var c={A:10,B:11,C:12,D:13,E:14,F:15,G:16,H:17,I:34,J:18,K:19,L:20,M:21,N:22,O:35,P:23,Q:24,R:25,S:26,T:27,U:28,V:29,W:32,X:30,Y:31,Z:33},d=u.trim().toUpperCase();return/^[A-Z][0-9]{9}$/.test(d)?Array.from(d).reduce(function(f,h,g){if(g===0){var p=c[h];return p%10*9+Math.floor(p/10)}return g===9?(10-f%10-Number(h))%10===0:f+Number(h)*(9-g)},0):!1},PK:function(u){var c=/^[1-7][0-9]{4}-[0-9]{7}-[1-9]$/,d=u.trim();return c.test(d)}};function o(l,u){if((0,t.default)(l),u in a)return a[u](l);if(u==="any"){for(var c in a)if(a.hasOwnProperty(c)){var d=a[c];if(d(l))return!0}return!1}throw new Error("Invalid locale '".concat(u,"'"))}r.exports=e.default,r.exports.default=e.default})(ih,ih.exports);var HC=ih.exports,ah={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=u;var t=n(Y);function n(c){return c&&c.__esModule?c:{default:c}}var s=8,i=14,a=/^(\d{8}|\d{13}|\d{14})$/;function o(c,d){return c===s||c===i?d%2===0?3:1:d%2===0?1:3}function l(c){var d=c.slice(0,-1).split("").map(function(h,g){return Number(h)*o(c.length,g)}).reduce(function(h,g){return h+g},0),f=10-d%10;return f<10?f:0}function u(c){(0,t.default)(c);var d=Number(c.slice(-1));return a.test(c)&&d===l(c)}r.exports=e.default,r.exports.default=e.default})(ah,ah.exports);var VC=ah.exports,oh={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;var t=n(Y);function n(a){return a&&a.__esModule?a:{default:a}}var s=/^[A-Z]{2}[0-9A-Z]{9}[0-9]$/;function i(a){if((0,t.default)(a),!s.test(a))return!1;for(var o=!0,l=0,u=a.length-2;u>=0;u--)if(a[u]>="A"&&a[u]<="Z")for(var c=a[u].charCodeAt(0)-55,d=c%10,f=Math.trunc(c/10),h=0,g=[d,f];h<g.length;h++){var p=g[h];o?p>=5?l+=1+(p-5)*2:l+=p*2:l+=p,o=!o}else{var v=a[u].charCodeAt(0)-48;o?v>=5?l+=1+(v-5)*2:l+=v*2:l+=v,o=!o}var m=Math.trunc((l+9)/10)*10-l;return+a[a.length-1]===m}r.exports=e.default,r.exports.default=e.default})(oh,oh.exports);var WC=oh.exports,lh={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var t=n(Y);function n(l){return l&&l.__esModule?l:{default:l}}var s=/^(?:[0-9]{9}X|[0-9]{10})$/,i=/^(?:[0-9]{13})$/,a=[1,3];function o(l,u){(0,t.default)(l);var c=String((u==null?void 0:u.version)||u);if(!(u!=null&&u.version||u))return o(l,{version:10})||o(l,{version:13});var d=l.replace(/[\s-]+/g,""),f=0;if(c==="10"){if(!s.test(d))return!1;for(var h=0;h<c-1;h++)f+=(h+1)*d.charAt(h);if(d.charAt(9)==="X"?f+=10*10:f+=10*d.charAt(9),f%11===0)return!0}else if(c==="13"){if(!i.test(d))return!1;for(var g=0;g<12;g++)f+=a[g%2]*d.charAt(g);if(d.charAt(12)-(10-f%10)%10===0)return!0}return!1}r.exports=e.default,r.exports.default=e.default})(lh,lh.exports);var zC=lh.exports,uh={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;var t=n(Y);function n(a){return a&&a.__esModule?a:{default:a}}var s="^\\d{4}-?\\d{3}[\\dX]$";function i(a){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};(0,t.default)(a);var l=s;if(l=o.require_hyphen?l.replace("?",""):l,l=o.case_sensitive?new RegExp(l):new RegExp(l,"i"),!l.test(a))return!1;for(var u=a.replace("-","").toUpperCase(),c=0,d=0;d<u.length;d++){var f=u[d];c+=(f==="X"?10:+f)*(8-d)}return c%11===0}r.exports=e.default,r.exports.default=e.default})(uh,uh.exports);var qC=uh.exports,ch={exports:{}},hs={};Object.defineProperty(hs,"__esModule",{value:!0});hs.iso7064Check=YC;hs.luhnCheck=ZC;hs.reverseMultiplyAndSum=QC;hs.verhoeffCheck=XC;function YC(r){for(var e=10,t=0;t<r.length-1;t++)e=(parseInt(r[t],10)+e)%10===0?10*2%11:(parseInt(r[t],10)+e)%10*2%11;return e=e===1?0:11-e,e===parseInt(r[10],10)}function ZC(r){for(var e=0,t=!1,n=r.length-1;n>=0;n--){if(t){var s=parseInt(r[n],10)*2;s>9?e+=s.toString().split("").map(function(i){return parseInt(i,10)}).reduce(function(i,a){return i+a},0):e+=s}else e+=parseInt(r[n],10);t=!t}return e%10===0}function QC(r,e){for(var t=0,n=0;n<r.length;n++)t+=r[n]*(e-n);return t}function XC(r){for(var e=[[0,1,2,3,4,5,6,7,8,9],[1,2,3,4,0,6,7,8,9,5],[2,3,4,0,1,7,8,9,5,6],[3,4,0,1,2,8,9,5,6,7],[4,0,1,2,3,9,5,6,7,8],[5,9,8,7,6,0,4,3,2,1],[6,5,9,8,7,1,0,4,3,2],[7,6,5,9,8,2,1,0,4,3],[8,7,6,5,9,3,2,1,0,4],[9,8,7,6,5,4,3,2,1,0]],t=[[0,1,2,3,4,5,6,7,8,9],[1,5,7,6,2,8,3,0,9,4],[5,8,0,3,7,9,6,1,4,2],[8,9,1,6,0,4,3,5,2,7],[9,4,5,3,1,2,6,8,7,0],[4,2,8,6,5,7,3,9,0,1],[2,7,9,3,8,0,6,4,1,5],[7,0,4,6,9,1,3,2,5,8]],n=r.split("").reverse().join(""),s=0,i=0;i<n.length;i++)s=e[s][t[i%8][parseInt(n[i],10)]];return s===0}(function(r,e){function t(R){"@babel/helpers - typeof";return t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(L){return typeof L}:function(L){return L&&typeof Symbol=="function"&&L.constructor===Symbol&&L!==Symbol.prototype?"symbol":typeof L},t(R)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=Se;var n=o(Y),s=a(hs),i=o(q_);function a(R,L){if(typeof WeakMap=="function")var $=new WeakMap,V=new WeakMap;return(a=function(H,ue){if(!ue&&H&&H.__esModule)return H;var ce,pe,Ee={__proto__:null,default:H};if(H===null||t(H)!="object"&&typeof H!="function")return Ee;if(ce=ue?V:$){if(ce.has(H))return ce.get(H);ce.set(H,Ee)}for(var at in H)at!=="default"&&{}.hasOwnProperty.call(H,at)&&((pe=(ce=Object.defineProperty)&&Object.getOwnPropertyDescriptor(H,at))&&(pe.get||pe.set)?ce(Ee,at,pe):Ee[at]=H[at]);return Ee})(R,L)}function o(R){return R&&R.__esModule?R:{default:R}}function l(R){return f(R)||d(R)||c(R)||u()}function u(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function c(R,L){if(R){if(typeof R=="string")return h(R,L);var $={}.toString.call(R).slice(8,-1);return $==="Object"&&R.constructor&&($=R.constructor.name),$==="Map"||$==="Set"?Array.from(R):$==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test($)?h(R,L):void 0}}function d(R){if(typeof Symbol<"u"&&R[Symbol.iterator]!=null||R["@@iterator"]!=null)return Array.from(R)}function f(R){if(Array.isArray(R))return h(R)}function h(R,L){(L==null||L>R.length)&&(L=R.length);for(var $=0,V=Array(L);$<L;$++)V[$]=R[$];return V}function g(R){var L=R.slice(0,2),$=parseInt(R.slice(2,4),10);$>40?($-=40,L="20".concat(L)):$>20?($-=20,L="18".concat(L)):L="19".concat(L),$<10&&($="0".concat($));var V="".concat(L,"/").concat($,"/").concat(R.slice(4,6));if(!(0,i.default)(V,"YYYY/MM/DD"))return!1;for(var W=R.split("").map(function(pe){return parseInt(pe,10)}),H=[2,4,8,5,10,9,7,3,6],ue=0,ce=0;ce<H.length;ce++)ue+=W[ce]*H[ce];return ue=ue%11===10?0:ue%11,ue===W[9]}function p(R){var L=R.split(""),$=L.filter(function(W,H){return H%2}).map(function(W){return Number(W)*2}).join("").split(""),V=L.filter(function(W,H){return!(H%2)}).concat($).map(function(W){return Number(W)}).reduce(function(W,H){return W+H});return V%10===0}function v(R){R=R.replace(/\W/,"");var L=parseInt(R.slice(0,2),10);if(R.length===10)L<54?L="20".concat(L):L="19".concat(L);else{if(R.slice(6)==="000")return!1;if(L<54)L="19".concat(L);else return!1}L.length===3&&(L=[L.slice(0,2),"0",L.slice(2)].join(""));var $=parseInt(R.slice(2,4),10);if($>50&&($-=50),$>20){if(parseInt(L,10)<2004)return!1;$-=20}$<10&&($="0".concat($));var V="".concat(L,"/").concat($,"/").concat(R.slice(4,6));if(!(0,i.default)(V,"YYYY/MM/DD"))return!1;if(R.length===10&&parseInt(R,10)%11!==0){var W=parseInt(R.slice(0,9),10)%11;if(parseInt(L,10)<1986&&W===10){if(parseInt(R.slice(9),10)!==0)return!1}else return!1}return!0}function m(R){return s.luhnCheck(R)}function y(R){for(var L=R.split("").map(function(pe){return parseInt(pe,10)}),$=[],V=0;V<L.length-1;V++){$.push("");for(var W=0;W<L.length-1;W++)L[V]===L[W]&&($[V]+=W)}if($=$.filter(function(pe){return pe.length>1}),$.length!==2&&$.length!==3)return!1;if($[0].length===3){for(var H=$[0].split("").map(function(pe){return parseInt(pe,10)}),ue=0,ce=0;ce<H.length-1;ce++)H[ce]+1===H[ce+1]&&(ue+=1);if(ue===2)return!1}return s.iso7064Check(R)}function S(R){R=R.replace(/\W/,"");var L=parseInt(R.slice(4,6),10),$=R.slice(6,7);switch($){case"0":case"1":case"2":case"3":L="19".concat(L);break;case"4":case"9":L<37?L="20".concat(L):L="19".concat(L);break;default:if(L<37)L="20".concat(L);else if(L>58)L="18".concat(L);else return!1;break}L.length===3&&(L=[L.slice(0,2),"0",L.slice(2)].join(""));var V="".concat(L,"/").concat(R.slice(2,4),"/").concat(R.slice(0,2));if(!(0,i.default)(V,"YYYY/MM/DD"))return!1;for(var W=R.split("").map(function(pe){return parseInt(pe,10)}),H=0,ue=4,ce=0;ce<9;ce++)H+=W[ce]*ue,ue-=1,ue===1&&(ue=7);return H%=11,H===1?!1:H===0?W[9]===0:W[9]===11-H}function E(R){for(var L=R.slice(0,8).split("").map(function(H){return parseInt(H,10)}),$=0,V=1;V<L.length;V+=2)$+=L[V];for(var W=0;W<L.length;W+=2)L[W]<2?$+=1-L[W]:($+=2*(L[W]-2)+5,L[W]>4&&($+=2));return String.fromCharCode($%26+65)===R.charAt(8)}function T(R){for(var L=R.split("").map(function(W){return parseInt(W,10)}),$=0,V=0;V<8;V++)$+=L[V]*Math.pow(2,8-V);return $%11%10===L[8]}function A(R){var L=s.reverseMultiplyAndSum(R.split("").slice(0,7).map(function($){return parseInt($,10)}),8);return R.length===9&&R[8]!=="W"&&(L+=(R[8].charCodeAt(0)-64)*9),L%=23,L===0?R[7].toUpperCase()==="W":R[7].toUpperCase()===String.fromCharCode(64+L)}var x={andover:["10","12"],atlanta:["60","67"],austin:["50","53"],brookhaven:["01","02","03","04","05","06","11","13","14","16","21","22","23","25","34","51","52","54","55","56","57","58","59","65"],cincinnati:["30","32","35","36","37","38","61"],fresno:["15","24"],internet:["20","26","27","45","46","47"],kansas:["40","44"],memphis:["94","95"],ogden:["80","90"],philadelphia:["33","39","41","42","43","46","48","62","63","64","66","68","71","72","73","74","75","76","77","81","82","83","84","85","86","87","88","91","92","93","98","99"],sba:["31"]};function w(){var R=[];for(var L in x)x.hasOwnProperty(L)&&R.push.apply(R,l(x[L]));return R}function b(R){return w().indexOf(R.slice(0,2))!==-1}function I(R){for(var L=0,$=R.split(""),V=parseInt($.pop(),10),W=0;W<$.length;W++)L+=$[9-W]*(2+W%6);var H=11-L%11;return H===11?H=0:H===10&&(H=9),V===H}function M(R){var L=R.toUpperCase().split("");if(isNaN(parseInt(L[0],10))&&L.length>1){var $=0;switch(L[0]){case"Y":$=1;break;case"Z":$=2;break}L.splice(0,1,$)}else for(;L.length<9;)L.unshift(0);var V=["T","R","W","A","G","M","Y","F","P","D","X","B","N","J","Z","S","Q","V","H","L","C","K","E"];L=L.join("");var W=parseInt(L.slice(0,8),10)%23;return L[8]===V[W]}function K(R){var L=R.slice(1,3),$=R.slice(0,1);switch($){case"1":case"2":L="18".concat(L);break;case"3":case"4":L="19".concat(L);break;default:L="20".concat(L);break}var V="".concat(L,"/").concat(R.slice(3,5),"/").concat(R.slice(5,7));if(!(0,i.default)(V,"YYYY/MM/DD"))return!1;for(var W=R.split("").map(function(Ee){return parseInt(Ee,10)}),H=0,ue=1,ce=0;ce<10;ce++)H+=W[ce]*ue,ue+=1,ue===10&&(ue=1);if(H%11===10){H=0,ue=3;for(var pe=0;pe<10;pe++)H+=W[pe]*ue,ue+=1,ue===10&&(ue=1);if(H%11===10)return W[10]===0}return H%11===W[10]}function z(R){var L=R.slice(4,6),$=R.slice(6,7);switch($){case"+":L="18".concat(L);break;case"-":L="19".concat(L);break;default:L="20".concat(L);break}var V="".concat(L,"/").concat(R.slice(2,4),"/").concat(R.slice(0,2));if(!(0,i.default)(V,"YYYY/MM/DD"))return!1;var W=parseInt(R.slice(0,6)+R.slice(7,10),10)%31;if(W<10)return W===parseInt(R.slice(10),10);W-=10;var H=["A","B","C","D","E","F","H","J","K","L","M","N","P","R","S","T","U","V","W","X","Y"];return H[W]===R.slice(10)}function X(R){if(R.slice(2,4)!=="00"||R.slice(4,6)!=="00"){var L="".concat(R.slice(0,2),"/").concat(R.slice(2,4),"/").concat(R.slice(4,6));if(!(0,i.default)(L,"YY/MM/DD"))return!1}var $=97-parseInt(R.slice(0,9),10)%97,V=parseInt(R.slice(9,11),10);return!($!==V&&($=97-parseInt("2".concat(R.slice(0,9)),10)%97,$!==V))}function Q(R){R=R.replace(/\s/g,"");var L=parseInt(R.slice(0,10),10)%511,$=parseInt(R.slice(10,13),10);return L===$}function N(R){var L="".concat(R.slice(0,4),"/").concat(R.slice(4,6),"/").concat(R.slice(6,8));return!(0,i.default)(L,"YYYY/MM/DD")||!s.luhnCheck(R.slice(0,12))?!1:s.verhoeffCheck("".concat(R.slice(0,11)).concat(R[12]))}function P(R){return s.iso7064Check(R)}function k(R){for(var L=R.split("").map(function(W){return parseInt(W,10)}),$=8,V=1;V<9;V++)$+=L[V]*(V+1);return $%11===L[9]}function F(R){for(var L=!1,$=!1,V=0;V<3;V++)if(!L&&/[AEIOU]/.test(R[V]))L=!0;else if(!$&&L&&R[V]==="X")$=!0;else if(V>0&&(L&&!$&&!/[AEIOU]/.test(R[V])||$&&!/X/.test(R[V])))return!1;return!0}function U(R){var L=R.toUpperCase().split("");if(!F(L.slice(0,3))||!F(L.slice(3,6)))return!1;for(var $=[6,7,9,10,12,13,14],V={L:"0",M:"1",N:"2",P:"3",Q:"4",R:"5",S:"6",T:"7",U:"8",V:"9"},W=0,H=$;W<H.length;W++){var ue=H[W];L[ue]in V&&L.splice(ue,1,V[L[ue]])}var ce={A:"01",B:"02",C:"03",D:"04",E:"05",H:"06",L:"07",M:"08",P:"09",R:"10",S:"11",T:"12"},pe=ce[L[8]],Ee=parseInt(L[9]+L[10],10);Ee>40&&(Ee-=40),Ee<10&&(Ee="0".concat(Ee));var at="".concat(L[6]).concat(L[7],"/").concat(pe,"/").concat(Ee);if(!(0,i.default)(at,"YY/MM/DD"))return!1;for(var hr=0,Gt=1;Gt<L.length-1;Gt+=2){var an=parseInt(L[Gt],10);isNaN(an)&&(an=L[Gt].charCodeAt(0)-65),hr+=an}for(var Ir={A:1,B:0,C:5,D:7,E:9,F:13,G:15,H:17,I:19,J:21,K:2,L:4,M:18,N:20,O:11,P:3,Q:6,R:8,S:12,T:14,U:16,V:10,W:22,X:25,Y:24,Z:23,0:1,1:0},Bn=0;Bn<L.length-1;Bn+=2){var jn=0;if(L[Bn]in Ir)jn=Ir[L[Bn]];else{var Va=parseInt(L[Bn],10);jn=2*Va+1,Va>4&&(jn+=2)}hr+=jn}return String.fromCharCode(65+hr%26)===L[15]}function B(R){R=R.replace(/\W/,"");var L=R.slice(0,2);if(L!=="32"){var $=R.slice(2,4);if($!=="00"){var V=R.slice(4,6);switch(R[6]){case"0":V="18".concat(V);break;case"1":V="19".concat(V);break;default:V="20".concat(V);break}var W="".concat(V,"/").concat(R.slice(2,4),"/").concat(L);if(!(0,i.default)(W,"YYYY/MM/DD"))return!1}for(var H=1101,ue=[1,6,3,7,9,10,5,8,4,2],ce=0;ce<R.length-1;ce++)H-=parseInt(R[ce],10)*ue[ce];return parseInt(R[10],10)===H%11}return!0}function G(R){if(R.length!==9){for(var L=R.toUpperCase().split("");L.length<8;)L.unshift(0);switch(R[7]){case"A":case"P":if(parseInt(L[6],10)===0)return!1;break;default:{var $=parseInt(L.join("").slice(0,5),10);if($>32e3)return!1;var V=parseInt(L.join("").slice(5,7),10);if($===V)return!1}}}return!0}function ie(R){return s.reverseMultiplyAndSum(R.split("").slice(0,8).map(function(L){return parseInt(L,10)}),9)%11===parseInt(R[8],10)}function ne(R){if(R.length===10){for(var L=[6,5,7,2,3,4,5,6,7],$=0,V=0;V<L.length;V++)$+=parseInt(R[V],10)*L[V];return $%=11,$===10?!1:$===parseInt(R[9],10)}var W=R.slice(0,2),H=parseInt(R.slice(2,4),10);H>80?(W="18".concat(W),H-=80):H>60?(W="22".concat(W),H-=60):H>40?(W="21".concat(W),H-=40):H>20?(W="20".concat(W),H-=20):W="19".concat(W),H<10&&(H="0".concat(H));var ue="".concat(W,"/").concat(H,"/").concat(R.slice(4,6));if(!(0,i.default)(ue,"YYYY/MM/DD"))return!1;for(var ce=0,pe=1,Ee=0;Ee<R.length-1;Ee++)ce+=parseInt(R[Ee],10)*pe%10,pe+=2,pe>10?pe=1:pe===5&&(pe+=2);return ce=10-ce%10,ce===parseInt(R[10],10)}function oe(R){if(R.length===11){var L,$;if(L=0,R==="11111111111"||R==="22222222222"||R==="33333333333"||R==="44444444444"||R==="55555555555"||R==="66666666666"||R==="77777777777"||R==="88888888888"||R==="99999999999"||R==="00000000000")return!1;for(var V=1;V<=9;V++)L+=parseInt(R.substring(V-1,V),10)*(11-V);if($=L*10%11,$===10&&($=0),$!==parseInt(R.substring(9,10),10))return!1;L=0;for(var W=1;W<=10;W++)L+=parseInt(R.substring(W-1,W),10)*(12-W);return $=L*10%11,$===10&&($=0),$===parseInt(R.substring(10,11),10)}if(R==="00000000000000"||R==="11111111111111"||R==="22222222222222"||R==="33333333333333"||R==="44444444444444"||R==="55555555555555"||R==="66666666666666"||R==="77777777777777"||R==="88888888888888"||R==="99999999999999")return!1;for(var H=R.length-2,ue=R.substring(0,H),ce=R.substring(H),pe=0,Ee=H-7,at=H;at>=1;at--)pe+=ue.charAt(H-at)*Ee,Ee-=1,Ee<2&&(Ee=9);var hr=pe%11<2?0:11-pe%11;if(hr!==parseInt(ce.charAt(0),10))return!1;H+=1,ue=R.substring(0,H),pe=0,Ee=H-7;for(var Gt=H;Gt>=1;Gt--)pe+=ue.charAt(H-Gt)*Ee,Ee-=1,Ee<2&&(Ee=9);return hr=pe%11<2?0:11-pe%11,hr===parseInt(ce.charAt(1),10)}function le(R){var L=11-s.reverseMultiplyAndSum(R.split("").slice(0,8).map(function($){return parseInt($,10)}),9)%11;return L>9?parseInt(R[8],10)===0:L===parseInt(R[8],10)}function Ie(R){if(R.slice(0,4)!=="9000"){var L=R.slice(1,3);switch(R[0]){case"1":case"2":L="19".concat(L);break;case"3":case"4":L="18".concat(L);break;case"5":case"6":L="20".concat(L);break}var $="".concat(L,"/").concat(R.slice(3,5),"/").concat(R.slice(5,7));if($.length===8){if(!(0,i.default)($,"YY/MM/DD"))return!1}else if(!(0,i.default)($,"YYYY/MM/DD"))return!1;for(var V=R.split("").map(function(ce){return parseInt(ce,10)}),W=[2,7,9,1,4,6,3,5,8,2,7,9],H=0,ue=0;ue<W.length;ue++)H+=V[ue]*W[ue];return H%11===10?V[12]===1:V[12]===H%11}return!0}function Fe(R){if(R.length===9){if(R=R.replace(/\W/,""),R.slice(6)==="000")return!1;var L=parseInt(R.slice(0,2),10);if(L>53)return!1;L<10?L="190".concat(L):L="19".concat(L);var $=parseInt(R.slice(2,4),10);$>50&&($-=50),$<10&&($="0".concat($));var V="".concat(L,"/").concat($,"/").concat(R.slice(4,6));if(!(0,i.default)(V,"YYYY/MM/DD"))return!1}return!0}function Ye(R){var L=11-s.reverseMultiplyAndSum(R.split("").slice(0,7).map(function($){return parseInt($,10)}),8)%11;return L===10?parseInt(R[7],10)===0:L===parseInt(R[7],10)}function pt(R){var L=R.slice(0);R.length>11&&(L=L.slice(2));var $="",V=L.slice(2,4),W=parseInt(L.slice(4,6),10);if(R.length>11)$=R.slice(0,4);else if($=R.slice(0,2),R.length===11&&W<60){var H=new Date().getFullYear().toString(),ue=parseInt(H.slice(0,2),10);if(H=parseInt(H,10),R[6]==="-")parseInt("".concat(ue).concat($),10)>H?$="".concat(ue-1).concat($):$="".concat(ue).concat($);else if($="".concat(ue-1).concat($),H-parseInt($,10)<100)return!1}W>60&&(W-=60),W<10&&(W="0".concat(W));var ce="".concat($,"/").concat(V,"/").concat(W);if(ce.length===8){if(!(0,i.default)(ce,"YY/MM/DD"))return!1}else if(!(0,i.default)(ce,"YYYY/MM/DD"))return!1;return s.luhnCheck(R.replace(/\W/,""))}function jt(R){for(var L=R.split("").map(function(H){return parseInt(H,10)}),$=[-1,5,7,9,4,6,10,5,7],V=0,W=0;W<$.length;W++)V+=L[W]*$[W];return V%11===10?L[9]===0:L[9]===V%11}var kt={"bg-BG":/^\d{10}$/,"cs-CZ":/^\d{6}\/{0,1}\d{3,4}$/,"de-AT":/^\d{9}$/,"de-DE":/^[1-9]\d{10}$/,"dk-DK":/^\d{6}-{0,1}\d{4}$/,"el-CY":/^[09]\d{7}[A-Z]$/,"el-GR":/^([0-4]|[7-9])\d{8}$/,"en-CA":/^\d{9}$/,"en-GB":/^\d{10}$|^(?!GB|NK|TN|ZZ)(?![DFIQUV])[A-Z](?![DFIQUVO])[A-Z]\d{6}[ABCD ]$/i,"en-IE":/^\d{7}[A-W][A-IW]{0,1}$/i,"en-US":/^\d{2}[- ]{0,1}\d{7}$/,"es-AR":/(20|23|24|27|30|33|34)[0-9]{8}[0-9]/,"es-ES":/^(\d{0,8}|[XYZKLM]\d{7})[A-HJ-NP-TV-Z]$/i,"et-EE":/^[1-6]\d{6}(00[1-9]|0[1-9][0-9]|[1-6][0-9]{2}|70[0-9]|710)\d$/,"fi-FI":/^\d{6}[-+A]\d{3}[0-9A-FHJ-NPR-Y]$/i,"fr-BE":/^\d{11}$/,"fr-FR":/^[0-3]\d{12}$|^[0-3]\d\s\d{2}(\s\d{3}){3}$/,"fr-LU":/^\d{13}$/,"hr-HR":/^\d{11}$/,"hu-HU":/^8\d{9}$/,"it-IT":/^[A-Z]{6}[L-NP-V0-9]{2}[A-EHLMPRST][L-NP-V0-9]{2}[A-ILMZ][L-NP-V0-9]{3}[A-Z]$/i,"lv-LV":/^\d{6}-{0,1}\d{5}$/,"mt-MT":/^\d{3,7}[APMGLHBZ]$|^([1-8])\1\d{7}$/i,"nl-NL":/^\d{9}$/,"pl-PL":/^\d{10,11}$/,"pt-BR":/(?:^\d{11}$)|(?:^\d{14}$)/,"pt-PT":/^\d{9}$/,"ro-RO":/^\d{13}$/,"sk-SK":/^\d{6}\/{0,1}\d{3,4}$/,"sl-SI":/^[1-9]\d{7}$/,"sv-SE":/^(\d{6}[-+]{0,1}\d{4}|(18|19|20)\d{6}[-+]{0,1}\d{4})$/,"uk-UA":/^\d{10}$/};kt["lb-LU"]=kt["fr-LU"],kt["lt-LT"]=kt["et-EE"],kt["nl-BE"]=kt["fr-BE"],kt["fr-CA"]=kt["en-CA"];var mt={"bg-BG":g,"cs-CZ":v,"de-AT":m,"de-DE":y,"dk-DK":S,"el-CY":E,"el-GR":T,"en-CA":p,"en-IE":A,"en-US":b,"es-AR":I,"es-ES":M,"et-EE":K,"fi-FI":z,"fr-BE":X,"fr-FR":Q,"fr-LU":N,"hr-HR":P,"hu-HU":k,"it-IT":U,"lv-LV":B,"mt-MT":G,"nl-NL":ie,"pl-PL":ne,"pt-BR":oe,"pt-PT":le,"ro-RO":Ie,"sk-SK":Fe,"sl-SI":Ye,"sv-SE":pt,"uk-UA":jt};mt["lb-LU"]=mt["fr-LU"],mt["lt-LT"]=mt["et-EE"],mt["nl-BE"]=mt["fr-BE"],mt["fr-CA"]=mt["en-CA"];var sn=/[-\\\/!@#$%\^&\*\(\)\+\=\[\]]+/g,Un={"de-AT":sn,"de-DE":/[\/\\]/g,"fr-BE":sn};Un["nl-BE"]=Un["fr-BE"];function Se(R){var L=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"en-US";(0,n.default)(R);var $=R.slice(0);if(L in kt)return L in Un&&($=$.replace(Un[L],"")),kt[L].test($)?L in mt?mt[L]($):!0:!1;throw new Error("Invalid locale '".concat(L,"'"))}r.exports=e.default,r.exports.default=e.default})(ch,ch.exports);var JC=ch.exports,$a={};Object.defineProperty($a,"__esModule",{value:!0});$a.default=rP;$a.locales=void 0;var eP=tP(Y);function tP(r){return r&&r.__esModule?r:{default:r}}var Oe={"am-AM":/^(\+?374|0)(33|4[134]|55|77|88|9[13-689])\d{6}$/,"ar-AE":/^((\+?971)|0)?5[024568]\d{7}$/,"ar-BH":/^(\+?973)?(3|6)\d{7}$/,"ar-DZ":/^(\+?213|0)(5|6|7)\d{8}$/,"ar-LB":/^(\+?961)?((3|81)\d{6}|7\d{7})$/,"ar-EG":/^((\+?20)|0)?1[0125]\d{8}$/,"ar-IQ":/^(\+?964|0)?7[0-9]\d{8}$/,"ar-JO":/^(\+?962|0)?7[789]\d{7}$/,"ar-KW":/^(\+?965)([569]\d{7}|41\d{6})$/,"ar-LY":/^((\+?218)|0)?(9[1-6]\d{7}|[1-8]\d{7,9})$/,"ar-MA":/^(?:(?:\+|00)212|0)[5-7]\d{8}$/,"ar-OM":/^((\+|00)968)?([79][1-9])\d{6}$/,"ar-PS":/^(\+?970|0)5[6|9](\d{7})$/,"ar-SA":/^(!?(\+?966)|0)?5\d{8}$/,"ar-SD":/^((\+?249)|0)?(9[012369]|1[012])\d{7}$/,"ar-SY":/^(!?(\+?963)|0)?9\d{8}$/,"ar-TN":/^(\+?216)?[2459]\d{7}$/,"az-AZ":/^(\+994|0)(10|5[015]|7[07]|99)\d{7}$/,"ar-QA":/^(\+?974|0)?([3567]\d{7})$/,"bs-BA":/^((((\+|00)3876)|06))((([0-3]|[5-6])\d{6})|(4\d{7}))$/,"be-BY":/^(\+?375)?(24|25|29|33|44)\d{7}$/,"bg-BG":/^(\+?359|0)?8[789]\d{7}$/,"bn-BD":/^(\+?880|0)1[13456789][0-9]{8}$/,"ca-AD":/^(\+376)?[346]\d{5}$/,"cs-CZ":/^(\+?420)? ?[1-9][0-9]{2} ?[0-9]{3} ?[0-9]{3}$/,"da-DK":/^(\+?45)?\s?\d{2}\s?\d{2}\s?\d{2}\s?\d{2}$/,"de-DE":/^((\+49|0)1)(5[0-25-9]\d|6([23]|0\d?)|7([0-57-9]|6\d))\d{7,9}$/,"de-AT":/^(\+43|0)\d{1,4}\d{3,12}$/,"de-CH":/^(\+41|0)([1-9])\d{1,9}$/,"de-LU":/^(\+352)?((6\d1)\d{6})$/,"dv-MV":/^(\+?960)?(7[2-9]|9[1-9])\d{5}$/,"el-GR":/^(\+?30|0)?6(8[5-9]|9(?![26])[0-9])\d{7}$/,"el-CY":/^(\+?357?)?(9(9|7|6|5|4)\d{6})$/,"en-AI":/^(\+?1|0)264(?:2(35|92)|4(?:6[1-2]|76|97)|5(?:3[6-9]|8[1-4])|7(?:2(4|9)|72))\d{4}$/,"en-AU":/^(\+?61|0)4\d{8}$/,"en-AG":/^(?:\+1|1)268(?:464|7(?:1[3-9]|[28]\d|3[0246]|64|7[0-689]))\d{4}$/,"en-BM":/^(\+?1)?441(((3|7)\d{6}$)|(5[0-3][0-9]\d{4}$)|(59\d{5}$))/,"en-BS":/^(\+?1[-\s]?|0)?\(?242\)?[-\s]?\d{3}[-\s]?\d{4}$/,"en-GB":/^(\+?44|0)7[1-9]\d{8}$/,"en-GG":/^(\+?44|0)1481\d{6}$/,"en-GH":/^(\+233|0)(20|50|24|54|27|57|26|56|23|53|28|55|59)\d{7}$/,"en-GY":/^(\+592|0)6\d{6}$/,"en-HK":/^(\+?852[-\s]?)?[456789]\d{3}[-\s]?\d{4}$/,"en-MO":/^(\+?853[-\s]?)?[6]\d{3}[-\s]?\d{4}$/,"en-IE":/^(\+?353|0)8[356789]\d{7}$/,"en-IN":/^(\+?91|0)?[6789]\d{9}$/,"en-JM":/^(\+?876)?\d{7}$/,"en-KE":/^(\+?254|0)(7|1)\d{8}$/,"fr-CF":/^(\+?236| ?)(70|75|77|72|21|22)\d{6}$/,"en-SS":/^(\+?211|0)(9[1257])\d{7}$/,"en-KI":/^((\+686|686)?)?( )?((6|7)(2|3|8)[0-9]{6})$/,"en-KN":/^(?:\+1|1)869(?:46\d|48[89]|55[6-8]|66\d|76[02-7])\d{4}$/,"en-LS":/^(\+?266)(22|28|57|58|59|27|52)\d{6}$/,"en-MT":/^(\+?356|0)?(99|79|77|21|27|22|25)[0-9]{6}$/,"en-MU":/^(\+?230|0)?\d{8}$/,"en-MW":/^(\+?265|0)(((77|88|31|99|98|21)\d{7})|(((111)|1)\d{6})|(32000\d{4}))$/,"en-NA":/^(\+?264|0)(6|8)\d{7}$/,"en-NG":/^(\+?234|0)?[789]\d{9}$/,"en-NZ":/^(\+?64|0)[28]\d{7,9}$/,"en-PG":/^(\+?675|0)?(7\d|8[18])\d{6}$/,"en-PK":/^((00|\+)?92|0)3[0-6]\d{8}$/,"en-PH":/^(09|\+639)\d{9}$/,"en-RW":/^(\+?250|0)?[7]\d{8}$/,"en-SG":/^(\+65)?[3689]\d{7}$/,"en-SL":/^(\+?232|0)\d{8}$/,"en-TZ":/^(\+?255|0)?[67]\d{8}$/,"en-UG":/^(\+?256|0)?[7]\d{8}$/,"en-US":/^((\+1|1)?( |-)?)?(\([2-9][0-9]{2}\)|[2-9][0-9]{2})( |-)?([2-9][0-9]{2}( |-)?[0-9]{4})$/,"en-ZA":/^(\+?27|0)\d{9}$/,"en-ZM":/^(\+?26)?0[79][567]\d{7}$/,"en-ZW":/^(\+263)[0-9]{9}$/,"en-BW":/^(\+?267)?(7[1-8]{1})\d{6}$/,"es-AR":/^\+?549(11|[2368]\d)\d{8}$/,"es-BO":/^(\+?591)?(6|7)\d{7}$/,"es-CO":/^(\+?57)?3(0(0|1|2|4|5)|1\d|2[0-4]|5(0|1))\d{7}$/,"es-CL":/^(\+?56|0)[2-9]\d{1}\d{7}$/,"es-CR":/^(\+506)?[2-8]\d{7}$/,"es-CU":/^(\+53|0053)?5\d{7}$/,"es-DO":/^(\+?1)?8[024]9\d{7}$/,"es-HN":/^(\+?504)?[9|8|3|2]\d{7}$/,"es-EC":/^(\+?593|0)([2-7]|9[2-9])\d{7}$/,"es-ES":/^(\+?34)?[6|7]\d{8}$/,"es-GT":/^(\+?502)?[2|6|7]\d{7}$/,"es-PE":/^(\+?51)?9\d{8}$/,"es-MX":/^(\+?52)?(1|01)?\d{10,11}$/,"es-NI":/^(\+?505)\d{7,8}$/,"es-PA":/^(\+?507)\d{7,8}$/,"es-PY":/^(\+?595|0)9[9876]\d{7}$/,"es-SV":/^(\+?503)?[67]\d{7}$/,"es-UY":/^(\+598|0)9[1-9][\d]{6}$/,"es-VE":/^(\+?58)?(2|4)\d{9}$/,"et-EE":/^(\+?372)?\s?(5|8[1-4])\s?([0-9]\s?){6,7}$/,"fa-IR":/^(\+?98[\-\s]?|0)9[0-39]\d[\-\s]?\d{3}[\-\s]?\d{4}$/,"fi-FI":/^(\+?358|0)\s?(4[0-6]|50)\s?(\d\s?){4,8}$/,"fj-FJ":/^(\+?679)?\s?\d{3}\s?\d{4}$/,"fo-FO":/^(\+?298)?\s?\d{2}\s?\d{2}\s?\d{2}$/,"fr-BF":/^(\+226|0)[67]\d{7}$/,"fr-BJ":/^(\+229)\d{8}$/,"fr-CD":/^(\+?243|0)?(8|9)\d{8}$/,"fr-CM":/^(\+?237)6[0-9]{8}$/,"fr-FR":/^(\+?33|0)[67]\d{8}$/,"fr-GF":/^(\+?594|0|00594)[67]\d{8}$/,"fr-GP":/^(\+?590|0|00590)[67]\d{8}$/,"fr-MQ":/^(\+?596|0|00596)[67]\d{8}$/,"fr-PF":/^(\+?689)?8[789]\d{6}$/,"fr-RE":/^(\+?262|0|00262)[67]\d{8}$/,"fr-WF":/^(\+681)?\d{6}$/,"he-IL":/^(\+972|0)([23489]|5[012345689]|77)[1-9]\d{6}$/,"hu-HU":/^(\+?36|06)(20|30|31|50|70)\d{7}$/,"id-ID":/^(\+?62|0)8(1[123456789]|2[1238]|3[1238]|5[12356789]|7[78]|9[56789]|8[123456789])([\s?|\d]{5,11})$/,"ir-IR":/^(\+98|0)?9\d{9}$/,"it-IT":/^(\+?39)?\s?3\d{2} ?\d{6,7}$/,"it-SM":/^((\+378)|(0549)|(\+390549)|(\+3780549))?6\d{5,9}$/,"ja-JP":/^(\+81[ \-]?(\(0\))?|0)[6789]0[ \-]?\d{4}[ \-]?\d{4}$/,"ka-GE":/^(\+?995)?(79\d{7}|5\d{8})$/,"kk-KZ":/^(\+?7|8)?7\d{9}$/,"kl-GL":/^(\+?299)?\s?\d{2}\s?\d{2}\s?\d{2}$/,"ko-KR":/^((\+?82)[ \-]?)?0?1([0|1|6|7|8|9]{1})[ \-]?\d{3,4}[ \-]?\d{4}$/,"ky-KG":/^(\+996\s?)?(22[0-9]|50[0-9]|55[0-9]|70[0-9]|75[0-9]|77[0-9]|880|990|995|996|997|998)\s?\d{3}\s?\d{3}$/,"lt-LT":/^(\+370|8)\d{8}$/,"lv-LV":/^(\+?371)2\d{7}$/,"mg-MG":/^((\+?261|0)(2|3)\d)?\d{7}$/,"mn-MN":/^(\+|00|011)?976(77|81|88|91|94|95|96|99)\d{6}$/,"my-MM":/^(\+?959|09|9)(2[5-7]|3[1-2]|4[0-5]|6[6-9]|7[5-9]|9[6-9])[0-9]{7}$/,"ms-MY":/^(\+?60|0)1(([0145](-|\s)?\d{7,8})|([236-9](-|\s)?\d{7}))$/,"mz-MZ":/^(\+?258)?8[234567]\d{7}$/,"nb-NO":/^(\+?47)?[49]\d{7}$/,"ne-NP":/^(\+?977)?9[78]\d{8}$/,"nl-BE":/^(\+?32|0)4\d{8}$/,"nl-NL":/^(((\+|00)?31\(0\))|((\+|00)?31)|0)6{1}\d{8}$/,"nl-AW":/^(\+)?297(56|59|64|73|74|99)\d{5}$/,"nn-NO":/^(\+?47)?[49]\d{7}$/,"pl-PL":/^(\+?48)? ?([5-8]\d|45) ?\d{3} ?\d{2} ?\d{2}$/,"pt-BR":/^((\+?55\ ?[1-9]{2}\ ?)|(\+?55\ ?\([1-9]{2}\)\ ?)|(0[1-9]{2}\ ?)|(\([1-9]{2}\)\ ?)|([1-9]{2}\ ?))((\d{4}\-?\d{4})|(9[1-9]{1}\d{3}\-?\d{4}))$/,"pt-PT":/^(\+?351)?9[1236]\d{7}$/,"pt-AO":/^(\+?244)?9\d{8}$/,"ro-MD":/^(\+?373|0)((6(0|1|2|6|7|8|9))|(7(6|7|8|9)))\d{6}$/,"ro-RO":/^(\+?40|0)\s?7\d{2}(\/|\s|\.|-)?\d{3}(\s|\.|-)?\d{3}$/,"ru-RU":/^(\+?7|8)?9\d{9}$/,"si-LK":/^(?:0|94|\+94)?(7(0|1|2|4|5|6|7|8)( |-)?)\d{7}$/,"sl-SI":/^(\+386\s?|0)(\d{1}\s?\d{3}\s?\d{2}\s?\d{2}|\d{2}\s?\d{3}\s?\d{3})$/,"sk-SK":/^(\+?421)? ?[1-9][0-9]{2} ?[0-9]{3} ?[0-9]{3}$/,"so-SO":/^(\+?252|0)((6[0-9])\d{7}|(7[1-9])\d{7})$/,"sq-AL":/^(\+355|0)6[2-9]\d{7}$/,"sr-RS":/^(\+3816|06)[- \d]{5,9}$/,"sv-SE":/^(\+?46|0)[\s\-]?7[\s\-]?[02369]([\s\-]?\d){7}$/,"tg-TJ":/^(\+?992)?[5][5]\d{7}$/,"th-TH":/^(\+66|66|0)\d{9}$/,"tr-TR":/^(\+?90|0)?5\d{9}$/,"tk-TM":/^(\+993|993|8)\d{8}$/,"uk-UA":/^(\+?38)?0(50|6[36-8]|7[357]|9[1-9])\d{7}$/,"uz-UZ":/^(\+?998)?(6[125-79]|7[1-69]|88|9\d)\d{7}$/,"vi-VN":/^((\+?84)|0)((3([2-9]))|(5([25689]))|(7([0|6-9]))|(8([1-9]))|(9([0-9])))([0-9]{7})$/,"zh-CN":/^((\+|00)86)?(1[3-9]|9[28])\d{9}$/,"zh-TW":/^(\+?886\-?|0)?9\d{8}$/,"dz-BT":/^(\+?975|0)?(17|16|77|02)\d{6}$/,"ar-YE":/^(((\+|00)9677|0?7)[0137]\d{7}|((\+|00)967|0)[1-7]\d{6})$/,"ar-EH":/^(\+?212|0)[\s\-]?(5288|5289)[\s\-]?\d{5}$/,"fa-AF":/^(\+93|0)?(2{1}[0-8]{1}|[3-5]{1}[0-4]{1})(\d{7})$/,"mk-MK":/^(\+?389|0)?((?:2[2-9]\d{6}|(?:3[1-4]|4[2-8])\d{6}|500\d{5}|5[2-9]\d{6}|7[0-9][2-9]\d{5}|8[1-9]\d{6}|800\d{5}|8009\d{4}))$/};Oe["en-CA"]=Oe["en-US"];Oe["fr-CA"]=Oe["en-CA"];Oe["fr-BE"]=Oe["nl-BE"];Oe["zh-HK"]=Oe["en-HK"];Oe["zh-MO"]=Oe["en-MO"];Oe["ga-IE"]=Oe["en-IE"];Oe["fr-CH"]=Oe["de-CH"];Oe["it-CH"]=Oe["fr-CH"];function rP(r,e,t){if((0,eP.default)(r),t&&t.strictMode&&!r.startsWith("+"))return!1;if(Array.isArray(e))return e.some(function(i){if(Oe.hasOwnProperty(i)){var a=Oe[i];if(a.test(r))return!0}return!1});if(e in Oe)return Oe[e].test(r);if(!e||e==="any"){for(var n in Oe)if(Oe.hasOwnProperty(n)){var s=Oe[n];if(s.test(r))return!0}return!1}throw new Error("Invalid locale '".concat(e,"'"))}$a.locales=Object.keys(Oe);var dh={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;var t=n(Y);function n(a){return a&&a.__esModule?a:{default:a}}var s=/^(0x)[0-9a-f]{40}$/i;function i(a){return(0,t.default)(a),s.test(a)}r.exports=e.default,r.exports.default=e.default})(dh,dh.exports);var nP=dh.exports,fh={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var t=s(Lt),n=s(Y);function s(l){return l&&l.__esModule?l:{default:l}}function i(l){var u="\\d{".concat(l.digits_after_decimal[0],"}");l.digits_after_decimal.forEach(function(y,S){S!==0&&(u="".concat(u,"|\\d{").concat(y,"}"))});var c="(".concat(l.symbol.replace(/\W/,function(y){return"\\".concat(y)}),")").concat(l.require_symbol?"":"?"),d="-?",f="[1-9]\\d*",h="[1-9]\\d{0,2}(\\".concat(l.thousands_separator,"\\d{3})*"),g=["0",f,h],p="(".concat(g.join("|"),")?"),v="(\\".concat(l.decimal_separator,"(").concat(u,"))").concat(l.require_decimal?"":"?"),m=p+(l.allow_decimal||l.require_decimal?v:"");return l.allow_negatives&&!l.parens_for_negatives&&(l.negative_sign_after_digits?m+=d:l.negative_sign_before_digits&&(m=d+m)),l.allow_negative_sign_placeholder?m="( (?!\\-))?".concat(m):l.allow_space_after_symbol?m=" ?".concat(m):l.allow_space_after_digits&&(m+="( (?!$))?"),l.symbol_after_digits?m+=c:m=c+m,l.allow_negatives&&(l.parens_for_negatives?m="(\\(".concat(m,"\\)|").concat(m,")"):l.negative_sign_before_digits||l.negative_sign_after_digits||(m=d+m)),new RegExp("^(?!-? )(?=.*\\d)".concat(m,"$"))}var a={symbol:"$",require_symbol:!1,allow_space_after_symbol:!1,symbol_after_digits:!1,allow_negatives:!0,parens_for_negatives:!1,negative_sign_before_digits:!1,negative_sign_after_digits:!1,allow_negative_sign_placeholder:!1,thousands_separator:",",decimal_separator:".",allow_decimal:!0,require_decimal:!1,digits_after_decimal:[2],allow_space_after_digits:!1};function o(l,u){return(0,n.default)(l),u=(0,t.default)(u,a),i(u).test(l)}r.exports=e.default,r.exports.default=e.default})(fh,fh.exports);var sP=fh.exports,hh={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=a;var t=n(Y);function n(o){return o&&o.__esModule?o:{default:o}}var s=/^(bc1|tb1|bc1p|tb1p)[ac-hj-np-z02-9]{39,58}$/,i=/^(1|2|3|m)[A-HJ-NP-Za-km-z1-9]{25,39}$/;function a(o){return(0,t.default)(o),s.test(o)||i.test(o)}r.exports=e.default,r.exports.default=e.default})(hh,hh.exports);var iP=hh.exports,Ua={};Object.defineProperty(Ua,"__esModule",{value:!0});Ua.isFreightContainerID=void 0;Ua.isISO6346=eT;var aP=oP(Y);function oP(r){return r&&r.__esModule?r:{default:r}}var lP=/^[A-Z]{3}(U[0-9]{7})|([J,Z][0-9]{6,7})$/,uP=/^[0-9]$/;function eT(r){if((0,aP.default)(r),r=r.toUpperCase(),!lP.test(r))return!1;if(r.length===11){for(var e=0,t=0;t<r.length-1;t++)if(uP.test(r[t]))e+=r[t]*Math.pow(2,t);else{var n=void 0,s=r.charCodeAt(t)-55;s<11?n=s:s>=11&&s<=20?n=12+s%11:s>=21&&s<=30?n=23+s%21:n=34+s%31,e+=n*Math.pow(2,t)}var i=e%11;return i===10&&(i=0),Number(r[r.length-1])===i}return!0}Ua.isFreightContainerID=eT;var gh={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;var t=n(Y);function n(a){return a&&a.__esModule?a:{default:a}}var s=new Set(["aa","ab","ae","af","ak","am","an","ar","as","av","ay","az","az","ba","be","bg","bh","bi","bm","bn","bo","br","bs","ca","ce","ch","co","cr","cs","cu","cv","cy","da","de","dv","dz","ee","el","en","eo","es","et","eu","fa","ff","fi","fj","fo","fr","fy","ga","gd","gl","gn","gu","gv","ha","he","hi","ho","hr","ht","hu","hy","hz","ia","id","ie","ig","ii","ik","io","is","it","iu","ja","jv","ka","kg","ki","kj","kk","kl","km","kn","ko","kr","ks","ku","kv","kw","ky","la","lb","lg","li","ln","lo","lt","lu","lv","mg","mh","mi","mk","ml","mn","mr","ms","mt","my","na","nb","nd","ne","ng","nl","nn","no","nr","nv","ny","oc","oj","om","or","os","pa","pi","pl","ps","pt","qu","rm","rn","ro","ru","rw","sa","sc","sd","se","sg","si","sk","sl","sm","sn","so","sq","sr","ss","st","su","sv","sw","ta","te","tg","th","ti","tk","tl","tn","to","tr","ts","tt","tw","ty","ug","uk","ur","uz","ve","vi","vo","wa","wo","xh","yi","yo","za","zh","zu"]);function i(a){return(0,t.default)(a),s.has(a)}r.exports=e.default,r.exports.default=e.default})(gh,gh.exports);var cP=gh.exports,ph={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var t=n(Y);function n(l){return l&&l.__esModule?l:{default:l}}var s=/^([\+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-3])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([\.,]\d+(?!:))?)?(\17[0-5]\d([\.,]\d+)?)?([zZ]|([\+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/,i=/^([\+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-3])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([\.,]\d+(?!:))?)?(\17[0-5]\d([\.,]\d+)?)?([zZ]|([\+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/,a=function(u){var c=u.match(/^(\d{4})-?(\d{3})([ T]{1}\.*|$)/);if(c){var d=Number(c[1]),f=Number(c[2]);return d%4===0&&d%100!==0||d%400===0?f<=366:f<=365}var h=u.match(/(\d{4})-?(\d{0,2})-?(\d*)/).map(Number),g=h[1],p=h[2],v=h[3],m=p&&"0".concat(p).slice(-2),y=v&&"0".concat(v).slice(-2),S=new Date("".concat(g,"-").concat(m||"01","-").concat(y||"01"));return p&&v?S.getUTCFullYear()===g&&S.getUTCMonth()+1===p&&S.getUTCDate()===v:!0};function o(l){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};(0,t.default)(l);var c=u.strictSeparator?i.test(l):s.test(l);return c&&u.strict?a(l):c}r.exports=e.default,r.exports.default=e.default})(ph,ph.exports);var dP=ph.exports,mh={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=m;var t=n(Y);function n(y){return y&&y.__esModule?y:{default:y}}var s=/[0-9]{4}/,i=/(0[1-9]|1[0-2])/,a=/([12]\d|0[1-9]|3[01])/,o=/([01][0-9]|2[0-3])/,l=/[0-5][0-9]/,u=/([0-5][0-9]|60)/,c=/(\.[0-9]+)?/,d=new RegExp("[-+]".concat(o.source,":").concat(l.source)),f=new RegExp("([zZ]|".concat(d.source,")")),h=new RegExp("".concat(o.source,":").concat(l.source,":").concat(u.source).concat(c.source)),g=new RegExp("".concat(s.source,"-").concat(i.source,"-").concat(a.source)),p=new RegExp("".concat(h.source).concat(f.source)),v=new RegExp("^".concat(g.source,"[ tT]").concat(p.source,"$"));function m(y){return(0,t.default)(y),v.test(y)}r.exports=e.default,r.exports.default=e.default})(mh,mh.exports);var fP=mh.exports,Ba={};Object.defineProperty(Ba,"__esModule",{value:!0});Ba.ScriptCodes=void 0;Ba.default=pP;var hP=gP(Y);function gP(r){return r&&r.__esModule?r:{default:r}}var tT=new Set(["Adlm","Afak","Aghb","Ahom","Arab","Aran","Armi","Armn","Avst","Bali","Bamu","Bass","Batk","Beng","Bhks","Blis","Bopo","Brah","Brai","Bugi","Buhd","Cakm","Cans","Cari","Cham","Cher","Chis","Chrs","Cirt","Copt","Cpmn","Cprt","Cyrl","Cyrs","Deva","Diak","Dogr","Dsrt","Dupl","Egyd","Egyh","Egyp","Elba","Elym","Ethi","Gara","Geok","Geor","Glag","Gong","Gonm","Goth","Gran","Grek","Gujr","Gukh","Guru","Hanb","Hang","Hani","Hano","Hans","Hant","Hatr","Hebr","Hira","Hluw","Hmng","Hmnp","Hrkt","Hung","Inds","Ital","Jamo","Java","Jpan","Jurc","Kali","Kana","Kawi","Khar","Khmr","Khoj","Kitl","Kits","Knda","Kore","Kpel","Krai","Kthi","Lana","Laoo","Latf","Latg","Latn","Leke","Lepc","Limb","Lina","Linb","Lisu","Loma","Lyci","Lydi","Mahj","Maka","Mand","Mani","Marc","Maya","Medf","Mend","Merc","Mero","Mlym","Modi","Mong","Moon","Mroo","Mtei","Mult","Mymr","Nagm","Nand","Narb","Nbat","Newa","Nkdb","Nkgb","Nkoo","Nshu","Ogam","Olck","Onao","Orkh","Orya","Osge","Osma","Ougr","Palm","Pauc","Pcun","Pelm","Perm","Phag","Phli","Phlp","Phlv","Phnx","Plrd","Piqd","Prti","Psin","Qaaa","Qaab","Qaac","Qaad","Qaae","Qaaf","Qaag","Qaah","Qaai","Qaaj","Qaak","Qaal","Qaam","Qaan","Qaao","Qaap","Qaaq","Qaar","Qaas","Qaat","Qaau","Qaav","Qaaw","Qaax","Qaay","Qaaz","Qaba","Qabb","Qabc","Qabd","Qabe","Qabf","Qabg","Qabh","Qabi","Qabj","Qabk","Qabl","Qabm","Qabn","Qabo","Qabp","Qabq","Qabr","Qabs","Qabt","Qabu","Qabv","Qabw","Qabx","Ranj","Rjng","Rohg","Roro","Runr","Samr","Sara","Sarb","Saur","Sgnw","Shaw","Shrd","Shui","Sidd","Sidt","Sind","Sinh","Sogd","Sogo","Sora","Soyo","Sund","Sunu","Sylo","Syrc","Syre","Syrj","Syrn","Tagb","Takr","Tale","Talu","Taml","Tang","Tavt","Tayo","Telu","Teng","Tfng","Tglg","Thaa","Thai","Tibt","Tirh","Tnsa","Todr","Tols","Toto","Tutg","Ugar","Vaii","Visp","Vith","Wara","Wcho","Wole","Xpeo","Xsux","Yezi","Yiii","Zanb","Zinh","Zmth","Zsye","Zsym","Zxxx","Zyyy","Zzzz"]);function pP(r){return(0,hP.default)(r),tT.has(r)}Ba.ScriptCodes=tT;var vh={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;var t=n(Y);function n(a){return a&&a.__esModule?a:{default:a}}var s=new Set(["AFG","ALA","ALB","DZA","ASM","AND","AGO","AIA","ATA","ATG","ARG","ARM","ABW","AUS","AUT","AZE","BHS","BHR","BGD","BRB","BLR","BEL","BLZ","BEN","BMU","BTN","BOL","BES","BIH","BWA","BVT","BRA","IOT","BRN","BGR","BFA","BDI","KHM","CMR","CAN","CPV","CYM","CAF","TCD","CHL","CHN","CXR","CCK","COL","COM","COG","COD","COK","CRI","CIV","HRV","CUB","CUW","CYP","CZE","DNK","DJI","DMA","DOM","ECU","EGY","SLV","GNQ","ERI","EST","ETH","FLK","FRO","FJI","FIN","FRA","GUF","PYF","ATF","GAB","GMB","GEO","DEU","GHA","GIB","GRC","GRL","GRD","GLP","GUM","GTM","GGY","GIN","GNB","GUY","HTI","HMD","VAT","HND","HKG","HUN","ISL","IND","IDN","IRN","IRQ","IRL","IMN","ISR","ITA","JAM","JPN","JEY","JOR","KAZ","KEN","KIR","PRK","KOR","KWT","KGZ","LAO","LVA","LBN","LSO","LBR","LBY","LIE","LTU","LUX","MAC","MKD","MDG","MWI","MYS","MDV","MLI","MLT","MHL","MTQ","MRT","MUS","MYT","MEX","FSM","MDA","MCO","MNG","MNE","MSR","MAR","MOZ","MMR","NAM","NRU","NPL","NLD","NCL","NZL","NIC","NER","NGA","NIU","NFK","MNP","NOR","OMN","PAK","PLW","PSE","PAN","PNG","PRY","PER","PHL","PCN","POL","PRT","PRI","QAT","REU","ROU","RUS","RWA","BLM","SHN","KNA","LCA","MAF","SPM","VCT","WSM","SMR","STP","SAU","SEN","SRB","SYC","SLE","SGP","SXM","SVK","SVN","SLB","SOM","ZAF","SGS","SSD","ESP","LKA","SDN","SUR","SJM","SWZ","SWE","CHE","SYR","TWN","TJK","TZA","THA","TLS","TGO","TKL","TON","TTO","TUN","TUR","TKM","TCA","TUV","UGA","UKR","ARE","GBR","USA","UMI","URY","UZB","VUT","VEN","VNM","VGB","VIR","WLF","ESH","YEM","ZMB","ZWE"]);function i(a){return(0,t.default)(a),s.has(a.toUpperCase())}r.exports=e.default,r.exports.default=e.default})(vh,vh.exports);var mP=vh.exports,yh={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;var t=n(Y);function n(a){return a&&a.__esModule?a:{default:a}}var s=new Set(["004","008","010","012","016","020","024","028","031","032","036","040","044","048","050","051","052","056","060","064","068","070","072","074","076","084","086","090","092","096","100","104","108","112","116","120","124","132","136","140","144","148","152","156","158","162","166","170","174","175","178","180","184","188","191","192","196","203","204","208","212","214","218","222","226","231","232","233","234","238","239","242","246","248","250","254","258","260","262","266","268","270","275","276","288","292","296","300","304","308","312","316","320","324","328","332","334","336","340","344","348","352","356","360","364","368","372","376","380","384","388","392","398","400","404","408","410","414","417","418","422","426","428","430","434","438","440","442","446","450","454","458","462","466","470","474","478","480","484","492","496","498","499","500","504","508","512","516","520","524","528","531","533","534","535","540","548","554","558","562","566","570","574","578","580","581","583","584","585","586","591","598","600","604","608","612","616","620","624","626","630","634","638","642","643","646","652","654","659","660","662","663","666","670","674","678","682","686","688","690","694","702","703","704","705","706","710","716","724","728","729","732","740","744","748","752","756","760","762","764","768","772","776","780","784","788","792","795","796","798","800","804","807","818","826","831","832","833","834","840","850","854","858","860","862","876","882","887","894"]);function i(a){return(0,t.default)(a),s.has(a)}r.exports=e.default,r.exports.default=e.default})(yh,yh.exports);var vP=yh.exports,ja={};Object.defineProperty(ja,"__esModule",{value:!0});ja.CurrencyCodes=void 0;ja.default=EP;var yP=SP(Y);function SP(r){return r&&r.__esModule?r:{default:r}}var rT=new Set(["AED","AFN","ALL","AMD","ANG","AOA","ARS","AUD","AWG","AZN","BAM","BBD","BDT","BGN","BHD","BIF","BMD","BND","BOB","BOV","BRL","BSD","BTN","BWP","BYN","BZD","CAD","CDF","CHE","CHF","CHW","CLF","CLP","CNY","COP","COU","CRC","CUP","CVE","CZK","DJF","DKK","DOP","DZD","EGP","ERN","ETB","EUR","FJD","FKP","GBP","GEL","GHS","GIP","GMD","GNF","GTQ","GYD","HKD","HNL","HTG","HUF","IDR","ILS","INR","IQD","IRR","ISK","JMD","JOD","JPY","KES","KGS","KHR","KMF","KPW","KRW","KWD","KYD","KZT","LAK","LBP","LKR","LRD","LSL","LYD","MAD","MDL","MGA","MKD","MMK","MNT","MOP","MRU","MUR","MVR","MWK","MXN","MXV","MYR","MZN","NAD","NGN","NIO","NOK","NPR","NZD","OMR","PAB","PEN","PGK","PHP","PKR","PLN","PYG","QAR","RON","RSD","RUB","RWF","SAR","SBD","SCR","SDG","SEK","SGD","SHP","SLE","SLL","SOS","SRD","SSP","STN","SVC","SYP","SZL","THB","TJS","TMT","TND","TOP","TRY","TTD","TWD","TZS","UAH","UGX","USD","USN","UYI","UYU","UYW","UZS","VED","VES","VND","VUV","WST","XAF","XAG","XAU","XBA","XBB","XBC","XBD","XCD","XDR","XOF","XPD","XPF","XPT","XSU","XTS","XUA","XXX","YER","ZAR","ZMW","ZWL"]);function EP(r){return(0,yP.default)(r),rT.has(r.toUpperCase())}ja.CurrencyCodes=rT;var Sh={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=l;var t=s(Y),n=s(Lt);function s(u){return u&&u.__esModule?u:{default:u}}var i=/^[A-Z2-7]+=*$/,a=/^[A-HJKMNP-TV-Z0-9]+$/,o={crockford:!1};function l(u,c){if((0,t.default)(u),c=(0,n.default)(c,o),c.crockford)return a.test(u);var d=u.length;return!!(d%8===0&&i.test(u))}r.exports=e.default,r.exports.default=e.default})(Sh,Sh.exports);var _P=Sh.exports,Eh={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;var t=n(Y);function n(a){return a&&a.__esModule?a:{default:a}}var s=/^[A-HJ-NP-Za-km-z1-9]*$/;function i(a){return(0,t.default)(a),!!s.test(a)}r.exports=e.default,r.exports.default=e.default})(Eh,Eh.exports);var TP=Eh.exports,_h={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var t=n(Y);function n(l){return l&&l.__esModule?l:{default:l}}var s=/^[a-z]+\/[a-z0-9\-\+\._]+$/i,i=/^[a-z\-]+=[a-z0-9\-]+$/i,a=/^[a-z0-9!\$&'\(\)\*\+,;=\-\._~:@\/\?%\s]*$/i;function o(l){(0,t.default)(l);var u=l.split(",");if(u.length<2)return!1;var c=u.shift().trim().split(";"),d=c.shift();if(d.slice(0,5)!=="data:")return!1;var f=d.slice(5);if(f!==""&&!s.test(f))return!1;for(var h=0;h<c.length;h++)if(!(h===c.length-1&&c[h].toLowerCase()==="base64")&&!i.test(c[h]))return!1;for(var g=0;g<u.length;g++)if(!a.test(u[g]))return!1;return!0}r.exports=e.default,r.exports.default=e.default})(_h,_h.exports);var xP=_h.exports,Th={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;var t=n(Y);function n(a){return a&&a.__esModule?a:{default:a}}var s=/(?:^magnet:\?|[^?&]&)xt(?:\.1)?=urn:(?:(?:aich|bitprint|btih|ed2k|ed2khash|kzhash|md5|sha1|tree:tiger):[a-z0-9]{32}(?:[a-z0-9]{8})?|btmh:1220[a-z0-9]{64})(?:$|&)/i;function i(a){return(0,t.default)(a),a.indexOf("magnet:?")!==0?!1:s.test(a)}r.exports=e.default,r.exports.default=e.default})(Th,Th.exports);var AP=Th.exports,xh={exports:{}},Ah={exports:{}},wh={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=s;var t=n(Y);function n(i){return i&&i.__esModule?i:{default:i}}function s(i,a){if((0,t.default)(i),a){var o=new RegExp("[".concat(a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"]+$"),"g");return i.replace(o,"")}for(var l=i.length-1;/\s/.test(i.charAt(l));)l-=1;return i.slice(0,l+1)}r.exports=e.default,r.exports.default=e.default})(wh,wh.exports);var nT=wh.exports,Ih={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=s;var t=n(Y);function n(i){return i&&i.__esModule?i:{default:i}}function s(i,a){(0,t.default)(i);var o=a?new RegExp("^[".concat(a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"]+"),"g"):/^\s+/g;return i.replace(o,"")}r.exports=e.default,r.exports.default=e.default})(Ih,Ih.exports);var sT=Ih.exports;(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;var t=s(nT),n=s(sT);function s(a){return a&&a.__esModule?a:{default:a}}function i(a,o){return(0,t.default)((0,n.default)(a,o),o)}r.exports=e.default,r.exports.default=e.default})(Ah,Ah.exports);var iT=Ah.exports;(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=g;var t=i(iT),n=i(W_),s=i(Y);function i(p){return p&&p.__esModule?p:{default:p}}function a(p,v){return u(p)||l(p,v)||d(p,v)||o()}function o(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function l(p,v){var m=p==null?null:typeof Symbol<"u"&&p[Symbol.iterator]||p["@@iterator"];if(m!=null){var y,S,E,T,A=[],x=!0,w=!1;try{if(E=(m=m.call(p)).next,v!==0)for(;!(x=(y=E.call(m)).done)&&(A.push(y.value),A.length!==v);x=!0);}catch(b){w=!0,S=b}finally{try{if(!x&&m.return!=null&&(T=m.return(),Object(T)!==T))return}finally{if(w)throw S}}return A}}function u(p){if(Array.isArray(p))return p}function c(p,v){var m=typeof Symbol<"u"&&p[Symbol.iterator]||p["@@iterator"];if(!m){if(Array.isArray(p)||(m=d(p))||v){m&&(p=m);var y=0,S=function(){};return{s:S,n:function(){return y>=p.length?{done:!0}:{done:!1,value:p[y++]}},e:function(w){throw w},f:S}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var E,T=!0,A=!1;return{s:function(){m=m.call(p)},n:function(){var w=m.next();return T=w.done,w},e:function(w){A=!0,E=w},f:function(){try{T||m.return==null||m.return()}finally{if(A)throw E}}}}function d(p,v){if(p){if(typeof p=="string")return f(p,v);var m={}.toString.call(p).slice(8,-1);return m==="Object"&&p.constructor&&(m=p.constructor.name),m==="Map"||m==="Set"?Array.from(p):m==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(m)?f(p,v):void 0}}function f(p,v){(v==null||v>p.length)&&(v=p.length);for(var m=0,y=Array(v);m<v;m++)y[m]=p[m];return y}function h(p){var v=new Set(["subject","body","cc","bcc"]),m={cc:"",bcc:""},y=!1,S=p.split("&");if(S.length>4)return!1;var E=c(S),T;try{for(E.s();!(T=E.n()).done;){var A=T.value,x=A.split("="),w=a(x,2),b=w[0],I=w[1];if(b&&!v.has(b)){y=!0;break}I&&(b==="cc"||b==="bcc")&&(m[b]=I),b&&v.delete(b)}}catch(M){E.e(M)}finally{E.f()}return y?!1:m}function g(p,v){if((0,s.default)(p),p.indexOf("mailto:")!==0)return!1;var m=p.replace("mailto:","").split("?"),y=a(m,2),S=y[0],E=y[1],T=E===void 0?"":E;if(!S&&!T)return!0;var A=h(T);return A?"".concat(S,",").concat(A.cc,",").concat(A.bcc).split(",").every(function(x){return x=(0,t.default)(x," "),x?(0,n.default)(x,v):!0}):!1}r.exports=e.default,r.exports.default=e.default})(xh,xh.exports);var wP=xh.exports,bh={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var t=n(Y);function n(l){return l&&l.__esModule?l:{default:l}}var s=/^(application|audio|font|image|message|model|multipart|text|video)\/[a-zA-Z0-9\.\-\+_]{1,100}$/i,i=/^text\/[a-zA-Z0-9\.\-\+]{1,100};\s?charset=("[a-zA-Z0-9\.\-\+\s]{0,70}"|[a-zA-Z0-9\.\-\+]{0,70})(\s?\([a-zA-Z0-9\.\-\+\s]{1,20}\))?$/i,a=/^multipart\/[a-zA-Z0-9\.\-\+]{1,100}(;\s?(boundary|charset)=("[a-zA-Z0-9\.\-\+\s]{0,70}"|[a-zA-Z0-9\.\-\+]{0,70})(\s?\([a-zA-Z0-9\.\-\+\s]{1,20}\))?){0,2}$/i;function o(l){return(0,t.default)(l),s.test(l)||i.test(l)||a.test(l)}r.exports=e.default,r.exports.default=e.default})(bh,bh.exports);var IP=bh.exports,Rh={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=d;var t=i(Y),n=i(Lt),s=i(z_);function i(f){return f&&f.__esModule?f:{default:f}}var a=/^\(?[+-]?(90(\.0+)?|[1-8]?\d(\.\d+)?)$/,o=/^\s?[+-]?(180(\.0+)?|1[0-7]\d(\.\d+)?|\d{1,2}(\.\d+)?)\)?$/,l=/^(([1-8]?\d)\D+([1-5]?\d|60)\D+([1-5]?\d|60)(\.\d+)?|90\D+0\D+0)\D+[NSns]?$/i,u=/^\s*([1-7]?\d{1,2}\D+([1-5]?\d|60)\D+([1-5]?\d|60)(\.\d+)?|180\D+0\D+0)\D+[EWew]?$/i,c={checkDMS:!1};function d(f,h){if((0,t.default)(f),h=(0,n.default)(h,c),!(0,s.default)(f,","))return!1;var g=f.split(",");return g[0].startsWith("(")&&!g[1].endsWith(")")||g[1].endsWith(")")&&!g[0].startsWith("(")?!1:h.checkDMS?l.test(g[0])&&u.test(g[1]):a.test(g[0])&&o.test(g[1])}r.exports=e.default,r.exports.default=e.default})(Rh,Rh.exports);var bP=Rh.exports,Ga={};Object.defineProperty(Ga,"__esModule",{value:!0});Ga.default=kP;Ga.locales=void 0;var RP=LP(Y);function LP(r){return r&&r.__esModule?r:{default:r}}var Sv=/^\d{3}$/,Kt=/^\d{4}$/,St=/^\d{5}$/,vc=/^\d{6}$/,Cs={AD:/^AD\d{3}$/,AT:Kt,AU:Kt,AZ:/^AZ\d{4}$/,BA:/^([7-8]\d{4}$)/,BD:/^([1-8][0-9]{3}|9[0-4][0-9]{2})$/,BE:Kt,BG:Kt,BR:/^\d{5}-?\d{3}$/,BY:/^2[1-4]\d{4}$/,CA:/^[ABCEGHJKLMNPRSTVXY]\d[ABCEGHJ-NPRSTV-Z][\s\-]?\d[ABCEGHJ-NPRSTV-Z]\d$/i,CH:Kt,CN:/^(0[1-7]|1[012356]|2[0-7]|3[0-6]|4[0-7]|5[1-7]|6[1-7]|7[1-5]|8[1345]|9[09])\d{4}$/,CO:/^(05|08|11|13|15|17|18|19|20|23|25|27|41|44|47|50|52|54|63|66|68|70|73|76|81|85|86|88|91|94|95|97|99)(\d{4})$/,CZ:/^\d{3}\s?\d{2}$/,DE:St,DK:Kt,DO:St,DZ:St,EE:St,ES:/^(5[0-2]{1}|[0-4]{1}\d{1})\d{3}$/,FI:St,FR:/^(?:(?:0[1-9]|[1-8]\d|9[0-5])\d{3}|97[1-46]\d{2})$/,GB:/^(gir\s?0aa|[a-z]{1,2}\d[\da-z]?\s?(\d[a-z]{2})?)$/i,GR:/^\d{3}\s?\d{2}$/,HR:/^([1-5]\d{4}$)/,HT:/^HT\d{4}$/,HU:Kt,ID:St,IE:/^(?!.*(?:o))[A-Za-z]\d[\dw]\s\w{4}$/i,IL:/^(\d{5}|\d{7})$/,IN:/^((?!10|29|35|54|55|65|66|86|87|88|89)[1-9][0-9]{5})$/,IR:/^(?!(\d)\1{3})[13-9]{4}[1346-9][013-9]{5}$/,IS:Sv,IT:St,JP:/^\d{3}\-\d{4}$/,KE:St,KR:/^(\d{5}|\d{6})$/,LI:/^(948[5-9]|949[0-7])$/,LT:/^LT\-\d{5}$/,LU:Kt,LV:/^LV\-\d{4}$/,LK:St,MG:Sv,MX:St,MT:/^[A-Za-z]{3}\s{0,1}\d{4}$/,MY:St,NL:/^[1-9]\d{3}\s?(?!sa|sd|ss)[a-z]{2}$/i,NO:Kt,NP:/^(10|21|22|32|33|34|44|45|56|57)\d{3}$|^(977)$/i,NZ:Kt,PK:St,PL:/^\d{2}\-\d{3}$/,PR:/^00[679]\d{2}([ -]\d{4})?$/,PT:/^\d{4}\-\d{3}?$/,RO:vc,RU:vc,SA:St,SE:/^[1-9]\d{2}\s?\d{2}$/,SG:vc,SI:Kt,SK:/^\d{3}\s?\d{2}$/,TH:St,TN:Kt,TW:/^\d{3}(\d{2,3})?$/,UA:St,US:/^\d{5}(-\d{4})?$/,ZA:Kt,ZM:St};Ga.locales=Object.keys(Cs);function kP(r,e){if((0,RP.default)(r),e in Cs)return Cs[e].test(r);if(e==="any"){for(var t in Cs)if(Cs.hasOwnProperty(t)){var n=Cs[t];if(n.test(r))return!0}return!1}throw new Error("Invalid locale '".concat(e,"'"))}var Lh={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=s;var t=n(Y);function n(i){return i&&i.__esModule?i:{default:i}}function s(i){return(0,t.default)(i),i.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\//g,"&#x2F;").replace(/\\/g,"&#x5C;").replace(/`/g,"&#96;")}r.exports=e.default,r.exports.default=e.default})(Lh,Lh.exports);var CP=Lh.exports,kh={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=s;var t=n(Y);function n(i){return i&&i.__esModule?i:{default:i}}function s(i){return(0,t.default)(i),i.replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&#x2F;/g,"/").replace(/&#x5C;/g,"\\").replace(/&#96;/g,"`").replace(/&amp;/g,"&")}r.exports=e.default,r.exports.default=e.default})(kh,kh.exports);var PP=kh.exports,Ch={exports:{}},Ph={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=s;var t=n(Y);function n(i){return i&&i.__esModule?i:{default:i}}function s(i,a){return(0,t.default)(i),i.replace(new RegExp("[".concat(a,"]+"),"g"),"")}r.exports=e.default,r.exports.default=e.default})(Ph,Ph.exports);var aT=Ph.exports;(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;var t=s(Y),n=s(aT);function s(a){return a&&a.__esModule?a:{default:a}}function i(a,o){(0,t.default)(a);var l=o?"\\x00-\\x09\\x0B\\x0C\\x0E-\\x1F\\x7F":"\\x00-\\x1F\\x7F";return(0,n.default)(a,l)}r.exports=e.default,r.exports.default=e.default})(Ch,Ch.exports);var DP=Ch.exports,Dh={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=s;var t=n(Y);function n(i){return i&&i.__esModule?i:{default:i}}function s(i,a){return(0,t.default)(i),i.replace(new RegExp("[^".concat(a,"]+"),"g"),"")}r.exports=e.default,r.exports.default=e.default})(Dh,Dh.exports);var OP=Dh.exports,Oh={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=s;var t=n(Y);function n(i){return i&&i.__esModule?i:{default:i}}function s(i,a){(0,t.default)(i);for(var o=i.length-1;o>=0;o--)if(a.indexOf(i[o])===-1)return!1;return!0}r.exports=e.default,r.exports.default=e.default})(Oh,Oh.exports);var MP=Oh.exports,Mh={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=c;var t=n(Lt);function n(d){return d&&d.__esModule?d:{default:d}}var s={all_lowercase:!0,gmail_lowercase:!0,gmail_remove_dots:!0,gmail_remove_subaddress:!0,gmail_convert_googlemaildotcom:!0,outlookdotcom_lowercase:!0,outlookdotcom_remove_subaddress:!0,yahoo_lowercase:!0,yahoo_remove_subaddress:!0,yandex_lowercase:!0,yandex_convert_yandexru:!0,icloud_lowercase:!0,icloud_remove_subaddress:!0},i=["icloud.com","me.com"],a=["hotmail.at","hotmail.be","hotmail.ca","hotmail.cl","hotmail.co.il","hotmail.co.nz","hotmail.co.th","hotmail.co.uk","hotmail.com","hotmail.com.ar","hotmail.com.au","hotmail.com.br","hotmail.com.gr","hotmail.com.mx","hotmail.com.pe","hotmail.com.tr","hotmail.com.vn","hotmail.cz","hotmail.de","hotmail.dk","hotmail.es","hotmail.fr","hotmail.hu","hotmail.id","hotmail.ie","hotmail.in","hotmail.it","hotmail.jp","hotmail.kr","hotmail.lv","hotmail.my","hotmail.ph","hotmail.pt","hotmail.sa","hotmail.sg","hotmail.sk","live.be","live.co.uk","live.com","live.com.ar","live.com.mx","live.de","live.es","live.eu","live.fr","live.it","live.nl","msn.com","outlook.at","outlook.be","outlook.cl","outlook.co.il","outlook.co.nz","outlook.co.th","outlook.com","outlook.com.ar","outlook.com.au","outlook.com.br","outlook.com.gr","outlook.com.pe","outlook.com.tr","outlook.com.vn","outlook.cz","outlook.de","outlook.dk","outlook.es","outlook.fr","outlook.hu","outlook.id","outlook.ie","outlook.in","outlook.it","outlook.jp","outlook.kr","outlook.lv","outlook.my","outlook.ph","outlook.pt","outlook.sa","outlook.sg","outlook.sk","passport.com"],o=["rocketmail.com","yahoo.ca","yahoo.co.uk","yahoo.com","yahoo.de","yahoo.fr","yahoo.in","yahoo.it","ymail.com"],l=["yandex.ru","yandex.ua","yandex.kz","yandex.com","yandex.by","ya.ru"];function u(d){return d.length>1?d:""}function c(d,f){f=(0,t.default)(f,s);var h=d.split("@"),g=h.pop(),p=h.join("@"),v=[p,g];if(v[1]=v[1].toLowerCase(),v[1]==="gmail.com"||v[1]==="googlemail.com"){if(f.gmail_remove_subaddress&&(v[0]=v[0].split("+")[0]),f.gmail_remove_dots&&(v[0]=v[0].replace(/\.+/g,u)),!v[0].length)return!1;(f.all_lowercase||f.gmail_lowercase)&&(v[0]=v[0].toLowerCase()),v[1]=f.gmail_convert_googlemaildotcom?"gmail.com":v[1]}else if(i.indexOf(v[1])>=0){if(f.icloud_remove_subaddress&&(v[0]=v[0].split("+")[0]),!v[0].length)return!1;(f.all_lowercase||f.icloud_lowercase)&&(v[0]=v[0].toLowerCase())}else if(a.indexOf(v[1])>=0){if(f.outlookdotcom_remove_subaddress&&(v[0]=v[0].split("+")[0]),!v[0].length)return!1;(f.all_lowercase||f.outlookdotcom_lowercase)&&(v[0]=v[0].toLowerCase())}else if(o.indexOf(v[1])>=0){if(f.yahoo_remove_subaddress){var m=v[0].split("-");v[0]=m.length>1?m.slice(0,-1).join("-"):m[0]}if(!v[0].length)return!1;(f.all_lowercase||f.yahoo_lowercase)&&(v[0]=v[0].toLowerCase())}else l.indexOf(v[1])>=0?((f.all_lowercase||f.yandex_lowercase)&&(v[0]=v[0].toLowerCase()),v[1]=f.yandex_convert_yandexru?"yandex.ru":v[1]):f.all_lowercase&&(v[0]=v[0].toLowerCase());return v.join("@")}r.exports=e.default,r.exports.default=e.default})(Mh,Mh.exports);var NP=Mh.exports,Nh={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;var t=n(Y);function n(a){return a&&a.__esModule?a:{default:a}}var s=/^[^\s-_](?!.*?[-_]{2,})[a-z0-9-\\][^\s]*[^-_\s]$/;function i(a){return(0,t.default)(a),s.test(a)}r.exports=e.default,r.exports.default=e.default})(Nh,Nh.exports);var FP=Nh.exports,Fh={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;var t=n(Y);function n(a){return a&&a.__esModule?a:{default:a}}var s={"cs-CZ":function(o){return/^(([ABCDEFHIJKLMNPRSTUVXYZ]|[0-9])-?){5,8}$/.test(o)},"de-DE":function(o){return/^((A|AA|AB|AC|AE|AH|AK|AM|AN|A|AP|AS|AT|AU|AW|AZ|B|BA|BB|BC|BE|BF|BH|BI|BK|BL|BM|BN|BO|B|BS|BT|BZ|C|CA|CB|CE|CO|CR|CW|D|DA|DD|DE|DH|DI|DL|DM|DN|DO|DU|DW|DZ|E|EA|EB|ED|EE|EF|EG|EH|EI|EL|EM|EN|ER|ES|EU|EW|F|FB|FD|FF|FG|FI|FL|FN|FO|FR|FS|FT|F|FW|FZ|G|GA|GC|GD|GE|GF|GG|GI|GK|GL|GM|GN|G|GP|GR|GS|GT|G|GV|GW|GZ|H|HA|HB|HC|HD|HE|HF|HG|HH|HI|HK|HL|HM|HN|HO|HP|HR|HS|HU|HV|HX|HY|HZ|IK|IL|IN|IZ|J|JE|JL|K|KA|KB|KC|KE|KF|KG|KH|KI|KK|KL|KM|KN|KO|KR|KS|KT|KU|KW|KY|L|LA|LB|LC|LD|LF|LG|LH|LI|LL|LM|LN|L|LP|LR|LU|M|MA|MB|MC|MD|ME|MG|MH|MI|MK|ML|MM|MN|MO|MQ|MR|MS|M|MW|MY|MZ|N|NB|ND|NE|NF|NH|NI|NK|NM|N|NP|NR|NT|NU|NW|NY|NZ|OA|OB|OC|OD|OE|OF|OG|OH|OK|OL|OP|OS|OZ|P|PA|PB|PE|PF|PI|PL|PM|PN|PR|PS|PW|PZ|R|RA|RC|RD|RE|RG|RH|RI|RL|RM|RN|RO|RP|RS|RT|RU|RV|RW|RZ|S|SB|SC|SE|SG|SI|SK|SL|SM|SN|SO|SP|SR|ST|SU|SW|SY|SZ|TE|TF|TG|TO|TP|TR|TS|TT|T|B|UE|UH|UL|UM|UN|V|VB|VG|VK|VR|VS|W|WA|WB|WE|WF|WI|WK|WL|WM|WN|WO|WR|WS|WT|W|WW|WZ|Z|ZE|ZI|ZP|ZR|ZW|ZZ)[- ]?[A-Z]{1,2}[- ]?\d{1,4}|(ABG|ABI|AIB|AIC|ALF|ALZ|ANA|ANG|ANK|APD|ARN|ART|ASL|ASZ|AUR|AZE|BAD|BAR|BBG|BCH|BED|BER|BGD|BGL|BID|BIN|BIR|BIT|BIW|BKS|BLB|BLK|BNA|BOG|BOH|BOR|BOT|BRA|BRB|BRG|BRK|BRL|BRV|BSB|BSK|BTF|BD|BUL|BR|BS|BZ|CAS|CHA|CLP|CLZ|COC|COE|CUX|DAH|DAN|DAU|DBR|DEG|DEL|DGF|DIL|DIN|DIZ|DKB|DLG|DON|DUD|DW|EBE|EBN|EBS|ECK|EIC|EIL|EIN|EIS|EMD|EMS|ERB|ERH|ERK|ERZ|ESB|ESW|FDB|FDS|FEU|FFB|FKB|FL|FOR|FRG|FRI|FRW|FTL|FS|GAN|GAP|GDB|GEL|GEO|GER|GHA|GHC|GLA|GMN|GNT|GOA|GOH|GRA|GRH|GRI|GRM|GRZ|GTH|GUB|GUN|GVM|HAB|HAL|HAM|HAS|HBN|HBS|HCH|HDH|HDL|HEB|HEF|HEI|HER|HET|HGN|HGW|HHM|HIG|HIP|HM|HOG|HOH|HOL|HOM|HOR|HS|HOT|HRO|HSK|HST|HVL|HWI|IGB|ILL|JL|KEH|KEL|KEM|KIB|KLE|KLZ|KN|KT|KZ|KRU|KN|KUS|KYF|LAN|LAU|LBS|LBZ|LDK|LDS|LEO|LER|LEV|LIB|LIF|LIP|LB|LOS|LRO|LSZ|LN|LUP|LWL|MAB|MAI|MAK|MAL|MED|MEG|MEI|MEK|MEL|MER|MET|MGH|MGN|MHL|MIL|MKK|MOD|MOL|MON|MOS|MSE|MSH|MSP|MST|MTK|MTL|MB|MR|MYK|MZG|NAB|NAI|NAU|NDH|NEA|NEB|NEC|NEN|NES|NEW|NMB|NMS|NOH|NOL|NOM|NOR|NVP|NWM|OAL|OBB|OBG|OCH|OHA|HR|OHV|OHZ|OPR|OSL|OVI|OVL|OVP|PAF|PAN|PAR|PCH|PEG|PIR|PL|PR|QFT|QLB|RDG|REG|REH|REI|RID|RIE|ROD|ROF|ROK|ROL|ROS|ROT|ROW|RSL|RD|RG|SAB|SAD|SAN|SAW|SBG|SBK|SCZ|SDH|SDL|SDT|SEB|SEE|SEF|SEL|SFB|SFT|SGH|SHA|SHG|SHK|SHL|SIG|SIM|SLE|SLF|SLK|SLN|SLS|SL|SLZ|SM|SOB|SOG|SOK|SM|SON|SPB|SPN|SRB|SRO|STA|STB|STD|STE|STL|SUL|SW|SWA|SZB|TBB|TDO|TET|TIR|TL|TUT|UEM|UER|UFF|USI|VAI|VEC|VER|VIB|VIE|VIT|VOH|WAF|WAK|WAN|WAR|WAT|WBS|WDA|WEL|WEN|WER|WES|WHV|WIL|WIS|WIT|WIZ|WLG|WMS|WND|WOB|WOH|WOL|WOR|WOS|WRN|WSF|WST|WSW|WTL|WTM|WUG|WM|WUN|WUR|WZL|ZEL|ZIG)[- ]?(([A-Z][- ]?\d{1,4})|([A-Z]{2}[- ]?\d{1,3})))[- ]?(E|H)?$/.test(o)},"de-LI":function(o){return/^FL[- ]?\d{1,5}[UZ]?$/.test(o)},"en-IN":function(o){return/^[A-Z]{2}[ -]?[0-9]{1,2}(?:[ -]?[A-Z])(?:[ -]?[A-Z]*)?[ -]?[0-9]{4}$/.test(o)},"en-SG":function(o){return/^[A-Z]{3}[ -]?[\d]{4}[ -]?[A-Z]{1}$/.test(o)},"es-AR":function(o){return/^(([A-Z]{2} ?[0-9]{3} ?[A-Z]{2})|([A-Z]{3} ?[0-9]{3}))$/.test(o)},"fi-FI":function(o){return/^(?=.{4,7})(([A-Z]{1,3}|[0-9]{1,3})[\s-]?([A-Z]{1,3}|[0-9]{1,5}))$/.test(o)},"hu-HU":function(o){return/^((((?!AAA)(([A-NPRSTVZWXY]{1})([A-PR-Z]{1})([A-HJ-NPR-Z]))|(A[ABC]I)|A[ABC]O|A[A-W]Q|BPI|BPO|UCO|UDO|XAO)-(?!000)\d{3})|(M\d{6})|((CK|DT|CD|HC|H[ABEFIKLMNPRSTVX]|MA|OT|R[A-Z]) \d{2}-\d{2})|(CD \d{3}-\d{3})|(C-(C|X) \d{4})|(X-(A|B|C) \d{4})|(([EPVZ]-\d{5}))|(S A[A-Z]{2} \d{2})|(SP \d{2}-\d{2}))$/.test(o)},"pt-BR":function(o){return/^[A-Z]{3}[ -]?[0-9][A-Z][0-9]{2}|[A-Z]{3}[ -]?[0-9]{4}$/.test(o)},"pt-PT":function(o){return/^(([A-Z]{2}[ -]?[0-9]{2}[ -]?[0-9]{2})|([0-9]{2}[ -]?[A-Z]{2}[ -]?[0-9]{2})|([0-9]{2}[ -]?[0-9]{2}[ -]?[A-Z]{2})|([A-Z]{2}[ -]?[0-9]{2}[ -]?[A-Z]{2}))$/.test(o)},"sq-AL":function(o){return/^[A-Z]{2}[- ]?((\d{3}[- ]?(([A-Z]{2})|T))|(R[- ]?\d{3}))$/.test(o)},"sv-SE":function(o){return/^[A-HJ-PR-UW-Z]{3} ?[\d]{2}[A-HJ-PR-UW-Z1-9]$|(^[A-Z ]{2,7}$)/.test(o.trim())},"en-PK":function(o){return/(^[A-Z]{2}((\s|-){0,1})[0-9]{3,4}((\s|-)[0-9]{2}){0,1}$)|(^[A-Z]{3}((\s|-){0,1})[0-9]{3,4}((\s|-)[0-9]{2}){0,1}$)|(^[A-Z]{4}((\s|-){0,1})[0-9]{3,4}((\s|-)[0-9]{2}){0,1}$)|(^[A-Z]((\s|-){0,1})[0-9]{4}((\s|-)[0-9]{2}){0,1}$)/.test(o.trim())}};function i(a,o){if((0,t.default)(a),o in s)return s[o](a);if(o==="any"){for(var l in s){var u=s[l];if(u(a))return!0}return!1}throw new Error("Invalid locale '".concat(o,"'"))}r.exports=e.default,r.exports.default=e.default})(Fh,Fh.exports);var $P=Fh.exports,$h={exports:{}};(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=h;var t=s(Lt),n=s(Y);function s(g){return g&&g.__esModule?g:{default:g}}var i=/^[A-Z]$/,a=/^[a-z]$/,o=/^[0-9]$/,l=/^[-#!$@%^&*()_+|~=`{}\[\]:";'<>?,.\/\\ ]$/,u={minLength:8,minLowercase:1,minUppercase:1,minNumbers:1,minSymbols:1,returnScore:!1,pointsPerUnique:1,pointsPerRepeat:.5,pointsForContainingLower:10,pointsForContainingUpper:10,pointsForContainingNumber:10,pointsForContainingSymbol:10};function c(g){var p={};return Array.from(g).forEach(function(v){var m=p[v];m?p[v]+=1:p[v]=1}),p}function d(g){var p=c(g),v={length:g.length,uniqueChars:Object.keys(p).length,uppercaseCount:0,lowercaseCount:0,numberCount:0,symbolCount:0};return Object.keys(p).forEach(function(m){i.test(m)?v.uppercaseCount+=p[m]:a.test(m)?v.lowercaseCount+=p[m]:o.test(m)?v.numberCount+=p[m]:l.test(m)&&(v.symbolCount+=p[m])}),v}function f(g,p){var v=0;return v+=g.uniqueChars*p.pointsPerUnique,v+=(g.length-g.uniqueChars)*p.pointsPerRepeat,g.lowercaseCount>0&&(v+=p.pointsForContainingLower),g.uppercaseCount>0&&(v+=p.pointsForContainingUpper),g.numberCount>0&&(v+=p.pointsForContainingNumber),g.symbolCount>0&&(v+=p.pointsForContainingSymbol),v}function h(g){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;(0,n.default)(g);var v=d(g);return p=(0,t.default)(p||{},u),p.returnScore?f(v,p):v.length>=p.minLength&&v.lowercaseCount>=p.minLowercase&&v.uppercaseCount>=p.minUppercase&&v.numberCount>=p.minNumbers&&v.symbolCount>=p.minSymbols}r.exports=e.default,r.exports.default=e.default})($h,$h.exports);var UP=$h.exports,Ka={};function Uh(r){"@babel/helpers - typeof";return Uh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Uh(r)}Object.defineProperty(Ka,"__esModule",{value:!0});Ka.default=VP;Ka.vatMatchers=void 0;var Ev=jP(Y),BP=oT(hs);function oT(r,e){if(typeof WeakMap=="function")var t=new WeakMap,n=new WeakMap;return(oT=function(i,a){if(!a&&i&&i.__esModule)return i;var o,l,u={__proto__:null,default:i};if(i===null||Uh(i)!="object"&&typeof i!="function")return u;if(o=a?n:t){if(o.has(i))return o.get(i);o.set(i,u)}for(var c in i)c!=="default"&&{}.hasOwnProperty.call(i,c)&&((l=(o=Object.defineProperty)&&Object.getOwnPropertyDescriptor(i,c))&&(l.get||l.set)?o(u,c,l):u[c]=i[c]);return u})(r,e)}function jP(r){return r&&r.__esModule?r:{default:r}}var GP=function(e){var t=e.match(/^(AU)?(\d{11})$/);if(!t)return!1;var n=[10,1,3,5,7,9,11,13,15,17,19];e=e.replace(/^AU/,"");for(var s=(parseInt(e.slice(0,1),10)-1).toString()+e.slice(1),i=0,a=0;a<11;a++)i+=n[a]*s.charAt(a);return i!==0&&i%89===0},KP=function(e){var t=function(s){var i=s.pop(),a=[5,4,3,2,7,6,5,4],o=(11-s.reduce(function(l,u,c){return l+u*a[c]},0)%11)%11;return i===o};return/^(CHE[- ]?)?(\d{9}|(\d{3}\.\d{3}\.\d{3})|(\d{3} \d{3} \d{3})) ?(TVA|MWST|IVA)?$/.test(e)&&t(e.match(/\d/g).map(function(n){return+n}))},HP=function(e){var t=e.match(/^(PT)?(\d{9})$/);if(!t)return!1;var n=t[2],s=11-BP.reverseMultiplyAndSum(n.split("").slice(0,8).map(function(i){return parseInt(i,10)}),9)%11;return s>9?parseInt(n[8],10)===0:s===parseInt(n[8],10)},_v=Ka.vatMatchers={AT:function(e){return/^(AT)?U\d{8}$/.test(e)},BE:function(e){return/^(BE)?\d{10}$/.test(e)},BG:function(e){return/^(BG)?\d{9,10}$/.test(e)},HR:function(e){return/^(HR)?\d{11}$/.test(e)},CY:function(e){return/^(CY)?\w{9}$/.test(e)},CZ:function(e){return/^(CZ)?\d{8,10}$/.test(e)},DK:function(e){return/^(DK)?\d{8}$/.test(e)},EE:function(e){return/^(EE)?\d{9}$/.test(e)},FI:function(e){return/^(FI)?\d{8}$/.test(e)},FR:function(e){return/^(FR)([A-Z0-9]{2}\d{9})$/.test(e)},DE:function(e){return/^(DE)?\d{9}$/.test(e)},EL:function(e){return/^(EL)?\d{9}$/.test(e)},HU:function(e){return/^(HU)?\d{8}$/.test(e)},IE:function(e){return/^(IE)?\d{7}\w{1}(W)?$/.test(e)},IT:function(e){return/^(IT)?\d{11}$/.test(e)},LV:function(e){return/^(LV)?\d{11}$/.test(e)},LT:function(e){return/^(LT)?\d{9,12}$/.test(e)},LU:function(e){return/^(LU)?\d{8}$/.test(e)},MT:function(e){return/^(MT)?\d{8}$/.test(e)},NL:function(e){return/^(NL)?\d{9}B\d{2}$/.test(e)},PL:function(e){return/^(PL)?(\d{10}|(\d{3}-\d{3}-\d{2}-\d{2})|(\d{3}-\d{2}-\d{2}-\d{3}))$/.test(e)},PT:HP,RO:function(e){return/^(RO)?\d{2,10}$/.test(e)},SK:function(e){return/^(SK)?\d{10}$/.test(e)},SI:function(e){return/^(SI)?\d{8}$/.test(e)},ES:function(e){return/^(ES)?\w\d{7}[A-Z]$/.test(e)},SE:function(e){return/^(SE)?\d{12}$/.test(e)},AL:function(e){return/^(AL)?\w{9}[A-Z]$/.test(e)},MK:function(e){return/^(MK)?\d{13}$/.test(e)},AU:GP,BY:function(e){return/^( )?\d{9}$/.test(e)},CA:function(e){return/^(CA)?\d{9}$/.test(e)},IS:function(e){return/^(IS)?\d{5,6}$/.test(e)},IN:function(e){return/^(IN)?\d{15}$/.test(e)},ID:function(e){return/^(ID)?(\d{15}|(\d{2}.\d{3}.\d{3}.\d{1}-\d{3}.\d{3}))$/.test(e)},IL:function(e){return/^(IL)?\d{9}$/.test(e)},KZ:function(e){return/^(KZ)?\d{12}$/.test(e)},NZ:function(e){return/^(NZ)?\d{9}$/.test(e)},NG:function(e){return/^(NG)?(\d{12}|(\d{8}-\d{4}))$/.test(e)},NO:function(e){return/^(NO)?\d{9}MVA$/.test(e)},PH:function(e){return/^(PH)?(\d{12}|\d{3} \d{3} \d{3} \d{3})$/.test(e)},RU:function(e){return/^(RU)?(\d{10}|\d{12})$/.test(e)},SM:function(e){return/^(SM)?\d{5}$/.test(e)},SA:function(e){return/^(SA)?\d{15}$/.test(e)},RS:function(e){return/^(RS)?\d{9}$/.test(e)},CH:KP,TR:function(e){return/^(TR)?\d{10}$/.test(e)},UA:function(e){return/^(UA)?\d{12}$/.test(e)},GB:function(e){return/^GB((\d{3} \d{4} ([0-8][0-9]|9[0-6]))|(\d{9} \d{3})|(((GD[0-4])|(HA[5-9]))[0-9]{2}))$/.test(e)},UZ:function(e){return/^(UZ)?\d{9}$/.test(e)},AR:function(e){return/^(AR)?\d{11}$/.test(e)},BO:function(e){return/^(BO)?\d{7}$/.test(e)},BR:function(e){return/^(BR)?((\d{2}.\d{3}.\d{3}\/\d{4}-\d{2})|(\d{3}.\d{3}.\d{3}-\d{2}))$/.test(e)},CL:function(e){return/^(CL)?\d{8}-\d{1}$/.test(e)},CO:function(e){return/^(CO)?\d{10}$/.test(e)},CR:function(e){return/^(CR)?\d{9,12}$/.test(e)},EC:function(e){return/^(EC)?\d{13}$/.test(e)},SV:function(e){return/^(SV)?\d{4}-\d{6}-\d{3}-\d{1}$/.test(e)},GT:function(e){return/^(GT)?\d{7}-\d{1}$/.test(e)},HN:function(e){return/^(HN)?$/.test(e)},MX:function(e){return/^(MX)?\w{3,4}\d{6}\w{3}$/.test(e)},NI:function(e){return/^(NI)?\d{3}-\d{6}-\d{4}\w{1}$/.test(e)},PA:function(e){return/^(PA)?$/.test(e)},PY:function(e){return/^(PY)?\d{6,8}-\d{1}$/.test(e)},PE:function(e){return/^(PE)?\d{11}$/.test(e)},DO:function(e){return/^(DO)?(\d{11}|(\d{3}-\d{7}-\d{1})|[1,4,5]{1}\d{8}|([1,4,5]{1})-\d{2}-\d{5}-\d{1})$/.test(e)},UY:function(e){return/^(UY)?\d{12}$/.test(e)},VE:function(e){return/^(VE)?[J,G,V,E]{1}-(\d{9}|(\d{8}-\d{1}))$/.test(e)}};function VP(r,e){if((0,Ev.default)(r),(0,Ev.default)(e),e in _v)return _v[e](r);throw new Error("Invalid country code: '".concat(e,"'"))}(function(r,e){function t(ln){"@babel/helpers - typeof";return t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(un){return typeof un}:function(un){return un&&typeof Symbol=="function"&&un.constructor===Symbol&&un!==Symbol.prototype?"symbol":typeof un},t(ln)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=q(pp),s=q(G_),i=q(Lk),a=q(kk),o=q(Ck),l=q(Pk),u=q(Dk),c=q(W_),d=q(Ok),f=q(Mk),h=q(iu),g=q(Nk),p=q(mp),v=q(q_),m=q(Fk),y=q($k),S=q(Uk),E=q(Bk),T=on(Oa),A=on(Ma),x=q(zk),w=on(Na),b=q(Qk),I=q(Xk),M=q(Jk),K=q(eC),z=q(tC),X=q(Si),Q=q(Ei),N=q(cC),P=q(dC),k=q(hC),F=q(gC),U=q(vp),B=on(yi),G=q(pC),ie=q(Y_),ne=q(mC),oe=q(vC),le=q(yC),Ie=q(SC),Fe=q(EC),Ye=q(_C),pt=on(Fa),jt=q(kC),kt=q(CC),mt=q(PC),sn=q(DC),Un=q(OC),Se=q(MC),R=q(NC),L=q(V_),$=q(FC),V=q($C),W=q(UC),H=q(BC),ue=q(jC),ce=q(GC),pe=q(J_),Ee=q(KC),at=q(HC),hr=q(VC),Gt=q(WC),an=q(zC),Ir=q(qC),Bn=q(JC),jn=on($a),Va=q(nP),bT=q(sP),RT=q(iP),xp=Ua,LT=q(cP),kT=q(dP),CT=q(fP),PT=q(Ba),DT=q(_i),OT=q(mP),MT=q(vP),NT=q(ja),FT=q(_P),$T=q(TP),UT=q(X_),BT=q(xP),jT=q(AP),GT=q(wP),KT=q(IP),HT=q(bP),Ap=on(Ga),VT=q(sT),WT=q(nT),zT=q(iT),qT=q(CP),YT=q(PP),ZT=q(DP),QT=q(OP),XT=q(aT),JT=q(MP),ex=q(NP),tx=q(FP),rx=q($P),nx=q(UP),sx=q(Ka);function on(ln,un){if(typeof WeakMap=="function")var ox=new WeakMap,lx=new WeakMap;return(on=function(Ct,wp){if(!wp&&Ct&&Ct.__esModule)return Ct;var gs,Wa,Ti={__proto__:null,default:Ct};if(Ct===null||t(Ct)!="object"&&typeof Ct!="function")return Ti;if(gs=wp?lx:ox){if(gs.has(Ct))return gs.get(Ct);gs.set(Ct,Ti)}for(var ps in Ct)ps!=="default"&&{}.hasOwnProperty.call(Ct,ps)&&((Wa=(gs=Object.defineProperty)&&Object.getOwnPropertyDescriptor(Ct,ps))&&(Wa.get||Wa.set)?gs(Ti,ps,Wa):Ti[ps]=Ct[ps]);return Ti})(ln,un)}function q(ln){return ln&&ln.__esModule?ln:{default:ln}}var ix="13.15.23",ax={version:ix,toDate:n.default,toFloat:s.default,toInt:i.default,toBoolean:a.default,equals:o.default,contains:l.default,matches:u.default,isEmail:c.default,isURL:d.default,isMACAddress:f.default,isIP:h.default,isIPRange:g.default,isFQDN:p.default,isBoolean:y.default,isIBAN:pt.default,isBIC:jt.default,isAbaRouting:E.default,isAlpha:T.default,isAlphaLocales:T.locales,isAlphanumeric:A.default,isAlphanumericLocales:A.locales,isNumeric:x.default,isPassportNumber:w.default,passportNumberLocales:w.locales,isPort:b.default,isLowercase:I.default,isUppercase:M.default,isAscii:z.default,isFullWidth:X.default,isHalfWidth:Q.default,isVariableWidth:N.default,isMultibyte:P.default,isSemVer:k.default,isSurrogatePair:F.default,isInt:U.default,isIMEI:K.default,isFloat:B.default,isFloatLocales:B.locales,isDecimal:G.default,isHexadecimal:ie.default,isOctal:ne.default,isDivisibleBy:oe.default,isHexColor:le.default,isRgbColor:Ie.default,isHSL:Fe.default,isISRC:Ye.default,isMD5:kt.default,isHash:mt.default,isJWT:sn.default,isJSON:Un.default,isEmpty:Se.default,isLength:R.default,isLocale:S.default,isByteLength:L.default,isULID:$.default,isUUID:V.default,isMongoId:W.default,isAfter:H.default,isBefore:ue.default,isIn:ce.default,isLuhnNumber:pe.default,isCreditCard:Ee.default,isIdentityCard:at.default,isEAN:hr.default,isISIN:Gt.default,isISBN:an.default,isISSN:Ir.default,isMobilePhone:jn.default,isMobilePhoneLocales:jn.locales,isPostalCode:Ap.default,isPostalCodeLocales:Ap.locales,isEthereumAddress:Va.default,isCurrency:bT.default,isBtcAddress:RT.default,isISO6346:xp.isISO6346,isFreightContainerID:xp.isFreightContainerID,isISO6391:LT.default,isISO8601:kT.default,isISO15924:PT.default,isRFC3339:CT.default,isISO31661Alpha2:DT.default,isISO31661Alpha3:OT.default,isISO31661Numeric:MT.default,isISO4217:NT.default,isBase32:FT.default,isBase58:$T.default,isBase64:UT.default,isDataURI:BT.default,isMagnetURI:jT.default,isMailtoURI:GT.default,isMimeType:KT.default,isLatLong:HT.default,ltrim:VT.default,rtrim:WT.default,trim:zT.default,escape:qT.default,unescape:YT.default,stripLow:ZT.default,whitelist:QT.default,blacklist:XT.default,isWhitelisted:JT.default,normalizeEmail:ex.default,toString,isSlug:tx.default,isStrongPassword:nx.default,isTaxID:Bn.default,isDate:v.default,isTime:m.default,isLicensePlate:rx.default,isVAT:sx.default,ibanLocales:pt.locales};e.default=ax,r.exports=e.default,r.exports.default=e.default})(Wd,Wd.exports);var WP=Wd.exports;/*!
 * is-extglob <https://github.com/jonschlinkert/is-extglob>
 *
 * Copyright (c) 2014-2015, Jon Schlinkert.
 * Licensed under the MIT License.
 */var zP=function(e){return typeof e=="string"&&/[@?!+*]\(/.test(e)};/*!
 * is-glob <https://github.com/jonschlinkert/is-glob>
 *
 * Copyright (c) 2014-2015, Jon Schlinkert.
 * Licensed under the MIT License.
 */var qP=zP,YP=function(e){return typeof e=="string"&&(/[*!?{}(|)[\]]/.test(e)||qP(e))};/*!
 * is-invalid-path <https://github.com/jonschlinkert/is-invalid-path>
 *
 * Copyright (c) 2015, Jon Schlinkert.
 * Licensed under the MIT License.
 */var ZP=YP,QP=/[!#$%&+^<=>`]/,XP=function(r){return typeof r!="string"||ZP(r)||QP.test(r)};/*!
 * is-valid-path <https://github.com/jonschlinkert/is-valid-path>
 *
 * Copyright (c) 2015 Jon Schlinkert, contributors.
 * Licensed under the MIT license.
 */var JP=XP,eD=function(r){return JP(r)===!1};const{isURL:tD}=WP,rD=eD,lT={};lT.parse=r=>{let e={header:{},items:[]},t=r.split(`
`).map(nD),n=t.find(a=>a.index===0);if(!n||!/^#EXTM3U/.test(n.raw))throw new Error("Playlist is not valid");e.header=sD(n);let s=0;const i={};for(let a of t){if(a.index===0)continue;const o=a.raw.toString().trim();if(o.startsWith("#EXTINF:")){const l=o;i[s]={name:l.getName(),tvg:{id:l.getAttribute("tvg-id"),name:l.getAttribute("tvg-name"),logo:l.getAttribute("tvg-logo"),url:l.getAttribute("tvg-url"),rec:l.getAttribute("tvg-rec"),shift:l.getAttribute("tvg-shift")},group:{title:l.getAttribute("group-title")},http:{referrer:"","user-agent":l.getAttribute("user-agent")},url:void 0,raw:a.raw,line:a.index+1,catchup:{type:l.getAttribute("catchup"),days:l.getAttribute("catchup-days"),source:l.getAttribute("catchup-source")},timeshift:l.getAttribute("timeshift")}}else if(o.startsWith("#EXTVLCOPT:")){if(!i[s])continue;const l=o;i[s].http.referrer=l.getOption("http-referrer")||i[s].http.referrer,i[s].http["user-agent"]=l.getOption("http-user-agent")||i[s].http["user-agent"],i[s].raw+=`\r
${a.raw}`}else if(o.startsWith("#EXTGRP:")){if(!i[s])continue;const l=o;i[s].group.title=l.getValue()||i[s].group.title,i[s].raw+=`\r
${a.raw}`}else{if(!i[s])continue;const l=o.getURL(),u=o.getParameter("user-agent"),c=o.getParameter("referer");if(l&&(rD(l)||tD(l)))i[s].url=l,i[s].http["user-agent"]=u||i[s].http["user-agent"],i[s].http.referrer=c||i[s].http.referrer,i[s].raw+=`\r
${a.raw}`,s++;else{if(!i[s])continue;i[s].raw+=`\r
${a.raw}`}}}return e.items=Object.values(i),e};function nD(r,e){return{index:e,raw:r}}function sD(r){const e=["x-tvg-url","url-tvg"];let t={};for(let n of e){const s=r.raw.getAttribute(n);s&&(t[n]=s)}return{attrs:t,raw:r.raw}}String.prototype.getName=function(){return this.replace(/\="(.*?)"/g,"").split(/,(.*)/)[1]||""};String.prototype.getAttribute=function(r){let t=new RegExp(r+'="(.*?)"',"gi").exec(this);return t&&t[1]?t[1]:""};String.prototype.getOption=function(r){let t=new RegExp(":"+r+"=(.*)","gi").exec(this);return t&&t[1]&&typeof t[1]=="string"?t[1].replace(/\"/g,""):""};String.prototype.getValue=function(r){let t=new RegExp(":(.*)","gi").exec(this);return t&&t[1]&&typeof t[1]=="string"?t[1].replace(/\"/g,""):""};String.prototype.getURL=function(){return this.split("|")[0]||""};String.prototype.getParameter=function(r){const e=this.replace(/^(.*)\|/,""),n=new RegExp(r+"=(\\w[^&]*)","gi").exec(e);return n&&n[1]?n[1]:""};var iD=lT;const aD=(r,e,t)=>{const n=r.toLowerCase(),s=(e||"").toLowerCase(),i=(t||"").toLowerCase();return n.includes("type=m3u")||n.includes("get.php")||n.includes("playlist.php")||n.includes(".m3u")&&!n.includes(".m3u8")?"playlist":n.includes("/movie/")||s.includes("movie")||s.includes("film")||s.includes("sinema")||s.includes("vod")||i.includes("(movie)")?"movie":n.includes("/series/")||s.includes("series")||s.includes("dizi")||s.includes("season")||s.includes("episode")||i.includes("s0")||i.includes("e0")||/s\d{1,2}e\d{1,2}/i.test(t)?"series":"live"},uT=r=>{const e={},t={live:[],movie:[],series:[],playlist:[]};return{channels:r.map((s,i)=>{var u,c,d,f;const a=((u=s.group)==null?void 0:u.title)||s.group||"Other",o=aD(s.url,a,s.name);e[a]||(e[a]=[]);const l={id:i,name:s.name||`Channel ${i+1}`,logo:((c=s.tvg)==null?void 0:c.logo)||s.logo||"",url:s.url,group:a,type:o,userAgent:((d=s.http)==null?void 0:d["user-agent"])||s.userAgent||"",referrer:((f=s.http)==null?void 0:f.referrer)||s.referrer||""};return e[a].push(l),t[o]||(t[o]=[]),t[o].push(l),l}),groups:e,categories:t}},yc=r=>{try{console.log("Parsing M3U content, length:",r.length);const e=r.replace(/^\uFEFF/,"").replace(/\r\n/g,`
`).replace(/\r/g,`
`),t=iD.parse(e);if(!t||!t.items||t.items.length===0)return console.warn("No items found in parsed result"),{channels:[],groups:{},categories:{live:[],movie:[],series:[]}};const{channels:n,groups:s,categories:i}=uT(t.items);return console.log("Parsed",n.length,"channels:",i.live.length,"live,",i.movie.length,"movies,",i.series.length,"series"),{channels:n,groups:s,categories:i}}catch(e){return console.error("Error parsing M3U:",e),{channels:[],groups:{},categories:{live:[],movie:[],series:[]}}}};function au(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(r);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(r,n[s])&&(t[n[s]]=r[n[s]]);return t}function oD(r,e,t,n){function s(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(c){try{u(n.next(c))}catch(d){a(d)}}function l(c){try{u(n.throw(c))}catch(d){a(d)}}function u(c){c.done?i(c.value):s(c.value).then(o,l)}u((n=n.apply(r,e||[])).next())})}const lD=r=>r?(...e)=>r(...e):(...e)=>fetch(...e);class yp extends Error{constructor(e,t="FunctionsError",n){super(e),this.name=t,this.context=n}}class uD extends yp{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Tv extends yp{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class xv extends yp{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Bh;(function(r){r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2"})(Bh||(Bh={}));class cD{constructor(e,{headers:t={},customFetch:n,region:s=Bh.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=lD(n)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return oD(this,arguments,void 0,function*(t,n={}){var s;let i,a;try{const{headers:o,method:l,body:u,signal:c,timeout:d}=n;let f={},{region:h}=n;h||(h=this.region);const g=new URL(`${this.url}/${t}`);h&&h!=="any"&&(f["x-region"]=h,g.searchParams.set("forceFunctionRegion",h));let p;u&&(o&&!Object.prototype.hasOwnProperty.call(o,"Content-Type")||!o)?typeof Blob<"u"&&u instanceof Blob||u instanceof ArrayBuffer?(f["Content-Type"]="application/octet-stream",p=u):typeof u=="string"?(f["Content-Type"]="text/plain",p=u):typeof FormData<"u"&&u instanceof FormData?p=u:(f["Content-Type"]="application/json",p=JSON.stringify(u)):p=u;let v=c;d&&(a=new AbortController,i=setTimeout(()=>a.abort(),d),c?(v=a.signal,c.addEventListener("abort",()=>a.abort())):v=a.signal);const m=yield this.fetch(g.toString(),{method:l||"POST",headers:Object.assign(Object.assign(Object.assign({},f),this.headers),o),body:p,signal:v}).catch(T=>{throw new uD(T)}),y=m.headers.get("x-relay-error");if(y&&y==="true")throw new Tv(m);if(!m.ok)throw new xv(m);let S=((s=m.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),E;return S==="application/json"?E=yield m.json():S==="application/octet-stream"||S==="application/pdf"?E=yield m.blob():S==="text/event-stream"?E=m:S==="multipart/form-data"?E=yield m.formData():E=yield m.text(),{data:E,error:null,response:m}}catch(o){return{data:null,error:o,response:o instanceof xv||o instanceof Tv?o.context:void 0}}finally{i&&clearTimeout(i)}})}}var dD=class extends Error{constructor(r){super(r.message),this.name="PostgrestError",this.details=r.details,this.hint=r.hint,this.code=r.code}},fD=class{constructor(r){var e,t;this.shouldThrowOnError=!1,this.method=r.method,this.url=r.url,this.headers=new Headers(r.headers),this.schema=r.schema,this.body=r.body,this.shouldThrowOnError=(e=r.shouldThrowOnError)!==null&&e!==void 0?e:!1,this.signal=r.signal,this.isMaybeSingle=(t=r.isMaybeSingle)!==null&&t!==void 0?t:!1,r.fetch?this.fetch=r.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(r,e){return this.headers=new Headers(this.headers),this.headers.set(r,e),this}then(r,e){var t=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const n=this.fetch;let s=n(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{let a=null,o=null,l=null,u=i.status,c=i.statusText;if(i.ok){var d,f;if(t.method!=="HEAD"){var h;const m=await i.text();m===""||(t.headers.get("Accept")==="text/csv"||t.headers.get("Accept")&&(!((h=t.headers.get("Accept"))===null||h===void 0)&&h.includes("application/vnd.pgrst.plan+text"))?o=m:o=JSON.parse(m))}const p=(d=t.headers.get("Prefer"))===null||d===void 0?void 0:d.match(/count=(exact|planned|estimated)/),v=(f=i.headers.get("content-range"))===null||f===void 0?void 0:f.split("/");p&&v&&v.length>1&&(l=parseInt(v[1])),t.isMaybeSingle&&t.method==="GET"&&Array.isArray(o)&&(o.length>1?(a={code:"PGRST116",details:`Results contain ${o.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},o=null,l=null,u=406,c="Not Acceptable"):o.length===1?o=o[0]:o=null)}else{var g;const p=await i.text();try{a=JSON.parse(p),Array.isArray(a)&&i.status===404&&(o=[],a=null,u=200,c="OK")}catch{i.status===404&&p===""?(u=204,c="No Content"):a={message:p}}if(a&&t.isMaybeSingle&&(!(a==null||(g=a.details)===null||g===void 0)&&g.includes("0 rows"))&&(a=null,u=200,c="OK"),a&&t.shouldThrowOnError)throw new dD(a)}return{error:a,data:o,count:l,status:u,statusText:c}});return this.shouldThrowOnError||(s=s.catch(i=>{var a;let o="";const l=i==null?void 0:i.cause;if(l){var u,c,d,f;const g=(u=l==null?void 0:l.message)!==null&&u!==void 0?u:"",p=(c=l==null?void 0:l.code)!==null&&c!==void 0?c:"";o=`${(d=i==null?void 0:i.name)!==null&&d!==void 0?d:"FetchError"}: ${i==null?void 0:i.message}`,o+=`

Caused by: ${(f=l==null?void 0:l.name)!==null&&f!==void 0?f:"Error"}: ${g}`,p&&(o+=` (${p})`),l!=null&&l.stack&&(o+=`
${l.stack}`)}else{var h;o=(h=i==null?void 0:i.stack)!==null&&h!==void 0?h:""}return{error:{message:`${(a=i==null?void 0:i.name)!==null&&a!==void 0?a:"FetchError"}: ${i==null?void 0:i.message}`,details:o,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),s.then(r,e)}returns(){return this}overrideTypes(){return this}},hD=class extends fD{select(r){let e=!1;const t=(r??"*").split("").map(n=>/\s/.test(n)&&!e?"":(n==='"'&&(e=!e),n)).join("");return this.url.searchParams.set("select",t),this.headers.append("Prefer","return=representation"),this}order(r,{ascending:e=!0,nullsFirst:t,foreignTable:n,referencedTable:s=n}={}){const i=s?`${s}.order`:"order",a=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${a?`${a},`:""}${r}.${e?"asc":"desc"}${t===void 0?"":t?".nullsfirst":".nullslast"}`),this}limit(r,{foreignTable:e,referencedTable:t=e}={}){const n=typeof t>"u"?"limit":`${t}.limit`;return this.url.searchParams.set(n,`${r}`),this}range(r,e,{foreignTable:t,referencedTable:n=t}={}){const s=typeof n>"u"?"offset":`${n}.offset`,i=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(s,`${r}`),this.url.searchParams.set(i,`${e-r+1}`),this}abortSignal(r){return this.signal=r,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:r=!1,verbose:e=!1,settings:t=!1,buffers:n=!1,wal:s=!1,format:i="text"}={}){var a;const o=[r?"analyze":null,e?"verbose":null,t?"settings":null,n?"buffers":null,s?"wal":null].filter(Boolean).join("|"),l=(a=this.headers.get("Accept"))!==null&&a!==void 0?a:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${i}; for="${l}"; options=${o};`),i==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(r){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${r}`),this}};const Av=new RegExp("[,()]");var Ps=class extends hD{eq(r,e){return this.url.searchParams.append(r,`eq.${e}`),this}neq(r,e){return this.url.searchParams.append(r,`neq.${e}`),this}gt(r,e){return this.url.searchParams.append(r,`gt.${e}`),this}gte(r,e){return this.url.searchParams.append(r,`gte.${e}`),this}lt(r,e){return this.url.searchParams.append(r,`lt.${e}`),this}lte(r,e){return this.url.searchParams.append(r,`lte.${e}`),this}like(r,e){return this.url.searchParams.append(r,`like.${e}`),this}likeAllOf(r,e){return this.url.searchParams.append(r,`like(all).{${e.join(",")}}`),this}likeAnyOf(r,e){return this.url.searchParams.append(r,`like(any).{${e.join(",")}}`),this}ilike(r,e){return this.url.searchParams.append(r,`ilike.${e}`),this}ilikeAllOf(r,e){return this.url.searchParams.append(r,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(r,e){return this.url.searchParams.append(r,`ilike(any).{${e.join(",")}}`),this}regexMatch(r,e){return this.url.searchParams.append(r,`match.${e}`),this}regexIMatch(r,e){return this.url.searchParams.append(r,`imatch.${e}`),this}is(r,e){return this.url.searchParams.append(r,`is.${e}`),this}isDistinct(r,e){return this.url.searchParams.append(r,`isdistinct.${e}`),this}in(r,e){const t=Array.from(new Set(e)).map(n=>typeof n=="string"&&Av.test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(r,`in.(${t})`),this}notIn(r,e){const t=Array.from(new Set(e)).map(n=>typeof n=="string"&&Av.test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(r,`not.in.(${t})`),this}contains(r,e){return typeof e=="string"?this.url.searchParams.append(r,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(r,`cs.{${e.join(",")}}`):this.url.searchParams.append(r,`cs.${JSON.stringify(e)}`),this}containedBy(r,e){return typeof e=="string"?this.url.searchParams.append(r,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(r,`cd.{${e.join(",")}}`):this.url.searchParams.append(r,`cd.${JSON.stringify(e)}`),this}rangeGt(r,e){return this.url.searchParams.append(r,`sr.${e}`),this}rangeGte(r,e){return this.url.searchParams.append(r,`nxl.${e}`),this}rangeLt(r,e){return this.url.searchParams.append(r,`sl.${e}`),this}rangeLte(r,e){return this.url.searchParams.append(r,`nxr.${e}`),this}rangeAdjacent(r,e){return this.url.searchParams.append(r,`adj.${e}`),this}overlaps(r,e){return typeof e=="string"?this.url.searchParams.append(r,`ov.${e}`):this.url.searchParams.append(r,`ov.{${e.join(",")}}`),this}textSearch(r,e,{config:t,type:n}={}){let s="";n==="plain"?s="pl":n==="phrase"?s="ph":n==="websearch"&&(s="w");const i=t===void 0?"":`(${t})`;return this.url.searchParams.append(r,`${s}fts${i}.${e}`),this}match(r){return Object.entries(r).forEach(([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)}),this}not(r,e,t){return this.url.searchParams.append(r,`not.${e}.${t}`),this}or(r,{foreignTable:e,referencedTable:t=e}={}){const n=t?`${t}.or`:"or";return this.url.searchParams.append(n,`(${r})`),this}filter(r,e,t){return this.url.searchParams.append(r,`${e}.${t}`),this}},gD=class{constructor(r,{headers:e={},schema:t,fetch:n}){this.url=r,this.headers=new Headers(e),this.schema=t,this.fetch=n}select(r,e){const{head:t=!1,count:n}=e??{},s=t?"HEAD":"GET";let i=!1;const a=(r??"*").split("").map(o=>/\s/.test(o)&&!i?"":(o==='"'&&(i=!i),o)).join("");return this.url.searchParams.set("select",a),n&&this.headers.append("Prefer",`count=${n}`),new Ps({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(r,{count:e,defaultToNull:t=!0}={}){var n;const s="POST";if(e&&this.headers.append("Prefer",`count=${e}`),t||this.headers.append("Prefer","missing=default"),Array.isArray(r)){const i=r.reduce((a,o)=>a.concat(Object.keys(o)),[]);if(i.length>0){const a=[...new Set(i)].map(o=>`"${o}"`);this.url.searchParams.set("columns",a.join(","))}}return new Ps({method:s,url:this.url,headers:this.headers,schema:this.schema,body:r,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch})}upsert(r,{onConflict:e,ignoreDuplicates:t=!1,count:n,defaultToNull:s=!0}={}){var i;const a="POST";if(this.headers.append("Prefer",`resolution=${t?"ignore":"merge"}-duplicates`),e!==void 0&&this.url.searchParams.set("on_conflict",e),n&&this.headers.append("Prefer",`count=${n}`),s||this.headers.append("Prefer","missing=default"),Array.isArray(r)){const o=r.reduce((l,u)=>l.concat(Object.keys(u)),[]);if(o.length>0){const l=[...new Set(o)].map(u=>`"${u}"`);this.url.searchParams.set("columns",l.join(","))}}return new Ps({method:a,url:this.url,headers:this.headers,schema:this.schema,body:r,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}update(r,{count:e}={}){var t;const n="PATCH";return e&&this.headers.append("Prefer",`count=${e}`),new Ps({method:n,url:this.url,headers:this.headers,schema:this.schema,body:r,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch})}delete({count:r}={}){var e;const t="DELETE";return r&&this.headers.append("Prefer",`count=${r}`),new Ps({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:(e=this.fetch)!==null&&e!==void 0?e:fetch})}},pD=class cT{constructor(e,{headers:t={},schema:n,fetch:s}={}){this.url=e,this.headers=new Headers(t),this.schemaName=n,this.fetch=s}from(e){if(!e||typeof e!="string"||e.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new gD(new URL(`${this.url}/${e}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new cT(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:n=!1,get:s=!1,count:i}={}){var a;let o;const l=new URL(`${this.url}/rpc/${e}`);let u;n||s?(o=n?"HEAD":"GET",Object.entries(t).filter(([d,f])=>f!==void 0).map(([d,f])=>[d,Array.isArray(f)?`{${f.join(",")}}`:`${f}`]).forEach(([d,f])=>{l.searchParams.append(d,f)})):(o="POST",u=t);const c=new Headers(this.headers);return i&&c.set("Prefer",`count=${i}`),new Ps({method:o,url:l,headers:c,schema:this.schemaName,body:u,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch})}};class mD{constructor(){}static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const t=process.versions;if(t&&t.node){const n=t.node,s=parseInt(n.replace(/^v/,"").split(".")[0]);return s>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${s} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${s} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const n=this.getWebSocketConstructor();return new n(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const vD="2.89.0",yD=`realtime-js/${vD}`,dT="1.0.0",SD="2.0.0",wv=dT,jh=1e4,ED=1e3,_D=100;var vn;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(vn||(vn={}));var Xe;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(Xe||(Xe={}));var _r;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(_r||(_r={}));var Gh;(function(r){r.websocket="websocket"})(Gh||(Gh={}));var Zn;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(Zn||(Zn={}));class TD{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=e??[]}encode(e,t){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return t(this._binaryEncodeUserBroadcastPush(e));let n=[e.join_ref,e.ref,e.topic,e.event,e.payload];return t(JSON.stringify(n))}_binaryEncodeUserBroadcastPush(e){var t;return this._isArrayBuffer((t=e.payload)===null||t===void 0?void 0:t.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var t,n;const s=(n=(t=e.payload)===null||t===void 0?void 0:t.payload)!==null&&n!==void 0?n:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,s)}_encodeJsonUserBroadcastPush(e){var t,n;const s=(n=(t=e.payload)===null||t===void 0?void 0:t.payload)!==null&&n!==void 0?n:{},a=new TextEncoder().encode(JSON.stringify(s)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,a)}_encodeUserBroadcastPush(e,t,n){var s,i;const a=e.topic,o=(s=e.ref)!==null&&s!==void 0?s:"",l=(i=e.join_ref)!==null&&i!==void 0?i:"",u=e.payload.event,c=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},d=Object.keys(c).length===0?"":JSON.stringify(c);if(l.length>255)throw new Error(`joinRef length ${l.length} exceeds maximum of 255`);if(o.length>255)throw new Error(`ref length ${o.length} exceeds maximum of 255`);if(a.length>255)throw new Error(`topic length ${a.length} exceeds maximum of 255`);if(u.length>255)throw new Error(`userEvent length ${u.length} exceeds maximum of 255`);if(d.length>255)throw new Error(`metadata length ${d.length} exceeds maximum of 255`);const f=this.USER_BROADCAST_PUSH_META_LENGTH+l.length+o.length+a.length+u.length+d.length,h=new ArrayBuffer(this.HEADER_LENGTH+f);let g=new DataView(h),p=0;g.setUint8(p++,this.KINDS.userBroadcastPush),g.setUint8(p++,l.length),g.setUint8(p++,o.length),g.setUint8(p++,a.length),g.setUint8(p++,u.length),g.setUint8(p++,d.length),g.setUint8(p++,t),Array.from(l,m=>g.setUint8(p++,m.charCodeAt(0))),Array.from(o,m=>g.setUint8(p++,m.charCodeAt(0))),Array.from(a,m=>g.setUint8(p++,m.charCodeAt(0))),Array.from(u,m=>g.setUint8(p++,m.charCodeAt(0))),Array.from(d,m=>g.setUint8(p++,m.charCodeAt(0)));var v=new Uint8Array(h.byteLength+n.byteLength);return v.set(new Uint8Array(h),0),v.set(new Uint8Array(n),h.byteLength),v.buffer}decode(e,t){if(this._isArrayBuffer(e)){let n=this._binaryDecode(e);return t(n)}if(typeof e=="string"){const n=JSON.parse(e),[s,i,a,o,l]=n;return t({join_ref:s,ref:i,topic:a,event:o,payload:l})}return t({})}_binaryDecode(e){const t=new DataView(e),n=t.getUint8(0),s=new TextDecoder;switch(n){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(e,t,s)}}_decodeUserBroadcast(e,t,n){const s=t.getUint8(1),i=t.getUint8(2),a=t.getUint8(3),o=t.getUint8(4);let l=this.HEADER_LENGTH+4;const u=n.decode(e.slice(l,l+s));l=l+s;const c=n.decode(e.slice(l,l+i));l=l+i;const d=n.decode(e.slice(l,l+a));l=l+a;const f=e.slice(l,e.byteLength),h=o===this.JSON_ENCODING?JSON.parse(n.decode(f)):f,g={type:this.BROADCAST_EVENT,event:c,payload:h};return a>0&&(g.meta=JSON.parse(d)),{join_ref:null,ref:null,topic:u,event:this.BROADCAST_EVENT,payload:g}}_isArrayBuffer(e){var t;return e instanceof ArrayBuffer||((t=e==null?void 0:e.constructor)===null||t===void 0?void 0:t.name)==="ArrayBuffer"}_pick(e,t){return!e||typeof e!="object"?{}:Object.fromEntries(Object.entries(e).filter(([n])=>t.includes(n)))}}class fT{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Le;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(Le||(Le={}));const Iv=(r,e,t={})=>{var n;const s=(n=t.skipTypes)!==null&&n!==void 0?n:[];return e?Object.keys(e).reduce((i,a)=>(i[a]=xD(a,r,e,s),i),{}):{}},xD=(r,e,t,n)=>{const s=e.find(o=>o.name===r),i=s==null?void 0:s.type,a=t[r];return i&&!n.includes(i)?hT(i,a):Kh(a)},hT=(r,e)=>{if(r.charAt(0)==="_"){const t=r.slice(1,r.length);return bD(e,t)}switch(r){case Le.bool:return AD(e);case Le.float4:case Le.float8:case Le.int2:case Le.int4:case Le.int8:case Le.numeric:case Le.oid:return wD(e);case Le.json:case Le.jsonb:return ID(e);case Le.timestamp:return RD(e);case Le.abstime:case Le.date:case Le.daterange:case Le.int4range:case Le.int8range:case Le.money:case Le.reltime:case Le.text:case Le.time:case Le.timestamptz:case Le.timetz:case Le.tsrange:case Le.tstzrange:return Kh(e);default:return Kh(e)}},Kh=r=>r,AD=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},wD=r=>{if(typeof r=="string"){const e=parseFloat(r);if(!Number.isNaN(e))return e}return r},ID=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch{return r}return r},bD=(r,e)=>{if(typeof r!="string")return r;const t=r.length-1,n=r[t];if(r[0]==="{"&&n==="}"){let i;const a=r.slice(1,t);try{i=JSON.parse("["+a+"]")}catch{i=a?a.split(","):[]}return i.map(o=>hT(e,o))}return r},RD=r=>typeof r=="string"?r.replace(" ","T"):r,gT=r=>{const e=new URL(r);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class Sc{constructor(e,t,n={},s=jh){this.channel=e,this.event=t,this.payload=n,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var n;return this._hasReceived(e)&&t((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(n=>n.status===e).forEach(n=>n.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var bv;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})(bv||(bv={}));class Zi{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},s=>{const{onJoin:i,onLeave:a,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Zi.syncState(this.state,s,i,a),this.pendingDiffs.forEach(l=>{this.state=Zi.syncDiff(this.state,l,i,a)}),this.pendingDiffs=[],o()}),this.channel._on(n.diff,{},s=>{const{onJoin:i,onLeave:a,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=Zi.syncDiff(this.state,s,i,a),o())}),this.onJoin((s,i,a)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:i,newPresences:a})}),this.onLeave((s,i,a)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:i,leftPresences:a})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,n,s){const i=this.cloneDeep(e),a=this.transformState(t),o={},l={};return this.map(i,(u,c)=>{a[u]||(l[u]=c)}),this.map(a,(u,c)=>{const d=i[u];if(d){const f=c.map(v=>v.presence_ref),h=d.map(v=>v.presence_ref),g=c.filter(v=>h.indexOf(v.presence_ref)<0),p=d.filter(v=>f.indexOf(v.presence_ref)<0);g.length>0&&(o[u]=g),p.length>0&&(l[u]=p)}else o[u]=c}),this.syncDiff(i,{joins:o,leaves:l},n,s)}static syncDiff(e,t,n,s){const{joins:i,leaves:a}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return n||(n=()=>{}),s||(s=()=>{}),this.map(i,(o,l)=>{var u;const c=(u=e[o])!==null&&u!==void 0?u:[];if(e[o]=this.cloneDeep(l),c.length>0){const d=e[o].map(h=>h.presence_ref),f=c.filter(h=>d.indexOf(h.presence_ref)<0);e[o].unshift(...f)}n(o,c,l)}),this.map(a,(o,l)=>{let u=e[o];if(!u)return;const c=l.map(d=>d.presence_ref);u=u.filter(d=>c.indexOf(d.presence_ref)<0),e[o]=u,s(o,u,l),u.length===0&&delete e[o]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(n=>t(n,e[n]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,n)=>{const s=e[n];return"metas"in s?t[n]=s.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[n]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Rv;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(Rv||(Rv={}));var Qi;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes",r.SYSTEM="system"})(Qi||(Qi={}));var Wr;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(Wr||(Wr={}));class qs{constructor(e,t={config:{}},n){var s,i;if(this.topic=e,this.params=t,this.socket=n,this.bindings={},this.state=Xe.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Sc(this,_r.join,this.params,this.timeout),this.rejoinTimer=new fT(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Xe.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(a=>a.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Xe.closed,this.socket._remove(this)}),this._onError(a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=Xe.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Xe.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=Xe.errored,this.rejoinTimer.scheduleTimeout())}),this._on(_r.reply,{},(a,o)=>{this._trigger(this._replyEventName(o),a)}),this.presence=new Zi(this),this.broadcastEndpointURL=gT(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((i=(s=this.params.config)===null||s===void 0?void 0:s.broadcast)===null||i===void 0)&&i.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,t=this.timeout){var n,s,i;if(this.socket.isConnected()||this.socket.connect(),this.state==Xe.closed){const{config:{broadcast:a,presence:o,private:l}}=this.params,u=(s=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(h=>h.filter))!==null&&s!==void 0?s:[],c=!!this.bindings[Qi.PRESENCE]&&this.bindings[Qi.PRESENCE].length>0||((i=this.params.config.presence)===null||i===void 0?void 0:i.enabled)===!0,d={},f={broadcast:a,presence:Object.assign(Object.assign({},o),{enabled:c}),postgres_changes:u,private:l};this.socket.accessTokenValue&&(d.access_token=this.socket.accessTokenValue),this._onError(h=>e==null?void 0:e(Wr.CHANNEL_ERROR,h)),this._onClose(()=>e==null?void 0:e(Wr.CLOSED)),this.updateJoinPayload(Object.assign({config:f},d)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:h})=>{var g;if(this.socket._isManualToken()||this.socket.setAuth(),h===void 0){e==null||e(Wr.SUBSCRIBED);return}else{const p=this.bindings.postgres_changes,v=(g=p==null?void 0:p.length)!==null&&g!==void 0?g:0,m=[];for(let y=0;y<v;y++){const S=p[y],{filter:{event:E,schema:T,table:A,filter:x}}=S,w=h&&h[y];if(w&&w.event===E&&qs.isFilterValueEqual(w.schema,T)&&qs.isFilterValueEqual(w.table,A)&&qs.isFilterValueEqual(w.filter,x))m.push(Object.assign(Object.assign({},S),{id:w.id}));else{this.unsubscribe(),this.state=Xe.errored,e==null||e(Wr.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=m,e&&e(Wr.SUBSCRIBED);return}}).receive("error",h=>{this.state=Xe.errored,e==null||e(Wr.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(h).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(Wr.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,n){return this.state===Xe.joined&&e===Qi.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(e,t,n)}async httpSend(e,t,n={}){var s;if(t==null)return Promise.reject("Payload is required for httpSend()");const i={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(i.Authorization=`Bearer ${this.socket.accessTokenValue}`);const a={method:"POST",headers:i,body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:t,private:this.private}]})},o=await this._fetchWithTimeout(this.broadcastEndpointURL,a,(s=n.timeout)!==null&&s!==void 0?s:this.timeout);if(o.status===202)return{success:!0};let l=o.statusText;try{const u=await o.json();l=u.error||u.message||l}catch{}return Promise.reject(new Error(l))}async send(e,t={}){var n,s;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:i,payload:a}=e,o={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(o.Authorization=`Bearer ${this.socket.accessTokenValue}`);const l={method:"POST",headers:o,body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:a,private:this.private}]})};try{const u=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(n=t.timeout)!==null&&n!==void 0?n:this.timeout);return await((s=u.body)===null||s===void 0?void 0:s.cancel()),u.ok?"ok":"error"}catch(u){return u.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var a,o,l;const u=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(o=(a=this.params)===null||a===void 0?void 0:a.config)===null||o===void 0?void 0:o.broadcast)===null||l===void 0)&&l.ack)&&i("ok"),u.receive("ok",()=>i("ok")),u.receive("error",()=>i("error")),u.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Xe.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(_r.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(s=>{n=new Sc(this,_r.leave,{},e),n.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n==null||n.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Xe.closed,this.bindings={}}async _fetchWithTimeout(e,t,n){const s=new AbortController,i=setTimeout(()=>s.abort(),n),a=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(i),a}_push(e,t,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new Sc(this,e,t,n);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>_D){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,n){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,n){var s,i;const a=e.toLocaleLowerCase(),{close:o,error:l,leave:u,join:c}=_r;if(n&&[o,l,u,c].indexOf(a)>=0&&n!==this._joinRef())return;let f=this._onMessage(a,t,n);if(t&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(h=>{var g,p,v;return((g=h.filter)===null||g===void 0?void 0:g.event)==="*"||((v=(p=h.filter)===null||p===void 0?void 0:p.event)===null||v===void 0?void 0:v.toLocaleLowerCase())===a}).map(h=>h.callback(f,n)):(i=this.bindings[a])===null||i===void 0||i.filter(h=>{var g,p,v,m,y,S;if(["broadcast","presence","postgres_changes"].includes(a))if("id"in h){const E=h.id,T=(g=h.filter)===null||g===void 0?void 0:g.event;return E&&((p=t.ids)===null||p===void 0?void 0:p.includes(E))&&(T==="*"||(T==null?void 0:T.toLocaleLowerCase())===((v=t.data)===null||v===void 0?void 0:v.type.toLocaleLowerCase()))}else{const E=(y=(m=h==null?void 0:h.filter)===null||m===void 0?void 0:m.event)===null||y===void 0?void 0:y.toLocaleLowerCase();return E==="*"||E===((S=t==null?void 0:t.event)===null||S===void 0?void 0:S.toLocaleLowerCase())}else return h.type.toLocaleLowerCase()===a}).map(h=>{if(typeof f=="object"&&"ids"in f){const g=f.data,{schema:p,table:v,commit_timestamp:m,type:y,errors:S}=g;f=Object.assign(Object.assign({},{schema:p,table:v,commit_timestamp:m,eventType:y,new:{},old:{},errors:S}),this._getPayloadRecords(g))}h.callback(f,n)})}_isClosed(){return this.state===Xe.closed}_isJoined(){return this.state===Xe.joined}_isJoining(){return this.state===Xe.joining}_isLeaving(){return this.state===Xe.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,n){const s=e.toLocaleLowerCase(),i={type:s,filter:t,callback:n};return this.bindings[s]?this.bindings[s].push(i):this.bindings[s]=[i],this}_off(e,t){const n=e.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(s=>{var i;return!(((i=s.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===n&&qs.isEqual(s.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}static isFilterValueEqual(e,t){return(e??void 0)===(t??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(_r.close,{},e)}_onError(e){this._on(_r.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Xe.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Iv(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Iv(e.columns,e.old_record)),t}}const Ec=()=>{},Co={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},LD=[1e3,2e3,5e3,1e4],kD=1e4,CD=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class PD{constructor(e,t){var n;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=jh,this.transport=null,this.heartbeatIntervalMs=Co.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Ec,this.ref=0,this.reconnectTimer=null,this.vsn=wv,this.logger=Ec,this.conn=null,this.sendBuffer=[],this.serializer=new TD,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=s=>s?(...i)=>s(...i):(...i)=>fetch(...i),!(!((n=t==null?void 0:t.params)===null||n===void 0)&&n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${Gh.websocket}`,this.httpEndpoint=gT(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t==null?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=mD.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,t??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,n){this.logger(e,t,n)}connectionState(){switch(this.conn&&this.conn.readyState){case vn.connecting:return Zn.Connecting;case vn.open:return Zn.Open;case vn.closing:return Zn.Closing;default:return Zn.Closed}}isConnected(){return this.connectionState()===Zn.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const n=`realtime:${e}`,s=this.getChannels().find(i=>i.topic===n);if(s)return s;{const i=new qs(`realtime:${e}`,t,this);return this.channels.push(i),i}}push(e){const{topic:t,event:n,payload:s,ref:i}=e,a=()=>{this.encode(e,o=>{var l;(l=this.conn)===null||l===void 0||l.send(o)})};this.log("push",`${t} ${n} (${i})`,s),this.isConnected()?a():this.sendBuffer.push(a)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(ED,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},Co.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(n=>n.topic===e&&(n._isJoined()||n._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{if(t.topic==="phoenix"&&t.event==="phx_reply")try{this.heartbeatCallback(t.payload.status==="ok"?"ok":"error")}catch(u){this.log("error","error in heartbeat callback",u)}t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:n,event:s,payload:i,ref:a}=t,o=a?`(${a})`:"",l=i.status||"";this.log("receive",`${l} ${n} ${s} ${o}`.trim(),i),this.channels.filter(u=>u._isMember(n)).forEach(u=>u._trigger(s,i,a)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e),this.conn.readyState===vn.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===vn.open||this.conn.readyState===vn.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(t=>{this.log("error","error waiting for auth on connect",t),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this._terminateWorker()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(_r.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const n=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return`${e}${n}${s}`}_workerObjectUrl(e){let t;if(e)t=e;else{const n=new Blob([CD],{type:"application/javascript"});t=URL.createObjectURL(n)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t,n=!1;if(e)t=e,n=!0;else if(this.accessToken)try{t=await this.accessToken()}catch(s){this.log("error","Error fetching access token from callback",s),t=this.accessTokenValue}else t=this.accessTokenValue;n?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(s=>{const i={access_token:t,version:yD};t&&s.updateJoinPayload(i),s.joinedOnce&&s._isJoined()&&s._push(_r.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this._isManualToken()||this.setAuth().catch(t=>{this.log("error",`Error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(n=>{try{n(t)}catch(s){this.log("error",`error in ${e} callback`,s)}})}catch(n){this.log("error",`error triggering ${e} callbacks`,n)}}_setupReconnectionTimer(){this.reconnectTimer=new fT(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Co.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,n,s,i,a,o,l,u,c,d,f,h;switch(this.transport=(t=e==null?void 0:e.transport)!==null&&t!==void 0?t:null,this.timeout=(n=e==null?void 0:e.timeout)!==null&&n!==void 0?n:jh,this.heartbeatIntervalMs=(s=e==null?void 0:e.heartbeatIntervalMs)!==null&&s!==void 0?s:Co.HEARTBEAT_INTERVAL,this.worker=(i=e==null?void 0:e.worker)!==null&&i!==void 0?i:!1,this.accessToken=(a=e==null?void 0:e.accessToken)!==null&&a!==void 0?a:null,this.heartbeatCallback=(o=e==null?void 0:e.heartbeatCallback)!==null&&o!==void 0?o:Ec,this.vsn=(l=e==null?void 0:e.vsn)!==null&&l!==void 0?l:wv,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(u=e==null?void 0:e.reconnectAfterMs)!==null&&u!==void 0?u:g=>LD[g-1]||kD,this.vsn){case dT:this.encode=(c=e==null?void 0:e.encode)!==null&&c!==void 0?c:(g,p)=>p(JSON.stringify(g)),this.decode=(d=e==null?void 0:e.decode)!==null&&d!==void 0?d:(g,p)=>p(JSON.parse(g));break;case SD:this.encode=(f=e==null?void 0:e.encode)!==null&&f!==void 0?f:this.serializer.encode.bind(this.serializer),this.decode=(h=e==null?void 0:e.decode)!==null&&h!==void 0?h:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}var Ta=class extends Error{constructor(r,e){var t;super(r),this.name="IcebergError",this.status=e.status,this.icebergType=e.icebergType,this.icebergCode=e.icebergCode,this.details=e.details,this.isCommitStateUnknown=e.icebergType==="CommitStateUnknownException"||[500,502,504].includes(e.status)&&((t=e.icebergType)==null?void 0:t.includes("CommitState"))===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function DD(r,e,t){const n=new URL(e,r);if(t)for(const[s,i]of Object.entries(t))i!==void 0&&n.searchParams.set(s,i);return n.toString()}async function OD(r){return!r||r.type==="none"?{}:r.type==="bearer"?{Authorization:`Bearer ${r.token}`}:r.type==="header"?{[r.name]:r.value}:r.type==="custom"?await r.getHeaders():{}}function MD(r){const e=r.fetchImpl??globalThis.fetch;return{async request({method:t,path:n,query:s,body:i,headers:a}){const o=DD(r.baseUrl,n,s),l=await OD(r.auth),u=await e(o,{method:t,headers:{...i?{"Content-Type":"application/json"}:{},...l,...a},body:i?JSON.stringify(i):void 0}),c=await u.text(),d=(u.headers.get("content-type")||"").includes("application/json"),f=d&&c?JSON.parse(c):c;if(!u.ok){const h=d?f:void 0,g=h==null?void 0:h.error;throw new Ta((g==null?void 0:g.message)??`Request failed with status ${u.status}`,{status:u.status,icebergType:g==null?void 0:g.type,icebergCode:g==null?void 0:g.code,details:h})}return{status:u.status,headers:u.headers,data:f}}}}function Po(r){return r.join("")}var ND=class{constructor(r,e=""){this.client=r,this.prefix=e}async listNamespaces(r){const e=r?{parent:Po(r.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:e})).data.namespaces.map(n=>({namespace:n}))}async createNamespace(r,e){const t={namespace:r.namespace,properties:e==null?void 0:e.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:t})).data}async dropNamespace(r){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Po(r.namespace)}`})}async loadNamespaceMetadata(r){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Po(r.namespace)}`})).data.properties}}async namespaceExists(r){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Po(r.namespace)}`}),!0}catch(e){if(e instanceof Ta&&e.status===404)return!1;throw e}}async createNamespaceIfNotExists(r,e){try{return await this.createNamespace(r,e)}catch(t){if(t instanceof Ta&&t.status===409)return;throw t}}};function As(r){return r.join("")}var FD=class{constructor(r,e="",t){this.client=r,this.prefix=e,this.accessDelegation=t}async listTables(r){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${As(r.namespace)}/tables`})).data.identifiers}async createTable(r,e){const t={};return this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${As(r.namespace)}/tables`,body:e,headers:t})).data.metadata}async updateTable(r,e){const t=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${As(r.namespace)}/tables/${r.name}`,body:e});return{"metadata-location":t.data["metadata-location"],metadata:t.data.metadata}}async dropTable(r,e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${As(r.namespace)}/tables/${r.name}`,query:{purgeRequested:String((e==null?void 0:e.purge)??!1)}})}async loadTable(r){const e={};return this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${As(r.namespace)}/tables/${r.name}`,headers:e})).data.metadata}async tableExists(r){const e={};this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${As(r.namespace)}/tables/${r.name}`,headers:e}),!0}catch(t){if(t instanceof Ta&&t.status===404)return!1;throw t}}async createTableIfNotExists(r,e){try{return await this.createTable(r,e)}catch(t){if(t instanceof Ta&&t.status===409)return await this.loadTable({namespace:r.namespace,name:e.name});throw t}}},$D=class{constructor(r){var n;let e="v1";r.catalogName&&(e+=`/${r.catalogName}`);const t=r.baseUrl.endsWith("/")?r.baseUrl:`${r.baseUrl}/`;this.client=MD({baseUrl:t,auth:r.auth,fetchImpl:r.fetch}),this.accessDelegation=(n=r.accessDelegation)==null?void 0:n.join(","),this.namespaceOps=new ND(this.client,e),this.tableOps=new FD(this.client,e,this.accessDelegation)}async listNamespaces(r){return this.namespaceOps.listNamespaces(r)}async createNamespace(r,e){return this.namespaceOps.createNamespace(r,e)}async dropNamespace(r){await this.namespaceOps.dropNamespace(r)}async loadNamespaceMetadata(r){return this.namespaceOps.loadNamespaceMetadata(r)}async listTables(r){return this.tableOps.listTables(r)}async createTable(r,e){return this.tableOps.createTable(r,e)}async updateTable(r,e){return this.tableOps.updateTable(r,e)}async dropTable(r,e){await this.tableOps.dropTable(r,e)}async loadTable(r){return this.tableOps.loadTable(r)}async namespaceExists(r){return this.namespaceOps.namespaceExists(r)}async tableExists(r){return this.tableOps.tableExists(r)}async createNamespaceIfNotExists(r,e){return this.namespaceOps.createNamespaceIfNotExists(r,e)}async createTableIfNotExists(r,e){return this.tableOps.createTableIfNotExists(r,e)}},ou=class extends Error{constructor(r){super(r),this.__isStorageError=!0,this.name="StorageError"}};function Ue(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}var UD=class extends ou{constructor(r,e,t){super(r),this.name="StorageApiError",this.status=e,this.statusCode=t}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Hh=class extends ou{constructor(r,e){super(r),this.name="StorageUnknownError",this.originalError=e}};const Sp=r=>r?(...e)=>r(...e):(...e)=>fetch(...e),BD=()=>Response,Vh=r=>{if(Array.isArray(r))return r.map(t=>Vh(t));if(typeof r=="function"||r!==Object(r))return r;const e={};return Object.entries(r).forEach(([t,n])=>{const s=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[s]=Vh(n)}),e},jD=r=>{if(typeof r!="object"||r===null)return!1;const e=Object.getPrototypeOf(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},GD=r=>!r||typeof r!="string"||r.length===0||r.length>100||r.trim()!==r||r.includes("/")||r.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(r);function xa(r){"@babel/helpers - typeof";return xa=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xa(r)}function KD(r,e){if(xa(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e);if(xa(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function HD(r){var e=KD(r,"string");return xa(e)=="symbol"?e:e+""}function VD(r,e,t){return(e=HD(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Lv(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,n)}return t}function fe(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Lv(Object(t),!0).forEach(function(n){VD(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):Lv(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}const _c=r=>{var e;return r.msg||r.message||r.error_description||(typeof r.error=="string"?r.error:(e=r.error)===null||e===void 0?void 0:e.message)||JSON.stringify(r)},WD=async(r,e,t)=>{r instanceof await BD()&&!(t!=null&&t.noResolveJson)?r.json().then(n=>{const s=r.status||500,i=(n==null?void 0:n.statusCode)||s+"";e(new UD(_c(n),s,i))}).catch(n=>{e(new Hh(_c(n),n))}):e(new Hh(_c(r),r))},zD=(r,e,t,n)=>{const s={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"||!n?s:(jD(n)?(s.headers=fe({"Content-Type":"application/json"},e==null?void 0:e.headers),s.body=JSON.stringify(n)):s.body=n,e!=null&&e.duplex&&(s.duplex=e.duplex),fe(fe({},s),t))};async function Ha(r,e,t,n,s,i){return new Promise((a,o)=>{r(t,zD(e,n,s,i)).then(l=>{if(!l.ok)throw l;return n!=null&&n.noResolveJson?l:l.json()}).then(l=>a(l)).catch(l=>WD(l,o,n))})}async function Aa(r,e,t,n){return Ha(r,"GET",e,t,n)}async function Sr(r,e,t,n,s){return Ha(r,"POST",e,n,s,t)}async function Wh(r,e,t,n,s){return Ha(r,"PUT",e,n,s,t)}async function qD(r,e,t,n){return Ha(r,"HEAD",e,fe(fe({},t),{},{noResolveJson:!0}),n)}async function Ep(r,e,t,n,s){return Ha(r,"DELETE",e,n,s,t)}var YD=class{constructor(r,e){this.downloadFn=r,this.shouldThrowOnError=e}then(r,e){return this.execute().then(r,e)}async execute(){var r=this;try{return{data:(await r.downloadFn()).body,error:null}}catch(e){if(r.shouldThrowOnError)throw e;if(Ue(e))return{data:null,error:e};throw e}}};let pT;pT=Symbol.toStringTag;var ZD=class{constructor(r,e){this.downloadFn=r,this.shouldThrowOnError=e,this[pT]="BlobDownloadBuilder",this.promise=null}asStream(){return new YD(this.downloadFn,this.shouldThrowOnError)}then(r,e){return this.getPromise().then(r,e)}catch(r){return this.getPromise().catch(r)}finally(r){return this.getPromise().finally(r)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var r=this;try{return{data:await(await r.downloadFn()).blob(),error:null}}catch(e){if(r.shouldThrowOnError)throw e;if(Ue(e))return{data:null,error:e};throw e}}};const QD={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},kv={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var XD=class{constructor(r,e={},t,n){this.shouldThrowOnError=!1,this.url=r,this.headers=e,this.bucketId=t,this.fetch=Sp(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async uploadOrUpdate(r,e,t,n){var s=this;try{let i;const a=fe(fe({},kv),n);let o=fe(fe({},s.headers),r==="POST"&&{"x-upsert":String(a.upsert)});const l=a.metadata;typeof Blob<"u"&&t instanceof Blob?(i=new FormData,i.append("cacheControl",a.cacheControl),l&&i.append("metadata",s.encodeMetadata(l)),i.append("",t)):typeof FormData<"u"&&t instanceof FormData?(i=t,i.has("cacheControl")||i.append("cacheControl",a.cacheControl),l&&!i.has("metadata")&&i.append("metadata",s.encodeMetadata(l))):(i=t,o["cache-control"]=`max-age=${a.cacheControl}`,o["content-type"]=a.contentType,l&&(o["x-metadata"]=s.toBase64(s.encodeMetadata(l))),(typeof ReadableStream<"u"&&i instanceof ReadableStream||i&&typeof i=="object"&&"pipe"in i&&typeof i.pipe=="function")&&!a.duplex&&(a.duplex="half")),n!=null&&n.headers&&(o=fe(fe({},o),n.headers));const u=s._removeEmptyFolders(e),c=s._getFinalPath(u),d=await(r=="PUT"?Wh:Sr)(s.fetch,`${s.url}/object/${c}`,i,fe({headers:o},a!=null&&a.duplex?{duplex:a.duplex}:{}));return{data:{path:u,id:d.Id,fullPath:d.Key},error:null}}catch(i){if(s.shouldThrowOnError)throw i;if(Ue(i))return{data:null,error:i};throw i}}async upload(r,e,t){return this.uploadOrUpdate("POST",r,e,t)}async uploadToSignedUrl(r,e,t,n){var s=this;const i=s._removeEmptyFolders(r),a=s._getFinalPath(i),o=new URL(s.url+`/object/upload/sign/${a}`);o.searchParams.set("token",e);try{let l;const u=fe({upsert:kv.upsert},n),c=fe(fe({},s.headers),{"x-upsert":String(u.upsert)});return typeof Blob<"u"&&t instanceof Blob?(l=new FormData,l.append("cacheControl",u.cacheControl),l.append("",t)):typeof FormData<"u"&&t instanceof FormData?(l=t,l.append("cacheControl",u.cacheControl)):(l=t,c["cache-control"]=`max-age=${u.cacheControl}`,c["content-type"]=u.contentType),{data:{path:i,fullPath:(await Wh(s.fetch,o.toString(),l,{headers:c})).Key},error:null}}catch(l){if(s.shouldThrowOnError)throw l;if(Ue(l))return{data:null,error:l};throw l}}async createSignedUploadUrl(r,e){var t=this;try{let n=t._getFinalPath(r);const s=fe({},t.headers);e!=null&&e.upsert&&(s["x-upsert"]="true");const i=await Sr(t.fetch,`${t.url}/object/upload/sign/${n}`,{},{headers:s}),a=new URL(t.url+i.url),o=a.searchParams.get("token");if(!o)throw new ou("No token returned by API");return{data:{signedUrl:a.toString(),path:r,token:o},error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(Ue(n))return{data:null,error:n};throw n}}async update(r,e,t){return this.uploadOrUpdate("PUT",r,e,t)}async move(r,e,t){var n=this;try{return{data:await Sr(n.fetch,`${n.url}/object/move`,{bucketId:n.bucketId,sourceKey:r,destinationKey:e,destinationBucket:t==null?void 0:t.destinationBucket},{headers:n.headers}),error:null}}catch(s){if(n.shouldThrowOnError)throw s;if(Ue(s))return{data:null,error:s};throw s}}async copy(r,e,t){var n=this;try{return{data:{path:(await Sr(n.fetch,`${n.url}/object/copy`,{bucketId:n.bucketId,sourceKey:r,destinationKey:e,destinationBucket:t==null?void 0:t.destinationBucket},{headers:n.headers})).Key},error:null}}catch(s){if(n.shouldThrowOnError)throw s;if(Ue(s))return{data:null,error:s};throw s}}async createSignedUrl(r,e,t){var n=this;try{let s=n._getFinalPath(r),i=await Sr(n.fetch,`${n.url}/object/sign/${s}`,fe({expiresIn:e},t!=null&&t.transform?{transform:t.transform}:{}),{headers:n.headers});const a=t!=null&&t.download?`&download=${t.download===!0?"":t.download}`:"";return i={signedUrl:encodeURI(`${n.url}${i.signedURL}${a}`)},{data:i,error:null}}catch(s){if(n.shouldThrowOnError)throw s;if(Ue(s))return{data:null,error:s};throw s}}async createSignedUrls(r,e,t){var n=this;try{const s=await Sr(n.fetch,`${n.url}/object/sign/${n.bucketId}`,{expiresIn:e,paths:r},{headers:n.headers}),i=t!=null&&t.download?`&download=${t.download===!0?"":t.download}`:"";return{data:s.map(a=>fe(fe({},a),{},{signedUrl:a.signedURL?encodeURI(`${n.url}${a.signedURL}${i}`):null})),error:null}}catch(s){if(n.shouldThrowOnError)throw s;if(Ue(s))return{data:null,error:s};throw s}}download(r,e){const t=typeof(e==null?void 0:e.transform)<"u"?"render/image/authenticated":"object",n=this.transformOptsToQueryString((e==null?void 0:e.transform)||{}),s=n?`?${n}`:"",i=this._getFinalPath(r),a=()=>Aa(this.fetch,`${this.url}/${t}/${i}${s}`,{headers:this.headers,noResolveJson:!0});return new ZD(a,this.shouldThrowOnError)}async info(r){var e=this;const t=e._getFinalPath(r);try{return{data:Vh(await Aa(e.fetch,`${e.url}/object/info/${t}`,{headers:e.headers})),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Ue(n))return{data:null,error:n};throw n}}async exists(r){var e=this;const t=e._getFinalPath(r);try{return await qD(e.fetch,`${e.url}/object/${t}`,{headers:e.headers}),{data:!0,error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Ue(n)&&n instanceof Hh){const s=n.originalError;if([400,404].includes(s==null?void 0:s.status))return{data:!1,error:n}}throw n}}getPublicUrl(r,e){const t=this._getFinalPath(r),n=[],s=e!=null&&e.download?`download=${e.download===!0?"":e.download}`:"";s!==""&&n.push(s);const i=typeof(e==null?void 0:e.transform)<"u"?"render/image":"object",a=this.transformOptsToQueryString((e==null?void 0:e.transform)||{});a!==""&&n.push(a);let o=n.join("&");return o!==""&&(o=`?${o}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${t}${o}`)}}}async remove(r){var e=this;try{return{data:await Ep(e.fetch,`${e.url}/object/${e.bucketId}`,{prefixes:r},{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Ue(t))return{data:null,error:t};throw t}}async list(r,e,t){var n=this;try{const s=fe(fe(fe({},QD),e),{},{prefix:r||""});return{data:await Sr(n.fetch,`${n.url}/object/list/${n.bucketId}`,s,{headers:n.headers},t),error:null}}catch(s){if(n.shouldThrowOnError)throw s;if(Ue(s))return{data:null,error:s};throw s}}async listV2(r,e){var t=this;try{const n=fe({},r);return{data:await Sr(t.fetch,`${t.url}/object/list-v2/${t.bucketId}`,n,{headers:t.headers},e),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(Ue(n))return{data:null,error:n};throw n}}encodeMetadata(r){return JSON.stringify(r)}toBase64(r){return typeof Buffer<"u"?Buffer.from(r).toString("base64"):btoa(r)}_getFinalPath(r){return`${this.bucketId}/${r.replace(/^\/+/,"")}`}_removeEmptyFolders(r){return r.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(r){const e=[];return r.width&&e.push(`width=${r.width}`),r.height&&e.push(`height=${r.height}`),r.resize&&e.push(`resize=${r.resize}`),r.format&&e.push(`format=${r.format}`),r.quality&&e.push(`quality=${r.quality}`),e.join("&")}};const mT="2.89.0",vT={"X-Client-Info":`storage-js/${mT}`};var JD=class{constructor(r,e={},t,n){this.shouldThrowOnError=!1;const s=new URL(r);n!=null&&n.useNewHostname&&/supabase\.(co|in|red)$/.test(s.hostname)&&!s.hostname.includes("storage.supabase.")&&(s.hostname=s.hostname.replace("supabase.","storage.supabase.")),this.url=s.href.replace(/\/$/,""),this.headers=fe(fe({},vT),e),this.fetch=Sp(t)}throwOnError(){return this.shouldThrowOnError=!0,this}async listBuckets(r){var e=this;try{const t=e.listBucketOptionsToQueryString(r);return{data:await Aa(e.fetch,`${e.url}/bucket${t}`,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Ue(t))return{data:null,error:t};throw t}}async getBucket(r){var e=this;try{return{data:await Aa(e.fetch,`${e.url}/bucket/${r}`,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Ue(t))return{data:null,error:t};throw t}}async createBucket(r,e={public:!1}){var t=this;try{return{data:await Sr(t.fetch,`${t.url}/bucket`,{id:r,name:r,type:e.type,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(Ue(n))return{data:null,error:n};throw n}}async updateBucket(r,e){var t=this;try{return{data:await Wh(t.fetch,`${t.url}/bucket/${r}`,{id:r,name:r,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(Ue(n))return{data:null,error:n};throw n}}async emptyBucket(r){var e=this;try{return{data:await Sr(e.fetch,`${e.url}/bucket/${r}/empty`,{},{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Ue(t))return{data:null,error:t};throw t}}async deleteBucket(r){var e=this;try{return{data:await Ep(e.fetch,`${e.url}/bucket/${r}`,{},{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Ue(t))return{data:null,error:t};throw t}}listBucketOptionsToQueryString(r){const e={};return r&&("limit"in r&&(e.limit=String(r.limit)),"offset"in r&&(e.offset=String(r.offset)),r.search&&(e.search=r.search),r.sortColumn&&(e.sortColumn=r.sortColumn),r.sortOrder&&(e.sortOrder=r.sortOrder)),Object.keys(e).length>0?"?"+new URLSearchParams(e).toString():""}},eO=class{constructor(r,e={},t){this.shouldThrowOnError=!1,this.url=r.replace(/\/$/,""),this.headers=fe(fe({},vT),e),this.fetch=Sp(t)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(r){var e=this;try{return{data:await Sr(e.fetch,`${e.url}/bucket`,{name:r},{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Ue(t))return{data:null,error:t};throw t}}async listBuckets(r){var e=this;try{const t=new URLSearchParams;(r==null?void 0:r.limit)!==void 0&&t.set("limit",r.limit.toString()),(r==null?void 0:r.offset)!==void 0&&t.set("offset",r.offset.toString()),r!=null&&r.sortColumn&&t.set("sortColumn",r.sortColumn),r!=null&&r.sortOrder&&t.set("sortOrder",r.sortOrder),r!=null&&r.search&&t.set("search",r.search);const n=t.toString(),s=n?`${e.url}/bucket?${n}`:`${e.url}/bucket`;return{data:await Aa(e.fetch,s,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Ue(t))return{data:null,error:t};throw t}}async deleteBucket(r){var e=this;try{return{data:await Ep(e.fetch,`${e.url}/bucket/${r}`,{},{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Ue(t))return{data:null,error:t};throw t}}from(r){var e=this;if(!GD(r))throw new ou("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const t=new $D({baseUrl:this.url,catalogName:r,auth:{type:"custom",getHeaders:async()=>e.headers},fetch:this.fetch}),n=this.shouldThrowOnError;return new Proxy(t,{get(s,i){const a=s[i];return typeof a!="function"?a:async(...o)=>{try{return{data:await a.apply(s,o),error:null}}catch(l){if(n)throw l;return{data:null,error:l}}}}})}};const _p={"X-Client-Info":`storage-js/${mT}`,"Content-Type":"application/json"};var yT=class extends Error{constructor(r){super(r),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}};function Zt(r){return typeof r=="object"&&r!==null&&"__isStorageVectorsError"in r}var Tc=class extends yT{constructor(r,e,t){super(r),this.name="StorageVectorsApiError",this.status=e,this.statusCode=t}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},tO=class extends yT{constructor(r,e){super(r),this.name="StorageVectorsUnknownError",this.originalError=e}};const Tp=r=>r?(...e)=>r(...e):(...e)=>fetch(...e),rO=r=>{if(typeof r!="object"||r===null)return!1;const e=Object.getPrototypeOf(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},Cv=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),nO=async(r,e,t)=>{if(r&&typeof r=="object"&&"status"in r&&"ok"in r&&typeof r.status=="number"&&!(t!=null&&t.noResolveJson)){const n=r.status||500,s=r;if(typeof s.json=="function")s.json().then(i=>{const a=(i==null?void 0:i.statusCode)||(i==null?void 0:i.code)||n+"";e(new Tc(Cv(i),n,a))}).catch(()=>{const i=n+"";e(new Tc(s.statusText||`HTTP ${n} error`,n,i))});else{const i=n+"";e(new Tc(s.statusText||`HTTP ${n} error`,n,i))}}else e(new tO(Cv(r),r))},sO=(r,e,t,n)=>{const s={method:r,headers:(e==null?void 0:e.headers)||{}};return n?(rO(n)?(s.headers=fe({"Content-Type":"application/json"},e==null?void 0:e.headers),s.body=JSON.stringify(n)):s.body=n,fe(fe({},s),t)):s};async function iO(r,e,t,n,s,i){return new Promise((a,o)=>{r(t,sO(e,n,s,i)).then(l=>{if(!l.ok)throw l;if(n!=null&&n.noResolveJson)return l;const u=l.headers.get("content-type");return!u||!u.includes("application/json")?{}:l.json()}).then(l=>a(l)).catch(l=>nO(l,o,n))})}async function Qt(r,e,t,n,s){return iO(r,"POST",e,n,s,t)}var aO=class{constructor(r,e={},t){this.shouldThrowOnError=!1,this.url=r.replace(/\/$/,""),this.headers=fe(fe({},_p),e),this.fetch=Tp(t)}throwOnError(){return this.shouldThrowOnError=!0,this}async createIndex(r){var e=this;try{return{data:await Qt(e.fetch,`${e.url}/CreateIndex`,r,{headers:e.headers})||{},error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Zt(t))return{data:null,error:t};throw t}}async getIndex(r,e){var t=this;try{return{data:await Qt(t.fetch,`${t.url}/GetIndex`,{vectorBucketName:r,indexName:e},{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(Zt(n))return{data:null,error:n};throw n}}async listIndexes(r){var e=this;try{return{data:await Qt(e.fetch,`${e.url}/ListIndexes`,r,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Zt(t))return{data:null,error:t};throw t}}async deleteIndex(r,e){var t=this;try{return{data:await Qt(t.fetch,`${t.url}/DeleteIndex`,{vectorBucketName:r,indexName:e},{headers:t.headers})||{},error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(Zt(n))return{data:null,error:n};throw n}}},oO=class{constructor(r,e={},t){this.shouldThrowOnError=!1,this.url=r.replace(/\/$/,""),this.headers=fe(fe({},_p),e),this.fetch=Tp(t)}throwOnError(){return this.shouldThrowOnError=!0,this}async putVectors(r){var e=this;try{if(r.vectors.length<1||r.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:await Qt(e.fetch,`${e.url}/PutVectors`,r,{headers:e.headers})||{},error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Zt(t))return{data:null,error:t};throw t}}async getVectors(r){var e=this;try{return{data:await Qt(e.fetch,`${e.url}/GetVectors`,r,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Zt(t))return{data:null,error:t};throw t}}async listVectors(r){var e=this;try{if(r.segmentCount!==void 0){if(r.segmentCount<1||r.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(r.segmentIndex!==void 0&&(r.segmentIndex<0||r.segmentIndex>=r.segmentCount))throw new Error(`segmentIndex must be between 0 and ${r.segmentCount-1}`)}return{data:await Qt(e.fetch,`${e.url}/ListVectors`,r,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Zt(t))return{data:null,error:t};throw t}}async queryVectors(r){var e=this;try{return{data:await Qt(e.fetch,`${e.url}/QueryVectors`,r,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Zt(t))return{data:null,error:t};throw t}}async deleteVectors(r){var e=this;try{if(r.keys.length<1||r.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:await Qt(e.fetch,`${e.url}/DeleteVectors`,r,{headers:e.headers})||{},error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Zt(t))return{data:null,error:t};throw t}}},lO=class{constructor(r,e={},t){this.shouldThrowOnError=!1,this.url=r.replace(/\/$/,""),this.headers=fe(fe({},_p),e),this.fetch=Tp(t)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(r){var e=this;try{return{data:await Qt(e.fetch,`${e.url}/CreateVectorBucket`,{vectorBucketName:r},{headers:e.headers})||{},error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Zt(t))return{data:null,error:t};throw t}}async getBucket(r){var e=this;try{return{data:await Qt(e.fetch,`${e.url}/GetVectorBucket`,{vectorBucketName:r},{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Zt(t))return{data:null,error:t};throw t}}async listBuckets(r={}){var e=this;try{return{data:await Qt(e.fetch,`${e.url}/ListVectorBuckets`,r,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Zt(t))return{data:null,error:t};throw t}}async deleteBucket(r){var e=this;try{return{data:await Qt(e.fetch,`${e.url}/DeleteVectorBucket`,{vectorBucketName:r},{headers:e.headers})||{},error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Zt(t))return{data:null,error:t};throw t}}},uO=class extends lO{constructor(r,e={}){super(r,e.headers||{},e.fetch)}from(r){return new cO(this.url,this.headers,r,this.fetch)}async createBucket(r){var e=()=>super.createBucket,t=this;return e().call(t,r)}async getBucket(r){var e=()=>super.getBucket,t=this;return e().call(t,r)}async listBuckets(r={}){var e=()=>super.listBuckets,t=this;return e().call(t,r)}async deleteBucket(r){var e=()=>super.deleteBucket,t=this;return e().call(t,r)}},cO=class extends aO{constructor(r,e,t,n){super(r,e,n),this.vectorBucketName=t}async createIndex(r){var e=()=>super.createIndex,t=this;return e().call(t,fe(fe({},r),{},{vectorBucketName:t.vectorBucketName}))}async listIndexes(r={}){var e=()=>super.listIndexes,t=this;return e().call(t,fe(fe({},r),{},{vectorBucketName:t.vectorBucketName}))}async getIndex(r){var e=()=>super.getIndex,t=this;return e().call(t,t.vectorBucketName,r)}async deleteIndex(r){var e=()=>super.deleteIndex,t=this;return e().call(t,t.vectorBucketName,r)}index(r){return new dO(this.url,this.headers,this.vectorBucketName,r,this.fetch)}},dO=class extends oO{constructor(r,e,t,n,s){super(r,e,s),this.vectorBucketName=t,this.indexName=n}async putVectors(r){var e=()=>super.putVectors,t=this;return e().call(t,fe(fe({},r),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async getVectors(r){var e=()=>super.getVectors,t=this;return e().call(t,fe(fe({},r),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async listVectors(r={}){var e=()=>super.listVectors,t=this;return e().call(t,fe(fe({},r),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async queryVectors(r){var e=()=>super.queryVectors,t=this;return e().call(t,fe(fe({},r),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async deleteVectors(r){var e=()=>super.deleteVectors,t=this;return e().call(t,fe(fe({},r),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}},fO=class extends JD{constructor(r,e={},t,n){super(r,e,t,n)}from(r){return new XD(this.url,this.headers,r,this.fetch)}get vectors(){return new uO(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new eO(this.url+"/iceberg",this.headers,this.fetch)}};const ST="2.89.0",Ds=30*1e3,zh=3,xc=zh*Ds,hO="http://localhost:9999",gO="supabase.auth.token",pO={"X-Client-Info":`gotrue-js/${ST}`},qh="X-Supabase-Api-Version",ET={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},mO=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,vO=10*60*1e3;class wa extends Error{constructor(e,t,n){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=n}}function ae(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}class yO extends wa{constructor(e,t,n){super(e,t,n),this.name="AuthApiError",this.status=t,this.code=n}}function SO(r){return ae(r)&&r.name==="AuthApiError"}class Qn extends wa{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class nn extends wa{constructor(e,t,n,s){super(e,n,s),this.name=t,this.status=n}}class Vt extends nn{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function EO(r){return ae(r)&&r.name==="AuthSessionMissingError"}class ws extends nn{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Do extends nn{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Oo extends nn{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function _O(r){return ae(r)&&r.name==="AuthImplicitGrantRedirectError"}class Pv extends nn{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class TO extends nn{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class Yh extends nn{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Ac(r){return ae(r)&&r.name==="AuthRetryableFetchError"}class Dv extends nn{constructor(e,t,n){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=n}}class Zh extends nn{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Fl="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Ov=` 	
\r=`.split(""),xO=(()=>{const r=new Array(128);for(let e=0;e<r.length;e+=1)r[e]=-1;for(let e=0;e<Ov.length;e+=1)r[Ov[e].charCodeAt(0)]=-2;for(let e=0;e<Fl.length;e+=1)r[Fl[e].charCodeAt(0)]=e;return r})();function Mv(r,e,t){if(r!==null)for(e.queue=e.queue<<8|r,e.queuedBits+=8;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;t(Fl[n]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;t(Fl[n]),e.queuedBits-=6}}function _T(r,e,t){const n=xO[r];if(n>-1)for(e.queue=e.queue<<6|n,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(r)}"`)}}function Nv(r){const e=[],t=a=>{e.push(String.fromCodePoint(a))},n={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},i=a=>{IO(a,n,t)};for(let a=0;a<r.length;a+=1)_T(r.charCodeAt(a),s,i);return e.join("")}function AO(r,e){if(r<=127){e(r);return}else if(r<=2047){e(192|r>>6),e(128|r&63);return}else if(r<=65535){e(224|r>>12),e(128|r>>6&63),e(128|r&63);return}else if(r<=1114111){e(240|r>>18),e(128|r>>12&63),e(128|r>>6&63),e(128|r&63);return}throw new Error(`Unrecognized Unicode codepoint: ${r.toString(16)}`)}function wO(r,e){for(let t=0;t<r.length;t+=1){let n=r.charCodeAt(t);if(n>55295&&n<=56319){const s=(n-55296)*1024&65535;n=(r.charCodeAt(t+1)-56320&65535|s)+65536,t+=1}AO(n,e)}}function IO(r,e,t){if(e.utf8seq===0){if(r<=127){t(r);return}for(let n=1;n<6;n+=1)if(!(r>>7-n&1)){e.utf8seq=n;break}if(e.utf8seq===2)e.codepoint=r&31;else if(e.utf8seq===3)e.codepoint=r&15;else if(e.utf8seq===4)e.codepoint=r&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(r<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|r&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function ii(r){const e=[],t={queue:0,queuedBits:0},n=s=>{e.push(s)};for(let s=0;s<r.length;s+=1)_T(r.charCodeAt(s),t,n);return new Uint8Array(e)}function bO(r){const e=[];return wO(r,t=>e.push(t)),new Uint8Array(e)}function ts(r){const e=[],t={queue:0,queuedBits:0},n=s=>{e.push(s)};return r.forEach(s=>Mv(s,t,n)),Mv(null,t,n),e.join("")}function RO(r){return Math.round(Date.now()/1e3)+r}function LO(){return Symbol("auth-callback")}const lt=()=>typeof window<"u"&&typeof document<"u",Hn={tested:!1,writable:!1},TT=()=>{if(!lt())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Hn.tested)return Hn.writable;const r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),Hn.tested=!0,Hn.writable=!0}catch{Hn.tested=!0,Hn.writable=!1}return Hn.writable};function kO(r){const e={},t=new URL(r);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((s,i)=>{e[i]=s})}catch{}return t.searchParams.forEach((n,s)=>{e[s]=n}),e}const xT=r=>r?(...e)=>r(...e):(...e)=>fetch(...e),CO=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",Os=async(r,e,t)=>{await r.setItem(e,JSON.stringify(t))},Vn=async(r,e)=>{const t=await r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},ot=async(r,e)=>{await r.removeItem(e)};class lu{constructor(){this.promise=new lu.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}lu.promiseConstructor=Promise;function wc(r){const e=r.split(".");if(e.length!==3)throw new Zh("Invalid JWT structure");for(let n=0;n<e.length;n++)if(!mO.test(e[n]))throw new Zh("JWT not in base64url format");return{header:JSON.parse(Nv(e[0])),payload:JSON.parse(Nv(e[1])),signature:ii(e[2]),raw:{header:e[0],payload:e[1]}}}async function PO(r){return await new Promise(e=>{setTimeout(()=>e(null),r)})}function DO(r,e){return new Promise((n,s)=>{(async()=>{for(let i=0;i<1/0;i++)try{const a=await r(i);if(!e(i,null,a)){n(a);return}}catch(a){if(!e(i,a)){s(a);return}}})()})}function OO(r){return("0"+r.toString(16)).substr(-2)}function MO(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=t.length;let s="";for(let i=0;i<56;i++)s+=t.charAt(Math.floor(Math.random()*n));return s}return crypto.getRandomValues(e),Array.from(e,OO).join("")}async function NO(r){const t=new TextEncoder().encode(r),n=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(n);return Array.from(s).map(i=>String.fromCharCode(i)).join("")}async function FO(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;const t=await NO(r);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Is(r,e,t=!1){const n=MO();let s=n;t&&(s+="/PASSWORD_RECOVERY"),await Os(r,`${e}-code-verifier`,s);const i=await FO(n);return[i,n===i?"plain":"s256"]}const $O=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function UO(r){const e=r.headers.get(qh);if(!e||!e.match($O))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function BO(r){if(!r)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(r<=e)throw new Error("JWT has expired")}function jO(r){switch(r){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const GO=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function bs(r){if(!GO.test(r))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Ic(){const r={};return new Proxy(r,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const n=t.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function KO(r,e){return new Proxy(r,{get:(t,n,s)=>{if(n==="__isInsecureUserWarningProxy")return!0;if(typeof n=="symbol"){const i=n.toString();if(i==="Symbol(Symbol.toPrimitive)"||i==="Symbol(Symbol.toStringTag)"||i==="Symbol(util.inspect.custom)"||i==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(t,n,s)}return!e.value&&typeof n=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(t,n,s)}})}function Fv(r){return JSON.parse(JSON.stringify(r))}const Yn=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),HO=[502,503,504];async function $v(r){var e;if(!CO(r))throw new Yh(Yn(r),0);if(HO.includes(r.status))throw new Yh(Yn(r),r.status);let t;try{t=await r.json()}catch(i){throw new Qn(Yn(i),i)}let n;const s=UO(r);if(s&&s.getTime()>=ET["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?n=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(n=t.error_code),n){if(n==="weak_password")throw new Dv(Yn(t),r.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(n==="session_not_found")throw new Vt}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,a)=>i&&typeof a=="string",!0))throw new Dv(Yn(t),r.status,t.weak_password.reasons);throw new yO(Yn(t),r.status||500,n)}const VO=(r,e,t,n)=>{const s={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),s.body=JSON.stringify(n),Object.assign(Object.assign({},s),t))};async function de(r,e,t,n){var s;const i=Object.assign({},n==null?void 0:n.headers);i[qh]||(i[qh]=ET["2024-01-01"].name),n!=null&&n.jwt&&(i.Authorization=`Bearer ${n.jwt}`);const a=(s=n==null?void 0:n.query)!==null&&s!==void 0?s:{};n!=null&&n.redirectTo&&(a.redirect_to=n.redirectTo);const o=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",l=await WO(r,e,t+o,{headers:i,noResolveJson:n==null?void 0:n.noResolveJson},{},n==null?void 0:n.body);return n!=null&&n.xform?n==null?void 0:n.xform(l):{data:Object.assign({},l),error:null}}async function WO(r,e,t,n,s,i){const a=VO(e,n,s,i);let o;try{o=await r(t,Object.assign({},a))}catch(l){throw console.error(l),new Yh(Yn(l),0)}if(o.ok||await $v(o),n!=null&&n.noResolveJson)return o;try{return await o.json()}catch(l){await $v(l)}}function mr(r){var e;let t=null;YO(r)&&(t=Object.assign({},r),r.expires_at||(t.expires_at=RO(r.expires_in)));const n=(e=r.user)!==null&&e!==void 0?e:r;return{data:{session:t,user:n},error:null}}function Uv(r){const e=mr(r);return!e.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((t,n)=>t&&typeof n=="string",!0)&&(e.data.weak_password=r.weak_password),e}function En(r){var e;return{data:{user:(e=r.user)!==null&&e!==void 0?e:r},error:null}}function zO(r){return{data:r,error:null}}function qO(r){const{action_link:e,email_otp:t,hashed_token:n,redirect_to:s,verification_type:i}=r,a=au(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:e,email_otp:t,hashed_token:n,redirect_to:s,verification_type:i},l=Object.assign({},a);return{data:{properties:o,user:l},error:null}}function Bv(r){return r}function YO(r){return r.access_token&&r.refresh_token&&r.expires_in}const bc=["global","local","others"];class ZO{constructor({url:e="",headers:t={},fetch:n}){this.url=e,this.headers=t,this.fetch=xT(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,t=bc[0]){if(bc.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${bc.join(", ")}`);try{return await de(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if(ae(n))return{data:null,error:n};throw n}}async inviteUserByEmail(e,t={}){try{return await de(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:En})}catch(n){if(ae(n))return{data:{user:null},error:n};throw n}}async generateLink(e){try{const{options:t}=e,n=au(e,["options"]),s=Object.assign(Object.assign({},n),t);return"newEmail"in n&&(s.new_email=n==null?void 0:n.newEmail,delete s.newEmail),await de(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:qO,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(ae(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await de(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:En})}catch(t){if(ae(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,n,s,i,a,o,l;try{const u={nextPage:null,lastPage:0,total:0},c=await de(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:"",per_page:(i=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:Bv});if(c.error)throw c.error;const d=await c.json(),f=(a=c.headers.get("x-total-count"))!==null&&a!==void 0?a:0,h=(l=(o=c.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&l!==void 0?l:[];return h.length>0&&(h.forEach(g=>{const p=parseInt(g.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(g.split(";")[1].split("=")[1]);u[`${v}Page`]=p}),u.total=parseInt(f)),{data:Object.assign(Object.assign({},d),u),error:null}}catch(u){if(ae(u))return{data:{users:[]},error:u};throw u}}async getUserById(e){bs(e);try{return await de(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:En})}catch(t){if(ae(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){bs(e);try{return await de(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:En})}catch(n){if(ae(n))return{data:{user:null},error:n};throw n}}async deleteUser(e,t=!1){bs(e);try{return await de(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:En})}catch(n){if(ae(n))return{data:{user:null},error:n};throw n}}async _listFactors(e){bs(e.userId);try{const{data:t,error:n}=await de(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:t,error:n}}catch(t){if(ae(t))return{data:null,error:t};throw t}}async _deleteFactor(e){bs(e.userId),bs(e.id);try{return{data:await de(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(ae(t))return{data:null,error:t};throw t}}async _listOAuthClients(e){var t,n,s,i,a,o,l;try{const u={nextPage:null,lastPage:0,total:0},c=await de(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:"",per_page:(i=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:Bv});if(c.error)throw c.error;const d=await c.json(),f=(a=c.headers.get("x-total-count"))!==null&&a!==void 0?a:0,h=(l=(o=c.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&l!==void 0?l:[];return h.length>0&&(h.forEach(g=>{const p=parseInt(g.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(g.split(";")[1].split("=")[1]);u[`${v}Page`]=p}),u.total=parseInt(f)),{data:Object.assign(Object.assign({},d),u),error:null}}catch(u){if(ae(u))return{data:{clients:[]},error:u};throw u}}async _createOAuthClient(e){try{return await de(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(ae(t))return{data:null,error:t};throw t}}async _getOAuthClient(e){try{return await de(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(ae(t))return{data:null,error:t};throw t}}async _updateOAuthClient(e,t){try{return await de(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:t,headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(ae(n))return{data:null,error:n};throw n}}async _deleteOAuthClient(e){try{return await de(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(t){if(ae(t))return{data:null,error:t};throw t}}async _regenerateOAuthClientSecret(e){try{return await de(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(ae(t))return{data:null,error:t};throw t}}}function jv(r={}){return{getItem:e=>r[e]||null,setItem:(e,t)=>{r[e]=t},removeItem:e=>{delete r[e]}}}const Rs={debug:!!(globalThis&&TT()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class AT extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class QO extends AT{}async function XO(r,e,t){Rs.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,e);const n=new globalThis.AbortController;return e>0&&setTimeout(()=>{n.abort(),Rs.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(r,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async s=>{if(s){Rs.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,s.name);try{return await t()}finally{Rs.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,s.name)}}else{if(e===0)throw Rs.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new QO(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(Rs.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}function JO(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function wT(r){if(!/^0x[a-fA-F0-9]{40}$/.test(r))throw new Error(`@supabase/auth-js: Address "${r}" is invalid.`);return r.toLowerCase()}function e2(r){return parseInt(r,16)}function t2(r){const e=new TextEncoder().encode(r);return"0x"+Array.from(e,n=>n.toString(16).padStart(2,"0")).join("")}function r2(r){var e;const{chainId:t,domain:n,expirationTime:s,issuedAt:i=new Date,nonce:a,notBefore:o,requestId:l,resources:u,scheme:c,uri:d,version:f}=r;{if(!Number.isInteger(t))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${t}`);if(!n)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(a&&a.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${a}`);if(!d)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(f!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${f}`);if(!((e=r.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${r.statement}`)}const h=wT(r.address),g=c?`${c}://${n}`:n,p=r.statement?`${r.statement}
`:"",v=`${g} wants you to sign in with your Ethereum account:
${h}

${p}`;let m=`URI: ${d}
Version: ${f}
Chain ID: ${t}${a?`
Nonce: ${a}`:""}
Issued At: ${i.toISOString()}`;if(s&&(m+=`
Expiration Time: ${s.toISOString()}`),o&&(m+=`
Not Before: ${o.toISOString()}`),l&&(m+=`
Request ID: ${l}`),u){let y=`
Resources:`;for(const S of u){if(!S||typeof S!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${S}`);y+=`
- ${S}`}m+=y}return`${v}
${m}`}class Ze extends Error{constructor({message:e,code:t,cause:n,name:s}){var i;super(e,{cause:n}),this.__isWebAuthnError=!0,this.name=(i=s??(n instanceof Error?n.name:void 0))!==null&&i!==void 0?i:"Unknown Error",this.code=t}}class $l extends Ze{constructor(e,t){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t,message:e}),this.name="WebAuthnUnknownError",this.originalError=t}}function n2({error:r,options:e}){var t,n,s;const{publicKey:i}=e;if(!i)throw Error("options was missing required publicKey property");if(r.name==="AbortError"){if(e.signal instanceof AbortSignal)return new Ze({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:r})}else if(r.name==="ConstraintError"){if(((t=i.authenticatorSelection)===null||t===void 0?void 0:t.requireResidentKey)===!0)return new Ze({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:r});if(e.mediation==="conditional"&&((n=i.authenticatorSelection)===null||n===void 0?void 0:n.userVerification)==="required")return new Ze({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:r});if(((s=i.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new Ze({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:r})}else{if(r.name==="InvalidStateError")return new Ze({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:r});if(r.name==="NotAllowedError")return new Ze({message:r.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r});if(r.name==="NotSupportedError")return i.pubKeyCredParams.filter(o=>o.type==="public-key").length===0?new Ze({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:r}):new Ze({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:r});if(r.name==="SecurityError"){const a=window.location.hostname;if(IT(a)){if(i.rp.id!==a)return new Ze({message:`The RP ID "${i.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:r})}else return new Ze({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:r})}else if(r.name==="TypeError"){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new Ze({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:r})}else if(r.name==="UnknownError")return new Ze({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:r})}return new Ze({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r})}function s2({error:r,options:e}){const{publicKey:t}=e;if(!t)throw Error("options was missing required publicKey property");if(r.name==="AbortError"){if(e.signal instanceof AbortSignal)return new Ze({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:r})}else{if(r.name==="NotAllowedError")return new Ze({message:r.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r});if(r.name==="SecurityError"){const n=window.location.hostname;if(IT(n)){if(t.rpId!==n)return new Ze({message:`The RP ID "${t.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:r})}else return new Ze({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:r})}else if(r.name==="UnknownError")return new Ze({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:r})}return new Ze({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r})}class i2{createNewAbortSignal(){if(this.controller){const t=new Error("Cancelling existing WebAuthn API call for new one");t.name="AbortError",this.controller.abort(t)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const a2=new i2;function o2(r){if(!r)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(r);const{challenge:e,user:t,excludeCredentials:n}=r,s=au(r,["challenge","user","excludeCredentials"]),i=ii(e).buffer,a=Object.assign(Object.assign({},t),{id:ii(t.id).buffer}),o=Object.assign(Object.assign({},s),{challenge:i,user:a});if(n&&n.length>0){o.excludeCredentials=new Array(n.length);for(let l=0;l<n.length;l++){const u=n[l];o.excludeCredentials[l]=Object.assign(Object.assign({},u),{id:ii(u.id).buffer,type:u.type||"public-key",transports:u.transports})}}return o}function l2(r){if(!r)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(r);const{challenge:e,allowCredentials:t}=r,n=au(r,["challenge","allowCredentials"]),s=ii(e).buffer,i=Object.assign(Object.assign({},n),{challenge:s});if(t&&t.length>0){i.allowCredentials=new Array(t.length);for(let a=0;a<t.length;a++){const o=t[a];i.allowCredentials[a]=Object.assign(Object.assign({},o),{id:ii(o.id).buffer,type:o.type||"public-key",transports:o.transports})}}return i}function u2(r){var e;if("toJSON"in r&&typeof r.toJSON=="function")return r.toJSON();const t=r;return{id:r.id,rawId:r.id,response:{attestationObject:ts(new Uint8Array(r.response.attestationObject)),clientDataJSON:ts(new Uint8Array(r.response.clientDataJSON))},type:"public-key",clientExtensionResults:r.getClientExtensionResults(),authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function c2(r){var e;if("toJSON"in r&&typeof r.toJSON=="function")return r.toJSON();const t=r,n=r.getClientExtensionResults(),s=r.response;return{id:r.id,rawId:r.id,response:{authenticatorData:ts(new Uint8Array(s.authenticatorData)),clientDataJSON:ts(new Uint8Array(s.clientDataJSON)),signature:ts(new Uint8Array(s.signature)),userHandle:s.userHandle?ts(new Uint8Array(s.userHandle)):void 0},type:"public-key",clientExtensionResults:n,authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function IT(r){return r==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(r)}function Gv(){var r,e;return!!(lt()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((r=navigator==null?void 0:navigator.credentials)===null||r===void 0?void 0:r.create)=="function"&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.get)=="function")}async function d2(r){try{const e=await navigator.credentials.create(r);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new $l("Browser returned unexpected credential type",e)}:{data:null,error:new $l("Empty credential response",e)}}catch(e){return{data:null,error:n2({error:e,options:r})}}}async function f2(r){try{const e=await navigator.credentials.get(r);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new $l("Browser returned unexpected credential type",e)}:{data:null,error:new $l("Empty credential response",e)}}catch(e){return{data:null,error:s2({error:e,options:r})}}}const h2={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},g2={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function Ul(...r){const e=s=>s!==null&&typeof s=="object"&&!Array.isArray(s),t=s=>s instanceof ArrayBuffer||ArrayBuffer.isView(s),n={};for(const s of r)if(s)for(const i in s){const a=s[i];if(a!==void 0)if(Array.isArray(a))n[i]=a;else if(t(a))n[i]=a;else if(e(a)){const o=n[i];e(o)?n[i]=Ul(o,a):n[i]=Ul(a)}else n[i]=a}return n}function p2(r,e){return Ul(h2,r,e||{})}function m2(r,e){return Ul(g2,r,e||{})}class v2{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:t,friendlyName:n,signal:s},i){try{const{data:a,error:o}=await this.client.mfa.challenge({factorId:e,webauthn:t});if(!a)return{data:null,error:o};const l=s??a2.createNewAbortSignal();if(a.webauthn.type==="create"){const{user:u}=a.webauthn.credential_options.publicKey;u.name||(u.name=`${u.id}:${n}`),u.displayName||(u.displayName=u.name)}switch(a.webauthn.type){case"create":{const u=p2(a.webauthn.credential_options.publicKey,i==null?void 0:i.create),{data:c,error:d}=await d2({publicKey:u,signal:l});return c?{data:{factorId:e,challengeId:a.id,webauthn:{type:a.webauthn.type,credential_response:c}},error:null}:{data:null,error:d}}case"request":{const u=m2(a.webauthn.credential_options.publicKey,i==null?void 0:i.request),{data:c,error:d}=await f2(Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:u,signal:l}));return c?{data:{factorId:e,challengeId:a.id,webauthn:{type:a.webauthn.type,credential_response:c}},error:null}:{data:null,error:d}}}}catch(a){return ae(a)?{data:null,error:a}:{data:null,error:new Qn("Unexpected error in challenge",a)}}}async _verify({challengeId:e,factorId:t,webauthn:n}){return this.client.mfa.verify({factorId:t,challengeId:e,webauthn:n})}async _authenticate({factorId:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:s}={}},i){if(!t)return{data:null,error:new wa("rpId is required for WebAuthn authentication")};try{if(!Gv())return{data:null,error:new Qn("Browser does not support WebAuthn",null)};const{data:a,error:o}=await this.challenge({factorId:e,webauthn:{rpId:t,rpOrigins:n},signal:s},{request:i});if(!a)return{data:null,error:o};const{webauthn:l}=a;return this._verify({factorId:e,challengeId:a.challengeId,webauthn:{type:l.type,rpId:t,rpOrigins:n,credential_response:l.credential_response}})}catch(a){return ae(a)?{data:null,error:a}:{data:null,error:new Qn("Unexpected error in authenticate",a)}}}async _register({friendlyName:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:s}={}},i){if(!t)return{data:null,error:new wa("rpId is required for WebAuthn registration")};try{if(!Gv())return{data:null,error:new Qn("Browser does not support WebAuthn",null)};const{data:a,error:o}=await this._enroll({friendlyName:e});if(!a)return await this.client.mfa.listFactors().then(c=>{var d;return(d=c.data)===null||d===void 0?void 0:d.all.find(f=>f.factor_type==="webauthn"&&f.friendly_name===e&&f.status!=="unverified")}).then(c=>c?this.client.mfa.unenroll({factorId:c==null?void 0:c.id}):void 0),{data:null,error:o};const{data:l,error:u}=await this._challenge({factorId:a.id,friendlyName:a.friendly_name,webauthn:{rpId:t,rpOrigins:n},signal:s},{create:i});return l?this._verify({factorId:a.id,challengeId:l.challengeId,webauthn:{rpId:t,rpOrigins:n,type:l.webauthn.type,credential_response:l.webauthn.credential_response}}):{data:null,error:u}}catch(a){return ae(a)?{data:null,error:a}:{data:null,error:new Qn("Unexpected error in register",a)}}}}JO();const y2={url:hO,storageKey:gO,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:pO,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function Kv(r,e,t){return await t()}const Ls={};class Ia{get jwks(){var e,t;return(t=(e=Ls[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){Ls[this.storageKey]=Object.assign(Object.assign({},Ls[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=Ls[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Ls[this.storageKey]=Object.assign(Object.assign({},Ls[this.storageKey]),{cachedAt:e})}constructor(e){var t,n,s;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const i=Object.assign(Object.assign({},y2),e);if(this.storageKey=i.storageKey,this.instanceID=(t=Ia.nextInstanceID[this.storageKey])!==null&&t!==void 0?t:0,Ia.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.instanceID>0&&lt()){const a=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(a),this.logDebugMessages&&console.trace(a)}if(this.persistSession=i.persistSession,this.autoRefreshToken=i.autoRefreshToken,this.admin=new ZO({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=xT(i.fetch),this.lock=i.lock||Kv,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,this.throwOnError=i.throwOnError,i.lock?this.lock=i.lock:this.persistSession&&lt()&&(!((n=globalThis==null?void 0:globalThis.navigator)===null||n===void 0)&&n.locks)?this.lock=XO:this.lock=Kv,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new v2(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(i.storage?this.storage=i.storage:TT()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=jv(this.memoryStorage)),i.userStorage&&(this.userStorage=i.userStorage)):(this.memoryStorage={},this.storage=jv(this.memoryStorage)),lt()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(a){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",a)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async a=>{this._debug("received broadcast notification from other tab or client",a),await this._notifyAllSubscribers(a.data.event,a.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${ST}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let t={},n="none";if(lt()&&(t=kO(window.location.href),this._isImplicitGrantCallback(t)?n="implicit":await this._isPKCECallback(t)&&(n="pkce")),lt()&&this.detectSessionInUrl&&n!=="none"){const{data:s,error:i}=await this._getSessionFromURL(t,n);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),_O(i)){const l=(e=i.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:a,redirectType:o}=s;return this._debug("#_initialize()","detected session in URL",a,"redirect type",o),await this._saveSession(a),setTimeout(async()=>{o==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return ae(t)?this._returnResult({error:t}):this._returnResult({error:new Qn("Unexpected error during initialization",t)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,n,s;try{const i=await de(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(s=e==null?void 0:e.options)===null||s===void 0?void 0:s.captchaToken}},xform:mr}),{data:a,error:o}=i;if(o||!a)return this._returnResult({data:{user:null,session:null},error:o});const l=a.session,u=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:u,session:l},error:null})}catch(i){if(ae(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signUp(e){var t,n,s;try{let i;if("email"in e){const{email:c,password:d,options:f}=e;let h=null,g=null;this.flowType==="pkce"&&([h,g]=await Is(this.storage,this.storageKey)),i=await de(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f==null?void 0:f.emailRedirectTo,body:{email:c,password:d,data:(t=f==null?void 0:f.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken},code_challenge:h,code_challenge_method:g},xform:mr})}else if("phone"in e){const{phone:c,password:d,options:f}=e;i=await de(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:c,password:d,data:(n=f==null?void 0:f.data)!==null&&n!==void 0?n:{},channel:(s=f==null?void 0:f.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken}},xform:mr})}else throw new Do("You must provide either an email or phone number and a password");const{data:a,error:o}=i;if(o||!a)return await ot(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:o});const l=a.session,u=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:u,session:l},error:null})}catch(i){if(await ot(this.storage,`${this.storageKey}-code-verifier`),ae(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:i,password:a,options:o}=e;t=await de(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:Uv})}else if("phone"in e){const{phone:i,password:a,options:o}=e;t=await de(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:Uv})}else throw new Do("You must provide either an email or phone number and a password");const{data:n,error:s}=t;if(s)return this._returnResult({data:{user:null,session:null},error:s});if(!n||!n.session||!n.user){const i=new ws;return this._returnResult({data:{user:null,session:null},error:i})}return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),this._returnResult({data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:s})}catch(t){if(ae(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOAuth(e){var t,n,s,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(n=e.options)===null||n===void 0?void 0:n.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;switch(t){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}}async signInWithEthereum(e){var t,n,s,i,a,o,l,u,c,d,f;let h,g;if("message"in e)h=e.message,g=e.signature;else{const{chain:p,wallet:v,statement:m,options:y}=e;let S;if(lt())if(typeof v=="object")S=v;else{const b=window;if("ethereum"in b&&typeof b.ethereum=="object"&&"request"in b.ethereum&&typeof b.ethereum.request=="function")S=b.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof v!="object"||!(y!=null&&y.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");S=v}const E=new URL((t=y==null?void 0:y.url)!==null&&t!==void 0?t:window.location.href),T=await S.request({method:"eth_requestAccounts"}).then(b=>b).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!T||T.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const A=wT(T[0]);let x=(n=y==null?void 0:y.signInWithEthereum)===null||n===void 0?void 0:n.chainId;if(!x){const b=await S.request({method:"eth_chainId"});x=e2(b)}const w={domain:E.host,address:A,statement:m,uri:E.href,version:"1",chainId:x,nonce:(s=y==null?void 0:y.signInWithEthereum)===null||s===void 0?void 0:s.nonce,issuedAt:(a=(i=y==null?void 0:y.signInWithEthereum)===null||i===void 0?void 0:i.issuedAt)!==null&&a!==void 0?a:new Date,expirationTime:(o=y==null?void 0:y.signInWithEthereum)===null||o===void 0?void 0:o.expirationTime,notBefore:(l=y==null?void 0:y.signInWithEthereum)===null||l===void 0?void 0:l.notBefore,requestId:(u=y==null?void 0:y.signInWithEthereum)===null||u===void 0?void 0:u.requestId,resources:(c=y==null?void 0:y.signInWithEthereum)===null||c===void 0?void 0:c.resources};h=r2(w),g=await S.request({method:"personal_sign",params:[t2(h),A]})}try{const{data:p,error:v}=await de(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:h,signature:g},!((d=e.options)===null||d===void 0)&&d.captchaToken?{gotrue_meta_security:{captcha_token:(f=e.options)===null||f===void 0?void 0:f.captchaToken}}:null),xform:mr});if(v)throw v;if(!p||!p.session||!p.user){const m=new ws;return this._returnResult({data:{user:null,session:null},error:m})}return p.session&&(await this._saveSession(p.session),await this._notifyAllSubscribers("SIGNED_IN",p.session)),this._returnResult({data:Object.assign({},p),error:v})}catch(p){if(ae(p))return this._returnResult({data:{user:null,session:null},error:p});throw p}}async signInWithSolana(e){var t,n,s,i,a,o,l,u,c,d,f,h;let g,p;if("message"in e)g=e.message,p=e.signature;else{const{chain:v,wallet:m,statement:y,options:S}=e;let E;if(lt())if(typeof m=="object")E=m;else{const A=window;if("solana"in A&&typeof A.solana=="object"&&("signIn"in A.solana&&typeof A.solana.signIn=="function"||"signMessage"in A.solana&&typeof A.solana.signMessage=="function"))E=A.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof m!="object"||!(S!=null&&S.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");E=m}const T=new URL((t=S==null?void 0:S.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in E&&E.signIn){const A=await E.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},S==null?void 0:S.signInWithSolana),{version:"1",domain:T.host,uri:T.href}),y?{statement:y}:null));let x;if(Array.isArray(A)&&A[0]&&typeof A[0]=="object")x=A[0];else if(A&&typeof A=="object"&&"signedMessage"in A&&"signature"in A)x=A;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in x&&"signature"in x&&(typeof x.signedMessage=="string"||x.signedMessage instanceof Uint8Array)&&x.signature instanceof Uint8Array)g=typeof x.signedMessage=="string"?x.signedMessage:new TextDecoder().decode(x.signedMessage),p=x.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in E)||typeof E.signMessage!="function"||!("publicKey"in E)||typeof E!="object"||!E.publicKey||!("toBase58"in E.publicKey)||typeof E.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");g=[`${T.host} wants you to sign in with your Solana account:`,E.publicKey.toBase58(),...y?["",y,""]:[""],"Version: 1",`URI: ${T.href}`,`Issued At: ${(s=(n=S==null?void 0:S.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&s!==void 0?s:new Date().toISOString()}`,...!((i=S==null?void 0:S.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${S.signInWithSolana.notBefore}`]:[],...!((a=S==null?void 0:S.signInWithSolana)===null||a===void 0)&&a.expirationTime?[`Expiration Time: ${S.signInWithSolana.expirationTime}`]:[],...!((o=S==null?void 0:S.signInWithSolana)===null||o===void 0)&&o.chainId?[`Chain ID: ${S.signInWithSolana.chainId}`]:[],...!((l=S==null?void 0:S.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${S.signInWithSolana.nonce}`]:[],...!((u=S==null?void 0:S.signInWithSolana)===null||u===void 0)&&u.requestId?[`Request ID: ${S.signInWithSolana.requestId}`]:[],...!((d=(c=S==null?void 0:S.signInWithSolana)===null||c===void 0?void 0:c.resources)===null||d===void 0)&&d.length?["Resources",...S.signInWithSolana.resources.map(x=>`- ${x}`)]:[]].join(`
`);const A=await E.signMessage(new TextEncoder().encode(g),"utf8");if(!A||!(A instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");p=A}}try{const{data:v,error:m}=await de(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:g,signature:ts(p)},!((f=e.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(h=e.options)===null||h===void 0?void 0:h.captchaToken}}:null),xform:mr});if(m)throw m;if(!v||!v.session||!v.user){const y=new ws;return this._returnResult({data:{user:null,session:null},error:y})}return v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),this._returnResult({data:Object.assign({},v),error:m})}catch(v){if(ae(v))return this._returnResult({data:{user:null,session:null},error:v});throw v}}async _exchangeCodeForSession(e){const t=await Vn(this.storage,`${this.storageKey}-code-verifier`),[n,s]=(t??"").split("/");try{if(!n&&this.flowType==="pkce")throw new TO;const{data:i,error:a}=await de(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:n},xform:mr});if(await ot(this.storage,`${this.storageKey}-code-verifier`),a)throw a;if(!i||!i.session||!i.user){const o=new ws;return this._returnResult({data:{user:null,session:null,redirectType:null},error:o})}return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),this._returnResult({data:Object.assign(Object.assign({},i),{redirectType:s??null}),error:a})}catch(i){if(await ot(this.storage,`${this.storageKey}-code-verifier`),ae(i))return this._returnResult({data:{user:null,session:null,redirectType:null},error:i});throw i}}async signInWithIdToken(e){try{const{options:t,provider:n,token:s,access_token:i,nonce:a}=e,o=await de(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:s,access_token:i,nonce:a,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:mr}),{data:l,error:u}=o;if(u)return this._returnResult({data:{user:null,session:null},error:u});if(!l||!l.session||!l.user){const c=new ws;return this._returnResult({data:{user:null,session:null},error:c})}return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),this._returnResult({data:l,error:u})}catch(t){if(ae(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOtp(e){var t,n,s,i,a;try{if("email"in e){const{email:o,options:l}=e;let u=null,c=null;this.flowType==="pkce"&&([u,c]=await Is(this.storage,this.storageKey));const{error:d}=await de(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(t=l==null?void 0:l.data)!==null&&t!==void 0?t:{},create_user:(n=l==null?void 0:l.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:u,code_challenge_method:c},redirectTo:l==null?void 0:l.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:d})}if("phone"in e){const{phone:o,options:l}=e,{data:u,error:c}=await de(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(s=l==null?void 0:l.data)!==null&&s!==void 0?s:{},create_user:(i=l==null?void 0:l.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(a=l==null?void 0:l.channel)!==null&&a!==void 0?a:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:u==null?void 0:u.message_id},error:c})}throw new Do("You must provide either an email or phone number.")}catch(o){if(await ot(this.storage,`${this.storageKey}-code-verifier`),ae(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async verifyOtp(e){var t,n;try{let s,i;"options"in e&&(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(n=e.options)===null||n===void 0?void 0:n.captchaToken);const{data:a,error:o}=await de(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:s,xform:mr});if(o)throw o;if(!a)throw new Error("An error occurred on token verification.");const l=a.session,u=a.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),this._returnResult({data:{user:u,session:l},error:null})}catch(s){if(ae(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signInWithSSO(e){var t,n,s,i,a;try{let o=null,l=null;this.flowType==="pkce"&&([o,l]=await Is(this.storage,this.storageKey));const u=await de(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&n!==void 0?n:void 0}),!((s=e==null?void 0:e.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:o,code_challenge_method:l}),headers:this.headers,xform:zO});return!((i=u.data)===null||i===void 0)&&i.url&&lt()&&!(!((a=e.options)===null||a===void 0)&&a.skipBrowserRedirect)&&window.location.assign(u.data.url),this._returnResult(u)}catch(o){if(await ot(this.storage,`${this.storageKey}-code-verifier`),ae(o))return this._returnResult({data:null,error:o});throw o}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:n}=e;if(n)throw n;if(!t)throw new Vt;const{error:s}=await de(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return this._returnResult({data:{user:null,session:null},error:s})})}catch(e){if(ae(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:n,type:s,options:i}=e,{error:a}=await de(this.fetch,"POST",t,{headers:this.headers,body:{email:n,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:a})}else if("phone"in e){const{phone:n,type:s,options:i}=e,{data:a,error:o}=await de(this.fetch,"POST",t,{headers:this.headers,body:{phone:n,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:a==null?void 0:a.message_id},error:o})}throw new Do("You must provide either an email or phone number and a type")}catch(t){if(ae(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await n,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=t();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Vn(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const n=e.expires_at?e.expires_at*1e3-Date.now()<xc:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",e.expires_at),!n){if(this.userStorage){const a=await Vn(this.userStorage,this.storageKey+"-user");a!=null&&a.user?e.user=a.user:e.user=Ic()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const a={value:this.suppressGetSessionWarning};e.user=KO(e.user,a),a.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{session:null},error:i}):this._returnResult({data:{session:s},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;const t=await this._acquireLock(-1,async()=>await this._getUser());return t.data.user&&(this.suppressGetSessionWarning=!0),t}async _getUser(e){try{return e?await de(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:En}):await this._useSession(async t=>{var n,s,i;const{data:a,error:o}=t;if(o)throw o;return!(!((n=a.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Vt}:await de(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(s=a.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0,xform:En})})}catch(t){if(ae(t))return EO(t)&&(await this._removeSession(),await ot(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:t});throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async n=>{const{data:s,error:i}=n;if(i)throw i;if(!s.session)throw new Vt;const a=s.session;let o=null,l=null;this.flowType==="pkce"&&e.email!=null&&([o,l]=await Is(this.storage,this.storageKey));const{data:u,error:c}=await de(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:l}),jwt:a.access_token,xform:En});if(c)throw c;return a.user=u.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),this._returnResult({data:{user:a.user},error:null})})}catch(n){if(await ot(this.storage,`${this.storageKey}-code-verifier`),ae(n))return this._returnResult({data:{user:null},error:n});throw n}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Vt;const t=Date.now()/1e3;let n=t,s=!0,i=null;const{payload:a}=wc(e.access_token);if(a.exp&&(n=a.exp,s=n<=t),s){const{data:o,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return this._returnResult({data:{user:null,session:null},error:l});if(!o)return{data:{user:null,session:null},error:null};i=o}else{const{data:o,error:l}=await this._getUser(e.access_token);if(l)throw l;i={access_token:e.access_token,refresh_token:e.refresh_token,user:o.user,token_type:"bearer",expires_in:n-t,expires_at:n},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return this._returnResult({data:{user:i.user,session:i},error:null})}catch(t){if(ae(t))return this._returnResult({data:{session:null,user:null},error:t});throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var n;if(!e){const{data:a,error:o}=t;if(o)throw o;e=(n=a.session)!==null&&n!==void 0?n:void 0}if(!(e!=null&&e.refresh_token))throw new Vt;const{data:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{user:null,session:null},error:i}):s?this._returnResult({data:{user:s.user,session:s},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(t){if(ae(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async _getSessionFromURL(e,t){try{if(!lt())throw new Oo("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Oo(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new Pv("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Oo("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Pv("No code detected.");const{data:y,error:S}=await this._exchangeCodeForSession(e.code);if(S)throw S;const E=new URL(window.location.href);return E.searchParams.delete("code"),window.history.replaceState(window.history.state,"",E.toString()),{data:{session:y.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:s,access_token:i,refresh_token:a,expires_in:o,expires_at:l,token_type:u}=e;if(!i||!o||!a||!u)throw new Oo("No session defined in URL");const c=Math.round(Date.now()/1e3),d=parseInt(o);let f=c+d;l&&(f=parseInt(l));const h=f-c;h*1e3<=Ds&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${h}s, should have been closer to ${d}s`);const g=f-d;c-g>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",g,f,c):c-g<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",g,f,c);const{data:p,error:v}=await this._getUser(i);if(v)throw v;const m={provider_token:n,provider_refresh_token:s,access_token:i,expires_in:d,expires_at:f,refresh_token:a,token_type:u,user:p.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:m,redirectType:e.type},error:null})}catch(n){if(ae(n))return this._returnResult({data:{session:null,redirectType:null},error:n});throw n}}_isImplicitGrantCallback(e){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),e):!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Vn(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var n;const{data:s,error:i}=t;if(i)return this._returnResult({error:i});const a=(n=s.session)===null||n===void 0?void 0:n.access_token;if(a){const{error:o}=await this.admin.signOut(a,e);if(o&&!(SO(o)&&(o.status===404||o.status===401||o.status===403)))return this._returnResult({error:o})}return e!=="others"&&(await this._removeSession(),await ot(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const t=LO(),n={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:n}}}async _emitInitialSession(e){return await this._useSession(async t=>{var n,s;try{const{data:{session:i},error:a}=t;if(a)throw a;await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let n=null,s=null;this.flowType==="pkce"&&([n,s]=await Is(this.storage,this.storageKey,!0));try{return await de(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:n,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(await ot(this.storage,`${this.storageKey}-code-verifier`),ae(i))return this._returnResult({data:null,error:i});throw i}}async getUserIdentities(){var e;try{const{data:t,error:n}=await this.getUser();if(n)throw n;return this._returnResult({data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(t){if(ae(t))return this._returnResult({data:null,error:t});throw t}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var t;try{const{data:n,error:s}=await this._useSession(async i=>{var a,o,l,u,c;const{data:d,error:f}=i;if(f)throw f;const h=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(a=e.options)===null||a===void 0?void 0:a.redirectTo,scopes:(o=e.options)===null||o===void 0?void 0:o.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await de(this.fetch,"GET",h,{headers:this.headers,jwt:(c=(u=d.session)===null||u===void 0?void 0:u.access_token)!==null&&c!==void 0?c:void 0})});if(s)throw s;return lt()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(n==null?void 0:n.url),this._returnResult({data:{provider:e.provider,url:n==null?void 0:n.url},error:null})}catch(n){if(ae(n))return this._returnResult({data:{provider:e.provider,url:null},error:n});throw n}}async linkIdentityIdToken(e){return await this._useSession(async t=>{var n;try{const{error:s,data:{session:i}}=t;if(s)throw s;const{options:a,provider:o,token:l,access_token:u,nonce:c}=e,d=await de(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(n=i==null?void 0:i.access_token)!==null&&n!==void 0?n:void 0,body:{provider:o,id_token:l,access_token:u,nonce:c,link_identity:!0,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:mr}),{data:f,error:h}=d;return h?this._returnResult({data:{user:null,session:null},error:h}):!f||!f.session||!f.user?this._returnResult({data:{user:null,session:null},error:new ws}):(f.session&&(await this._saveSession(f.session),await this._notifyAllSubscribers("USER_UPDATED",f.session)),this._returnResult({data:f,error:h}))}catch(s){if(await ot(this.storage,`${this.storageKey}-code-verifier`),ae(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}})}async unlinkIdentity(e){try{return await this._useSession(async t=>{var n,s;const{data:i,error:a}=t;if(a)throw a;return await de(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(n=i.session)===null||n===void 0?void 0:n.access_token)!==null&&s!==void 0?s:void 0})})}catch(t){if(ae(t))return this._returnResult({data:null,error:t});throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const n=Date.now();return await DO(async s=>(s>0&&await PO(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await de(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:mr})),(s,i)=>{const a=200*Math.pow(2,s);return i&&Ac(i)&&Date.now()+a-n<Ds})}catch(n){if(this._debug(t,"error",n),ae(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const n=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",n),lt()&&!t.skipBrowserRedirect&&window.location.assign(n),{data:{provider:e,url:n},error:null}}async _recoverAndRefresh(){var e,t;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const s=await Vn(this.storage,this.storageKey);if(s&&this.userStorage){let a=await Vn(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!a&&(a={user:s.user},await Os(this.userStorage,this.storageKey+"-user",a)),s.user=(e=a==null?void 0:a.user)!==null&&e!==void 0?e:Ic()}else if(s&&!s.user&&!s.user){const a=await Vn(this.storage,this.storageKey+"-user");a&&(a!=null&&a.user)?(s.user=a.user,await ot(this.storage,this.storageKey+"-user"),await Os(this.storage,this.storageKey,s)):s.user=Ic()}if(this._debug(n,"session from storage",s),!this._isValidSession(s)){this._debug(n,"session is not valid"),s!==null&&await this._removeSession();return}const i=((t=s.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<xc;if(this._debug(n,`session has${i?"":" not"} expired with margin of ${xc}s`),i){if(this.autoRefreshToken&&s.refresh_token){const{error:a}=await this._callRefreshToken(s.refresh_token);a&&(console.error(a),Ac(a)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",a),await this._removeSession()))}}else if(s.user&&s.user.__isUserNotAvailableProxy===!0)try{const{data:a,error:o}=await this._getUser(s.access_token);!o&&(a!=null&&a.user)?(s.user=a.user,await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(a){console.error("Error getting user data:",a),this._debug(n,"error getting user data, skipping SIGNED_IN notification",a)}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(n,"error",s),console.error(s);return}finally{this._debug(n,"end")}}async _callRefreshToken(e){var t,n;if(!e)throw new Vt;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new lu;const{data:i,error:a}=await this._refreshAccessToken(e);if(a)throw a;if(!i.session)throw new Vt;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const o={data:i.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(i){if(this._debug(s,"error",i),ae(i)){const a={data:null,error:i};return Ac(i)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(a),a}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(i),i}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,n=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],a=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(e,t)}catch(l){i.push(l)}});if(await Promise.all(a),i.length>0){for(let o=0;o<i.length;o+=1)console.error(i[o]);throw i[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await ot(this.storage,`${this.storageKey}-code-verifier`);const t=Object.assign({},e),n=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&t.user&&await Os(this.userStorage,this.storageKey+"-user",{user:t.user});const s=Object.assign({},t);delete s.user;const i=Fv(s);await Os(this.storage,this.storageKey,i)}else{const s=Fv(t);await Os(this.storage,this.storageKey,s)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await ot(this.storage,this.storageKey),await ot(this.storage,this.storageKey+"-code-verifier"),await ot(this.storage,this.storageKey+"-user"),this.userStorage&&await ot(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&lt()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Ds);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:n}}=t;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((n.expires_at*1e3-e)/Ds);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${Ds}ms, refresh threshold is ${zh} ticks`),s<=zh&&await this._callRefreshToken(n.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof AT)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!lt()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,n){const s=[`provider=${encodeURIComponent(t)}`];if(n!=null&&n.redirectTo&&s.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n!=null&&n.scopes&&s.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[i,a]=await Is(this.storage,this.storageKey),o=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(a)}`});s.push(o.toString())}if(n!=null&&n.queryParams){const i=new URLSearchParams(n.queryParams);s.push(i.toString())}return n!=null&&n.skipBrowserRedirect&&s.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var n;const{data:s,error:i}=t;return i?this._returnResult({data:null,error:i}):await de(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token})})}catch(t){if(ae(t))return this._returnResult({data:null,error:t});throw t}}async _enroll(e){try{return await this._useSession(async t=>{var n,s;const{data:i,error:a}=t;if(a)return this._returnResult({data:null,error:a});const o=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:l,error:u}=await de(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:(n=i==null?void 0:i.session)===null||n===void 0?void 0:n.access_token});return u?this._returnResult({data:null,error:u}):(e.factorType==="totp"&&l.type==="totp"&&(!((s=l==null?void 0:l.totp)===null||s===void 0)&&s.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),this._returnResult({data:l,error:null}))})}catch(t){if(ae(t))return this._returnResult({data:null,error:t});throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;const{data:s,error:i}=t;if(i)return this._returnResult({data:null,error:i});const a=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?u2(e.webauthn.credential_response):c2(e.webauthn.credential_response)})}:{code:e.code}),{data:o,error:l}=await de(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:a,headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token});return l?this._returnResult({data:null,error:l}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),this._returnResult({data:o,error:l}))})}catch(t){if(ae(t))return this._returnResult({data:null,error:t});throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;const{data:s,error:i}=t;if(i)return this._returnResult({data:null,error:i});const a=await de(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token});if(a.error)return a;const{data:o}=a;if(o.type!=="webauthn")return{data:o,error:null};switch(o.webauthn.type){case"create":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:o2(o.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:l2(o.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(t){if(ae(t))return this._returnResult({data:null,error:t});throw t}})}async _challengeAndVerify(e){const{data:t,error:n}=await this._challenge({factorId:e.factorId});return n?this._returnResult({data:null,error:n}):await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){var e;const{data:{user:t},error:n}=await this.getUser();if(n)return{data:null,error:n};const s={all:[],phone:[],totp:[],webauthn:[]};for(const i of(e=t==null?void 0:t.factors)!==null&&e!==void 0?e:[])s.all.push(i),i.status==="verified"&&s[i.factor_type].push(i);return{data:s,error:null}}async _getAuthenticatorAssuranceLevel(){var e,t;const{data:{session:n},error:s}=await this.getSession();if(s)return this._returnResult({data:null,error:s});if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:i}=wc(n.access_token);let a=null;i.aal&&(a=i.aal);let o=a;((t=(e=n.user.factors)===null||e===void 0?void 0:e.filter(c=>c.status==="verified"))!==null&&t!==void 0?t:[]).length>0&&(o="aal2");const u=i.amr||[];return{data:{currentLevel:a,nextLevel:o,currentAuthenticationMethods:u},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async t=>{const{data:{session:n},error:s}=t;return s?this._returnResult({data:null,error:s}):n?await de(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:n.access_token,xform:i=>({data:i,error:null})}):this._returnResult({data:null,error:new Vt})})}catch(t){if(ae(t))return this._returnResult({data:null,error:t});throw t}}async _approveAuthorization(e,t){try{return await this._useSession(async n=>{const{data:{session:s},error:i}=n;if(i)return this._returnResult({data:null,error:i});if(!s)return this._returnResult({data:null,error:new Vt});const a=await de(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"approve"},xform:o=>({data:o,error:null})});return a.data&&a.data.redirect_url&&lt()&&!(t!=null&&t.skipBrowserRedirect)&&window.location.assign(a.data.redirect_url),a})}catch(n){if(ae(n))return this._returnResult({data:null,error:n});throw n}}async _denyAuthorization(e,t){try{return await this._useSession(async n=>{const{data:{session:s},error:i}=n;if(i)return this._returnResult({data:null,error:i});if(!s)return this._returnResult({data:null,error:new Vt});const a=await de(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"deny"},xform:o=>({data:o,error:null})});return a.data&&a.data.redirect_url&&lt()&&!(t!=null&&t.skipBrowserRedirect)&&window.location.assign(a.data.redirect_url),a})}catch(n){if(ae(n))return this._returnResult({data:null,error:n});throw n}}async _listOAuthGrants(){try{return await this._useSession(async e=>{const{data:{session:t},error:n}=e;return n?this._returnResult({data:null,error:n}):t?await de(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:t.access_token,xform:s=>({data:s,error:null})}):this._returnResult({data:null,error:new Vt})})}catch(e){if(ae(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async t=>{const{data:{session:n},error:s}=t;return s?this._returnResult({data:null,error:s}):n?(await de(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:n.access_token,query:{client_id:e.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new Vt})})}catch(t){if(ae(t))return this._returnResult({data:null,error:t});throw t}}async fetchJwk(e,t={keys:[]}){let n=t.keys.find(o=>o.kid===e);if(n)return n;const s=Date.now();if(n=this.jwks.keys.find(o=>o.kid===e),n&&this.jwks_cached_at+vO>s)return n;const{data:i,error:a}=await de(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(a)throw a;return!i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=s,n=i.keys.find(o=>o.kid===e),!n)?null:n}async getClaims(e,t={}){try{let n=e;if(!n){const{data:h,error:g}=await this.getSession();if(g||!h.session)return this._returnResult({data:null,error:g});n=h.session.access_token}const{header:s,payload:i,signature:a,raw:{header:o,payload:l}}=wc(n);t!=null&&t.allowExpired||BO(i.exp);const u=!s.alg||s.alg.startsWith("HS")||!s.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(s.kid,t!=null&&t.keys?{keys:t.keys}:t==null?void 0:t.jwks);if(!u){const{error:h}=await this.getUser(n);if(h)throw h;return{data:{claims:i,header:s,signature:a},error:null}}const c=jO(s.alg),d=await crypto.subtle.importKey("jwk",u,c,!0,["verify"]);if(!await crypto.subtle.verify(c,d,a,bO(`${o}.${l}`)))throw new Zh("Invalid JWT signature");return{data:{claims:i,header:s,signature:a},error:null}}catch(n){if(ae(n))return this._returnResult({data:null,error:n});throw n}}}Ia.nextInstanceID={};const S2=Ia,E2="2.89.0";let Fi="";typeof Deno<"u"?Fi="deno":typeof document<"u"?Fi="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Fi="react-native":Fi="node";const _2={"X-Client-Info":`supabase-js-${Fi}/${E2}`},T2={headers:_2},x2={schema:"public"},A2={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},w2={};function ba(r){"@babel/helpers - typeof";return ba=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ba(r)}function I2(r,e){if(ba(r)!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e);if(ba(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function b2(r){var e=I2(r,"string");return ba(e)=="symbol"?e:e+""}function R2(r,e,t){return(e=b2(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Hv(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(r,s).enumerable})),t.push.apply(t,n)}return t}function Ve(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Hv(Object(t),!0).forEach(function(n){R2(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):Hv(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}const L2=r=>r?(...e)=>r(...e):(...e)=>fetch(...e),k2=()=>Headers,C2=(r,e,t)=>{const n=L2(t),s=k2();return async(i,a)=>{var o;const l=(o=await e())!==null&&o!==void 0?o:r;let u=new s(a==null?void 0:a.headers);return u.has("apikey")||u.set("apikey",r),u.has("Authorization")||u.set("Authorization",`Bearer ${l}`),n(i,Ve(Ve({},a),{},{headers:u}))}};function P2(r){return r.endsWith("/")?r:r+"/"}function D2(r,e){var t,n;const{db:s,auth:i,realtime:a,global:o}=r,{db:l,auth:u,realtime:c,global:d}=e,f={db:Ve(Ve({},l),s),auth:Ve(Ve({},u),i),realtime:Ve(Ve({},c),a),storage:{},global:Ve(Ve(Ve({},d),o),{},{headers:Ve(Ve({},(t=d==null?void 0:d.headers)!==null&&t!==void 0?t:{}),(n=o==null?void 0:o.headers)!==null&&n!==void 0?n:{})}),accessToken:async()=>""};return r.accessToken?f.accessToken=r.accessToken:delete f.accessToken,f}function O2(r){const e=r==null?void 0:r.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(P2(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var M2=class extends S2{constructor(r){super(r)}},N2=class{constructor(r,e,t){var n,s;this.supabaseUrl=r,this.supabaseKey=e;const i=O2(r);if(!e)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",i),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",i),this.storageUrl=new URL("storage/v1",i),this.functionsUrl=new URL("functions/v1",i);const a=`sb-${i.hostname.split(".")[0]}-auth-token`,o={db:x2,realtime:w2,auth:Ve(Ve({},A2),{},{storageKey:a}),global:T2},l=D2(t??{},o);if(this.storageKey=(n=l.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(s=l.global.headers)!==null&&s!==void 0?s:{},l.accessToken)this.accessToken=l.accessToken,this.auth=new Proxy({},{get:(c,d)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(d)} is not possible`)}});else{var u;this.auth=this._initSupabaseAuthClient((u=l.auth)!==null&&u!==void 0?u:{},this.headers,l.global.fetch)}this.fetch=C2(e,this._getAccessToken.bind(this),l.global.fetch),this.realtime=this._initRealtimeClient(Ve({headers:this.headers,accessToken:this._getAccessToken.bind(this)},l.realtime)),this.accessToken&&this.accessToken().then(c=>this.realtime.setAuth(c)).catch(c=>console.warn("Failed to set initial Realtime auth token:",c)),this.rest=new pD(new URL("rest/v1",i).href,{headers:this.headers,schema:l.db.schema,fetch:this.fetch}),this.storage=new fO(this.storageUrl.href,this.headers,this.fetch,t==null?void 0:t.storage),l.accessToken||this._listenForAuthEvents()}get functions(){return new cD(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(r){return this.rest.from(r)}schema(r){return this.rest.schema(r)}rpc(r,e={},t={head:!1,get:!1,count:void 0}){return this.rest.rpc(r,e,t)}channel(r,e={config:{}}){return this.realtime.channel(r,e)}getChannels(){return this.realtime.getChannels()}removeChannel(r){return this.realtime.removeChannel(r)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var r=this,e,t;if(r.accessToken)return await r.accessToken();const{data:n}=await r.auth.getSession();return(e=(t=n.session)===null||t===void 0?void 0:t.access_token)!==null&&e!==void 0?e:r.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:r,persistSession:e,detectSessionInUrl:t,storage:n,userStorage:s,storageKey:i,flowType:a,lock:o,debug:l,throwOnError:u},c,d){const f={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new M2({url:this.authUrl.href,headers:Ve(Ve({},f),c),storageKey:i,autoRefreshToken:r,persistSession:e,detectSessionInUrl:t,storage:n,userStorage:s,flowType:a,lock:o,debug:l,throwOnError:u,fetch:d,hasCustomAuthorizationHeader:Object.keys(this.headers).some(h=>h.toLowerCase()==="authorization")})}_initRealtimeClient(r){return new PD(this.realtimeUrl.href,Ve(Ve({},r),{},{params:Ve(Ve({},{apikey:this.supabaseKey}),r==null?void 0:r.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((r,e)=>{this._handleTokenChanged(r,"CLIENT",e==null?void 0:e.access_token)})}_handleTokenChanged(r,e,t){(r==="TOKEN_REFRESHED"||r==="SIGNED_IN")&&this.changedAccessToken!==t?(this.changedAccessToken=t,this.realtime.setAuth(t)):r==="SIGNED_OUT"&&(this.realtime.setAuth(),e=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const F2=(r,e,t)=>new N2(r,e,t);function $2(){if(typeof window<"u"||typeof process>"u")return!1;const r=process.version;if(r==null)return!1;const e=r.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}$2()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");let Vv=null;const U2=(r,e)=>{if(!r||!e)throw new Error("Supabase URL and Key are required");return Vv=F2(r,e),Vv},B2=async(r,e)=>{try{if(Or()){console.log("Fetching from Supabase via Electron IPC...");const i=await window.electronAPI.invoke("supabase-fetch-channels",r,e);if(i.success)return i.data||[];throw new Error(i.error)}const t=U2(r,e),{data:n,error:s}=await t.from("channels").select("*").order("id",{ascending:!0});if(s)throw s;return n||[]}catch(t){throw console.error("Supabase fetch error:",t),t}};function j2(){const[r,e]=re.useState({channels:[],groups:{},categories:{live:[],movie:[],series:[]}}),[t,n]=re.useState("All"),[s,i]=re.useState(null),[a,o]=re.useState(!1),[l,u]=re.useState(null),[c,d]=re.useState(!1),[f,h]=re.useState(null),[g,p]=re.useState(""),[v,m]=re.useState(()=>localStorage.getItem("auto-skip-enabled")==="true"),[y,S]=re.useState({url:"https://htqfhemxmxsuvvpqcahc.supabase.co",key:"sb_secret_Xcwdaghq615euLZgzUFN-A_ftxBGasa"}),[E,T]=re.useState(!1),A=async P=>{try{await $_(P)}catch(k){console.error("Failed to open external player:",k)}},x=P=>{const k=P.toLowerCase();return k.includes("type=m3u")||k.includes("get.php")||k.includes("playlist.php")||k.includes(".m3u")&&!k.includes(".m3u8")},w=P=>{console.log("Processing Playlist Data:",{totalChannels:P.channels.length,categories:Object.keys(P.categories).map(U=>`${U}: ${P.categories[U].length}`)});const k=P.categories&&P.categories.playlist&&P.categories.playlist.length>0,F=k||P.channels.some(U=>x(U.url)||U.group&&U.group.toLowerCase().includes("playlist"));if(console.log("Processing playlist. hasPlaylists:",k,"containsPlaylists:",F),e(P),n("All"),i(null),F){const U=P.channels.filter(B=>x(B.url)||B.group&&B.group.toLowerCase().includes("playlist"));if(U.length===1){console.log("Only 1 playlist link found, auto-opening:",U[0].name),setTimeout(()=>{b(U[0],!1)},100);return}u("all"),d(!0),console.log("Detected playlist directory with",U.length,"links - showing flat view")}else u(null),d(!1),console.log("Detected standard channels - showing category selection")},b=async(P,k=!1)=>{const F=x(P.url);if(k&&!F){A(P.url),i(P);return}if(F){o(!0);try{console.log("Loading nested playlist from:",P.url);let U;try{U=await dv(P.url)}catch(G){throw console.error("Fetch error:",G),new Error(`Network error: ${G.message}`)}if(console.log("Received playlist content length:",U.length),!U||U.length<10)throw new Error("Received empty or invalid playlist content");if(!U.includes("#EXTM3U")&&!U.includes("#EXTINF"))throw console.warn("Content does not appear to be M3U format:",U.substring(0,200)),new Error("Invalid M3U format received");const B=yc(U);if(!B.channels||B.channels.length===0)throw new Error("No channels found in the playlist");console.log("Successfully parsed",B.channels.length,"channels"),w(B)}catch(U){console.error("Failed to load nested playlist:",U);const B=U.message.includes("timeout")?"Connection timed out. Please try again.":U.message.includes("CORS")?"Server access error. This playlist may not be supported.":`Failed to load playlist: ${U.message}`;console.warn("User-friendly error:",B),setTimeout(()=>{confirm(`${B}

Would you like to try again?`)&&b(P)},100)}finally{o(!1)}}else i(P)},I=P=>{const k=P.target.files[0];if(!k)return;h(k.path||null);const F=new FileReader;F.onload=U=>{const B=U.target.result,G=yc(B);w(G)},F.readAsText(k)},M=async()=>{if(g.trim()){o(!0);try{console.log("Loading playlist from URL:",g);const P=await dv(g);if(!P||P.length<10)throw new Error("Received empty or invalid playlist content");const k=yc(P);if(!k.channels||k.channels.length===0)throw new Error("No channels found in the playlist");h(null),w(k)}catch(P){console.error("URL Load Error:",P),alert(`Failed to load playlist: ${P.message}`)}finally{o(!1)}}},K=async P=>{if(!f){alert("Dosya yolu bulunamad. Kanal silinemedi.");return}if(confirm(`"${P.name}" kanaln silmek istediinizden emin misiniz?

Bu ilem dosyadan kalc olarak silinecektir.`))try{const F=await xk(f,P.name,P.url);F.success?(e(U=>{const B=U.channels.filter(ne=>ne.id!==P.id),G={},ie={live:[],movie:[],series:[],playlist:[]};return B.forEach((ne,oe)=>{ne.id=oe;const le=ne.group||"Other";G[le]||(G[le]=[]),G[le].push(ne),ie[ne.type]||(ie[ne.type]=[]),ie[ne.type].push(ne)}),{channels:B,groups:G,categories:ie}}),(s==null?void 0:s.id)===P.id&&i(null)):alert("Kanal silinemedi: "+(F.error||"Bilinmeyen hata"))}catch(F){console.error("Delete channel error:",F),alert("Kanal silinirken hata olutu: "+F.message)}},z=()=>{let P=r.channels;return l&&l!=="all"&&r.categories&&(P=r.categories[l]||[]),t==="All"?P:P.filter(k=>k.group===t)},X=()=>{m(P=>{const k=!P;return localStorage.setItem("auto-skip-enabled",k.toString()),k})},Q=()=>{if(!v||!s)return;const P=z(),k=P.findIndex(F=>F.id===s.id);if(k!==-1&&k<P.length-1){const F=P[k+1];console.log("Auto-skipping to next channel:",F.name),i(F)}else if(k===P.length-1&&P.length>1){const F=P[0];console.log("Auto-skipping to first channel:",F.name),i(F)}},N=async()=>{if(!y.url||!y.key){alert("Please enter both Supabase URL and Key");return}o(!0);try{localStorage.setItem("supabase-url",y.url),localStorage.setItem("supabase-key",y.key);const P=await B2(y.url,y.key);if(!P||P.length===0)throw new Error("No channels found in the database");console.log("Fetched",P.length,"channels from Supabase");const k=uT(P);h(null),w(k),T(!1)}catch(P){console.error("Supabase Connect Error:",P),alert("Failed to load from database: "+P.message)}finally{o(!1)}};return C.jsxs("div",{className:"flex h-screen w-screen bg-white text-gray-900 overflow-hidden relative",children:[a&&C.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:99999},children:C.jsxs("div",{style:{backgroundColor:"white",padding:"48px 64px",borderRadius:"16px",textAlign:"center",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.5)",border:"3px solid #f97316"},children:[C.jsx(_d,{className:"animate-spin",size:80,style:{color:"#f97316",marginBottom:"24px"}}),C.jsx("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#1f2937",marginBottom:"8px"},children:"Loading Playlist..."}),C.jsx("div",{style:{fontSize:"14px",color:"#6b7280"},children:"Please wait"})]})}),E&&C.jsx("div",{className:"fixed inset-0 z-[60] bg-black/80 flex items-center justify-center p-4",children:C.jsxs("div",{className:"bg-white p-6 rounded-lg w-full max-w-md shadow-2xl border border-gray-200",children:[C.jsxs("h2",{className:"text-xl font-bold mb-4 text-gray-900 flex items-center gap-2",children:[C.jsx(M0,{size:24,className:"text-orange-500"}),"Load from Database"]}),C.jsxs("div",{className:"space-y-4",children:[C.jsxs("div",{children:[C.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Supabase URL"}),C.jsx("input",{type:"text",value:y.url,onChange:P=>S(k=>({...k,url:P.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-gray-900 focus:ring-2 focus:ring-orange-500 outline-none",placeholder:"https://xyz.supabase.co"})]}),C.jsxs("div",{children:[C.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Supabase Anon Key"}),C.jsx("input",{type:"password",value:y.key,onChange:P=>S(k=>({...k,key:P.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-gray-900 focus:ring-2 focus:ring-orange-500 outline-none",placeholder:"eyJh..."})]}),C.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[C.jsx("button",{onClick:()=>T(!1),className:"px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg font-medium",children:"Cancel"}),C.jsx("button",{onClick:N,className:"px-4 py-2 bg-orange-500 text-white hover:bg-orange-600 rounded-lg font-medium",children:"Connect & Load"})]})]})]})}),r.channels.length===0&&C.jsx("div",{className:"absolute inset-0 z-50 bg-white flex flex-col items-center justify-center p-6",children:C.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-lg border border-gray-200 max-w-md w-full text-center",children:[C.jsx("div",{className:"w-16 h-16 bg-orange-500 rounded-lg flex items-center justify-center mx-auto mb-6",children:C.jsx(Td,{size:32,className:"text-white"})}),C.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Welcome to IPTV Player"}),C.jsxs("div",{className:"mb-6",children:[C.jsxs("div",{className:"flex gap-2",children:[C.jsx("input",{type:"text",placeholder:"Enter Playlist URL (http://...)",value:g,onChange:P=>p(P.target.value),spellCheck:!1,autoComplete:"off",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent outline-none text-gray-800",onKeyDown:P=>P.key==="Enter"&&M()}),C.jsx("button",{onClick:M,disabled:!g.trim(),className:"bg-gray-800 hover:bg-gray-700 disabled:bg-gray-400 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:"Load"})]}),C.jsxs("div",{className:"relative my-4",children:[C.jsx("div",{className:"absolute inset-0 flex items-center",children:C.jsx("div",{className:"w-full border-t border-gray-300"})}),C.jsx("div",{className:"relative flex justify-center text-sm",children:C.jsx("span",{className:"px-2 bg-white text-gray-500",children:"OR"})})]})]}),C.jsxs("label",{className:"block w-full cursor-pointer",children:[C.jsx("input",{type:"file",accept:".m3u,.m3u8",onChange:I,className:"hidden"}),C.jsxs("div",{className:"flex items-center justify-center gap-3 bg-orange-500 hover:bg-orange-600 text-white py-3 px-6 rounded-lg font-semibold transition-colors",children:[C.jsx(Td,{size:20}),"Select Playlist File"]})]}),C.jsxs("button",{onClick:()=>{y.url&&y.key?N():T(!0)},className:"flex items-center justify-center gap-3 bg-indigo-600 hover:bg-indigo-700 text-white py-3 px-6 rounded-lg font-semibold transition-colors mt-3 w-full",children:[C.jsx(M0,{size:20}),y.url&&y.key?"Connect to Database":"Load from Database"]}),C.jsx("p",{className:"mt-4 text-xs text-gray-500",children:"Supports .m3u and .m3u8 playlist files"})]})}),r.channels.length>0&&(l===null&&!c?C.jsx(Ik,{categories:r.categories,onSelectCategory:u,onLoadNewPlaylist:()=>{e({channels:[],groups:{},categories:{live:[],movie:[],series:[]}}),i(null),n("All"),u(null)}}):C.jsxs(C.Fragment,{children:[C.jsxs("div",{className:"absolute top-4 right-4 z-40 flex gap-2",children:[C.jsxs("button",{onClick:()=>{u(null),d(!1),i(null)},className:"bg-gray-800 hover:bg-gray-700 text-gray-200 px-4 py-2 rounded-lg border border-gray-700 shadow-sm transition-colors flex items-center gap-2",title:"Back to Categories",children:[C.jsx(B1,{size:16}),C.jsx("span",{className:"text-sm font-medium",children:"Back"})]}),C.jsx("button",{onClick:()=>{e({channels:[],groups:{},categories:{live:[],movie:[],series:[]}}),i(null),n("All"),u(null)},className:"bg-gray-800 hover:bg-gray-700 text-gray-200 p-2 rounded-lg border border-gray-700 shadow-sm transition-colors",title:"Load new playlist",children:C.jsx(Y1,{size:16})})]}),C.jsx(vw,{channels:z(),selectedChannel:s,onSelectChannel:b,onDeleteChannel:K,isPlaylistView:c,canDelete:!!f&&Or()}),C.jsx(wk,{channel:s,onPlaybackError:Q,autoSkipEnabled:v,onToggleAutoSkip:X})]}))]})}class G2 extends ry.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("Uncaught error:",e,t),this.setState({errorInfo:t})}render(){return this.state.hasError?C.jsxs("div",{style:{padding:20,backgroundColor:"#fef2f2",color:"#991b1b",height:"100vh",overflow:"auto"},children:[C.jsx("h1",{children:"Something went wrong."}),C.jsxs("details",{style:{whiteSpace:"pre-wrap"},children:[this.state.error&&this.state.error.toString(),C.jsx("br",{}),this.state.errorInfo&&this.state.errorInfo.componentStack]})]}):this.props.children}}Rc.createRoot(document.getElementById("root")).render(C.jsx(ry.StrictMode,{children:C.jsx(G2,{children:C.jsx(j2,{})})}));export{F_ as _};
